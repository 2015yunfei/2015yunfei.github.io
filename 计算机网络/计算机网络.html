<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>

<link href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color: #ffffff; --text-color: #333333; --select-text-bg-color: #B5D6FC; --select-text-font-color: auto; --monospace: "Lucida Console",Consolas,"Courier",monospace; --title-bar-height: 20px; }
.mac-os-11 { --title-bar-height: 28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
h1, h2, h3, h4, h5 { white-space: pre-wrap; }
body { margin: 0px; padding: 0px; height: auto; inset: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
thead, tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-fences-adv-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
svg { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; border-color: transparent !important; padding-top: 0px !important; padding-bottom: 0px !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
  #write > p:nth-child(1) { margin-top: 0px; }
  .typora-export-show-outline .typora-export-sidebar { display: none; }
  figure { overflow-x: visible; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.reversefootnote { font-family: ui-monospace, sans-serif; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.6; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
.md-expand mark .md-meta { opacity: 0.3 !important; }
mark .md-meta { color: rgb(0, 0, 0); }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-fences.md-fences-math { font-size: 1em; }
.md-fences-advanced:not(.md-focus) { padding: 0px; white-space: nowrap; border: 0px; }
.md-fences-advanced:not(.md-focus) { background: inherit; }
.typora-export-show-outline .typora-export-content { max-width: 1440px; margin: auto; display: flex; flex-direction: row; }
.typora-export-sidebar { width: 300px; font-size: 0.8rem; margin-top: 80px; margin-right: 18px; }
.typora-export-show-outline #write { --webkit-flex: 2; flex: 2 1 0%; }
.typora-export-sidebar .outline-content { position: fixed; top: 0px; max-height: 100%; overflow: hidden auto; padding-bottom: 30px; padding-top: 60px; width: 300px; }
@media screen and (max-width: 1024px) {
  .typora-export-sidebar, .typora-export-sidebar .outline-content { width: 240px; }
}
@media screen and (max-width: 800px) {
  .typora-export-sidebar { display: none; }
}
.outline-content li, .outline-content ul { margin-left: 0px; margin-right: 0px; padding-left: 0px; padding-right: 0px; list-style: none; overflow-wrap: anywhere; }
.outline-content ul { margin-top: 0px; margin-bottom: 0px; }
.outline-content strong { font-weight: 400; }
.outline-expander { width: 1rem; height: 1.42857rem; position: relative; display: table-cell; vertical-align: middle; cursor: pointer; padding-left: 4px; }
.outline-expander::before { content: ""; position: relative; font-family: Ionicons; display: inline-block; font-size: 8px; vertical-align: middle; }
.outline-item { padding-top: 3px; padding-bottom: 3px; cursor: pointer; }
.outline-expander:hover::before { content: ""; }
.outline-h1 > .outline-item { padding-left: 0px; }
.outline-h2 > .outline-item { padding-left: 1em; }
.outline-h3 > .outline-item { padding-left: 2em; }
.outline-h4 > .outline-item { padding-left: 3em; }
.outline-h5 > .outline-item { padding-left: 4em; }
.outline-h6 > .outline-item { padding-left: 5em; }
.outline-label { cursor: pointer; display: table-cell; vertical-align: middle; text-decoration: none; color: inherit; }
.outline-label:hover { text-decoration: underline; }
.outline-item:hover { border-color: rgb(245, 245, 245); background-color: var(--item-hover-bg-color); }
.outline-item:hover { margin-left: -28px; margin-right: -28px; border-left: 28px solid transparent; border-right: 28px solid transparent; }
.outline-item-single .outline-expander::before, .outline-item-single .outline-expander:hover::before { display: none; }
.outline-item-open > .outline-item > .outline-expander::before { content: ""; }
.outline-children { display: none; }
.info-panel-tab-wrapper { display: none; }
.outline-item-open > .outline-children { display: block; }
.typora-export .outline-item { padding-top: 1px; padding-bottom: 1px; }
.typora-export .outline-item:hover { margin-right: -8px; border-right: 8px solid transparent; }
.typora-export .outline-expander::before { content: "+"; font-family: inherit; top: -1px; }
.typora-export .outline-expander:hover::before, .typora-export .outline-item-open > .outline-item > .outline-expander::before { content: "−"; }
.typora-export-collapse-outline .outline-children { display: none; }
.typora-export-collapse-outline .outline-item-open > .outline-children, .typora-export-no-collapse-outline .outline-children { display: block; }
.typora-export-no-collapse-outline .outline-expander::before { content: "" !important; }
.typora-export-show-outline .outline-item-active > .outline-item .outline-label { font-weight: 700; }
.md-inline-math-container mjx-container { zoom: 0.95; }
mjx-container { break-inside: avoid; }
.md-alert.md-alert-note { border-left-color: rgb(9, 105, 218); }
.md-alert.md-alert-important { border-left-color: rgb(130, 80, 223); }
.md-alert.md-alert-warning { border-left-color: rgb(154, 103, 0); }
.md-alert.md-alert-tip { border-left-color: rgb(31, 136, 61); }
.md-alert.md-alert-caution { border-left-color: rgb(207, 34, 46); }
.md-alert { padding: 0px 1em; margin-bottom: 16px; color: inherit; border-left: 0.25em solid rgb(0, 0, 0); }
.md-alert-text-note { color: rgb(9, 105, 218); }
.md-alert-text-important { color: rgb(130, 80, 223); }
.md-alert-text-warning { color: rgb(154, 103, 0); }
.md-alert-text-tip { color: rgb(31, 136, 61); }
.md-alert-text-caution { color: rgb(207, 34, 46); }
.md-alert-text { font-size: 0.9rem; font-weight: 700; }
.md-alert-text svg { fill: currentcolor; position: relative; top: 0.125em; margin-right: 1ch; overflow: visible; }
.md-alert-text-container::after { content: attr(data-text); text-transform: capitalize; pointer-events: none; margin-right: 1ch; }


:root {
    --side-bar-bg-color: #fafafa;
    --control-text-color: #777;
}

@include-when-export url(https://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

/* open-sans-regular - latin-ext_latin */
  /* open-sans-italic - latin-ext_latin */
    /* open-sans-700 - latin-ext_latin */
    /* open-sans-700italic - latin-ext_latin */
  html {
    font-size: 16px;
    -webkit-font-smoothing: antialiased;
}

body {
    font-family: "Open Sans","Clear Sans", "Helvetica Neue", Helvetica, Arial, 'Segoe UI Emoji', sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
}

#write {
    max-width: 860px;
  	margin: 0 auto;
  	padding: 30px;
    padding-bottom: 100px;
}

@media only screen and (min-width: 1400px) {
	#write {
		max-width: 1024px;
	}
}

@media only screen and (min-width: 1800px) {
	#write {
		max-width: 1200px;
	}
}

#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}

a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}

/*@media print {
    .typora-export h1,
    .typora-export h2 {
        border-bottom: none;
        padding-bottom: initial;
    }

    .typora-export h1::after,
    .typora-export h2::after {
        content: "";
        display: block;
        height: 100px;
        margin-top: -96px;
        border-top: 1px solid #eee;
    }
}*/

h3 {
    font-size: 1.5em;
    line-height: 1.43;
}
h4 {
    font-size: 1.25em;
}
h5 {
    font-size: 1em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dfe2e5;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
    word-break: initial;
}
table tr {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n),
thead {
    background-color: #f8f8f8;
}
table th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    margin: 0;
    padding: 6px 13px;
}
table td {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 6px 13px;
}
table th:first-child,
table td:first-child {
    margin-top: 0;
}
table th:last-child,
table td:last-child {
    margin-bottom: 0;
}

.CodeMirror-lines {
    padding-left: 4px;
}

.code-tooltip {
    box-shadow: 0 1px 1px 0 rgba(0,28,36,.3);
    border-top: 1px solid #eef2f2;
}

.md-fences,
code,
tt {
    border: 1px solid #e7eaed;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}

code {
    background-color: #f3f4f4;
    padding: 0 2px 0 2px;
}

.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding-top: 8px;
    padding-bottom: 6px;
}


.md-task-list-item > input {
  margin-left: -1.3em;
}

@media print {
    html {
        font-size: 13px;
    }
    pre {
        page-break-inside: avoid;
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

.md-mathjax-midline {
    background: #fafafa;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    /*border: 1px solid #ddd;*/
    border-radius: 3px;
    padding: 2px 0px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag {
    color: #a7a7a7;
    opacity: 1;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

.sidebar-tabs {
    border-bottom: none;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

/** focus mode */
.on-focus-mode blockquote {
    border-left-color: rgba(85, 85, 85, 0.12);
}

header, .context-menu, .megamenu-content, footer{
    font-family: "Segoe UI", "Arial", sans-serif;
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state{
    visibility: visible;
}

.mac-seamless-mode #typora-sidebar {
    background-color: #fafafa;
    background-color: var(--side-bar-bg-color);
}

.mac-os #write{
    caret-color: AccentColor;
}

.md-lang {
    color: #b4654d;
}

/*.html-for-mac {
    --item-hover-bg-color: #E6F0FE;
}*/

#md-notification .btn {
    border: 0;
}

.dropdown-menu .divider {
    border-color: #e5e5e5;
    opacity: 0.4;
}

.ty-preferences .window-content {
    background-color: #fafafa;
}

.ty-preferences .nav-group-item.active {
    color: white;
    background: #999;
}

.menu-item-container a.menu-style-btn {
    background-color: #f5f8fa;
    background-image: linear-gradient( 180deg , hsla(0, 0%, 100%, 0.8), hsla(0, 0%, 100%, 0)); 
}



mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
  min-height: 1px;
  min-width: 1px;
}

mjx-container[jax="SVG"] > svg a {
  fill: blue;
  stroke: blue;
}

mjx-assistive-mml {
  position: absolute !important;
  top: 0px;
  left: 0px;
  clip: rect(1px, 1px, 1px, 1px);
  padding: 1px 0px 0px 0px !important;
  border: 0px !important;
  display: block !important;
  width: auto !important;
  overflow: hidden !important;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

mjx-assistive-mml[display="block"] {
  width: 100% !important;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][display="true"][width="full"] {
  display: flex;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line], svg[data-table] > g > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame], svg[data-table] > g > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed, svg[data-table] > g > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted, svg[data-table] > g > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > g > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

mjx-container[jax="SVG2"] path[data-c], mjx-container[jax="SVG2"] use[data-c] {
  stroke-width: 3;
}

g[data-mml-node="xypic"] path {
  stroke-width: inherit;
}

.MathJax g[data-mml-node="xypic"] path {
  stroke-width: inherit;
}
mjx-container[jax="SVG"] path[data-c], mjx-container[jax="SVG"] use[data-c] {
							stroke-width: 0;
						}
</style><title>计算机网络</title>
</head>
<body class='typora-export os-windows'><div class='typora-export-content'>
<div id='write'  class=''><h1 id='考试范围'><span>考试范围</span></h1><p><span>说明：</span>
<span>下列为按教材章节标示的本次考试范围（不代表考研等其他考试）。</span>
<span>如果节（x.y）下面不列小节(x.y.z)，则该节的所有小节都包含；</span>
<span>如果节（x.y）下面列出小节(x.y.z)，则该节列出的小节包含，其他小节不包含；</span>
<span>PPT课件属于对应章节的就在范围内，不属于这些章节的PPT不考。</span></p><p><span>第1章 计算机网络和因特网</span>
<span>1.1 什么是因特网</span>
<span>1.2 网络边缘</span>
<span>1.3 网络核心</span>
<span>1.4 分组交换网中的时延、丢包和吞吐量</span>
<span>1.5 协议层次及其服务模型</span></p><p><span>第2章 应用层</span>
<span>2.1 应用层协议原理</span>
<span>2.2 Web和HTTP</span>
<span>2.2.1 HTTP概况</span>
<span>2.2.2 非持续连接和持续连接</span>
<span>2.2.3 HTTP报文格式</span>
<span>2.2.4 用户与服务器的交互：cookie</span>
<span>2.4 DNS：因特网的目录服务</span></p><p><span>第3章 运输层</span>
<span>3.1 概述和运输层服务</span>
<span>3.2 多路复用与多路分解</span>
<span>3.3 无连接运输：UDP</span>
<span>3.4 可靠传输原理</span>
<span>3.5 面向连接的运输：TCP</span>
<span>3.6 拥塞控制原理</span>
<span>3.7 TCP拥塞控制</span></p><p><span>第4章 网络层：数据平面</span>
<span>4.1 网络层概述</span>
<span>4.2 路由器工作原理</span>
<span>4.3 网际协议：IPv4、寻址、IPv6及其他</span></p><p><span>第5章 网络层：控制平面</span>
<span>5.2 路由选择算法</span>
<span>5.3 因特网自治系统内部的路由选择：OSPF</span>
<span>5.4 ISP之间的路由选择：BGP</span>
<span>5.6 ICMP：因特网控制报文协议</span></p><p><span>第6章 链路层和局域网</span>
<span>6.1 链路层概述</span>
<span>6.2 差错检测和纠正技术</span>
<span>6.3 多路访问链路和协议</span>
<span>6.3.1 信道划分协议</span>
<span>6.3.2 随机接入协议</span>
<span>6.3.3 轮流协议</span>
<span>6.4 交换局域网</span>
<span>6.7 回顾：Web页面请求的历程</span></p><p>&nbsp;</p><h1 id='第1章-计算机网络和因特网'><span>第1章 计算机网络和因特网</span></h1><h2 id='什么是因特网'><span>什么是因特网</span></h2><p><span>因特网为应用程序提供服务的基础设施。</span></p><p><span>因特网为应用程序提供编程接口（API）</span></p><ul><li><p><span>应用程序连接到因特网上的通道</span></p></li><li><p><span>提供不同级别的服务选项</span></p><ul><li><p><span>服务方式</span></p></li><li><p><span>服务质量</span></p></li></ul></li></ul><p>&nbsp;</p><p><span>人类之间交流的语言（协议）</span></p><p><span>计算机之间交流的语言（协议）</span></p><ul><li><p><span>语法</span></p></li><li><p><span>语义</span></p></li><li><p><span>同步</span></p></li></ul><p>&nbsp;</p><p><span>一个协议定义了在两个或者多个通信实体之间交换的报文格式和次序，以及报文发送和/或接收一条报文或其他事件所采取的动作。</span></p><p>&nbsp;</p><h3 id='osi'><span>OSI</span></h3><p>&nbsp;</p><blockquote><p><span>在计算机网络中，OSI指的是&quot;开放系统互连&quot;（Open Systems Interconnection）。</span></p><p><span>OSI是一个由国际标准化组织（ISO）制定的网络参考模型，旨在定义计算机网络中不同层次的功能和协议。该模型将计算机网络的通信过程划分为七个不同的层次，每个层次都有其特定的功能和任务。每个层次在通信过程中通过接口与上下两个相邻层次进行交互。</span></p><p><span>以下是OSI模型的七个层次：</span></p><ol start='' ><li><p><span>物理层（Physical Layer）：处理物理介质上的比特传输，如电压、电流和光信号等。</span></p></li><li><p><span>数据链路层（Data Link Layer）：提供可靠的数据传输，通过帧的形式将数据划分为数据块。</span></p></li><li><p><span>网络层（Network Layer）：负责数据包的路由和转发，实现网络间的逻辑通信。</span></p></li><li><p><span>传输层（Transport Layer）：提供端到端的可靠数据传输，负责数据分段、流量控制和错误恢复等。</span></p></li><li><p><span>会话层（Session Layer）：建立、管理和终止会话连接，为应用程序之间的通信提供协调和同步。</span></p></li><li><p><span>表示层（Presentation Layer）：处理数据的表示和转换，确保不同系统的数据格式能够互相理解。</span></p></li><li><p><span>应用层（Application Layer）：提供应用程序与网络之间的接口，支持特定的网络应用和服务。</span></p></li></ol><p><span>OSI模型为不同厂商和组织开发网络设备和协议提供了一个通用的参考框架。尽管在实际网络中并不都严格遵循OSI模型的七层结构，但该模型仍然是理解计算机网络和协议的基础概念之一。</span></p></blockquote><p>&nbsp;</p><h2 id='网络边缘'><span>网络边缘</span></h2><p><span>主机：客户端和服务器</span></p><p><span>数据中心的服务器</span></p><p>&nbsp;</p><h3 id='网络边缘的构成'><span>网络边缘的构成</span></h3><p><span>端系统（主机）：运行应用程序，如：IE、Foxmail等</span></p><p>&nbsp;</p><p><span>我们通常说的“服务器”（例如淘宝服务器）在网络结构中属于网络核心还是网络边缘？</span></p><blockquote><p><span>一般情况下，我们通常将像淘宝服务器这样的服务器归类为网络边缘设备，而不是网络核心设备。</span></p><p><span>在计算机网络中，网络边缘指的是用户或终端设备连接到互联网或内部网络的地方。这包括个人计算机、智能手机、服务器、路由器等设备。边缘设备负责与用户进行交互，处理用户请求和提供服务。</span></p><p><span>相比之下，网络核心是指连接网络中各个边缘设备的主干网络部分。它由高速路由器、交换机和其他中央设备组成，用于传输数据和路由流量。</span><strong><span>网络核心设备负责在边缘设备之间进行数据转发和路由决策。</span></strong></p><p><span>淘宝服务器作为提供服务的设备，处于网络边缘位置。它处理用户的请求、存储商品信息、处理交易等。虽然淘宝服务器可能连接到网络核心设备，但从角色和功能上来说，它更符合网络边缘设备的定义。</span></p><p><span>需要注意的是，这只是一种常见的分类方法，并不意味着所有服务器都只属于网络边缘。在复杂的网络架构中，可能会有一些服务器部署在网络核心，用于负载均衡、缓存、路由等关键功能。因此，在具体的网络环境中，服务器的位置可能会有所不同。</span></p></blockquote><p>&nbsp;</p><h3 id='网络应用的通信模型'><span>网络应用的通信模型</span></h3><p><span>客户/服务器模型（C/S）：</span></p><ul><li><p><span>客户：使用服务者</span></p></li><li><p><span>服务器：提供服务者</span></p></li></ul><p>&nbsp;</p><p><span>对等模型（P2P）</span></p><ul><li><p><span>所有的主机同时承担服务器和客户机的双重身份</span></p></li></ul><p>&nbsp;</p><h3 id='接入网的作用'><span>接入网的作用</span></h3><p><span>将网络边缘与网络核心连接起来，通常是将端系统连接到边缘路由器上。</span></p><p><span>边缘路由器：端系统到任何其它远程端系统的路径上的第一台路由器。</span></p><p>&nbsp;</p><blockquote><p><a href='https://mooc1.chaoxing.com/mooc2/work/view?courseId=233435142&amp;classId=74377116&amp;cpi=200104603&amp;workId=26168279&amp;answerId=51539574&amp;enc=d9c417f55a7cbac1551040040181cf84' target='_blank' class='url'>https://mooc1.chaoxing.com/mooc2/work/view?courseId=233435142&classId=74377116&cpi=200104603&workId=26168279&answerId=51539574&enc=d9c417f55a7cbac1551040040181cf84</a></p></blockquote><p><strong><span>接入网是指将端系统物理连接到边缘路由器的网络</span></strong></p><p><strong><span>边缘路由器是指端系统到任何其它远程系统路径上的第一台路由器</span></strong></p><p><strong><span>ADSL是指：非对称数字用户线</span></strong></p><p><span>从构成因特网的硬件角度，因特网有以下哪几部分构成呢？</span></p><ul><li><p><span>端系统</span></p></li><li><p><span>交换设备（路由器、链路层交换机等）</span></p></li><li><p><span>通信链路</span></p></li></ul><p>&nbsp;</p><p><span>因特网作为为应用程序提供服务的基础设施，以下那些说法是正确的？</span></p><ul><li><p><span>因特网为应用程序提供网络编程接口（API）</span></p></li><li><p><span>因特网为应用程序提供数据交互服务</span></p></li><li><p><span>因特网能够为应用程序提供不同种类、不同质量的服务</span></p></li></ul><p>&nbsp;</p><p><span>网络协议包含下面的那些要素：</span></p><ul><li><p><span>语义</span></p></li><li><p><span>语法</span></p></li><li><p><span>同步</span></p></li></ul><p>&nbsp;</p><p><span>网络应用程序的通信模型一般包括：</span></p><ul><li><p><span>C/S模型</span></p></li><li><p><span>P2P模型</span></p></li><li><p><span>混合模型</span></p></li></ul><p>&nbsp;</p><h3 id='接入的方式'><span>接入的方式</span></h3><p><span>家庭：Modem拨号/ADSL拨号/HFC/FTTH/卫星</span></p><p><span>企业：以太网/Wi-Fi</span></p><p><span>广域无线接入：3G/LTE/5G</span></p><p>&nbsp;</p><h4 id='modem拨号'><span>Modem拨号</span></h4><p><span>通过本地电话回路点对点连接ISP的拨号池（通常是路由器）</span></p><p><span>无法实现在上网的同时拨打电话</span></p><p>&nbsp;</p><h4 id='dsl数字用户线'><span>DSL：数字用户线</span></h4><p><span>下行/上行速率最高可达55Mbps/15Mbps</span></p><ul><li><p><span>频分复用：</span></p><ul><li><p><span>0kHz—4kHz：语音</span></p></li><li><p><span>4kHz—50kHz：上行</span></p></li><li><p><span>50kHz—1MHz：下行</span></p></li></ul></li><li><p><span>带宽独享</span></p></li></ul><p>&nbsp;</p><h4 id='光纤同轴电缆混合网络hfc'><span>光纤同轴电缆混合网络HFC</span></h4><p><span>HFC (Hybrid Fiber Coaxial Cable) </span></p><p><span>下行/上行速率最高可达40Mbps/30Mbps</span></p><p><span>通过有线电视网络部署</span></p><p><span>带宽共享</span></p><p>&nbsp;</p><h4 id='局域网接入'><span>局域网接入</span></h4><p><span>公司/大学的局域网 (LAN) 将端系统连接到边缘路由器</span></p><p>&nbsp;</p><h4 id='无线接入'><span>无线接入</span></h4><p><span>共享的无线接入网络连接端系统和路由器</span></p><ul><li><p><span>通过基站（无线接入点）</span></p></li></ul><p>&nbsp;</p><h4 id='常用的物理媒体'><span>常用的物理媒体</span></h4><p><span>导向媒体/非导向媒体</span></p><p><span>新型的物理媒体</span></p><p>&nbsp;</p><p><span>物理媒体分类：</span></p><ul><li><p><span>导引型媒体：信号沿着固体媒体被导引</span></p></li><li><p><span>非导引型媒体：信号自由传播</span></p></li></ul><p>&nbsp;</p><p><span>导引型媒体：</span></p><ul><li><p><span>双绞线：两根互相绝缘的铜导线</span></p><ul><li><p><span>3类线：传统的电话线， 10Mbps以太网</span></p></li><li><p><span>5类线：100Mbps以太网</span></p></li><li><p><span>6类线：1Gbps以太网</span></p></li></ul></li><li><p><span>同轴电缆</span></p><ul><li><p><span>双向传输</span></p></li><li><p><span>基带</span></p><ul><li><p><span>电缆上单信道</span></p></li><li><p><span>以太网</span></p></li></ul></li><li><p><span>宽带</span></p></li></ul></li><li><p><span>光缆</span></p><ul><li><p><span>在玻璃光纤传播光脉冲，每一个脉冲一比特</span></p></li><li><p><span>高速运行</span></p></li><li><p><span>低误码率：中继器相隔很远； 不受电磁干扰</span></p></li></ul></li></ul><p>&nbsp;</p><p><span>非导引型媒体：无线电</span></p><p><span>无线电的特性：</span></p><ol start='' ><li><p><span>通过电磁频谱传播信号</span></p></li><li><p><span>没有物理“线路”</span></p></li><li><p><span>双向传输</span></p></li><li><p><span>传播受到环境影响</span></p></li></ol><p>&nbsp;</p><h2 id='网络核心'><span>网络核心</span></h2><p><span>路由器</span></p><p><span>网络的网络</span></p><p>&nbsp;</p><p><span>基本问题：数据是怎样通过网络传输的？</span></p><p>&nbsp;</p><p><span>第一代计算机网络——电路交换网络</span></p><ul><li><p><span>数据交换前需建立起一条从发端到收端的电路（预留资源）</span></p></li><li><p><span>在数据交换的全部时间内用户始终占用端到端的固定传输信道</span></p></li><li><p><span>交换双方可实时进行数据交换而不会存在任何延迟</span></p></li></ul><p><span>电路交换涉及到TDM、FDM</span></p><p><span>电路交换存在的问题：</span></p><ul><li><p><span>计算机之间的数据交换往往具有突发性和间歇性特征，而对电路交换而言，用户支付的费用则是按用户占用线路的时间来收费的。</span></p></li><li><p><span>不够灵活。只要在通话双方建立的通路中的任何一点出了故障，就必须重新拨号建立新的连接，这对紧急和重要通信是很不利的。</span></p></li></ul><p>&nbsp;</p><p><span>第二代计算机网络--分组交换网络</span></p><p><span>数据截断划分成分组，由分组交换机（路由器）转发分组，使用链路最大传输速率传输。</span></p><p><span>分组传输的模式：存储转发传输</span></p><p><span>什么是存储转发：分组交换机（链路层交换机或路由器）将整个分组收下并存储，存储后再发出去</span></p><p><strong><span>为什么要存储后再转发</span></strong><span>：校验</span></p><p><span>分组交换网络的特征：</span></p><ul><li><p><span>数据分成若干分组分别传送</span></p></li><li><p><span>不必预先确定分组的传输路径</span></p></li><li><p><span>交换结点均为共享结点，选择路径</span></p></li><li><p><span>存储/转发</span></p></li><li><p><span>断续(动态)分配传输带宽</span></p></li><li><p><span>网状拓扑结构——提高可靠性</span></p></li><li><p><span>主干线路往往由一些高速链路构成</span></p></li></ul><p>&nbsp;</p><p><span>存储转发的效率及可靠性：</span></p><ul><li><p><span>传输时延（发送时延）：将分组推向链路的时间，L/R，其中 R为链路带宽</span></p></li><li><p><span>排队时延：存储需要缓存，缓存的过程中可能需要排队（等待前面的分组处理）</span></p></li><li><p><span>分组丢失：缓存满，随即丢弃</span></p></li></ul><p>&nbsp;</p><h2 id='分组交换网中的时延丢包和吞吐量'><span>分组交换网中的时延、丢包和吞吐量</span></h2><h3 id='时延'><span>时延</span></h3><p><span>时延：在路由器缓存中的分组队列，分组到达输入链路的速率超出输出链路能力。</span></p><p>&nbsp;</p><ul><li><p><span>节点处理时延d</span><sub><span>proc</span></sub></p><ul><li><p><span>检测比特差错</span></p></li><li><p><span>确定输出链路</span></p></li></ul></li><li><p><span>排队时延d</span><sub><span>queue</span></sub></p><ul><li><p><span>在输出链路中等待被发送</span></p></li><li><p><span>取决于路由器的拥塞程度</span></p></li></ul></li><li><p><span>传输时延d</span><sub><span>trans</span></sub></p><ul><li><p><span>R=链路带宽 (bps)、L=分组长度 (bits)</span></p></li><li><p><span>将分组比特流发送到链路上的时间 = L/R</span></p></li></ul></li><li><p><span>传播时延d</span><sub><span>prop</span></sub></p><ul><li><p><span>d = 物理链路的长度</span></p></li><li><p><span>s = 媒体中的传播速度 (~2x10</span><sup><span>8</span></sup><span> 米/秒)</span></p></li><li><p><span>传播时延= d / s</span></p></li><li><p><span>注意:传输时延和传播时延是两个完全不同的概念</span></p></li></ul></li></ul><p>&nbsp;</p><p><span>假定:</span></p><ul><li><p><span>R=链路带宽 (bps)</span></p></li><li><p><span>L=分组长度 (bits)</span></p></li><li><p><span>a=平均分组到达速率</span></p></li></ul><p><span>流量强度：La/R</span></p><ul><li><p><span>La/R ~ 0: 平均排队时延很小，甚至为0</span></p></li><li><p><span>La/R &lt; 1: 时延较小，且会随时间推延而变小</span></p></li><li><p><span>La/R = 1: 时延不会变化，具体数值取决于当时队列长度</span></p></li><li><p><span>La/R &gt; 1: 平均时延较大，且随时间推延而趋于无穷！</span></p></li></ul><p>&nbsp;</p><h3 id='丢包'><span>丢包</span></h3><p><span>缓存中队列的容量是有限的，当分组到达时队列已满，则分组被丢弃 (丢失)。丢失的分组可能会被前一个节点、源端系统重新传输，或者根本不重传。</span></p><p>&nbsp;</p><h3 id='吞吐量'><span>吞吐量</span></h3><p><span>两种吞吐量：</span></p><ul><li><p><span>瞬时吞吐量：任何时刻接收文件的速率</span></p></li><li><p><span>平均吞吐量：接收整个文件的平均速率</span></p></li></ul><p>&nbsp;</p><p><span>瓶颈链路：在端到端路径上限制了端到端平均吞吐量的那一段链路。</span></p><p>&nbsp;</p><h2 id='协议层次及其服务模型'><span>协议层次及其服务模型</span></h2><p><span>层次: 每个层次实现一种服务，即通过该层次自身的行为，其依赖下一层所提供的服务。</span></p><p><span>协议：控制报文的发送和接收。例如：TCP, IP, HTTP, FTP, PPP。</span></p><p>&nbsp;</p><p><span>基本概念</span></p><p><span>实体(Entity)：实体是任何可以发送和接收信息的硬件和软件进程。通常是一个特定的软件模块。</span></p><p><span>对等体(Peer)：不同机器上包含对应层的实体称为对等体。</span></p><p><span>协议(Protocol)：</span></p><ul><li><p><span>语法，即数据与控制信息的结构或格式。</span></p></li><li><p><span>语义，即需发现何种控制信息，完成何种动作以及做出何种应答。</span></p></li><li><p><span>同步，即事件实现顺序的详细说明。</span></p></li></ul><p><span>服务(Service)：为保证上层对等体之间能互相通信，下层向上层提供的功能。</span></p><p><span>服务原语：指网络相邻层间进行交互时所要交换的一些必要命令。</span></p><p><span>服务访问点(SAP)：是同一系统中相邻两层的实体进行交互的地方。</span></p><p><span>协议数据单元(PDU)：是对等层次上传送数据的单位。</span></p><p><span>服务数据单元(SDU)：是层与层之间交换数据的单位。</span></p><p><span>网络体系结构(Network Architecture)：是层和协议的集合。</span></p><p><span>协议栈(Protocol Stack)：一个特定的系统所使用的一组协议（每层一个协议）称为协议栈。</span></p><p>&nbsp;</p><blockquote><p><a href='https://mooc1.chaoxing.com/mooc2/work/view?courseId=233435142&amp;classId=74377116&amp;cpi=200104603&amp;workId=26432664&amp;answerId=51551255&amp;enc=6a3c97fd05305aea5d3cdfd9884cc1ed' target='_blank' class='url'>https://mooc1.chaoxing.com/mooc2/work/view?courseId=233435142&classId=74377116&cpi=200104603&workId=26432664&answerId=51551255&enc=6a3c97fd05305aea5d3cdfd9884cc1ed</a></p></blockquote><p><span>网络协议主要是约束对等体之间通信行为的规范</span></p><p><span>网络协议的语义和语法主要体现为报文格式</span></p><p><span>所谓协议栈是指一个特定系统使用的一组协议</span></p><p>&nbsp;</p><p><span>关于网络协议分层，以下说法正确的是：ABCD</span></p><p><span>A. 可能造成功能的重叠</span></p><p><span>B. 在特殊情况下，某一层的功能实现可能需要使用其它层的信息</span></p><p><span>C. 可以使系统具有更好的可扩展性</span></p><p><span>D. 一个层次可以仅对其他层次提供调用服务的接口，而隐藏实现服务的细节。</span></p><p>&nbsp;</p><h1 id='第2章-应用层'><span>第2章 应用层</span></h1><h2 id='应用层协议原理'><span>应用层协议原理</span></h2><p><span>进程：在端系统运行起来的程序，一个程序可能产生多个进程</span></p><ul><li><p><span>同一台主机上的不同多个进程之间的通信采用的是内部进程通信方式（操作系统决定）</span></p></li><li><p><span>不同主机之间的进程通信采用报文交换方式（应用层协议）</span></p></li></ul><p>&nbsp;</p><p><span>应用层协议 ≠ 网络应用</span></p><p>&nbsp;</p><h3 id='套接字socket'><span>套接字socket</span></h3><p><span>当新的网络应用程序Run起来后，就变成了网络应用进程。产生了如下问题：</span></p><ul><li><p><span>当新的网络应用和其它网络应用共同运行在一台主机上时，如何把新的网络应用区分开来？</span></p></li><li><p><span>通信子网只负责把数据交付到主机，并不负责把数据交付到应用，主机如何知道数据该交付到哪个网络应用？</span></p><ul><li><p><span>操作系统（单机）是如何处理这些问题的</span></p></li></ul></li></ul><p>&nbsp;</p><p><span>解决方法 “</span><strong><span>套接字</span></strong><span>（Socket）”</span></p><p><span>每个网络应用进程都有一个属于自己的套接字，该套接字在整个因特网上独一无二：</span></p><ul><li><p><span>主机地址：标识该网络应用进程运行在因特网上哪一台主机上，通常使用32位的IP地址进行标识</span></p></li><li><p><span>端口地址：在该主机上标示该网络应用进程，通常使用16位的端口号进行标识</span></p></li><li><p><span>因此套接字的长度为48位</span></p></li></ul><p>&nbsp;</p><p><span>进程通过套接字来接收和发送报文。套接字相当于一个门，发送进程将报文”推出”门，发送进程依赖门另一边的传输基础设施（传输层及以下）来投递数据到接收进程的套接字</span></p><p>&nbsp;</p><p><span>UDP的套接字由一个二元组（目的IP地址和目的端口号）来标识</span></p><p><span>TCP的套接字由一个四元组（源IP地址、源端口号、目的IP地址、目的端口号）来标识</span></p><p>&nbsp;</p><p><span>UDP的一个服务器进程只用一个套接字跟所有客户端发送和接收数据</span></p><p><span>TCP的一个服务器进程跟每个客户端用不同的套接字发送和接收数据</span></p><p>&nbsp;</p><h3 id='传输服务'><span>传输服务</span></h3><p><span>因特网运输层将所提供的服务整合成两类传输服务，你的网络应用使用哪一类传输服务，你该做出决定了！</span></p><p><span>TCP：</span></p><ul><li><p><span>面向连接：在客户端和服务器进程之间需要建立连接</span></p></li><li><p><span>可靠传输：在发送和接受进程之间</span></p></li><li><p><span>流量控制：发送数据的速度决不超过接收的速度</span></p></li><li><p><span>拥塞控制：当网络超负荷时，束紧发送端口，减缓发送速度</span></p></li><li><p><span>不提供：实时性, 最小带宽承诺</span></p></li></ul><p>&nbsp;</p><p><span>UDP：</span></p><ul><li><p><span>在客户端和服务器进程之间实现“不可靠的”数据传输</span></p></li><li><p><span>不提供：连接建立，可靠性保证，流量控制，拥塞控制，实时性，最小带宽承诺</span></p></li></ul><p>&nbsp;</p><h3 id='安全性'><span>安全性</span></h3><p><span>TCP/UDP天生不具备安全性，如果你敢把密码以明文送给TCP/UDP，TCP/UDP就敢把明文送给网络</span></p><p>&nbsp;</p><h2 id='web和http'><span>Web和HTTP</span></h2><p><strong><span>特别说明：WEB属于C/S模式</span></strong></p><p><span>HTML文件是Web页面的基础，它可以包括各种各样的对象，是一个容器对象，任何一个对象都可以用 URL来定位</span></p><p>&nbsp;</p><h2 id='http概况'><span>HTTP概况</span></h2><p><span>协议：</span></p><ul><li><p><span>信息表达的协议——HTML</span></p></li><li><p><span>信息传输的协议——HTTP</span></p></li></ul><p>&nbsp;</p><h2 id='非持续连接和持续连接'><span>非持续连接和持续连接</span></h2><ul><li><p><span>HTTP1.0的传输模式——非持久性连接</span></p></li><li><p><span>HTTP1.1的新传输模式——持久连接</span></p><ul><li><p><span>非流水线方式：一个对象传输完成方能传输下一个</span></p></li><li><p><span>流水线方式：可以一次性发送所有请求，慢慢接收</span></p></li></ul></li></ul><p>&nbsp;</p><h2 id='http报文格式'><span>HTTP报文格式</span></h2><p><img src="./库/image-20230523132027245.png" alt="image-20230523132027245" style="zoom: 25%;" /></p><p>&nbsp;</p><h3 id='http请求行支持的方法'><span>HTTP请求行支持的方法</span></h3><p><span>HTTP1.0 定义的方法：</span></p><ul><li><p><span>GET：向服务器请求指定URL的对象</span></p></li><li><p><span>POST：</span></p><ul><li><p><span>用于向服务器提交表单数据</span></p></li><li><p><span>也可以同时请求一个WEB页面</span></p></li><li><p><span>特别注意：可以不使用POST方法，而使用GET方法发送表单数据以获取新的WEB页面。e.g. 搜索引擎</span></p></li></ul></li><li><p><span>HEAD：请求服务器返回一个响应报文，但是该报文中并不包含请求的对象。该方法常常用来进行故障跟踪。</span></p></li></ul><p>&nbsp;</p><p><span>HTTP1.1新定义的方法：</span></p><ul><li><p><span>PUT：上传的文件放在实体主体字段中，目标路径由URL字段标明</span></p></li><li><p><span>DELETE：删除URL字段中指定的文件</span></p></li><li><p><span>另一种上传数据的方式：</span></p><ul><li><p><span>使用GET方法</span></p></li><li><p><span>将需要上传的数据放到URL中</span></p></li></ul></li></ul><p>&nbsp;</p><p><span>关于http响应报文，以下说法正确的是：ABCD</span></p><p><span>A. 状态码和状态短语表达的意思是一致的</span></p><p><span>B. 状态行和首部行构成了整个响应报文的首部</span></p><p><span>C. 空行作为http报文首部与数据部分的界限标志</span></p><p><span>D. 允许只有首部没有数据的http响应报文存在</span></p><p>&nbsp;</p><p><span>Web中的cookie机制，有以下那些部分组成：ABCD</span></p><p><span>A. http请求报文中与Cookie相关的首部行</span></p><p><span>B. http响应报文中与Cookie相关的首部行</span></p><p><span>C. 由客户端负责管理的Cookie文件</span></p><p><span>D. 服务器后端的数据库系统</span></p><p>&nbsp;</p><h2 id='用户与服务器的交互cookie'><span>用户与服务器的交互：cookie</span></h2><p><span>WEB站点使用Cookie的目的：</span></p><ul><li><p><span>限制用户的访问</span></p></li><li><p><span>把内容和用户身份关联起来</span></p></li></ul><p>&nbsp;</p><p><span>Cookie技术的组成部分：</span></p><ul><li><p><span>在HTTP响应报文中有一个Cookie首部行</span></p></li><li><p><span>在HTTP请求报文中也有一个Cookie首部行</span></p></li><li><p><span>在用户的端系统中保留了一个Cookie文件，由用户浏览器负责管理</span></p></li><li><p><span>在Web站点有一个后端数据库</span></p></li></ul><p>&nbsp;</p><h2 id='dns因特网的目录服务'><span>DNS：因特网的目录服务</span></h2><p><span>IP 地址和域名之间如何映射(转换) ?为此设计了DNS系统，用于IP地址和域名之间的转换。</span></p><p>&nbsp;</p><p><span>DNS是一个分布式数据库，由很多台DNS服务器按照层次结构组织起来</span></p><p><span>DNS运行在端到端系统上，且使用</span><strong><span>UDP</span></strong><span>协议（53号端口）进行报文传输，因此DNS是</span><strong><span>应用层协议</span></strong></p><p><span>DNS以</span><strong><span>C/S</span></strong><span>的模式工作</span></p><p><span>DNS不直接和用户打交道，而是因特网的核心功能</span></p><p>&nbsp;</p><p><span>严格的讲，本地DNS服务器其并不属于DNS层次结构中的一层</span></p><ul><li><p><span>每一个网络服务提供商都会提供一个本地DNS服务器，有时候，我们将其称为“默认DNS服务器”</span></p></li><li><p><span>当一台主机需要做一个域名查询的时候，查询请求首先被发送到本地域名服务器</span></p></li><li><p><span>本地域名服务器的行为就像一个代理，它会向域名的层次体系中进行进一步的域名查询。</span></p></li></ul><p>&nbsp;</p><p><span>发起请求使用递归查询，后续解析为迭代查询</span></p><p>&nbsp;</p><h3 id='dns可提供的服务'><span>DNS可提供的服务</span></h3><ol start='' ><li><p><span>域名到IP地址的转换</span></p></li><li><p><span>主机/邮件服务器别名</span></p></li><li><p><span>负载均衡</span></p><ul><li><p><span>一个域名对应多个IP</span></p></li><li><p><span>DNS服务器在多个IP中进行轮转</span></p></li></ul></li></ol><p>&nbsp;</p><h3 id='攻击dns服务器'><span>攻击DNS服务器</span></h3><ul><li><p><span>DDoS攻击</span></p><ul><li><p><span>通过ICMP Ping洪泛攻击根DNS服务器——难以成功</span></p><ul><li><p><span>根服务器通常配备分组过滤器</span></p></li><li><p><span>大多数本地DNS服务器缓存了TLD DNS服务器的地址</span></p></li></ul></li><li><p><span>通过DNS请求报文洪泛攻击TLD DNS服务器</span></p><ul><li><p><span>难以过滤</span></p></li></ul></li></ul></li><li><p><span>重定向攻击</span></p><ul><li><p><span>DNS劫持攻击——攻击者截获来自主机的请求并返回伪造的回答</span></p></li><li><p><span>DNS毒害攻击——攻击者想一台DNS服务器发送伪造的回答，诱使服务器在它的缓存中接收伪造的记录。</span></p></li></ul></li><li><p><span>利用DNS服务器对目标主机采用DDoS攻击——反射攻击</span></p></li></ul><p>&nbsp;</p><h1 id='第3章-运输层'><span>第3章 运输层</span></h1><h2 id='概述和运输层服务'><span>概述和运输层服务</span></h2><p><span>为不同主机上运行的应用进程之间提供逻辑通信(logical communication)。</span></p><p>&nbsp;</p><p><span>运输层和网络层的区别：</span></p><ul><li><p><span>网络层: 不同主机之间的逻辑通信</span></p></li><li><p><span>运输层: 应用进程之间的逻辑通信</span></p></li></ul><p>&nbsp;</p><p><span>因特网上的运输层协议：</span></p><ol start='' ><li><p><span>用户数据报协议UDP（数据报）</span></p></li><li><p><span>传输控制协议TCP（报文段）</span></p></li></ol><p>&nbsp;</p><h2 id='多路复用与多路分解'><span>多路复用与多路分解</span></h2><p><img src="./库/image-20230522102726225.png" alt="image-20230522102726225" style="zoom:33%;" /></p><p>&nbsp;</p><h3 id='端口'><span>端口</span></h3><p><span>端口的作用就是让应用层的各种应用进程都能将其数据通过端口向下交付给运输层，以及让运输层知道应当将其报文段中的数据向上通过端口交付给应用层相应的进程（或者线程）。</span></p><p>&nbsp;</p><p><span>从这个意义上讲，端口是用来标志应用层的进程（或者线程）。</span></p><p><span>端口用一个 16 bit 端口号进行标志。</span></p><p>&nbsp;</p><h3 id='套接字'><span>套接字</span></h3><p><span>TCP 使用“连接”(而不仅仅是“端口”)作为最基本的抽象，同时将TCP 连接的端点称为套接字(socket) 。</span></p><p><span>套接字和端口、IP 地址的关系是：</span></p><p><img src="./库/image-20230522102912721.png" alt="image-20230522102912721" style="zoom: 25%;" /></p><p>&nbsp;</p><h3 id='报文段数据报）的投送'><span>报文段（数据报）的投送</span></h3><p><span>主机收到IP包：</span></p><ul><li><p><span>每个数据包都有源IP地址和目的IP地址</span></p></li><li><p><span>每个数据包都携带一个传输层的数据报文段</span></p></li><li><p><span>每个数据报文段都有源、目的端口号</span></p></li></ul><p><span>主机根据“IP地址＋端口号”将报文段定向到相应的套接字。</span></p><p>&nbsp;</p><p><span>对于UDP来说，发给同一个进程的数据，无论是从哪里来，都只用一个套接字来接收。</span></p><p>&nbsp;</p><p><span>TCP 套接字由一个四元组来标识（一个连接一组套接字）：</span></p><p><code>（源IP地址，源端口号，目的IP地址，目的端口号）</code></p><p><span>接收方主机根据这四个值将报文段定向到相应的套接字。</span></p><p><span>服务器主机同时支持多个并发的TCP套接字：每一个套接字都由其四元组来标识。</span></p><p><span>Web服务器为每一个客户连接都产生不同的套接字，非持久HTTP对每一个请求都建立不同的套接字（会影响性能）。</span></p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h2 id='无连接运输udp'><span>无连接运输：UDP</span></h2><p><strong><span>UDP通信事先无需握手，是无连接的</span></strong></p><p>&nbsp;</p><h3 id='udp处理数据的流程'><span>UDP处理数据的流程</span></h3><p><span>发送方：</span></p><ol start='' ><li><p><span>从应用进程得到数据</span></p></li><li><p><span>附加上为多路复用/多路分解所需的源和目的端口号及差错检测信息，形成报文段（数据报）</span></p></li><li><p><span>递交给网络层，尽力而为的交付给接收主机</span></p></li></ol><p>&nbsp;</p><p><span>接收方：</span></p><ol start='' ><li><p><span>从网络层接收报文段（数据报）</span></p></li><li><p><span>根据目的端口号，将数据交付给相应的应用进程</span></p></li></ol><p>&nbsp;</p><h3 id='udp的优势'><span>UDP的优势</span></h3><ul><li><p><span>无需建立连接——建立连接会增加时延</span></p></li><li><p><span>简单——发送方和接收方无需维护连接状态</span></p></li><li><p><span>段首部开销小——TCP： 20 Byte  VS  UDP：8 Byte</span></p></li><li><p><span>无拥塞控制——UDP 可按需要随时发送</span></p></li></ul><p>&nbsp;</p><h3 id='部分采用udp协议的应用'><span>部分采用UDP协议的应用</span></h3><ul><li><p><span>远程文件服务器（NFS）</span></p></li><li><p><span>流式多媒体</span></p></li><li><p><span>因特网电话</span></p></li><li><p><span>网络管理（SNMP）</span></p></li><li><p><span>选路协议（RIP）</span></p></li><li><p><span>域名解析（DNS）</span></p></li></ul><p>&nbsp;</p><h3 id='udp大量应用可能导致的严重后果'><span>UDP大量应用可能导致的严重后果</span></h3><ul><li><p><span>路由器中大量的分组溢出</span></p></li><li><p><span>显著减小TCP通信的速率，甚至挤垮TCP会话</span></p></li></ul><p>&nbsp;</p><h3 id='使用udp的可靠数据传输'><span>使用UDP的可靠数据传输</span></h3><p><span>在应用层实现数据的可靠传输，也就是应用程序特定的错误恢复。（增加了应用进程的实现难度）</span></p><p>&nbsp;</p><h3 id='udp的检验和'><span>UDP的检验和</span></h3><p><span>目标：检测收到的报文段的“差错” (例如, 出现突变的比特)。</span></p><p>&nbsp;</p><p><span>发送方：</span></p><ul><li><p><span>把报文段看作是16比特字的序列</span></p></li><li><p><span>检验和：对报文段的所有16比特字的和进行反码运算</span></p></li><li><p><span>发送方将校验和写入UDP检验和字段中</span></p></li></ul><p>&nbsp;</p><p><span>接收方：</span></p><ul><li><p><span>计算接收到的报文段的和（包括发送方的校验和）</span></p><ul><li><p><span>不为全1--检测到错误存在</span></p></li><li><p><span>为全1—没有检测到错误（但仍可能存在错误）</span></p></li></ul></li></ul><p>&nbsp;</p><p><span>例子：将两个16比特字相加</span></p><p><img src="./库/image-20230522103952852.png" alt="image-20230522103952852" style="zoom:33%;" /></p><p><strong><span>注意：最高有效位的进位要回卷加到结果当中</span></strong></p><p>&nbsp;</p><p><strong><span>是否连首部一起校验？校验字段还没有计算出来呀！</span></strong></p><p><span>把检验和字段置为0</span></p><p>&nbsp;</p><p><strong><span>接收方怎么校验？也用相同的方式计算一遍？但接收方收到的数据是包含校验和啊！</span></strong></p><p><span>接收方按直接相加的方式计算一遍，结果应该为全1</span></p><p>&nbsp;</p><p><strong><span>有没有可能出现奇数字节的UDP数据包？这样的话最后一个字节该怎么计算？</span></strong></p><p><span>完全有可能，最后一个字节和一个全0的字节计算</span></p><p>&nbsp;</p><p><strong><span>有没有可能出现奇数位（bit）的UDP数据包？这样的话又该怎么计算？</span></strong></p><p><span>完全不可能，应用层下来的数据一定是按字节的，所以首部是按字节统计长度的</span></p><p>&nbsp;</p><h2 id='可靠传输原理'><span>可靠传输原理</span></h2><p><strong><span>在应用层、运输层和链路层都很重要</span></strong></p><p>&nbsp;</p><p><span>逐步地开发</span><strong><span>可靠数据传输协议rdt</span></strong><span>的发送方和接收方。</span></p><p><span>只考虑单向数据传输(unidirectional data transfer)的情况。</span></p><p><span>用</span><strong><span>有限状态机FSM</span></strong><span>来描述发送方和接收方。</span></p><p>&nbsp;</p><p><span>可靠信道上的可靠传输——rdt 1.0</span></p><p><span>底层信道完全可靠：</span></p><ul><li><p><span>不会产生比特错误</span></p></li><li><p><span>不会丢失分组</span></p></li></ul><p><img src="./库/image-20230522104847677.png" alt="image-20230522104847677" style="zoom:25%;" /></p><p>&nbsp;</p><p><span>信道可能导致比特出现差错时——rdt 2.x</span></p><p><span>假设：</span></p><ul><li><p><span>分组比特可能受损</span></p></li><li><p><span>所有传输的分组都将按序被接收，不会丢失</span></p></li></ul><p><span>处理机制：</span></p><p><span>如何判断分组受损——差错检测：</span></p><ul><li><p><span>如何通知发送方分组是否受损——接收方反馈（ACK和NAK）</span></p></li><li><p><span>在得知分组受损后，发送方如何处理——出错重传</span></p></li></ul><p>&nbsp;</p><p><span>如何实现重传？使用缓冲区缓存已发出但未收到反馈的报文段</span></p><p><span>需要多大的缓冲区呢？接收方和发送方各一个报文段大小的缓冲区即可</span></p><p>&nbsp;</p><p><img src="./库/image-20230522105150688.png" alt="image-20230522105150688" style="zoom:25%;" /></p><p>&nbsp;</p><p><span>第二个版本——rdt 2.1</span></p><p><span>问题的引入：ACK和NAK分组可能受损，而rdt 2.0没有考虑该情况—2.0的一个致命的缺陷</span></p><p>&nbsp;</p><p><span>解决问题的几种思路：</span></p><ul><li><p><span>在人类的对话中，如果听不清楚对方所述，会回问一句“刚才你说什么来着？”但如果这句话仍然没有听清楚呢？怎么办？双方对着问“刚才你说什么来着？”这就可能进入了一个难以解困的死循环</span></p></li><li><p><span>增加足够的检查和比特，使发送方不仅可以检查比特差错，还可以恢复比特差错</span></p></li><li><p><span>收到出错的反馈时，不管三七二十一，直接重发当前数据分组</span></p><ul><li><p><span>怎么区分新旧数据？</span></p></li><li><p><span>但这就需要对数据分组进行编号，以示识别</span></p></li></ul></li></ul><p>&nbsp;</p><p><span>rdt 2.1：在具有比特差错信道上的有NAK的可靠数据传输协议</span></p><p>&nbsp;</p><p><span>ACK和NAK损坏怎么办？</span></p><ul><li><p><span>发送方不知道接收方的情况</span></p></li><li><p><span>不能只重传：重复接收</span></p></li></ul><p>&nbsp;</p><p><span>重复接收怎么办？</span></p><ul><li><p><span>发送方重发——若收到被破坏的ACK或者NAK</span></p></li><li><p><span>为每一个数据报加上序号，接收方收到重复序号的数据则丢弃</span></p></li></ul><p>&nbsp;</p><p><img src="./库/image-20230522105444697.png" alt="image-20230522105444697" style="zoom:33%;" /></p><p>&nbsp;</p><p><span>第三个版本——rdt 2.2</span></p><p><span>针对rdt 2.1的改进：只使用ACK</span></p><p><span>如何通告“错”在哪里：取消NAK，接收方对最后一个正确收到的分组发送 ACK。（接收方必须明确指出被确认的分组的序号）</span></p><p><span>发送方收到的重复的ACK将按照NAK来进行处理：重传正确的分组</span></p><p>&nbsp;</p><p><span>停等协议：发送方发送数据报之后等待接收方的响应</span></p><p>&nbsp;</p><p><img src="./库/image-20230522105653755.png" alt="image-20230522105653755" style="zoom:33%;" /></p><p>&nbsp;</p><p><span>信道不但出错，而且丢包时——rdt 3.0</span></p><p><span>假设：底层信道不但可能出现比特差错，而且可能会丢包（data,ACK）</span></p><p><span>发生丢包后，如何处理：校验和技术、序号、ACK、重传</span></p><p><span>如何判断数据报丢失了呢？最简单的方法就是：耐心的等待！</span></p><p>&nbsp;</p><p><img src="./库/image-20230522105941853.png" referrerpolicy="no-referrer" alt="image-20230522105941853"></p><p>&nbsp;</p><p><span>rdt 3.0的性能分析：网络协议限制了物理资源的利用率！</span></p><p><span>rdt 3.0性能低下的原因：停等操作</span></p><p><img src="./库/image-20230522110045581.png" alt="image-20230522110045581" style="zoom:33%;" /></p><p><span>提高性能的方法：流水线技术</span></p><p>&nbsp;</p><p><span>问题：当流水线技术中丢失一个分组后，如何进行重传？</span></p><ul><li><p><span>Go-Back-N（GBN）协议：其后分组全部重传</span></p></li><li><p><span>选择重传（SR）协议：仅重传该分组</span></p></li></ul><p>&nbsp;</p><p><span>上述两种协议已经在后面高军老师课程中介绍过了，可以往后查看。</span></p><p>&nbsp;</p><h2 id='面向连接的运输tcp'><span>面向连接的运输：TCP</span></h2><p>&nbsp;</p><blockquote><p><a href='https://mooc1.chaoxing.com/mooc2/work/view?courseId=233435142&amp;classId=74377116&amp;cpi=200104603&amp;workId=27425809&amp;answerId=51672344&amp;enc=dae6d18a4334f7e169f4a4c5286c114d' target='_blank' class='url'>https://mooc1.chaoxing.com/mooc2/work/view?courseId=233435142&classId=74377116&cpi=200104603&workId=27425809&answerId=51672344&enc=dae6d18a4334f7e169f4a4c5286c114d</a></p><ul><li><p><span>在rdt2.0中，接收方为了防止失序数据的到达，设置了多个缓冲区（错）</span></p></li><li><p><span>假定主机A通过TCP向主机B发送大文件，如果当前连接的一个分组的序号为m，则下一个分组的序号必然是m+1（错）</span></p></li><li><p><span>假定主机A通过TCP向主机B发送一个序号为64的4字节报文段，则主机B反馈的确认号必定是68（错）</span></p></li></ul></blockquote><p>&nbsp;</p><h3 id='tcp报文段首部结构'><span>TCP报文段首部结构</span></h3><p><img src="./库/image-20230522111024894.png" alt="image-20230522111024894" style="zoom: 25%;" /></p><p><span>源端口和目的端口字段——各占 2 字节。端口是运输层与应用层的服务接口。运输层的复用和分用功能都要通过端口才能实现。</span></p><p><span>序号字段——占 4 字节。TCP 连接中传送的数据流中的每一个字节都编上一个序号。序号字段的值则指的是本报文段所发送的数据的第一个字节在整个报文字节流中的序号。</span></p><p><span>确认号字段——占 4 字节，是期望收到对方的下一个报文段的数据的第一个字节的序号。</span></p><p><span>首部长度——占 4 bit，它指示意32bit的字为单位的TCP首部长度。若选项字段为空，TCP首部典型长度为20字节。</span></p><p><span>保留字段——占 6 bit，保留为今后使用，但目前应置为 0。</span></p><p><span>紧急比特 URG —— 当 URG = 1 时，表明紧急指针字段有效。它告诉系统此报文段中有紧急数据，应尽快传送。（一般不使用）</span></p><p><span>确认比特 ACK —— 只有当 ACK = 1 时确认号字段才有效。当 ACK = 0 时，确认号无效。</span></p><p><span>推送比特 PSH (PuSH) —— 接收 TCP 收到推送比特置 1 的报文段，就尽快地交付给接收应用进程，而不再等到整个缓存都填满了后再向上交付。</span></p><p><span>复位比特 RST (ReSeT) —— 当 RST = 1 时，表明 TCP 连接中出现严重差错（如由于主机崩溃或其他原因），必须释放连接，然后再重新建立运输连接。</span></p><p><span>同步比特 SYN —— 同步比特 SYN 置为 1，就表示这是一个连接请求或连接接受报文。</span></p><p><span>终止比特 FIN (FINal) —— 用来释放一个连接。当FIN = 1 时，表明此报文段的发送端的数据已发送完毕，并要求释放运输连接。</span></p><p><span>窗口字段 —— 占 2 字节。窗口字段用来控制对方发送的数据量，单位为字节。TCP 连接的一端根据设置的缓存空间大小确定自己的接收窗口大小，然后通知对方以确定对方的发送窗口的上限。</span></p><p><span>检验和 —— 占 2 字节。检验和字段检验的范围包括首部和数据这两部分。在计算检验和时，要在 TCP 报文段的前面加上 12 字节的伪首部。</span></p><p><span>紧急指针字段 —— 占 16 bit。紧急指针指出在本报文段中的紧急数据的最后一个字节的序号。</span></p><p><span>选项字段 —— 长度可变。TCP 只规定了一种选项，即最大报文段长度MSS (Maximum Segment Size)。MSS 告诉对方 TCP：“我的缓存所能接收的报文段的数据字段的最大长度是 MSS 个字节。”</span></p><p><span>MSS 是 TCP 报文段中的数据字段的最大长度。数据字段加上 TCP 首部才等于整个的 TCP 报文段。</span></p><p><span>填充字段 —— 这是为了使整个首部长度是 4 字节的整数倍。</span></p><p>&nbsp;</p><h3 id='tcp超时的设置'><span>TCP超时的设置</span></h3><p><span>如何设置TCP的超时？</span></p><p><span>应该大于往返时延RTT，但是RTT是随时变化的。</span></p><p><span>若超时时间设置太短：造成不必要的重传</span></p><p><span>若超时时间设置太长：对丢包反应太慢</span></p><p>&nbsp;</p><p><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="25.705ex" height="1.967ex" role="img" focusable="false" viewBox="0 -704 11361.6 869.6" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.375ex;"><defs><path id="MJX-4-TEX-I-1D445" d="M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"></path><path id="MJX-4-TEX-I-1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path><path id="MJX-4-TEX-I-1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"></path><path id="MJX-4-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-4-TEX-I-1D446" d="M308 24Q367 24 416 76T466 197Q466 260 414 284Q308 311 278 321T236 341Q176 383 176 462Q176 523 208 573T273 648Q302 673 343 688T407 704H418H425Q521 704 564 640Q565 640 577 653T603 682T623 704Q624 704 627 704T632 705Q645 705 645 698T617 577T585 459T569 456Q549 456 549 465Q549 471 550 475Q550 478 551 494T553 520Q553 554 544 579T526 616T501 641Q465 662 419 662Q362 662 313 616T263 510Q263 480 278 458T319 427Q323 425 389 408T456 390Q490 379 522 342T554 242Q554 216 546 186Q541 164 528 137T492 78T426 18T332 -20Q320 -22 298 -22Q199 -22 144 33L134 44L106 13Q83 -14 78 -18T65 -22Q52 -22 52 -14Q52 -11 110 221Q112 227 130 227H143Q149 221 149 216Q149 214 148 207T144 186T142 153Q144 114 160 87T203 47T255 29T308 24Z"></path><path id="MJX-4-TEX-N-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path><path id="MJX-4-TEX-N-34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path id="MJX-4-TEX-I-D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path><path id="MJX-4-TEX-I-1D437" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D445" xlink:href="#MJX-4-TEX-I-1D445"></use></g><g data-mml-node="mi" transform="translate(759,0)"><use data-c="1D447" xlink:href="#MJX-4-TEX-I-1D447"></use></g><g data-mml-node="mi" transform="translate(1463,0)"><use data-c="1D442" xlink:href="#MJX-4-TEX-I-1D442"></use></g><g data-mml-node="mo" transform="translate(2503.8,0)"><use data-c="3D" xlink:href="#MJX-4-TEX-N-3D"></use></g><g data-mml-node="mi" transform="translate(3559.6,0)"><use data-c="1D445" xlink:href="#MJX-4-TEX-I-1D445"></use></g><g data-mml-node="mi" transform="translate(4318.6,0)"><use data-c="1D447" xlink:href="#MJX-4-TEX-I-1D447"></use></g><g data-mml-node="msub" transform="translate(5022.6,0)"><g data-mml-node="mi"><use data-c="1D447" xlink:href="#MJX-4-TEX-I-1D447"></use></g><g data-mml-node="mi" transform="translate(617,-150) scale(0.707)"><use data-c="1D446" xlink:href="#MJX-4-TEX-I-1D446"></use></g></g><g data-mml-node="mo" transform="translate(6367.9,0)"><use data-c="2B" xlink:href="#MJX-4-TEX-N-2B"></use></g><g data-mml-node="mn" transform="translate(7368.1,0)"><use data-c="34" xlink:href="#MJX-4-TEX-N-34"></use></g><g data-mml-node="mi" transform="translate(7868.1,0)"><use data-c="D7" xlink:href="#MJX-4-TEX-I-D7"></use></g><g data-mml-node="mi" transform="translate(8646.1,0)"><use data-c="1D445" xlink:href="#MJX-4-TEX-I-1D445"></use></g><g data-mml-node="mi" transform="translate(9405.1,0)"><use data-c="1D447" xlink:href="#MJX-4-TEX-I-1D447"></use></g><g data-mml-node="msub" transform="translate(10109.1,0)"><g data-mml-node="mi"><use data-c="1D447" xlink:href="#MJX-4-TEX-I-1D447"></use></g><g data-mml-node="mi" transform="translate(617,-150) scale(0.707)"><use data-c="1D437" xlink:href="#MJX-4-TEX-I-1D437"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>R</mi><mi>T</mi><mi>O</mi><mo>=</mo><mi>R</mi><mi>T</mi><msub><mi>T</mi><mi>S</mi></msub><mo>+</mo><mn>4</mn><mi>×</mi><mi>R</mi><mi>T</mi><msub><mi>T</mi><mi>D</mi></msub></math></mjx-assistive-mml></mjx-container><script type="math/tex">RTO = RTT_S  + 4 × RTT_D  </script></p><p><img src="./库/image-20230521170756012.png" referrerpolicy="no-referrer" alt="image-20230521170756012"></p><p>&nbsp;</p><h3 id='可靠的tcp数据传输'><span>可靠的TCP数据传输</span></h3><p><span>IP协议是不可靠的</span></p><p><span>TCP采用了上面阐述的数据可靠传输的方法</span></p><p><span>特别之处：</span></p><ul><li><p><span>TCP编号采用按字节编号，而非按报文段编号</span></p></li><li><p><span>TCP仅采用唯一（单一）的超时定时器</span></p><ul><li><p><span>假定每一个已发送但未被确认的报文段都与一个定时器相关联</span></p></li><li><p><span>但定时器的管理需要相当大的开销</span></p></li></ul></li></ul><p>&nbsp;</p><p><span>TCP的几种重传情况：</span></p><p><img src="./库/image-20230522111926366.png" alt="image-20230522111926366" style="zoom:33%;" /></p><p>&nbsp;</p><p><span> 产生TCP ACK的建议（RFC1122、2581）</span></p><p><img src="./库/image-20230522112022603.png" alt="image-20230522112022603" style="zoom: 50%;" /></p><p>&nbsp;</p><h3 id='快速重传'><span>快速重传</span></h3><p><span>快速重传：在超时到来之前重传报文段</span></p><p><span>超时周期往往太长，增加重发丢失分组的延时</span></p><p><span>通过重复的ACK检测丢失报文段：</span></p><ul><li><p><span>发送方常要连续发送大量报文段</span></p></li><li><p><span>如果一个报文段丢失，会引起很多连续的重复ACK</span></p></li></ul><p><span>如果发送收到一个数据的3个ACK，它会认为确认数据之后的报文段丢失，此时进行快速重传：在超时到来之前重传报文段</span></p><p>&nbsp;</p><p><span>TCP流量控制：略</span></p><p>&nbsp;</p><h2 id='拥塞控制原理'><span>拥塞控制原理</span></h2><p><span>拥塞控制的方法：</span></p><ul><li><p><span>网络辅助的拥塞控制</span></p><ul><li><p><span>直接网络反馈：路由器以阻塞分组的形式通知发送方“网络拥塞了”</span></p></li><li><p><span>经由接收方的网络反馈：路由器标识从发送方流向接收方分组中的某个字段以指示拥塞的产生，由接收方通知发送方“网络拥塞了”</span></p></li></ul></li><li><p><span>端到端拥塞控制</span></p><ul><li><p><span>网络层不为拥塞控制提供任何帮助和支持</span></p></li><li><p><span>端系统通过对网络行为（丢包或时延增加）的观测判断网络是否发生拥塞</span></p></li><li><p><span>目前TCP采用该种方法</span></p></li></ul></li></ul><p>&nbsp;</p><h2 id='tcp拥塞控制'><span>TCP拥塞控制</span></h2><p><span>TCP拥塞控制为端到端拥塞控制</span></p><p>&nbsp;</p><p><span>TCP进行拥塞控制的方法：</span></p><ul><li><p><span>每个发送方自动感知网络拥塞的程度</span></p></li><li><p><span>发送方根据感知的结果限制外发的流量</span></p><ul><li><p><span>如果前方路径上出现了拥塞，则降低发送速率</span></p></li><li><p><span>如果前方路径上没有出现拥塞，则增加发送速率</span></p></li></ul></li></ul><p>&nbsp;</p><p><span>TCP拥塞控制需要解决的三个问题：</span></p><ul><li><p><span>TCP发送方如何限制外发流量的速率：拥塞窗口</span></p></li><li><p><span>发送方如何感知拥塞：</span></p><ul><li><p><span>超时</span></p></li><li><p><span>三个ACK</span></p></li></ul></li><li><p><span>在感知到拥塞后，发送方如何调节发送速率</span></p><ul><li><p><span>太快→拥塞崩溃</span></p></li><li><p><span>太慢→带宽利用率低</span></p></li></ul></li></ul><p>&nbsp;</p><p><span>TCP拥塞控制的具体过程看后面高军老师的讲解，这里仅仅做一点强调：</span></p><ul><li><p><span>对收到3个重复ACK的反应</span></p><ul><li><p><span>将门限值和CongWin减为原来的一半</span></p></li><li><p><span>线性增大拥塞窗口</span></p></li></ul></li><li><p><span>对超时事件的反应</span></p><ul><li><p><span>门限值设为当前CongWin的一半（门限值初始值65kB）</span></p></li><li><p><span>将CongWin设为1个 MSS大小</span></p></li><li><p><span>窗口以指数速度增大</span></p></li><li><p><span>窗口增大到门限值之后，再以线性速度增大</span></p></li></ul></li></ul><p><span>特别说明：早期的TCP Tahoe版本对上述两个事件并不区分，统一将CongWin降为1。实际上， 3个重复的ACK相对超时来说是一个预警信号，因此在Reno版中作了区分</span></p><p>&nbsp;</p><p><img src="./库/image-20230522113220440.png" alt="image-20230522113220440" style="zoom: 25%;" /></p><p><span>发送端的发送窗口不能超过拥塞窗口 cwnd 和接收端窗口 rwnd 中的最小值。我们假定接收端窗口足够大，因此现在发送窗口的数值等于拥塞窗口的数值。</span></p><p>&nbsp;</p><p><img src="./库/image-20230522113258506.png" alt="image-20230522113258506" style="zoom:25%;" /></p><p><span>快速恢复（TCP推荐但非必须实现）</span></p><ul><li><p><span>3个冗余ACK进入快速重传后</span></p></li><li><p><span>每收到一个冗余ACK：CongWin++</span></p></li><li><p><span>直至收到一个新的ACK：CongWin=门限值，重新进入拥塞避免</span></p></li><li><p><span>在进入快速恢复之后及重新进入拥塞避免之间，如果出现超时现象，直接按照前述超时事件进行处理</span></p></li></ul><p>&nbsp;</p><h3 id='tcp拥塞控制算法reno）总结'><span>TCP拥塞控制算法（Reno）总结</span></h3><ul><li><p><span>当 拥塞窗口CongWin 小于门限值Threshold时，发送方处于 </span><strong><span>慢启动</span></strong><span> 阶段，窗口以</span><strong><span>指数速度增大</span></strong><span>。</span></p></li><li><p><span>当 拥塞窗口CongWin 大于门限值Threshold时，发送方处于 </span><strong><span>拥塞避免</span></strong><span> 阶段，</span><strong><span>窗口线性增大</span></strong><span>。</span></p></li><li><p><span>当收到 3个重复的ACK 时，门限值Threshold设为拥塞窗口的1/2，而拥塞窗口CongWin设为门限值Threshold+3MSS ，收到新的ACK，则拥塞窗口CongWin设为门限值Threshold。</span></p></li><li><p><span>当 超时 事件发生时，门限值Threshold设为拥塞窗口的1/2，而拥塞窗口</span>
<span>CongWin设为1个 MSS。</span></p></li></ul><p>&nbsp;</p><p><img src="./库/image-20230522162620091.png" alt="image-20230522162620091" style="zoom: 33%;" /></p><p>&nbsp;</p><h3 id='tcp的吞吐量'><span>TCP的吞吐量</span></h3><p>&nbsp;</p><blockquote><p><span>在计算机网络中，TCP（传输控制协议）的吞吐量是指在一定时间内通过TCP连接传输的数据量。吞吐量通常以每秒传输的数据量来衡量，单位可以是比特/秒（bps）、千比特/秒（Kbps）、兆比特/秒（Mbps）或吉比特/秒（Gbps）等。</span></p><p><span>TCP吞吐量的定义受到以下因素的影响：</span></p><ol start='' ><li><p><span>网络带宽：网络带宽是指网络连接的最大数据传输速率，以比特/秒为单位。较高的带宽意味着TCP连接可以在单位时间内传输更多的数据量，从而提高吞吐量。</span></p></li><li><p><span>往返时延（Round-Trip Time，RTT）：RTT是指发送方发送数据到接收方并接收到确认消息的时间。较高的RTT会增加数据传输的延迟，从而影响吞吐量。</span></p></li><li><p><span>拥塞控制：TCP的拥塞控制算法用于监测网络的拥塞程度，并调整发送数据的速率以避免网络拥塞。拥塞控制机制会根据网络的拥塞情况来调整发送方的发送速率，从而影响吞吐量。</span></p></li><li><p><span>窗口大小：TCP使用滑动窗口机制来管理数据的传输。窗口大小决定了发送方可以在未收到确认消息之前发送的数据量。较大的窗口大小可以提高吞吐量，因为发送方可以发送更多的数据，而无需等待确认。</span></p></li></ol><p><span>在实际计算吞吐量时，需要考虑上述因素。通常使用以下公式计算TCP吞吐量：</span></p><p><span>吞吐量 = 传输的数据量 / 传输时间</span></p><p><span>其中，传输的数据量可以是字节数、比特数或其他单位，传输时间可以是秒数或毫秒数。</span></p><p><span>需要注意的是，TCP吞吐量的实际值可能会受到网络环境、网络拥塞、协议延迟等因素的影响。此外，吞吐量也可以因应用程序的需求和网络配置的限制而有所不同。因此，在评估和测量TCP吞吐量时，应考虑到实际情况和相关因素。</span></p></blockquote><p>&nbsp;</p><p><span>作为窗口大小和RTT的函数TCP的平均吞吐量应该是什么样的？不考虑慢启动</span></p><p><span>假定当丢包事件发生时，窗口大小为 W，此时吞吐量为W/RTT</span></p><p>&nbsp;</p><p><span>TCP吞吐量的进一步讨论</span></p><p><span>吞吐量是丢包率(L)的函数</span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="8.385ex" height="3.353ex" role="img" focusable="false" viewBox="0 -892.5 3706.1 1482" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -1.334ex;"><defs><path id="MJX-2-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-2-TEX-N-2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path><path id="MJX-2-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path id="MJX-2-TEX-N-2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path><path id="MJX-2-TEX-I-1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"></path><path id="MJX-2-TEX-I-1D446" d="M308 24Q367 24 416 76T466 197Q466 260 414 284Q308 311 278 321T236 341Q176 383 176 462Q176 523 208 573T273 648Q302 673 343 688T407 704H418H425Q521 704 564 640Q565 640 577 653T603 682T623 704Q624 704 627 704T632 705Q645 705 645 698T617 577T585 459T569 456Q549 456 549 465Q549 471 550 475Q550 478 551 494T553 520Q553 554 544 579T526 616T501 641Q465 662 419 662Q362 662 313 616T263 510Q263 480 278 458T319 427Q323 425 389 408T456 390Q490 379 522 342T554 242Q554 216 546 186Q541 164 528 137T492 78T426 18T332 -20Q320 -22 298 -22Q199 -22 144 33L134 44L106 13Q83 -14 78 -18T65 -22Q52 -22 52 -14Q52 -11 110 221Q112 227 130 227H143Q149 221 149 216Q149 214 148 207T144 186T142 153Q144 114 160 87T203 47T255 29T308 24Z"></path><path id="MJX-2-TEX-I-1D445" d="M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"></path><path id="MJX-2-TEX-I-1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path><path id="MJX-2-TEX-N-221A" d="M95 178Q89 178 81 186T72 200T103 230T169 280T207 309Q209 311 212 311H213Q219 311 227 294T281 177Q300 134 312 108L397 -77Q398 -77 501 136T707 565T814 786Q820 800 834 800Q841 800 846 794T853 782V776L620 293L385 -193Q381 -200 366 -200Q357 -200 354 -197Q352 -195 256 15L160 225L144 214Q129 202 113 190T95 178Z"></path><path id="MJX-2-TEX-I-1D43F" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 217 683Q271 680 344 680Q485 680 506 683H518Q524 677 524 674T522 656Q517 641 513 637H475Q406 636 394 628Q387 624 380 600T313 336Q297 271 279 198T252 88L243 52Q243 48 252 48T311 46H328Q360 46 379 47T428 54T478 72T522 106T564 161Q580 191 594 228T611 270Q616 273 628 273H641Q647 264 647 262T627 203T583 83T557 9Q555 4 553 3T537 0T494 -1Q483 -1 418 -1T294 0H116Q32 0 32 10Q32 17 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(220,394) scale(0.707)"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-2-TEX-N-31"></use><use data-c="2E" xlink:href="#MJX-2-TEX-N-2E" transform="translate(500,0)"></use><use data-c="32" xlink:href="#MJX-2-TEX-N-32" transform="translate(778,0)"></use><use data-c="32" xlink:href="#MJX-2-TEX-N-32" transform="translate(1278,0)"></use></g><g data-mml-node="mo" transform="translate(1778,0)"><use data-c="2217" xlink:href="#MJX-2-TEX-N-2217"></use></g><g data-mml-node="mi" transform="translate(2278,0)"><use data-c="1D440" xlink:href="#MJX-2-TEX-I-1D440"></use></g><g data-mml-node="mi" transform="translate(3329,0)"><use data-c="1D446" xlink:href="#MJX-2-TEX-I-1D446"></use></g><g data-mml-node="mi" transform="translate(3974,0)"><use data-c="1D446" xlink:href="#MJX-2-TEX-I-1D446"></use></g></g><g data-mml-node="mrow" transform="translate(544.6,-525.2) scale(0.707)"><g data-mml-node="mi"><use data-c="1D445" xlink:href="#MJX-2-TEX-I-1D445"></use></g><g data-mml-node="mi" transform="translate(759,0)"><use data-c="1D447" xlink:href="#MJX-2-TEX-I-1D447"></use></g><g data-mml-node="mi" transform="translate(1463,0)"><use data-c="1D447" xlink:href="#MJX-2-TEX-I-1D447"></use></g><g data-mml-node="msqrt" transform="translate(2167,0)"><g transform="translate(853,0)"><g data-mml-node="mi"><use data-c="1D43F" xlink:href="#MJX-2-TEX-I-1D43F"></use></g></g><g data-mml-node="mo" transform="translate(0,91.4)"><use data-c="221A" xlink:href="#MJX-2-TEX-N-221A"></use></g><rect width="681" height="42.4" x="853" y="849"></rect></g></g><rect width="3466.1" height="60" x="120" y="220"></rect></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mfrac><mrow><mn>1.22</mn><mo>∗</mo><mi>M</mi><mi>S</mi><mi>S</mi></mrow><mrow><mi>R</mi><mi>T</mi><mi>T</mi><msqrt><mi>L</mi></msqrt></mrow></mfrac></math></mjx-assistive-mml></mjx-container><script type="math/tex">\frac{1.22*MSS}{RTT\sqrt{L} } </script></p><p><span>对于一条MSS=1500字节，RTT=100ms的TCP连接而言，如果希望达到10Gbps的吞吐量，那么丢包率L不能高于2x10</span><sup><span>-10</span></sup></p><p>&nbsp;</p><h3 id='tcp拥塞控制的公平性分析'><span>TCP拥塞控制的公平性分析</span></h3><h4 id='公平性的目标'><span>公平性的目标</span></h4><p><span>如果K个TCP连接共享同一个带宽为R的瓶颈链路, 每个连接的平均传输速率为 </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="2.418ex" height="2.765ex" role="img" focusable="false" viewBox="0 -877 1068.6 1222" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.781ex;"><defs><path id="MJX-3-TEX-I-1D445" d="M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"></path><path id="MJX-3-TEX-I-1D43E" d="M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mi" transform="translate(266,394) scale(0.707)"><use data-c="1D445" xlink:href="#MJX-3-TEX-I-1D445"></use></g><g data-mml-node="mi" transform="translate(220,-345) scale(0.707)"><use data-c="1D43E" xlink:href="#MJX-3-TEX-I-1D43E"></use></g><rect width="828.6" height="60" x="120" y="220"></rect></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mfrac><mi>R</mi><mi>K</mi></mfrac></math></mjx-assistive-mml></mjx-container><script type="math/tex">\frac{R}{K}</script></p><p>&nbsp;</p><h4 id='tcp的公平性'><span>TCP的公平性</span></h4><p>&nbsp;</p><blockquote><p><span>TCP（传输控制协议）是一种可靠的、面向连接的传输协议，它在计算机网络中广泛应用。然而，TCP协议在面对多个并发连接时，存在公平性问题。</span></p><p><span>公平性问题指的是当多个TCP连接共享网络带宽时，每个连接获得的带宽是否公平分配。在网络拥塞的情况下，带宽有限，如果某些连接获得过多的带宽，可能会导致其他连接的性能下降，造成不公平的现象。</span></p><p><span>TCP公平性问题的主要原因是拥塞控制机制的设计。TCP使用拥塞控制算法来调整发送方的发送速率，以避免网络拥塞。其中，主要的拥塞控制算法是拥塞避免和拥塞恢复。</span></p><p><span>在拥塞避免阶段，TCP发送方根据网络的拥塞情况动态调整拥塞窗口的大小，从而控制发送速率。然而，这种拥塞控制算法是基于每个TCP连接独立运行的，而不考虑其他连接的存在。这可能导致某些连接获得过多的带宽，而其他连接的带宽受限，从而导致公平性问题。</span></p><p><span>此外，TCP还使用了拥塞控制的丢包恢复机制，即当检测到网络拥塞时，TCP会将发送速率减半。这种机制可能会导致某些连接过于保守地减小发送速率，从而浪费了带宽资源。</span></p><p><span>为了解决TCP的公平性问题，提出了一些改进的拥塞控制算法和流量调度算法。例如，基于TCP的拥塞控制算法如TCP Vegas和TCP CUBIC尝试更好地评估网络的拥塞程度，以提供更公平的带宽分配。此外，流量调度算法如公平队列调度（Fair Queuing）和公平带宽分享（Fair Bandwidth Sharing）也被用于在路由器和交换机等网络设备上实现公平性。</span></p><p><span>总之，TCP的公平性问题是指在多个并发连接共享网络带宽时，带宽是否公平分配的问题。这个问题主要源于TCP拥塞控制机制的设计，但可以通过改进的拥塞控制算法和流量调度算法来解决。</span></p></blockquote><p>&nbsp;</p><h4 id='公平性和udp'><span>公平性和UDP</span></h4><p><span>多媒体应用一般不使用TCP，不希望因为拥塞控制影响其速率。</span></p><p><span>多媒体应用采用UDP，恒定的速率传输音频和视频数据，可容忍丢包。</span></p><p>&nbsp;</p><p>&nbsp;</p><h1 id='第4章-网络层数据平面'><span>第4章 网络层：数据平面</span></h1><h2 id='网络层概述'><span>网络层概述</span></h2><p><span>网络层在计算机网络中的地位：</span></p><ul><li><p><span>为运输层提供支持</span></p><ul><li><p><span>运输层实现进程到进程的通信</span></p></li><li><p><span>运输层功能的实现依赖于网络层提供的服务</span></p></li></ul></li><li><p><span>为实现从源主机到目标主机成功的移动数据分组，整个路径上的每一台分组交换机（设备）上均需实现网络层</span></p></li></ul><p>&nbsp;</p><h3 id='功能'><span>功能</span></h3><p><strong><span>网络层实现主机到主机的通信。</span></strong></p><p>&nbsp;</p><ul><li><p><span>在全局范畴为主机之间的通信进行选路，选路的结果反映为分组交换机（设备）上的转发表 (控制层面）</span></p></li><li><p><span>分组交换机（设备）上的网络层根据转发表以及分组头部信息，将分组向适当链路进行转发（数据层面）</span></p></li></ul><p>&nbsp;</p><h3 id='分组交换机设备）的分类'><span>分组交换机（设备）的分类</span></h3><p><span>根据链路层首部信息进行转发的——链路层节点交换机</span></p><p><span>根据网络层首部信息进行转发的——路由器</span></p><p>&nbsp;</p><h3 id='网络层可能提供的服务'><span>网络层可能提供的服务</span></h3><p><span>确保交付：确保分组最终到达目的地</span></p><p><span>具有时延上界的确保交付：时延上限内交付</span></p><p><span>有序分组交付：以发送顺序到达</span></p><p><span>确保最小带宽：以低于特定比特率速率传输，分组不会丢失且会在预定时延内到达</span></p><p><span>确保最大时延抖动：连续分组间隔时间不超过特定值</span></p><p><span>安全性服务：机密性、完整性和源鉴别</span></p><p>&nbsp;</p><h3 id='网络层提供的服务'><span>网络层提供的服务</span></h3><p><span>面向连接的服务——虚电路，需事先握手</span></p><p><span>面向无连接的服务——数据报，无需握手</span></p><p>&nbsp;</p><h3 id='网络层与运输层相应服务的区别'><span>网络层与运输层相应服务的区别</span></h3><p><strong><span>网络层</span></strong><span>是向运输层提供</span><strong><span>主机到主机</span></strong><span>的服务，而</span><strong><span>运输层</span></strong><span>是向应用层提供</span><strong><span>进程到进程</span></strong><span>的服务</span></p><p><span>网络层仅提供上述两种服务中的一种，不同时提供两种，而运输层则同时提供两种</span></p><p><strong><span>运输层的服务在网络边缘的端系统中实现</span></strong><span>，而</span><strong><span>网络层的服务则在整个网络中实现，含路由器</span></strong></p><p>&nbsp;</p><h3 id='虚电路'><span>虚电路</span></h3><h4 id='目标'><span>目标</span></h4><p><span>使收发双方之间的路径表现得如同电话线路一般。</span></p><p>&nbsp;</p><h4 id='工作机制'><span>工作机制</span></h4><ul><li><p><span>数据开始流动之前，呼叫建立；流动结束后要断开</span></p></li><li><p><span>每一个分组携带虚电路的标识 (而不是目的主机的地址)</span></p></li><li><p><span>路径上的每一个路由器必须为进行中的连接维持连接状态信息</span></p><ul><li><p><span>传输层的连接仅涉及到两个端系统（end system）</span></p></li></ul></li><li><p><span>链路, 路由器资源 (带宽、缓冲区) 可以分配给虚电路</span></p><ul><li><p><span>目的：为了达到类似线路交换的性能</span></p></li></ul></li></ul><p>&nbsp;</p><h4 id='虚电路的组成'><span>虚电路的组成</span></h4><ul><li><p><span>从源到目的主机的路径</span></p><ul><li><p><span>一系列链路和路由器</span></p></li></ul></li><li><p><span>VC 号，沿着该路径的每段链路的一个号码</span></p><ul><li><p><span>一条虚电路在每条链路上具有不同的VC号</span></p></li><li><p><span>每台中间路由器必须用一个新的VC号替代每个传输分组的VC号</span></p></li></ul></li><li><p><span>沿着该路径的每台路由器中的转发表</span></p><ul><li><p><span>创建一条新的虚电路，转发表增加一个新表项</span></p></li><li><p><span>终止一条虚电路，表中相应项被删除</span></p></li></ul></li></ul><p>&nbsp;</p><h4 id='信令协议'><span>信令协议</span></h4><ul><li><p><span>用于建立、维护以及断开虚电路</span></p></li><li><p><span>用于 ATM, 帧中继, X.25网络</span></p></li><li><p><span>今天的因特网已经不再使用该协议</span></p></li></ul><p>&nbsp;</p><h3 id='数据报网络'><span>数据报网络</span></h3><p><span>在网络层没有连接建立过程</span></p><p><span>路由器：在端到端的连接中不维护连接状态信息</span></p><p><span>在网络层不存在“连接”的概念</span></p><p><span>传输报文时使用目的主机地址信息</span></p><p><span>同一对主机间的报文可能会走不同的路径</span></p><p>&nbsp;</p><h2 id='路由器工作原理'><span>路由器工作原理</span></h2><h3 id='路由器的两个关键组成'><span>路由器的两个关键组成</span></h3><ul><li><p><span>运行路由算法\协议（RIP、OSPF、BGP）</span></p></li><li><p><span>从入口到出口的转发</span></p></li></ul><p>&nbsp;</p><h3 id='分散式交换'><span>分散式交换</span></h3><p><span>按照给出的目的地址,使用输入端口的内存中存储的路由表，查找输出端口。</span></p><p><span>端口内容中的路由表是路由选择处理器计算和更新。</span></p><p>&nbsp;</p><h4 id='最长前缀匹配'><span>最长前缀匹配</span></h4><p><span>查找给定目标地址的转发表项时，请使用与目标地址匹配的最长地址前缀。</span></p><p>&nbsp;</p><h3 id='输入端口'><span>输入端口</span></h3><p><span>如果输入端口的处理速率超过了交换结构的速率，输入端口就可能产生排队。</span></p><p><span>线头阻塞：在输入队列中排队的分组必须等待通过交换结构发送，因为它被位于线头的另一个分组阻塞了。</span></p><p><strong><span>输入缓冲区溢出可导致排队时延和丢包！</span></strong></p><p>&nbsp;</p><blockquote><p><span>在路由器中，线头阻塞（Head-of-Line Blocking）是指在队列中的某个数据包由于前面的数据包没有被及时处理而被阻塞的情况。当多个数据包进入路由器的输入队列或输出队列时，如果前面的数据包没有被处理完毕，后续的数据包就会被阻塞在队列中等待。</span></p><p><span>线头阻塞可以在路由器的输入队列和输出队列中发生。在输入队列中，当多个数据包到达路由器的输入接口并需要转发时，如果前面的数据包在进行路由选择、查找转发表或其他处理时花费了较长时间，后续的数据包就会被阻塞在输入队列中等待处理，从而造成线头阻塞。</span></p><p><span>在输出队列中，当多个数据包需要通过同一个输出接口发送时，如果前面的数据包在排队等待发送的过程中发生了阻塞，后续的数据包也会受到影响而被阻塞在输出队列中。</span></p><p><span>线头阻塞会导致延迟增加和吞吐量降低，因为被阻塞的数据包需要等待前面的数据包处理完成后才能继续转发。在高负载的网络环境中，线头阻塞可能会导致网络性能下降和传输延迟增加的问题。</span></p><p><span>为了缓解线头阻塞的影响，一些技术和算法被应用于路由器设计中，如使用多队列调度算法、使用优先级队列、增加缓冲区容量等，以提高并行处理能力和减少数据包在队列中的等待时间。</span></p></blockquote><p>&nbsp;</p><h3 id='经内存交换'><span>经内存交换</span></h3><p><span>在输入端口和输出端口之间的交换是在CPU（路由处理器）的直接控制下完成的。</span></p><p><span>分组被拷贝到系统内存中，CPU提出报头中的目标地址，查找路由表中的输出接口，将数据包拷贝到输出接口。</span></p><p><span>转发速度受限于内存的带宽（吞吐量&lt;带宽/2）。</span></p><p><span>一次转发一个分组。</span></p><p><img src="./库/image-20230519200714809.png" alt="image-20230519200714809" style="zoom:33%;" /></p><p>&nbsp;</p><h3 id='经总线交换'><span>经总线交换</span></h3><p><span>输入端口经一根共享总线将分组直接传送到输出端口。</span></p><p><span>总线交换的问题：交换速度受限于总线的带宽。</span></p><p><img src="./库/image-20230519200814037.png" alt="image-20230519200814037" style="zoom:33%;" /></p><p>&nbsp;</p><h3 id='经内联网络'><span>经内联网络</span></h3><p><span>克服总线带宽限制。</span></p><p><span>Banyan 网络：过去在多处理机计算机体系结构中用来互连多个处理器的网络。</span></p><p><span>设计先进：将长度变化的IP分组分片成固定尺寸的</span><strong><span>信元</span></strong><span>，通过交换结构对信元进行转发。</span></p><p><img src="./库/image-20230519200920723.png" alt="image-20230519200920723" style="zoom:33%;" /></p><p>&nbsp;</p><h3 id='输出端口'><span>输出端口</span></h3><p><span>缓存管理：当交换结构将分组交付给输出端口的速率超过输出链路速率时进行缓存管理。当通过交换结构到达的分组速率超过了输出链路的速率时，需要对分组进行缓存。</span></p><p><span>调度原则：在数据报队列中选择数据报进行传输。</span></p><p><strong><span>输出端口缓冲区溢出会导致分组的排队和丢失！</span></strong></p><p>&nbsp;</p><h3 id='路由器拥塞问题'><span>路由器拥塞问题</span></h3><p><strong><span>输出端口分组调度策略</span></strong></p><p><span>先来先服务FCFS（FIFO)</span></p><p><span>丢弃策略：</span></p><ul><li><p><span>尾部丢弃：丢弃到达的数据包</span></p></li><li><p><span>优先级：按优先级丢弃/删除</span></p></li><li><p><span>随机：随机丢弃/移除</span></p></li></ul><p>&nbsp;</p><p><span>优先级排队：</span></p><ul><li><p><span>发送最高优先级排队数据包。</span></p></li><li><p><span>多个类，具有不同的优先级。类别可能取决于标记或其他首部信息，例如 IP、端口等。</span></p></li></ul><p>&nbsp;</p><p><span>循环（RR）调度：</span></p><ul><li><p><span>多个类</span></p></li><li><p><span>循环扫描不同类的队列，轮流给每个类发送数据包（如果有可用的数据包）</span></p></li></ul><p>&nbsp;</p><p><span>加权公平队列（WFQ）：</span></p><ul><li><p><span>通用的循环排队（RR）</span></p></li><li><p><span>每个类在每个周期中获得一定数量的服务（根据权值）</span></p></li></ul><p>&nbsp;</p><h2 id='网际协议ipv4寻址ipv6及其他'><span>网际协议：IPv4、寻址、IPv6及其他</span></h2><h3 id='ip数据报的格式'><span>IP数据报的格式</span></h3><h3 id='ip分片和重组'><span>IP分片和重组</span></h3><p><span>网络链路具有 MTU (最大传输单位)属性——是由链路层最大帧的限制决定的。不同类型的链路有不同的MTU值。</span></p><p><span>重组只在目的主机进行，数据报头部的标识、标志以及片偏移字段用于目的主机对接收的分片进行重组。</span></p><p>&nbsp;</p><h3 id='ip地址'><span>IP地址</span></h3><p><span>32位主机或路由器的接口标志符，IP 地址只和接口有关, 而与主机、路由器却没有太多关联。</span></p><ul><li><p><span>一般说来，路由器有多个接口</span></p></li><li><p><span>主机也有可能有多个接口</span></p></li></ul><p>&nbsp;</p><h3 id='ip地址的结构'><span>IP地址的结构</span></h3><h3 id='ip地址的表示方法'><span>IP地址的表示方法</span></h3><h3 id='什么是子网'><span>什么是子网</span></h3><h3 id='ip地址的分类'><span>IP地址的分类</span></h3><p>&nbsp;</p><p><span>路由器总是具有两个或两个以上的 IP 地址。路由器的每一个接口都有一个不同网络号的 IP 地址。</span></p><p>&nbsp;</p><h3 id='子网的划分'><span>子网的划分</span></h3><p><span>子网划分的方法：从主机号中借用一部分位数作为子网号。</span></p><p>&nbsp;</p><h3 id='子网掩码'><span>子网掩码</span></h3><p><span>作用：对外隐藏子网的存在，对内指示网络号和子网号的位置。</span></p><p><span>获得方法：通过在网络号的子网号相应的位置全置1，主机号相应的位置全置0，即可得到子网掩码。</span></p><p>&nbsp;</p><h3 id='网络地址和广播地址'><span>网络地址和广播地址</span></h3><p><span>(IP 地址) AND (子网掩码) = 网络地址</span></p><p>&nbsp;</p><h3 id='引入子网掩码后的寻址'><span>引入子网掩码后的寻址</span></h3><p><span>采用子网掩码后，路由器的寻址过程将演变成一个两级寻址过程：</span></p><ol start='' ><li><p><span>检查分组目的IP地址中的网络号：若网络号不是本网络，则从路由表中找出相应的转发结点地址将其转发出去。</span></p></li><li><p><span>检查子网号：当网络号是本网络时，路由器将检查子网号，向相应的子网转发此分组。</span></p></li></ol><p>&nbsp;</p><h3 id='最长前缀匹配-2'><span>最长前缀匹配</span></h3><p><span>使用 CIDR 时，路由表中的每个项目由“网络前缀”和“下一跳地址”组成。在查找路由表时可能会得到不止一个匹配结果。应当从匹配结果中选择具有最长网络前缀的路由：最长前缀匹配(longest-prefix matching)。网络前缀越长，其地址块就越小，因而路由就越具体。最长前缀匹配又称为最长匹配或最佳匹配。</span></p><p>&nbsp;</p><h3 id='层次编址---路由聚合'><span>层次编址—路由聚合</span></h3><p><span>DHCP：动态主机配置协议</span></p><p><span>思考：DHCP工作在哪个层次？</span></p><p>&nbsp;</p><blockquote><p><span>DHCP（Dynamic Host Configuration Protocol）是一种网络协议，用于自动分配IP地址和其他网络配置参数给连接到网络的主机。DHCP工作在计算机网络体系结构中的应用层。</span></p><p><span>应用层是计算机网络体系结构中的最高层，负责提供用户应用程序和网络之间的接口。DHCP作为一个应用层协议，使用UDP（User Datagram Protocol）作为传输协议，通过网络中的DHCP服务器和客户端之间的交互来完成IP地址的分配和配置。</span></p><p><span>具体而言，DHCP工作的过程如下：</span></p><ol start='' ><li><p><span>客户端发送DHCP发现消息（DHCP Discover），广播到网络中的所有DHCP服务器。</span></p></li><li><p><span>DHCP服务器收到DHCP发现消息后，回复DHCP提供消息（DHCP Offer），提供IP地址和其他网络配置参数。</span></p></li><li><p><span>客户端接收到一个或多个DHCP提供消息后，选择其中一个DHCP服务器，发送DHCP请求消息（DHCP Request）来接受提供的IP地址和配置参数。</span></p></li><li><p><span>DHCP服务器收到DHCP请求消息后，发送DHCP确认消息（DHCP Acknowledgment）来确认客户端的请求，并提供最终的IP地址和配置参数。</span></p></li></ol><p><span>通过DHCP协议，网络中的DHCP服务器可以动态地为主机分配IP地址，以及提供子网掩码、默认网关、DNS服务器等其他网络配置参数。这样可以大大简化了网络管理，减少了手动配置IP地址的工作量。</span></p><p><span>需要注意的是，DHCP协议虽然工作在应用层，但它和其他网络层协议（如IP协议）密切相关，通过网络层的UDP协议进行通信，并利用网络层的IP地址来实现DHCP服务器和客户端之间的交互。</span></p></blockquote><p>&nbsp;</p><h3 id='nat'><span>NAT</span></h3><p><span>动机：本地网络只要使用一个IP地址就可以和外部网络相连。</span></p><p><span>不需要从 ISP处获得大批IP地址: 所有设备可以使用同一个 IP地址。</span></p><p><span>可以在不通知外部网络的情况下改变内网主机的IP地址。</span></p><p><span>即使改变了ISP也无须改变内网主机的IP地址。</span></p><p><span>内网主机对外网主机而言是不可见的、不可寻址的。（这也算是一项安全措施）</span></p><p>&nbsp;</p><blockquote><p><span>NAT的具体过程：略</span></p><p><a href='https://www.bilibili.com/video/BV1NT411g7n6?p=65&amp;vd_source=11579445a367b6624c1d123aa6f75a37' target='_blank' class='url'>https://www.bilibili.com/video/BV1NT411g7n6?p=65&vd_source=11579445a367b6624c1d123aa6f75a37</a></p></blockquote><p>&nbsp;</p><p><span>两类地址：</span></p><ul><li><p><span>本地地址</span></p></li><li><p><span>全球地址</span></p></li></ul><p>&nbsp;</p><p><span>三种地址转换方式：</span></p><ul><li><p><span>静态NAT：一个本地地址对应一个全球地址</span></p></li><li><p><span>动态NAT：一个全球地址对应多个本地地址</span></p></li><li><p><span>端口NAT：一个本地地址的端口对应到一个全球地址的端口</span></p></li></ul><p>&nbsp;</p><p><span>NAT转换表具有WAN端和LAN端</span></p><p>&nbsp;</p><blockquote><p><span>在计算机网络中，WAN和LAN是两个常用的术语，用来描述不同的网络范围和拓扑结构。</span></p><p><span>WAN代表广域网（Wide Area Network），指的是连接广泛地理区域的计算机网络。WAN通常覆盖跨越城市、国家甚至全球的范围，并通过公共或专用的传输媒介（如电话线、光纤、卫星等）连接着远离的地理位置上的计算机和网络设备。WAN的目的是为不同地区的网络提供互联互通的能力，例如连接不同分支机构的企业网络、连接不同城市的互联网服务提供商等。</span></p><p><span>LAN代表局域网（Local Area Network），指的是在相对较小的范围内连接设备的计算机网络。LAN通常限于一个建筑物、校园、办公室或某个地理区域。它使用局域网技术（如以太网）来连接计算机、服务器、打印机和其他网络设备，以实现高速数据传输和资源共享。LAN通常是私有网络，由一个组织或个人控制和管理。</span></p><p><span>WAN和LAN之间有几个主要区别：</span></p><ol start='' ><li><p><span>范围：WAN覆盖的范围更大，跨越较长的地理距离，而LAN覆盖的范围相对较小，局限于特定的区域或场所。</span></p></li><li><p><span>传输速度：由于WAN覆盖范围广且跨越较长距离，其传输速度通常较慢。而LAN通常提供更高的传输速度和带宽，适用于本地区域内的高速数据交换。</span></p></li><li><p><span>管理控制：WAN通常涉及多个组织或服务提供商之间的协调，因此其管理和控制较为复杂。相比之下，LAN通常由单个组织或个人负责管理和控制。</span></p></li></ol><p><span>需要注意的是，WAN和LAN并不是互斥的概念，而是描述了不同范围和拓扑结构的网络。在实际的网络环境中，可以通过互联网服务提供商的WAN连接来连接不同地理位置上的局域网，将局域网互连形成更大的网络。</span></p></blockquote><p>&nbsp;</p><p><span>NAT转换中存在的一个问题：NAT穿透</span></p><p><span>解决方案1：采用端口NAT，在路由器中静态的为服务器配置一条记录</span></p><p><span>解决方案2：通用即插即用UPnP</span></p><p><span>解决方案3：中继（用于Skype）</span></p><p>&nbsp;</p><h3 id='因特网控制报文协议icmp'><span>因特网控制报文协议ICMP</span></h3><p><span>用于主机、路由器、网关之间交换网络层信息：</span></p><ul><li><p><span>错误报告: 如主机、网络、端口、协议不可达等</span></p></li><li><p><span>回声请求/回答 (用于ping应用程序)</span></p></li></ul><p>&nbsp;</p><p><span>从体系结构而言，位于IP层之上：ICMP 报文封装在IP分组中。</span></p><p>&nbsp;</p><p><span>ICMP 报文的种类有两种：</span></p><ul><li><p><span>ICMP 差错报告报文</span></p></li><li><p><span>ICMP 询问报文</span></p></li></ul><p>&nbsp;</p><h3 id='ipv4面临的问题'><span>IPv4面临的问题</span></h3><ul><li><p><span>地址空间消耗很快</span></p></li><li><p><span>首部长度不定（20-40字节），中间结点（路由器）需要消耗相当资源用于分组处理</span></p></li><li><p><span>缺少QoS</span></p></li><li><p><span>安全性不够高</span></p></li></ul><p>&nbsp;</p><h3 id='ipv6数据报格式'><span>IPv6数据报格式</span></h3><p><span>略</span></p><p><span>无检查和，中间结点无需计算</span></p><p><span>中间结点不再负责分片和重组，由端结点负责</span></p><p><span>首部长度固定，加速中间结点转发速度</span></p><p>&nbsp;</p><h3 id='ipv6与ipv4不同之处'><span>IPv6与IPv4不同之处</span></h3><p><span>校验和: 为了节省路由器的处理时间，去掉了此功能</span></p><p><span>扩大的地址空间。IPv6 将地址从 IPv4 的 32 bit 增大到了128 bit</span></p><p><span>简单高效的40字节首部</span></p><p><span>改进的选项：不再是标准IP首部的一部分，可能出现在IPv6首部中由下一个首部指出的位置上。</span></p><p><span>允许协议继续扩充</span></p><p><span>支持即插即用（即自动配置）</span></p><p><span>支持资源的预分配</span></p><p><span>ICMPv6: 新版本的 ICMP</span></p><ul><li><p><span>增加了消息的类型，比如”报文太大“。</span></p></li><li><p><span>增加了多播组管理功能</span></p></li></ul><p>&nbsp;</p><h3 id='ipv4到ipv6的迁移'><span>IPv4到IPv6的迁移</span></h3><p><span>设立标志日，统一迁移</span></p><p><span>双栈技术</span></p><ul><li><p><span>新加入的设备支持IPv4/IPv6双协议栈</span></p></li><li><p><span>一段链路上，如果源和目标均支持IPv6，则使用IPv6进行通信</span></p></li><li><p><span>如果任一方不支持IPv6，则使用IPv4进行通信</span></p></li><li><p><span>可能会出现信息的丢失（流标号）</span></p></li></ul><p><span>隧道技术</span></p><p>&nbsp;</p><h1 id='第5章-网络层控制平面'><span>第5章 网络层：控制平面</span></h1><h2 id='路由选择算法'><span>路由选择算法</span></h2><p><span>链路状态路由选择算法</span></p><p><span>距离向量路由选择算法</span></p><p>&nbsp;</p><blockquote><p><span>链路状态选路算法和距离向量选路算法是两种常见的路由选择算法，用于在计算机网络中确定数据包在网络中的传输路径。</span></p><ol start='' ><li><p><span>链路状态选路算法（Link State Routing Algorithm）：</span></p><ul><li><p><span>描述：链路状态选路算法基于每个路由器了解整个网络拓扑的全局信息，每个路由器都维护有关网络中所有路由器和链路的信息。</span></p></li><li><p><span>工作原理：每个路由器将自己的链路状态广播给整个网络，以构建网络拓扑图。通过收集和处理链路状态信息，每个路由器计算出最短路径树（Shortest Path Tree），并使用该树确定到达目标网络的最佳路径。</span></p></li><li><p><span>示例协议：OSPF（Open Shortest Path First）就是一种常见的链路状态选路协议。</span></p></li></ul></li><li><p><span>距离向量选路算法（Distance Vector Routing Algorithm）：</span></p><ul><li><p><span>描述：距离向量选路算法基于每个路由器只了解邻居路由器的距离向量信息，每个路由器只维护与其直接相邻的邻居路由器的距离信息。</span></p></li><li><p><span>工作原理：每个路由器周期性地向邻居路由器发送距离向量信息，邻居路由器将其接收到的信息与自身的距离向量信息进行计算和更新。通过不断交换和更新距离向量信息，每个路由器最终能够计算出到达目标网络的最佳路径。</span></p></li><li><p><span>示例协议：RIP（Routing Information Protocol）和BGP（Border Gateway Protocol）就是常见的距离向量选路协议。</span></p></li></ul></li></ol><p><span>需要注意的是，链路状态选路算法和距离向量选路算法在工作原理和实现方式上有所不同，它们在路由计算和信息交换的方式上有不同的优缺点。具体选择哪种算法取决于网络规模、性能要求和特定的应用场景。</span></p></blockquote><p>&nbsp;</p><p><span>层次路由：自治系统</span></p><p>&nbsp;</p><h2 id='因特网自治系统内部的路由选择ospf'><span>因特网自治系统内部的路由选择：OSPF</span></h2><h2 id='isp之间的路由选择bgp'><span>ISP之间的路由选择：BGP</span></h2><blockquote><p><span>在计算机网络中，iBGP（Interior Border Gateway Protocol）和eBGP（Exterior Border Gateway Protocol）是两种不同的BGP（Border Gateway Protocol）扩展。</span></p><ol start='' ><li><p><span>iBGP（Interior Border Gateway Protocol）：iBGP是在自治系统（AS）内部运行的BGP协议。一个自治系统是一个具有统一的路由政策的网络，由一组路由器组成。iBGP主要用于在同一个自治系统内的不同路由器之间交换路由信息。iBGP确保在自治系统内的所有路由器之间传播BGP路由信息，以便它们可以共享完整的路由表。</span></p></li><li><p><span>eBGP（Exterior Border Gateway Protocol）：eBGP是自治系统之间运行的BGP协议。当两个自治系统相互连接时，它们使用eBGP来交换路由信息。eBGP用于在不同自治系统之间传递路由信息，以实现跨网络的路由选择。eBGP负责将路由信息从一个自治系统传播到另一个自治系统，并确保自治系统之间的路由可达性。</span></p></li></ol><p><span>总结：</span></p><ul><li><p><span>iBGP是在自治系统内部运行的BGP协议，用于自治系统内的路由器之间交换路由信息。</span></p></li><li><p><span>eBGP是自治系统之间运行的BGP协议，用于不同自治系统之间的路由信息交换。</span></p></li></ul></blockquote><p>&nbsp;</p><h2 id='icmp因特网控制报文协议'><span>ICMP：因特网控制报文协议</span></h2><h1 id='第6章-链路层和局域网'><span>第6章 链路层和局域网</span></h1><p><strong><span>目标</span></strong></p><ul><li><p><span>了解链路层服务的原则：</span></p><ul><li><p><span>错误检测，校正</span></p></li><li><p><span>共享广播信道：多址访问</span></p></li><li><p><span>链路层寻址</span></p></li><li><p><span>局域网：以太网，VLAN</span></p></li></ul></li><li><p><span>实例化，各种链路层技术的实现</span></p></li></ul><p>&nbsp;</p><h2 id='链路层概述'><span>链路层概述</span></h2><h3 id='术语'><span>术语</span></h3><p><span>节点：主机和路由器</span></p><p><span>链路：沿着通信路径连接相邻节点的通信信道</span></p><ul><li><p><span>有线链路</span></p></li><li><p><span>无线链路</span></p></li></ul><p><span>链路层帧：链路层的PDU</span></p><p>&nbsp;</p><h3 id='链路层的主要功能'><span>链路层的主要功能</span></h3><p><span>负责将数据报通过链路从一个节点传输到物理上相邻的节点。</span></p><p>&nbsp;</p><h3 id='特别说明'><span>特别说明</span></h3><ul><li><p><span>数据报在不同链路上可能由不同的链路层协议进行处理。</span></p></li></ul><p><span>例如：第一段链路上由PPP处理，最后一段链路上由以太网处理，中间链路上由广域链路层协议处理</span></p><p>&nbsp;</p><ul><li><p><span>不同的链路层协议可能提供不同的服务</span></p></li></ul><p><span>例如：可靠传递、不可靠传递</span></p><p>&nbsp;</p><h3 id='链路层提供的服务'><span>链路层提供的服务</span></h3><h4 id='成帧'><span>成帧</span></h4><p><span>将数据加上头部和尾部，封装成数据帧</span></p><p><span>帧头部用MAC地址标识源和目的（不同于IP地址）</span></p><p>&nbsp;</p><h4 id='链路接入'><span>链路接入</span></h4><p><span>共享介质的信道访问</span></p><p>&nbsp;</p><h4 id='可靠交付'><span>可靠交付</span></h4><p><span>很少用于误码率低的链路（光纤、双绞线链路）</span></p><p><span>用于误码率高的链路（无线链路）</span></p><p><span>思考：为何运输层和链路层都要提供可靠数据传输</span></p><p>&nbsp;</p><blockquote><p><span>在计算机网络中，运输层和链路层都有提供可靠数据传输的需求，但出于不同的目的和层次。</span></p><ol start='' ><li><p><span>运输层（Transport Layer）：</span></p><ul><li><p><span>目的：运输层的主要目的是在通信的源端和目的端之间提供可靠的端到端数据传输服务。它负责将数据分割为适当的大小并进行传输，确保数据的正确性、顺序性和完整性。可靠传输服务对于许多应用程序是至关重要的，例如文件传输、电子邮件和网页浏览等。</span></p></li></ul></li><li><p><span>链路层（Link Layer）：</span></p><ul><li><p><span>目的：链路层的主要目的是在相邻节点之间提供可靠的数据传输服务。它负责将数据帧从一个节点传输到另一个节点，并处理数据帧的错误、丢失和重复等问题。链路层的可靠传输主要是为了解决物理链路上的传输问题，例如噪声、干扰和传输错误。</span></p></li></ul></li></ol><p><span>需要同时在运输层和链路层提供可靠数据传输的原因包括：</span></p><ol start='' ><li><p><span>端到端可靠性：运输层的可靠传输确保了端到端通信的可靠性，保证数据在源和目的地之间的正确传输。链路层的可靠传输则确保了相邻节点之间的可靠数据传输。</span></p></li><li><p><span>不同层次的需求：运输层和链路层处于网络协议栈的不同层次，各自负责不同的功能和服务。可靠数据传输是它们各自职责范围内的一个重要方面，以满足各自层次的需求。</span></p></li><li><p><span>不同层次的错误处理：运输层和链路层面临的错误类型和处理方式不同。运输层主要处理端到端的传输错误，例如丢失、重复、顺序混乱等。链路层主要处理物理链路上的传输错误，例如比特错误和噪声干扰。</span></p></li></ol><p><span>虽然在两个层次都提供可靠数据传输会带来一定的性能开销，但在许多应用中，数据的可靠性是至关重要的。通过运输层和链路层的可靠传输机制，网络能够提供高质量的数据传输服务，确保数据的可靠性和完整性。</span></p></blockquote><p>&nbsp;</p><h4 id='差错检测和纠正'><span>差错检测和纠正</span></h4><p><span>信号衰减和电磁干扰噪声导致出错</span></p><p><span>接收方检测到错误存在：给发送方发送信号要求重传或丢弃该数据帧，或者接收方检测和纠正帧中错误，不用重传</span></p><p>&nbsp;</p><h4 id='流量控制'><span>流量控制</span></h4><p><span>在相邻的收发节点间限制流量</span></p><p>&nbsp;</p><h4 id='半双工和全双工'><span>半双工和全双工</span></h4><p><span>半双工时，链路两端的节点都能传输分组，但不能同时传输</span></p><p>&nbsp;</p><h4 id='适配器通信'><span>适配器通信</span></h4><p><span>适配器通信存在于每一台设备上（主机、交换机、路由器）</span></p><p><span>链路层在“适配器”（网卡NIC）或者芯片上实现</span></p><p><span>网卡直接与主机的系统总线相连，和其它连接主机的I/O设备相同，是硬件、软件和固件的结合体</span></p><p>&nbsp;</p><p><span>适配器是半自治单元，向上提交数据时，需要节点干预，最终受控于节点。</span></p><p><span>帧的接收和发送、检错、丢弃均是自主进行。</span></p><p>&nbsp;</p><blockquote><p><span>这句话的意思是，在计算机网络中，网络适配器（Network Adapter）是一种半自治单元。当网络适配器向上层（更高层）提交数据时，需要节点（例如操作系统或网络协议栈）进行干预和处理。</span></p><p><span>具体解释如下：</span></p><ul><li><p><span>网络适配器是计算机与网络之间的接口设备，负责将数据从计算机系统传输到网络中，或者从网络中接收数据并传递给计算机系统。它通常由硬件和相关的驱动程序组成，实现网络通信的功能。</span></p></li><li><p><span>半自治单元表示网络适配器在某种程度上具有一定的自主性，能够执行一些本地的网络操作，例如物理层的数据传输和链路层的处理。</span></p></li><li><p><span>当网络适配器向上提交数据时，即将数据传递给更高层的节点（例如操作系统的网络协议栈），需要节点进行干预和处理。这是因为更高层的节点负责实现网络协议、数据处理和应用程序的逻辑，需要对数据进行解析、分析、转发或传递给相应的应用程序。</span></p></li></ul><p><span>因此，这句话的含义是指网络适配器在将数据传递给更高层的节点之前，需要节点对数据进行处理和干预，以便进行适当的网络协议操作和数据处理。这种干预和处理的方式可以根据具体的网络协议和系统实现而有所不同。</span></p><p><span>在上述上下文中，&quot;节点&quot;指的是网络协议栈中的某个组件或实体，它负责处理来自网络适配器的数据、执行网络协议操作，并将数据传递给更高层的组件或应用程序。这样的节点可以是操作系统的网络协议栈、网络中的路由器或其他设备，具体取决于讨论的背景和上下文。</span></p></blockquote><p>&nbsp;</p><h3 id='链路层在何处实现'><span>链路层在何处实现</span></h3><p><span>发送方：</span></p><p><span>在一个帧内封装数据报，增加差错检测位，可靠交付，流量检测等。</span></p><p><span>接收方：</span></p><p><span>查找错误，可靠交付，流量控制等。查找错误，可靠交付，流量控制等。</span></p><p>&nbsp;</p><h2 id='差错检测和纠正技术'><span>差错检测和纠正技术</span></h2><h3 id='差错检测模型'><span>差错检测模型</span></h3><p><img src="./库/image-20230516172934500.png" alt="image-20230516172934500" style="zoom:33%;" /></p><p>&nbsp;</p><p><span>EDC= Error Detection and Correction bits 差错检测和纠错比特</span></p><p><span>差错检测不是100%可靠的，EDC越长，则出错的概率越低！</span></p><p><span>D = Data 差错检测位保护的数据，可包括首部</span></p><p>&nbsp;</p><h3 id='奇偶校验'><span>奇偶校验</span></h3><h4 id='单比特奇偶校验'><span>单比特奇偶校验</span></h4><p>&nbsp;</p><h4 id='二维奇偶校验'><span>二维奇偶校验</span></h4><p><img src="./库/image-20230516173043192.png" alt="image-20230516173043192" style="zoom:33%;" /></p><h3 id='检验和方法'><span>检验和方法</span></h3><p><span>目标：检测发送包中的“错误”（例如，翻转位）（注：仅用于运输层）</span></p><p>&nbsp;</p><p><span>发送方：</span></p><ul><li><p><span>将数据段的内容作为16比特的整数序列</span></p></li><li><p><span>校验和：累加求和，计算和的1的补码发送方将得到的校验和值放入</span><strong><span>PDU校验和</span></strong><span>字段</span></p></li></ul><p>&nbsp;</p><p><span>接收方：</span></p><ul><li><p><span>计算收到的数据段的校验和</span></p></li><li><p><span>检查计算出的校验和与校验和字段中的值是否相同：</span></p><ul><li><p><span>NO – 检测到错误</span></p></li><li><p><span>YES – 没有检测错误（不代表没有错误）</span></p></li></ul></li></ul><p>&nbsp;</p><p><span>特别注意：仅用于TCP、UDP和IPv4协议中</span></p><p>&nbsp;</p><blockquote><p><span>在计算机网络中，数据链路层中的“因特网检查和”是指对数据链路层帧中的数据进行校验和计算和验证的操作。</span></p><p><span>校验和是一种简单的错误检测机制，用于检测数据在传输过程中是否发生了错误或损坏。在数据链路层中，发送方计算校验和并将其添加到帧的尾部。接收方接收到帧后，会重新计算校验和，并将计算结果与帧中的校验和进行比较。如果两者匹配，说明数据在传输过程中没有发生错误；如果不匹配，则说明数据可能在传输过程中出现了错误或损坏。</span></p><p><span>通过校验和的计算和验证，可以帮助数据链路层检测并丢弃错误的帧，以确保数据的可靠性和完整性。这对于保证数据在物理链路上的正确传输非常重要，尤其是在面对可能的传输错误和噪声干扰时。</span></p></blockquote><p>&nbsp;</p><h3 id='循环冗余检测'><span>循环冗余检测</span></h3><p>&nbsp;</p><h2 id='多路访问链路和协议'><span>多路访问链路和协议</span></h2><p><span>两种链路：</span></p><ul><li><p><span>点到点链路</span></p><ul><li><p><span>PPP、HDLC</span></p></li><li><p><span>以太网交换机和主机之间的点到点链路</span></p></li></ul></li><li><p><span>广播链路（共享线路或介质）</span></p><ul><li><p><span>传统以太网</span></p></li><li><p><span>802.11无线LAN</span></p></li><li><p><span>HFC</span></p></li></ul></li></ul><p>&nbsp;</p><h3 id='广播链路的特点'><span>广播链路的特点</span></h3><ul><li><p><span>单个共享广播信道</span></p></li><li><p><span>两个或多个节点同时传输：相互干扰。碰撞：一个节点同时收到两个或多个信号</span></p></li></ul><p>&nbsp;</p><h3 id='多路访问协议'><span>多路访问协议</span></h3><p><span>分布式算法决定节点如何共享信道，如节点何时可以传输数据</span></p><p><span>特别注意：有关共享信道的通信（协商）需使用信道本身，没有额外的信道来进行协调</span></p><p>&nbsp;</p><blockquote><p><span>在计算机网络中，多路访问协议（Multiple Access Protocol）指的是一组协议和技术，用于在共享媒体或网络中，允许多个节点同时访问传输介质并进行通信的方式。</span></p><p><span>在计算机网络中，当多个节点共享同一个传输介质（如以太网或无线信道）时，需要使用多路访问协议来协调节点之间的访问，以避免冲突和碰撞，确保数据的正确传输。</span></p><p><span>常见的多路访问协议包括以下几种：</span></p><ol start='' ><li><p><span>CSMA/CD（Carrier Sense Multiple Access with Collision Detection）：用于以太网等共享介质网络，节点在发送数据前先监听信道，如果检测到信道空闲，再发送数据，若发生冲突则进行碰撞检测并进行退避重传。</span></p></li><li><p><span>CSMA/CA（Carrier Sense Multiple Access with Collision Avoidance）：用于无线局域网（如Wi-Fi），通过采用随机退避机制和预定时间间隙来避免碰撞。</span></p></li><li><p><span>TDMA（Time Division Multiple Access）：在时分多路复用的基础上，将时间分割为多个时隙，不同节点在不同的时隙中进行数据传输。</span></p></li><li><p><span>FDMA（Frequency Division Multiple Access）：在频分多路复用的基础上，将频率划分为多个不重叠的子频带，不同节点使用不同的频带进行通信。</span></p></li><li><p><span>CDMA（Code Division Multiple Access）：采用编码技术，使得不同节点的数据能够同时传输并在接收端进行区分和恢复。</span></p></li></ol><p><span>这些多路访问协议在不同的场景和网络类型中应用广泛，它们提供了有效的方法来实现多个节点之间的共享访问和数据传输。</span></p></blockquote><p>&nbsp;</p><p><span>对于信道为速率为R b/s的广播信道，理想的多址访问协议需满足：</span></p><ul><li><p><span>当只有一个节点有数据发送时，该节点的吞吐量为R</span></p></li><li><p><span>当M个节点有数据发送时，每个节点吞吐量为R/M</span></p></li><li><p><span>分散</span></p><ul><li><p><span>没有特定节点用于调整传输</span></p></li><li><p><span>没有时钟同步</span></p></li></ul></li><li><p><span>简单</span></p></li></ul><p>&nbsp;</p><h3 id='多址访问协议的分类'><span>多址访问协议的分类</span></h3><p><span>信道划分协议：</span></p><ul><li><p><span>将信道划分成小的“片”（时隙、频率、编码）</span></p></li><li><p><span>将“片”分配给节点使用</span></p></li></ul><p>&nbsp;</p><p><span>随机接入（访问）协议：</span></p><ul><li><p><span>信道没有被分割，允许碰撞</span></p></li><li><p><span>碰撞恢复</span></p></li></ul><p>&nbsp;</p><p><span>轮流协议：</span></p><ul><li><p><span>节点轮流传送，但数据量大的节点轮流更长时间</span></p></li></ul><p>&nbsp;</p><h3 id='信道划分协议'><span>信道划分协议</span></h3><h4 id='tdma'><span>TDMA</span></h4><h4 id='统计时分复用stdm'><span>统计时分复用STDM</span></h4><p><strong><span>在计算机网络中，统计时分复用（Statistical Time Division Multiplexing，STDM）和时分复用（Time Division Multiplexing，TDM）是两种不同的复用技术，它们有一定的联系和区别。</span></strong></p><p>&nbsp;</p><p><span>联系：</span></p><ol start='' ><li><p><span>复用原理：STDM和TDM都是利用时间分割的原理来实现多路复用。</span></p></li><li><p><span>复用目的：它们的目标都是将多个低速信道或数据流合并成一个高速信道或数据流，以提高带宽利用率和传输效率。</span></p></li></ol><p>&nbsp;</p><p><span>区别：</span></p><ol start='' ><li><p><span>分配方式：TDM是固定时分复用，将时间划分为固定的时隙，每个时隙分配给特定的通信信道或数据流。而STDM是动态时分复用，根据通信信道或数据流的实际需求，在时隙内根据需求分配时间片段，实现灵活的资源分配。</span></p></li><li><p><span>空闲利用：TDM中，即使在某个时隙中没有数据传输，该时隙仍然会被保留给对应的通信信道。而STDM中，空闲时隙可以被其他通信信道使用，提高了带宽的利用率。</span></p></li><li><p><span>管理和调度：TDM需要严格的时钟同步来确保各个时隙的准确分配和传输。STDM使用动态的资源分配算法，根据实时需求进行管理和调度。</span></p></li></ol><p>&nbsp;</p><p><span>虽然STDM和TDM有一些共同之处，但它们在分配方式、资源利用和调度等方面存在显著的区别。STDM相对于TDM更为灵活，能够更高效地利用带宽，并根据实际需求动态分配资源。</span></p><p>&nbsp;</p><h4 id='fdma'><span>FDMA</span></h4><p><span>信道按频谱分成若干频段</span></p><p><span>每个节点分配固定频段</span></p><p><span>在频段不用时该部分信道被闲置和浪费</span></p><p>&nbsp;</p><h3 id='随机接入协议'><span>随机接入协议</span></h3><p><span>当节点有数据发送时：</span></p><ul><li><p><span>以信道全部速率R传输</span></p></li><li><p><span>没有主节点起协调作用</span></p></li></ul><p>&nbsp;</p><p><span>两个或多个节点传送时：</span></p><ul><li><p><span>碰撞</span></p></li></ul><p>&nbsp;</p><p><span>随机访问协议解决可能发生的碰撞问题，包括两个方面：</span></p><ul><li><p><span>如何检测碰撞</span></p></li><li><p><span>如何从碰撞中恢复（如：延时后重传）</span></p></li></ul><p>&nbsp;</p><p><span>随机访问协议举例：</span></p><ul><li><p><span>ALOHA、时隙ALOHA</span></p></li><li><p><span>CSMA，CSMA/CD，CSMA/CA</span></p></li></ul><p>&nbsp;</p><h4 id='aloha'><span>ALOHA</span></h4><p><span>ALOHA网的特征：</span></p><ul><li><p><span>因群岛位置的散布，网络拓扑采用了</span><strong><span>星型结构</span></strong><span>；</span></p></li><li><p><span>为节省费用和易于组网，网络中各站点的通信采用了</span><strong><span>无线传输介质</span></strong><span>。</span></p></li><li><p><span>由于采用无线电信道，考虑到无法申请更多的频率点，因而所有站点都使用</span><strong><span>统一的频率</span></strong><span>通过主机交换信息。</span></p></li></ul><p>&nbsp;</p><h5 id='时隙aloha'><span>时隙ALOHA</span></h5><p><span>假定：</span></p><ul><li><p><span>所有的帧大小相同</span></p></li><li><p><span>时间被划分为相同大小的时隙，一个时隙等于传输一帧的时间</span></p></li><li><p><span>节点只在时隙的开始传输帧</span></p></li><li><p><span>节点被同步</span></p></li><li><p><span>若有两个或多个节点在一个时隙内传送，则所有节点都能在该时隙内检测到冲突</span></p></li></ul><p>&nbsp;</p><p><span>操作：</span></p><ul><li><p><span>当节点有新的帧发送，它等到下一个时隙发送</span></p></li><li><p><span>若没有碰撞，节点能在下一时隙传送完新帧</span></p></li><li><p><span>若有碰撞，节点以概率p在后续的每一个时隙重传该帧</span></p></li></ul><p>&nbsp;</p><p><img src="./库/image-20230517004954304.png" referrerpolicy="no-referrer" alt="image-20230517004954304"></p><p>&nbsp;</p><p><span>优点：</span></p><ul><li><p><span>单个活动节点能以全速R连续传输</span></p></li><li><p><span>高度分散：时隙只在节点同步</span></p></li><li><p><span>简单</span></p></li></ul><p>&nbsp;</p><p><span>缺点：</span></p><ul><li><p><span>碰撞，浪费时隙</span></p></li><li><p><span>时隙空闲</span></p></li><li><p><span>节点需要在分组传送时间以内检测到碰撞</span></p></li><li><p><span>时钟同步</span></p></li></ul><p>&nbsp;</p><p><span>效率 ：当有大量活动节点、每个节点总有大量帧发送、长期运行时成功时隙的份额</span></p><p>&nbsp;</p><p><span>假定 N 个节点有大量帧发送，每个节点在每个时隙传送帧的概率为p</span></p><p><span>一个给定节点成功传送的概率为p(1-p)</span><sup><span>N-1</span></sup></p><p><span>任意一个节点成功的概率= Np(1-p)</span><sup><span>N-1</span></sup></p><p><span>为获得N个节点的最大效率，需要找到使Np(1-p)</span><sup><span>N-1</span></sup><span>最大化的p</span></p><p><span>当N趋于无穷时，求Np</span><em><span>(1-p</span></em><span>)</span><sup><span>N-1</span></sup><span>的极限, 得到最大效率为 1/e = 0.37</span></p><p><span>最佳情况: 信道使用率只有37%!</span></p><p>&nbsp;</p><p><strong><span>如果没有抢到时隙的开始发送，就意味这要等待整个时隙</span></strong></p><p>&nbsp;</p><blockquote><p><span>时隙的目的是什么？</span></p></blockquote><p>&nbsp;</p><h5 id='纯aloha'><span>纯ALOHA</span></h5><p><span>非时隙ALOHA：简单，不需同步</span></p><p><span>当帧首次到达，节点立刻传送</span></p><p><span>碰撞可能增加</span></p><p>&nbsp;</p><p><span>t</span><sub><span>0</span></sub><span> 时刻发送的帧与 [t</span><sub><span>0-1</span></sub><span>,t</span><sub><span>0+1</span></sub><span>]之内发送的帧碰撞</span></p><p><img src="./库/image-20230517005420513.png" referrerpolicy="no-referrer" alt="image-20230517005420513"></p><p>&nbsp;</p><p><span>纯ALOHA的工作效率：</span></p><p><span>P(给定节点成功概率) = P(给定节点传送)×P(在[t0-1，t0]没有其它节点传送)×P(在[t0，t0+1]没有其它节点传送)</span></p><p><span>									</span><span>= p×(1-p)</span><sup><span>N-1</span></sup><span>×(1-p)</span><sup><span>N-1</span></sup></p><p><span>									</span><span>= p×(1-p)</span><sup><span>2(N-1)</span></sup></p><p><span>选择最合适p，n趋于无穷，取极限 = 1/(2e) = 0.18</span></p><p>&nbsp;</p><blockquote><p><span>在计算机网络中，ALOHA（亦称随机接入）和CSMA（载波侦听多路访问）是两种常见的访问控制协议，用于解决多个设备共享同一网络媒介时的冲突问题。它们的主要区别如下：</span></p><ol start='' ><li><p><span>碰撞检测：ALOHA和CSMA使用不同的碰撞检测机制。在ALOHA中，发送方发送数据后，会立即进行碰撞检测，如果检测到碰撞，则采取退避重传策略。而CSMA使用载波侦听机制，在发送前先侦听媒介上是否有其他设备正在发送数据，如果侦听到载波（即有设备在发送），则等待一段时间再发送，以避免碰撞。</span></p></li><li><p><span>随机性：ALOHA是一种纯粹的随机接入协议。当设备准备发送数据时，它会随机选择一个时间窗口进行发送。如果发生碰撞，设备会等待随机的时间后再次尝试发送。而CSMA引入了持续侦听机制，设备会在侦听到载波时等待一段随机的时间，然后再次侦听，如果媒介仍然被占用，则继续等待。</span></p></li><li><p><span>效率：由于ALOHA的随机性较高，可能导致碰撞较多，从而降低网络效率。而CSMA的载波侦听机制能够提高效率，因为设备在发送前会先侦听媒介上是否有其他设备发送数据。</span></p></li></ol></blockquote><p>&nbsp;</p><blockquote><p><span>ALOHA和CSMA都是用于计算机网络中的媒体访问控制协议。</span></p><p><span>ALOHA协议是一种最简单的媒体访问控制协议，它允许任何节点在任何时候发送数据帧，而不考虑其他节点的活动。如果两个或更多个节点同时发送数据帧，则这些数据帧将在传输介质上发生碰撞，导致数据的丢失。在发生碰撞后，节点会等待一个随机时间间隔，然后重试发送。</span></p><p><span>CSMA（载波监听多路访问）协议是一种更为复杂的媒体访问控制协议。在CSMA协议中，节点会在发送数据之前监听网络，以确保没有其他节点正在发送数据。如果网络上没有其他节点发送数据，则节点可以发送数据。如果另一个节点同时发送数据，则会发生碰撞，发送的数据帧将会丢失。在这种情况下，节点会等待一个随机时间间隔后重新尝试发送数据。</span></p><p><span>因此，ALOHA协议允许任何节点在任何时候发送数据，而CSMA协议要求节点在发送数据之前进行一些检查，以减少碰撞的发生。</span></p></blockquote><p>&nbsp;</p><h4 id='csma'><span>CSMA</span></h4><h5 id='csma分类'><span>CSMA分类</span></h5><ul><li><p><span>非坚持（nonpersistent）CSMA：一旦监听到信道忙（即发现有其他站在发送数据），就不再坚持听下去，而是根据协议的算法延迟一个随机的时间后重新再监听。若进行载波监听时发现信道空闲，则将准备好的帧发送出去。</span></p></li><li><p><span>时隙非坚持CSMA：采用划分时隙的随机接入CSMA协议，协议规定只能在每个时隙开始时才能发送帧。</span></p></li><li><p><span>1坚持CSMA：当一个站点要传送数据时，首先侦听信道，看是否有其他站点正在传送。如果信道正忙，它就持续等待直到它侦听到信道空闲时，便将数据送出。若发生冲突，站点就等待一个随机长的时间，然后重新开始。</span></p></li><li><p><span>P坚持CSMA：当一个站点要传送数据时，首先侦听信道，看是否有其他站点正在传送。如果信道正忙，它就持续等待直到它侦听到信道空闲时，以概率P发送数据，而以概率（1－P）延迟一段时间τ（网络中最远的端到端的传播时延），重新监听信道。若发生冲突，站点就等待一个随机长的时间，然后重新开始。</span></p></li></ul><p>&nbsp;</p><h5 id='csma比较'><span>CSMA比较</span></h5><ul><li><p><span>非坚持：不能充分利用信道刚刚转入空闲期的这段时间。</span></p></li><li><p><span>1坚持：容易在上述这段时间产生冲突。</span></p></li><li><p><span>P坚持：可以在一定程度上克服这些缺点，但却很难选择一个能用于各种通信量强度的P值。</span></p></li></ul><p><strong><span>在实际网络中常选择1坚持CSMA</span></strong></p><p>&nbsp;</p><h5 id='csmacd'><span>CSMA/CD</span></h5><p><span>在短时间内碰撞被检测</span></p><p><span>在有线LANs中比较容易：测量信号强度，比较收、发的信号</span></p><p><span>在无线LANs中比较困难：传输时接收器是关闭的；接收的信号强度远小于发送信号强度</span></p><p><span>碰撞后停止传输，减少信道浪费</span></p><p>&nbsp;</p><h6 id='强化碰撞'><span>强化碰撞</span></h6><p><span>当发送数据的站一旦发现发生了碰撞时，除了立即停止发送数据外，还要再继续发送若干比特的人为干扰信号（jamming signal），以便让所有用户都知道现在已经发生了碰撞。</span></p><p>&nbsp;</p><h6 id='争用期'><span>争用期</span></h6><p><span>最先发送数据帧的站，在发送数据帧后至多经过时间 𝟐𝝉（两倍的端到端时延）就可知道发送的数据帧是否遭受了碰撞。以太网的端到端往返时延 𝟐𝝉 称为争用期，或碰撞窗口。经过争用期这段时间还没有检测到碰撞，才能肯定这次发送不会发生碰撞。</span></p><p>&nbsp;</p><h6 id='以太网csmacd算法'><span>以太网CSMA/CD算法</span></h6><ol start='' ><li><p><span>网卡从网络层接收数据报，创建数据帧</span></p></li><li><p><span>如果网卡检测信道空闲，开始帧传输</span></p></li><li><p><span>如果网卡的检测信道忙，等待直到信道空闲，然后发送</span></p></li><li><p><span>如果网卡发送整个帧没有探测到另一个传输，网卡完成帧发送！</span></p></li><li><p><span>如果网卡检测到另一个传输，传输终止并发送干扰信号</span></p></li><li><p><span>传输终止后，进入二进制（指数）退避</span></p></li></ol><p>&nbsp;</p><p><span>第m次碰撞后，网卡随机从{0，1，2，...，2</span><sup><span>m-1</span></sup><span>}选择K。网卡等待K×512bit时间。返回第2步。</span></p><p><strong><span>越多的碰撞，越大的退避间隔。</span></strong></p><p>&nbsp;</p><p>&nbsp;</p><h3 id='轮流协议'><span>轮流协议</span></h3><h2 id='交换局域网'><span>交换局域网</span></h2><h2 id='回顾web页面请求的历程'><span>回顾：Web页面请求的历程</span></h2><p>&nbsp;</p><h1 id='第一章'><span>第一章</span></h1><h2 id='信息时代的计算机网络'><span>信息时代的计算机网络</span></h2><h2 id='因特网概述'><span>因特网概述</span></h2><h3 id='网络互连网互联网）与因特网的区别与关系'><span>网络、互连网（互联网）与因特网的区别与关系</span></h3><ul><li><p><span>若干节点和链路互连形成网络</span></p></li><li><p><span>若干网络通过路由器互连形成互连网（互联网）</span></p></li><li><p><span>因特网是当今世界上最大的互联网</span></p></li></ul><p>&nbsp;</p><p><span>我们有时并没有严格区分互联网和因特网这两个名词，许多人口中的互联网实际上是指因特网。</span></p><p>&nbsp;</p><h3 id='internet'><span>internet</span></h3><p><span>通用名词</span></p><p><span>互连网（互联网）</span></p><p><span>任意通信协议</span></p><p>&nbsp;</p><h3 id='internet-2'><span>Internet</span></h3><p><span>专用名词</span></p><p><span>因特网</span></p><p><span>TCP/IP协议族</span></p><p>&nbsp;</p><p><span>因特网服务提供者（Internet Service Provider，ISP）</span></p><p><span>因特网已发展成为基于ISP的多层次结构的互连网络</span></p><p><img src="./库/image-20230514171427242.png" alt="image-20230514171427242" style="zoom:33%;" /></p><p>&nbsp;</p><p><span>因特网的标准化工作</span></p><p><span>因特网的标准化工作是面向公众的，其任何一个建议标准在成为因特网标准之前都以RFC技术文档的形式在因特网上发表。</span></p><p><span>RFC（Request For Comments）的意思是“请求评论”。任何人都可以从因特网上免费下载RFC文档（</span><a href='http://www.ietf.org/rfc.html' target='_blank' class='url'>http://www.ietf.org/rfc.html</a><span>），并随时对某个RFC文档发表意见和建议。</span></p><p>&nbsp;</p><p><span>因特网的管理机构</span></p><p><img src="./库/image-20230514171540416.png" alt="image-20230514171540416" style="zoom: 33%;" /></p><p>&nbsp;</p><h2 id='三种交换方式'><span>三种交换方式</span></h2><h3 id='电路交换'><span>电路交换</span></h3><p><img src="./库/image-20230514171656527.png" alt="image-20230514171656527" style="zoom:33%;" /></p><p>&nbsp;</p><p><span>        计算机之间的数据传送是突发式的，当使用电路交换来传送计算机数据时，其线路的传输效率一般都会很低，线路上真正用来传送数据的时间往往不到10%甚至1%。</span></p><p>&nbsp;</p><h3 id='分组交换'><span>分组交换</span></h3><p><img src="./库/image-20230514193704138.png" alt="image-20230514193704138" style="zoom: 50%;" /></p><ul><li><p><span>发送方：构造分组、转发分组</span></p></li><li><p><span>交换节点：缓存分组、转发分组</span></p></li><li><p><span>接收方：接收分组、还原报文</span></p></li></ul><p>&nbsp;</p><p><span>分组交换的优点：</span></p><ul><li><p><span>没有建立连接和释放连接的过程。</span></p></li><li><p><span>分组传输过程中逐段占用通信链路，有较高的通信线路利用率。</span></p></li><li><p><span>交换节点可以为每一个分组独立选择转发路由，使得网络有很好的生存性。</span></p></li></ul><p>&nbsp;</p><p><span>分组交换的缺点：</span></p><ul><li><p><span>分组首部带来了额外的传输开销。</span></p></li><li><p><span>交换节点存储转发分组会造成一定的时延。</span></p></li><li><p><span>无法确保通信时端到端通信资源全部可用，在通信量较大时可能造成网络拥塞。</span></p></li><li><p><span>分组可能会出现失序和丢失等问题。</span></p></li></ul><p>&nbsp;</p><h3 id='报文交换'><span>报文交换</span></h3><p><span>报文交换是分组交换的前身。</span></p><p><span>在报文交换中，报文被整个地发送，而不是拆分成若干个分组进行发送。</span></p><p><span>交换节点将报文整体接收完成后才能查找转发表，将整个报文转发到下一个节点。</span></p><p><span>因此，报文交换比分组交换带来的转发时延要长很多，需要交换节点具有的缓存空间也大很多。</span></p><p>&nbsp;</p><h3 id='三种交换方式的对比'><span>三种交换方式的对比</span></h3><p><img src="./库/image-20230514193937005.png" referrerpolicy="no-referrer" alt="image-20230514193937005"></p><p><span>若要连续传送大量的数据，并且数据传送时间远大于建立连接的时间，则使用电路交换可以有较高的传输效率。然而计算机的数据传送往往是突发式的，采用电路交换时通信线路的利用率会很低。</span></p><p><span>报文交换和分组交换都</span><strong><span>不需要建立连接</span></strong><span>（即预先分配通信资源），在传送计算机的突发数据时可以提高通信线路的利用率。</span></p><p><span>将报文构造成若干个更小的分组进行分组交换，比将整个报文进行报文交换的时延要小，并且还可以避免太长的报文长时间占用链路，有利于差错控制，同时具有更好的灵活性。</span></p><p>&nbsp;</p><h2 id='计算机网络的定义和分类'><span>计算机网络的定义和分类</span></h2><p><span>现阶段计算机网络的一个较好的定义：</span></p><p><span>计算机网络主要是由一些通用的、可编程的硬件互连而成的，而这些硬件并非专门用来实现某一特定目的（例如，传送数据或视频信号）。这些可编程的硬件能够用来传送多种不同类型的数据，并能支持广泛的和日益增长的应用。</span></p><p>&nbsp;</p><p><span>覆盖范围：</span></p><ul><li><p><span>广域网WAN</span><span>	</span><span>几十千米</span></p></li><li><p><span>城域网MAN    5-50km</span></p></li><li><p><span>局域网LAN     1000m</span></p></li><li><p><span>个域网PAN    10m</span></p></li></ul><p>&nbsp;</p><p><span>拓扑结构：</span></p><ul><li><p><span>总线型</span></p></li><li><p><span>星形</span></p></li><li><p><span>环形</span></p></li><li><p><span>网状型</span></p></li></ul><p>&nbsp;</p><h2 id='计算机网络的性能指标'><span>计算机网络的性能指标</span></h2><p><span>计算机网络的性能指标被用来从不同方面度量计算机网络的性能。</span></p><ul><li><p><span>速率</span></p></li><li><p><span>带宽</span></p></li><li><p><span>吞吐量</span></p></li><li><p><span>时延</span></p></li><li><p><span>时延带宽积</span></p></li><li><p><span>往返时间</span></p></li><li><p><span>利用率</span></p></li><li><p><span>丢包率</span></p></li></ul><p>&nbsp;</p><h3 id='速率'><span>速率</span></h3><p><span>比特（bit，记为小写b）是计算机中</span><strong><span>数据量的基本单位</span></strong><span>，一个比特就是二进制数字中的一个1或0。</span></p><p><span>数据量的常用单位有字节（byte，记为大写B）、千字节（KB）、兆字节（MB）、吉字节（GB）以及太字节（TB）。</span></p><p><img src="./库/image-20230514194623658.png" alt="image-20230514194623658" style="zoom: 50%;" /></p><p>&nbsp;</p><p><span>速率是指数据的传送速率（即每秒传送多少个比特），也称为数据率（Data Rate）或比特率（Bit Rate）。</span></p><p><span>速率的基本单位是比特/秒（bit/s，可简记为b/s，有时也记为bps，即bit per second）。速率的常用单位有千比特/秒（kb/s或kbps）、兆比特/秒（Mb/s或Mbps）、吉比特/秒（Gb/s或Gbps）以及太比特/秒（Tb/s或Tbps）。</span></p><p><img src="./库/image-20230514194651735.png" alt="image-20230514194651735" style="zoom:50%;" /></p><p>&nbsp;</p><p><strong><span>数据量单位</span></strong><span>中的K、M、G、T的数值分别为2</span><sup><span>10</span></sup><span>、2</span><sup><span>20</span></sup><span>、2</span><sup><span>30</span></sup><span>、2</span><sup><span>40</span></sup></p><p><strong><span>速率单位</span></strong><span>中的k、M、G、T的数值分别为10</span><sup><span>3</span></sup><span>、10</span><sup><span>6</span></sup><span>、10</span><sup><span>9</span></sup><span>、10</span><sup><span>12</span></sup></p><p><img src="./库/image-20230514194916026.png" referrerpolicy="no-referrer" alt="image-20230514194916026"></p><p>&nbsp;</p><p><span>【练习1】有一个待发送的数据块，大小为100MB，网卡的发送速率为100Mbps，则网卡发送完该数据块需要多长时间？</span></p><p><img src="./库/image-20230514195010619.png" alt="image-20230514195010619" style="zoom: 50%;" /></p><p>&nbsp;</p><h3 id='带宽'><span>带宽</span></h3><p><span>带宽在模拟信号系统中的意义：某个信号所包含的各种不同频率成分所占据的频率范围。单位：Hz（kHz，MHz，GHz）。</span></p><p>&nbsp;</p><p><span>带宽在计算机网络中的意义：用来表示网络的通信线路所能传送数据的能力，即在单位时间内从网络中的某一点到另一点所能通过的最高数据率。单位：b/s（kb/s，Mb/s，Gb/s，Tb/s）。</span></p><p>&nbsp;</p><p><strong><span>数据传送速率 = min [ 主机接口速率，线路带宽，交换机或路由器的接口速率 ]</span></strong></p><p>&nbsp;</p><p><u><span>注意：带宽一般指的是线路上的带宽，而总的数据传输速率要从多个角度考虑</span></u></p><p>&nbsp;</p><h3 id='吞吐量-2'><span>吞吐量</span></h3><p><span>吞吐量是指在单位时间内通过某个网络或接口的实际数据量。吞吐量常被用于对实际网络的测量，以便获知到底有多少数据量通过了网络。</span></p><p><span>吞吐量受网络带宽的限制。</span></p><p>&nbsp;</p><h3 id='时延-2'><span>时延</span></h3><p><span>时延是指数据从网络的一端传送到另一端所耗费的时间，也称为延迟或迟延。 数据可由一个或多个分组、甚至是一个比特构成。</span></p><p><span>四种时延：</span></p><ul><li><p><span>发送时延</span></p></li><li><p><span>排队时延（不方便计算）</span></p></li><li><p><span>处理时延（不方便计算）</span></p></li><li><p><span>传播时延</span></p></li></ul><p><img src="./库/image-20230515095955476.png" alt="image-20230515095955476" style="zoom:33%;" /></p><p><span>注意：发送速率 = min [主机接口速率， 线路带宽，交换机或路由器的接口速率]</span></p><p><span>自由空间：3.0 × 10</span><sup><span>8</span></sup><span> m/s</span>
<span>铜线：2.3 × 10</span><sup><span>8</span></sup><span> m/s</span>
<span>光纤：2.0 × 10</span><sup><span>8</span></sup><span> m/s</span></p><p><img src="./库/image-20230515100123718.png" alt="image-20230515100123718" style="zoom:33%;" /></p><p><img src="./库/image-20230515100203638.png" alt="image-20230515100203638" style="zoom:33%;" /></p><p><span>简单起见，未画出分组在路由器上的排队时延和处理时延。</span></p><p>&nbsp;</p><p><img src="./库/image-20230515100927162.png" alt="image-20230515100927162" style="zoom:50%;" /></p><p>&nbsp;</p><h3 id='时延带宽积'><span>时延带宽积</span></h3><p><span>时延带宽积是传播时延和带宽的乘积。</span></p><p><span>【举例】主机A和B之间采用光纤链路，链路长1km，链路带宽为1Gb/s，请计算该链路的时延带宽积。</span></p><p><img src="./库/image-20230515101250758.png" alt="image-20230515101250758" style="zoom:33%;" /></p><p><span>因此，链路的时延带宽积也称为以比特为单位的链路长度，这对我们以后理解以太网的最短帧长是非常有帮助的。</span></p><p>&nbsp;</p><h3 id='往返时间'><span>往返时间</span></h3><p><span>往返时间（Round-Trip Time，RTT）是指从发送端发送数据分组开始，到发送端收到接收端发来的相应确认分组为止，总共耗费的时间。</span></p><p>&nbsp;</p><h3 id='利用率'><span>利用率</span></h3><p><span>链路利用率：链路利用率是指某条链路有百分之几的时间是被利用的（即</span><strong><span>有数据通过</span></strong><span>）。完全空闲的链路的利用率为零。</span></p><p><span>网络利用率：网络利用率是指网络中所有链路的链路利用率的加权平均。</span></p><p>&nbsp;</p><p><span>根据排队论可知，当某链路的利用率增大时，该链路引起的时延就会迅速增加。</span></p><p><span>当网络的通信量较少时，产生的时延并不大，但在网络通信量不断增大时，分组在交换节点（路由器或交换机）中的排队时延会随之增大，因此网络引起的时延就会增大。</span></p><p><span>令D</span><sub><span>0</span></sub><span>表示网络空闲时的时延，D表示网络当前的时延，那么在理想的假定条件下，可用下式来表示D、D</span><sub><span>0</span></sub><span>和网络利用率U之间的关系。</span></p><p><img src="./库/image-20230515101819662.png" alt="image-20230515101819662" style="zoom:33%;" /></p><p><img src="./库/image-20230515101853701.png" alt="image-20230515101853701" style="zoom: 33%;" /></p><p>&nbsp;</p><h3 id='丢包率'><span>丢包率</span></h3><p><span>丢包率是指在一定的时间范围内，传输过程中丢失的分组数量与总分组数量的比率。</span></p><p><span>可能发生丢包的位置：</span></p><ul><li><p><span>接口</span></p></li><li><p><span>节点</span></p></li><li><p><span>链路</span></p></li><li><p><span>路径</span></p></li><li><p><span>网络</span></p></li></ul><p>&nbsp;</p><p><span>分组丢失主要有以下两种情况：</span></p><ul><li><p><span>分组在传输过程中出现误码，被传输路径中的节点交换机（例如路由器）或目的主机检测出误码而丢弃。</span></p></li><li><p><span>节点交换机根据丢弃策略主动丢弃分组。</span></p></li></ul><p>&nbsp;</p><p><span>丢包率可以反映网络的拥塞情况：</span></p><ul><li><p><span>无拥塞时路径丢包率为0。</span></p></li><li><p><span>轻度拥塞时路径丢包率为1%~4%。</span></p></li><li><p><span>严重拥塞时路径丢包率为5%~15%。</span></p></li></ul><p>&nbsp;</p><h2 id='计算机网络体系结构'><span>计算机网络体系结构</span></h2><p><span>计算机网络体系结构原理参考模型：</span></p><p><img src="./库/image-20230515102240349.png" alt="image-20230515102240349" style="zoom:33%;" /></p><p><span>“分层”可将庞大复杂的问题转化为若干较小的局部问题。</span></p><p>&nbsp;</p><p><span>分层：</span></p><ul><li><p><span>应用层：解决通过应用进程的交互来实现特定网络应用的问题</span></p></li><li><p><span>运输层：解决进程之间基于网络的通信问题</span></p></li><li><p><span>网络层：解决数据包在多个网络之间传输和路由的问题</span></p></li><li><p><span>链路层：解决数据包在一个网络或一段链路上传输的问题</span></p></li><li><p><span>物理层：解决使用何种信号来表示比特0和1的问题</span></p></li></ul><p>&nbsp;</p><p><span>计算机网络体系结构中的专用术语：</span></p><ul><li><p><span>实体</span></p><ul><li><p><span>实体是指任何可发送或接收信息的硬件或软件进程。</span></p></li><li><p><span>对等实体是指通信双方相同层次中的实体。</span></p></li></ul></li><li><p><span>协议</span></p><ul><li><p><span>协议是控制两个对等实体在“水平方向” 进行“逻辑通信”的规则的集合。</span></p></li><li><p><span>协议的三要素</span></p><ul><li><p><span>语法：定义所交换信息的格式（报文头部）</span></p></li><li><p><span>语义：定义通信双方所要完成的操作</span></p></li><li><p><span>同步：定义通信双方的时序关系</span></p></li></ul></li></ul></li><li><p><span>服务</span></p><ul><li><p><span>在协议的控制下，两个对等实体在水平方向的逻辑通信使得本层能够向上一层提供服务。</span></p></li><li><p><span>要实现本层协议，还需要使用下面一层所提供的服务。</span></p></li><li><p><span>协议是“水平”的，而服务是“垂直”的。</span></p></li><li><p><span>实体看得见下层提供的服务，但并不知道实现该服务的具体协议。下层的协议对上层的实体是“透明”的。</span></p></li><li><p><span>在同一系统中相邻两层的实体交换信息的逻辑接口称为</span><u><span>服务访问点SAP</span></u><span>，它被用于区分不同的服务类型。</span></p></li><li><p><span>帧的“类型”字段、IP数据报的“协议”字段，TCP报文段或UDP用户数据报的“端口号”字段都是SAP。</span></p></li><li><p><span>上层要使用下层所提供的服务，必须通过与下层交换一些命令，这些命令称为服务原语。</span></p></li><li><p><strong><span>对等层次</span></strong><span>之间传送的数据包称为</span><strong><span>该层的协议数据单元</span></strong><span>（Protocol Data Unit，PDU）。</span></p></li><li><p><strong><span>同一系统内层与层之间</span></strong><span>交换的数据包称为</span><strong><span>服务数据单元</span></strong><span>（Service Data Unit，SDU）。</span></p></li></ul></li></ul><p>&nbsp;</p><h1 id='第二章'><span>第二章</span></h1><h2 id='物理层基本概念'><span>物理层基本概念</span></h2><h2 id='物理层下面的传输媒体'><span>物理层下面的传输媒体</span></h2><h2 id='传输方式'><span>传输方式</span></h2><h2 id='编码与调制'><span>编码与调制</span></h2><p>&nbsp;</p><h2 id='信道的极限容量'><span>信道的极限容量</span></h2><h2 id='信道复用技术'><span>信道复用技术</span></h2><h3 id='信道复用技术的基本原理'><span>信道复用技术的基本原理</span></h3><p><span>复用（Multiplexing）就是在一条传输媒体上同时传输多路用户的信号。</span></p><p><span>当一条传输媒体的传输容量大于多条信道传输的总容量时，就可以通过复用技术，在这条传输媒体上建立多条通信信道，以便充分利用传输媒体的带宽。</span></p><p><span>尽管实现信道复用会增加通信成本（需要复用器、分用器以及费用较高的大容量共享信道），但如果复用的信道数量较大，还是比较划算的。</span></p><p><img src="./库/image-20230516131225269.png" alt="image-20230516131225269" style="zoom:25%;" /></p><p>&nbsp;</p><h3 id='常见的信道复用技术'><span>常见的信道复用技术</span></h3><ul><li><p><span>频分复用FDM</span></p></li><li><p><span>时分复用TDM</span></p></li><li><p><span>波分复用WDM</span></p></li><li><p><span>码分复用CDM</span></p></li></ul><p>&nbsp;</p><h4 id='频分复用fdm'><span>频分复用FDM</span></h4><p><span>频分复用的所有用户同时占用不同的频带资源并行通信</span></p><p><img src="./库/image-20230516131322978.png" alt="image-20230516131322978" style="zoom:33%;" /></p><p>&nbsp;</p><h4 id='时分复用tdm'><span>时分复用TDM</span></h4><p><span>时分复用的所有用户在不同的时间占用同样的频带</span></p><p><img src="./库/image-20230516131354636.png" alt="image-20230516131354636" style="zoom:33%;" /></p><p>&nbsp;</p><h4 id='波分复用wdm'><span>波分复用WDM</span></h4><p><span>光的频分复用FDM。</span></p><p><span>根据频分复用的设计思想，可在一根光纤上同时传输多个频率（波长）相近的光载波信号，实现基于光纤的频分复用技术。目前可以在一根光纤上复用80路或更多路的光载波信号。因此，这种复用技术也称为密集波分复用DWDM。</span></p><p><span>铺设光缆的工程耗资巨大，应尽量在一根光缆中放入尽可能多的光纤，然后对每一根光纤使用密集波分复用技术。</span></p><p><span>例如，在一根光缆中放入100根速率为2.5Gb/s的光纤，对每根光纤采用40倍的密集波分复用，则这根光缆的总数据速率为（2.5Gb/s × 40）× 100 = 10000Gb/s = 10Tb/s。</span></p><p>&nbsp;</p><h4 id='码分复用cdm'><span>码分复用CDM</span></h4><p><span>码分复用（Code Division Multiplexing，CDM）常称为码分多址（Code Division Multiple Access，CDMA），它是在扩频通信技术的基础上发展起来的一种无线通信技术。</span></p><p><span>与FDM和TDM不同，CDMA的每个用户可以在相同的时间使用相同的频带进行通信。</span></p><p><span>CDMA最初用于军事通信，这种系统发送的信号有很强的抗干扰能力，其频谱类似于白噪声，不易被敌人发现。随着技术的进步，CDMA设备的价格和体积都大幅度下降，因而现在已广泛用于民用的移动通信中。</span></p><p>&nbsp;</p><p><span>CDMA</span><strong><span>将每个比特时间划分为m个更短的时间片，称为码片</span></strong><span>（Chip）。m的取值通常为64或128。</span></p><p><span>为了简单起见，在后续的举例中，我们假设m的取值为8。</span></p><p><span>CDMA中的每个站点都被指派一个唯一的m比特码片序列（Chip Sequence）。</span></p><ul><li><p><span>某个站要发送比特1，则发送它自己的m比特码片序列；</span></p></li><li><p><span>某个站要发送比特0，则发送它自己的m比特码片序列的反码。</span></p></li></ul><p>&nbsp;</p><p><span>【举例】</span></p><p><span>假设给某个站指派的8比特码片序列为01011001</span></p><ul><li><p><span>该站发送比特1：发送自己的8比特码片序列01011001</span></p></li><li><p><span>该站发送比特0：发送自己的8比特码片序列01011001的反码10100110</span></p></li></ul><p><span>将码片序列中的比特0记为-1，而比特1记为+1，可写出码片序列相应的码片向量。在本例中，该站的码片向量为（-1 +1 -1 +1 +1 -1 -1 +1）。</span></p><p>&nbsp;</p><p><span>如果有两个或多个站同时发送数据，则信道中的信号就是这些站各自所发送一系列码片序列或码片序列反码的叠加（就是每一位都做加法）。为了从信道中分离出每个站的信号，给每个站指派码片序列时，必须遵循以下规则：</span></p><ul><li><p><span>分配给每个站的码片序列必须各不相同，实际常采用伪随机码序列。</span></p></li><li><p><span>分配给每个站的码片序列必须相互正交，即各码片序列相应的码片向量之间的规格化內积为0。</span></p></li></ul><p><span>令向量A表示站A的码片向量，向量B表示站B的码片向量。</span></p><p><span>两个不同站A和B的码片序列相互正交，就是向量A与向量B的规格化內积为0，如下式所示。</span></p><p><img src="./库/image-20230516131804231.png" alt="image-20230516131804231" style="zoom:33%;" /></p><p><span>如果计算出来的结果是0，则说明没有给该设备发送信息。</span></p><p>&nbsp;</p><h1 id='第三章'><span>第三章</span></h1><h2 id='数据链路层概述'><span>数据链路层概述</span></h2><p><span>链路（Link）是指从一个节点到相邻节点的一段物理线路（有线或无线），而中间没有任何其他的交换节点。</span></p><p><span>数据链路（Data Link）是基于链路的。当在一条链路上传送数据时，除需要链路本身，还需要一些必要的通信协议来控制这些数据的传输，把实现这些协议的硬件和软件加到链路上，就构成了数据链路。</span></p><p><span>计算机中的网络适配器（俗称网卡）和其相应的软件驱动程序就实现了这些协议。一般的网络适配器都包含了物理层和数据链路层这两层的功能。</span></p><p><span>帧（Frame）是数据链路层对等实体之间在水平方向进行逻辑通信的协议数据单元PDU。</span></p><blockquote><p><span>每一层水平方向通信的协议数据单元都有自己的名字</span></p></blockquote><p>&nbsp;</p><p><span>节点：主机和路由器</span></p><p><span>链路：沿着通信路径连接相邻节点的通信信道（有线链路、无线链路）</span></p><p><span>链路层帧：链路层的PDU</span></p><p><strong><span>链路层的主要功能：负责将数据报通过链路从一个节点传输到物理上相邻的节点</span></strong></p><p>&nbsp;</p><p><span>几点特别说明：</span></p><ol start='' ><li><p><span>数据报在不同链路上可能由不同的链路层协议进行处理，第一段链路上由PPP处理，最后一段链路上由以太网处理，中间链路上由广域链路层协议处理</span></p></li><li><p><span>不同的链路层协议可能提供不同的服务（可靠传递、不可靠传递）</span></p></li></ol><p>&nbsp;</p><p><span>链路层提供的服务：</span></p><ul><li><p><span>成帧</span></p><ul><li><p><span>将数据加上头部和尾部，封装成数据帧</span></p></li><li><p><span>帧头部用MAC地址标识源和目的（不同于IP地址）</span></p></li></ul></li><li><p><span>链路接入（共享介质的信道访问）</span></p></li><li><p><span>可靠交付</span></p><ul><li><p><span>很少用于误码率低的链路（光纤、双绞线链路）</span></p></li><li><p><span>用于误码率高的链路（无线链路）</span></p></li></ul></li><li><p><span>差错检测和纠正</span></p><ul><li><p><span>信号衰减和电磁干扰噪声导致出错</span></p></li><li><p><span>接收方检测到错误存在</span></p><ul><li><p><span>给发送方发送信号要求重传或丢弃该数据帧</span></p></li><li><p><span>接收方检测和纠正帧中错误，不用重传</span></p></li></ul></li></ul></li><li><p><span>流量控制</span></p><ul><li><p><span>在相邻的收发节点间限制流量</span></p></li></ul></li><li><p><span>半双工和全双工</span></p><ul><li><p><span>半双工时，链路两端的节点都能传输分组，但不能同时传输</span></p></li></ul></li><li><p><span>适配器通信</span></p><ul><li><p><span>在每一台设备上（主机、交换机、路由器）</span></p></li><li><p><span>链路层在“适配器”（网卡NIC）或者芯片上实现</span></p></li><li><p><span>直接与主机的系统总线相连</span></p></li><li><p><span>是硬件、软件和固件的结合体</span></p></li></ul></li></ul><p>&nbsp;</p><h2 id='数据链路层的三个重要问题'><span>数据链路层的三个重要问题</span></h2><ul><li><p><span>封装成帧和透明传输</span></p><ul><li><p><span>数据链路层给上层交付下来的协议数据单元PDU添加帧首部和帧尾部，这称为封装成帧。</span></p></li><li><p><span>如果能够采取措施，使得数据链路层对上层交付的PDU的内容没有任何限制，就好像数据链路层不存在一样，就称其为透明传输。</span></p></li></ul></li><li><p><span>差错检测</span></p><ul><li><p><span>帧在传输的过程中可能出现误码。</span></p></li><li><p><span>接收方根据发送方添加在帧尾部中的检错码，可以检测出帧是否出现了误码。</span></p></li><li><p><span>EDC= Error Detection and Correction bits 差错检测和纠错比特</span></p></li><li><p><span>D = Data 差错检测位保护的数据，可包括首部</span></p></li><li><p><span>差错检测不是100%可靠的，EDC越长，则出错的概率越低！</span></p></li></ul></li><li><p><span>可靠传输</span></p><ul><li><p><span>不可靠传输服务：收到有误码的帧，直接丢弃，其他什么也不做；未收到发送方发送的帧，也不进行任何处理。</span></p></li><li><p><span>可靠传输服务：实现发送方发送什么，接收方最终都能正确收到。</span></p></li></ul></li></ul><p>&nbsp;</p><h3 id='封装成帧'><span>封装成帧</span></h3><p><img src="./库/image-20230515103429985.png" referrerpolicy="no-referrer" alt="image-20230515103429985"></p><p><span>封装成帧是指数据链路层给上层交付下来的协议数据单元PDU添加一个首部和一个尾部，使之成为帧。</span></p><p><span>帧的首部和尾部中包含有一些重要的控制信息。</span></p><p><span>帧首部和尾部的作用之一就是帧定界。</span></p><blockquote><p><span>并不是每一种数据链路层协议的帧都包含有帧定界标志。</span></p><p><span>以太网V2的MAC帧（最大长度 1518 B），其帧首部和尾部中并没有帧定界标志。</span></p><p><span>以太网V2的MAC帧具有前导码，帧间间隔（发送96比特所耗费的时间）</span></p></blockquote><p>&nbsp;</p><p><span>为了提高数据链路层传输帧的效率，应当使帧的数据载荷的长度尽可能地大于首部和尾部的长度。</span></p><p><span>考虑到对缓存空间的需求以及差错控制等诸多因素，每一种数据链路层协议都规定了帧的数据载荷的长度上限，即</span><strong><span>最大传送单元</span></strong><span>（Maximum Transfer Unit，</span><strong><span>MTU</span></strong><span>）。例如，以太网的MTU为1500个字节。</span></p><p>&nbsp;</p><h3 id='透明传输'><span>透明传输</span></h3><p><span>每一个链路层帧的帧首部和帧尾部都有标志字段（帧界定符），但是在数据载荷部分也有可能出现标志字段。</span></p><p><span>如果不解决上述问题，则数据链路层就会对上层交付的PDU的内容有所限制，即PDU中不能包含帧定界符。显然，这样的数据链路层没有什么应用价值。</span></p><p><span>如果能够采取措施，使得数据链路层对上层交付的PDU的内容没有任何限制，就好像数据链路层不存在一样，就称其为透明传输。</span></p><p>&nbsp;</p><ul><li><p><span>面向字节的物理链路使用字节填充的方法实现透明传输。</span></p></li><li><p><span>面向比特的物理链路使用比特填充的方法实现透明传输。</span></p></li></ul><p>&nbsp;</p><p><span>【2013年 题37】HDLC协议对0111110001111110组帧后对应的比特串为011111000011111010</span></p><p><span>解析：高级数据链路控制协议HDLC采用帧首部和帧尾部中的标志字段作为帧定界符，其值为01111110。HDLC为了实现“透明传输”，采用“零比特填充法”，即每五个连续比特1后面插入一个比特0。</span></p><p><img src="./库/image-20230515104641403.png" referrerpolicy="no-referrer" alt="image-20230515104641403"></p><p>&nbsp;</p><h3 id='差错检测'><span>差错检测</span></h3><p><span>接收方如何知道链路层帧的数据载荷部分出现了误码？</span></p><p><img src="./库/image-20230515103906883.png" alt="image-20230515103906883" style="zoom:33%;" /></p><p>&nbsp;</p><h4 id='误码的相关概念'><span>误码的相关概念</span></h4><p><span>实际的通信链路都不是理想的，比特在传输过程中可能会产生差错（称为比特差错）：</span></p><ul><li><p><span>比特1可能变成比特0</span></p></li><li><p><span>比特0可能变成比特1</span></p></li></ul><blockquote><p><span>受到噪声干扰、传输媒体质量等因素影响</span></p></blockquote><p>&nbsp;</p><p><span>在一段时间内，传输错误的比特数量占所传输比特总数的比率称为</span><strong><span>误码率</span></strong><span>（Bit Error Rate，BER）。</span></p><p><span>提高链路的信噪比，可以降低误码率。但在实际的通信链路上，不可能使误码率下降为零。</span></p><p><span>使用差错检测技术来检测数据在传输过程中是否产生了比特差错，是数据链路层所要解决的重要问题之一。</span></p><p>&nbsp;</p><h4 id='因特网检查和'><span>因特网检查和</span></h4><p><strong><span>仅用于TCP、UDP和IPv4协议中</span></strong></p><p>&nbsp;</p><p><span>目标：检测发送包中的“错误”（例如，翻转位）（注：仅用于运输层）</span></p><p>&nbsp;</p><p><strong><span>发送方</span></strong></p><p><span>将数据段的内容作为16比特的整数序列</span></p><p><span>校验和：累加求和，计算和的1的补码</span></p><p><span>发送方将得到的校验和值放入PDU校验和字段</span></p><p>&nbsp;</p><p><strong><span>接收方</span></strong></p><p><span>计算收到的数据段的校验和</span></p><p><span>检查计算出的校验和与校验和字段中的值是否相同</span></p><ul><li><p><span>NO – 检测到错误</span></p></li><li><p><span>YES – 没有检测错误（不代表没有错误）</span></p></li></ul><p>&nbsp;</p><h4 id='奇偶校验-2'><span>奇偶校验</span></h4><p><span>奇校验是在待发送的数据后面添加1个校验位，使得添加该校验位后的整个数据中比特1的个数为奇数。</span></p><p><span>偶校验是在待发送的数据后面添加1个校验位，使得添加该校验位后的整个数据中比特1的个数为偶数。</span></p><p>&nbsp;</p><p><span>产生1位误码（出现在数据位或者校验位）：“1”数量的偶性改变，可检出错误。</span></p><p><span>产生2位误码（数据位和校验位各1位）：“1”数量的偶性不改变，不能检出错误。</span></p><p>&nbsp;</p><p><span>在所传输的数据中，如果有</span><strong><span>奇数个位发生误码</span></strong><span>，则所包含比特1的数量的奇偶性会发生改变，</span><strong><span>可以检测</span></strong><span>出误码。</span></p><p><span>在所传输的数据中，如果有</span><strong><span>偶数个位发生误码</span></strong><span>，则所包含比特1的数量的奇偶性不会发生改变，</span><strong><span>无法检测</span></strong><span>出误码（漏检）。</span></p><blockquote><p><span>在实际使用时，奇偶校验又可分为垂直奇偶校验、水平奇偶校验以及水平垂直奇偶校验。</span></p></blockquote><p>&nbsp;</p><h4 id='循环冗余校验'><span>循环冗余校验</span></h4><p><span>数据链路层广泛使用漏检率极低的循环冗余校验（Cyclic Redundancy Check，CRC）检错技术。</span></p><p>&nbsp;</p><p><span>循环冗余校验CRC的基本思想：</span></p><ul><li><p><span>收发双方约定好一个生成多项式G(X)。</span></p></li><li><p><span>发送方基于待发送的数据和生成多项式G(X)，计算出差错检测码（冗余码），将冗余码添加到待发送数据的后面一起传输。</span></p></li><li><p><span>接收方收到数据和冗余码后，通过生成多项式G(X)来计算收到的数据和冗余码是否产生了误码。</span></p></li></ul><p>&nbsp;</p><p><span>注意：CRC确定余数的过程中是二进制模2除法，相当于</span><strong><span>对应位进行逻辑异或运算</span></strong></p><p><span>接收方：余数为0可判断接收无误码，余数不为0可判断接收有误码</span></p><p>&nbsp;</p><h3 id='可靠传输'><span>可靠传输</span></h3><p><span>不可靠传输服务：直接丢弃有误码的帧</span></p><p><span>可靠传输服务：实现发送方发送什么，接收方最终都能正确收到。（重传）</span></p><h4 id='基本概念'><span>基本概念</span></h4><p><span>使用差错检测技术（例如循环冗余校验CRC），接收方的数据链路层就可检测出帧在传输过程中是否产生了误码（比特差错）。</span></p><p><span>利用FCS字段的值（检错码）可以检测出误码。</span></p><p>&nbsp;</p><p><span>检测出误码后如何处理呢？取决于数据链路层向其上层提供的服务类型</span></p><p><span>不可靠传输服务：仅仅丢弃有误码的帧，其他什么也不做；</span></p><p><span>可靠传输服务：通过某种机制实现发送方发送什么，接收方最终就能收到什么。</span></p><p>&nbsp;</p><p><span>一般情况下，有线链路的误码率比较低。为了减小开销，并不要求数据链路层向其上层提供可靠传输服务。即使出现了误码，可靠传输的问题由其上层处理。</span></p><p><span>无线链路易受干扰，误码率比较高，因此要求数据链路层必须向其上层提供可靠传输服务。</span></p><p>&nbsp;</p><p><span>传输差错：</span></p><ol start='' ><li><p><span>误码（比特差错）</span></p></li><li><p><span>分组丢失：输入队列快满了，主动丢弃收到的分组</span></p></li><li><p><span>分组失序：分组到达顺序与发送顺序不同</span></p></li><li><p><span>分组重复：路由器繁忙，分组在输入队列中等待较长时间，源主机超时重传</span></p></li></ol><p>&nbsp;</p><p><span>传输差错：</span></p><ul><li><p><span>误码（比特差错）——出现在数据链路层及其下层</span></p></li><li><p><span>分组重复——出现在数据链路层的上层</span></p></li><li><p><span>分组失序——出现在数据链路层的上层</span></p></li><li><p><span>分组丢失——出现在数据链路层的上层</span></p></li></ul><p>&nbsp;</p><p><strong><span>可靠传输服务并不局限于数据链路层，其他各层均可选择实现可靠传输。</span></strong><span>例如运输层的TCP协议就是可靠传输。</span></p><p><span>可靠传输的实现比较复杂，开销比较大，是否使用可靠传输取决于应用需求。</span></p><p>&nbsp;</p><h4 id='停止等待协议'><span>停止等待协议</span></h4><p><img src="./库/image-20230515105952337.png" alt="image-20230515105952337" style="zoom: 33%;" /></p><p><span>接收方收不到数据分组，就不会发送相应的ACK或NAK。</span></p><p><span>如果不采取措施，发送方就会一直处于等待接收方ACK或NAK的状态。</span></p><p><span>为解决上述问题，发送方可在每发送完一个数据分组时就启动一个</span><strong><span>超时计时器</span></strong><span>（Timeout Timer）。</span></p><p><span>若到了超时计时器所设置的超时重传时间（Retransmission Time-Out，RTO），但发送方仍未收到接收方的ACK或NAK，就重传之前已发送过的数据分组。</span></p><p><strong><span>一般可将超时重传时间RTO设置为略大于收发双方的平均往返时间RTT。</span></strong></p><p>&nbsp;</p><p><img src="./库/image-20230515110207267.png" alt="image-20230515110207267" style="zoom:33%;" /></p><p><span>为了避免分组重复这种传输错误，必须给每个分组带上序号。</span></p><p><span>对于停止-等待协议，由于每发送一个数据分组就停止等待，只要保证每发送一个新的数据分组，其序号与上次发送的数据分组的序号不同就可以了，因此用一个比特来编号就够了，序号有0和1这两个。</span></p><p>&nbsp;</p><p><strong><span>注意：确认分组也需要编号！！！</span></strong></p><p><img src="./库/image-20230515110428427.png" alt="image-20230515110428427" style="zoom:33%;" /></p><p><span>注意事项：</span></p><p><span>使用超时重传机制后，就可以不使用否认机制了，这样可使协议实现起来更加简单。但是，如果点对点链路的误码率较高，使用否认机制可以使发送方在超时计时器超时前就尽快重传。</span></p><p><span>为了让接收方能够判断所收到的数据分组是否是重复的，需要给数据分组编号。由于停止-等待协议的特性，只需1个比特编序号即可，即序号0和序号1。</span></p><p><span>为了让发送方能够判断所收到的确认分组是否是重复的，需要给确认分组编号，所用比特数量与数据分组所用比特数量一样。数据链路层一般不会出现确认分组迟到的情况，因此在数据链路层实现停止-等待协议可以不用给确认分组编号。</span></p><p><span>给超时计时器设置的超时重传时间RTO应当仔细选择，一般将RTO设置为略大于收发双方的平均往返时间RTT。</span></p><ul><li><p><span>在数据链路层，点对点的往返时间RTT比较固定，RTO就比较好设定。</span></p></li><li><p><span>在运输层，由于端到端往返时间非常不确定，设置合适的超时重传时间RTO有时并不容易。</span></p></li></ul><p><span>停止-等待协议属于自动请求重传（Automatic Repeat reQuest，ARQ）协议。即重传的请求是发送方自动进行的，而不是接收方请求发送方重传某个误码的数据分组。</span></p><p>&nbsp;</p><p><span>停止-等待协议的信道利用率</span></p><p><img src="./库/image-20230515110849524.png" alt="image-20230515110849524" style="zoom:50%;" /></p><p><span>主要关注</span><strong><span>发送时延</span></strong><span>和</span><strong><span>RTT</span></strong></p><p><span>若出现超时重传，对于传送有用的数据信息来说，信道利用率还要降低。</span></p><p><span>在往返时间RTT相对较大的情况下，为了提高信道利用率，收发双方不适合采用停止-等待协议，而可以选择使用回退N帧（GBN）协议或选择重传（SR）协议。</span></p><p>&nbsp;</p><p><img src="./库/image-20230515111031033.png" alt="image-20230515111031033" style="zoom: 33%;" /></p><p>&nbsp;</p><h4 id='回退n帧协议'><span>回退N帧协议</span></h4><p><span>采用流水线传输可以显著提高信道利用率</span></p><p><img src="./库/image-20230515111126136.png" alt="image-20230515111126136" style="zoom:33%;" /></p><p><span>在使用流水线传输方式时，发送方不能无限制地连续发送数据分组，否则可能会导致网络中的路由器或接收方来不及处理这些数据分组，进而导致数据分组的丢失，这实际上是对网络资源的浪费。</span></p><p><span>回退N帧协议采用流水线传输方式，并且</span><strong><span>利用发送窗口来限制发送方连续发送数据分组的数量</span></strong><span>，这属于连续ARQ协议。</span></p><p>&nbsp;</p><p><span>采用𝒏个比特给分组编序号，序号范围是 0 ~ 2</span><sup><span>n</span></sup><span>-1</span></p><p><span>本例假设采用𝟑个比特给分组编序号，则序号范围是𝟎~𝟕。</span></p><p><span>发送方需要维护一个发送窗口𝑾</span><sub><span>𝑻</span></sub><span>  ，在未收到接收方确认分组的情况下，发送方可将序号落入𝑾</span><sub><span>𝑻</span></sub><span>内的所有数据分组连续发送出去。</span></p><p><span>采用𝒏个比特给分组编序号，则𝑾</span><sub><span>𝑻</span></sub><span>的取值范围是𝟏&lt;𝑾</span><sub><span>𝑻</span></sub><span>≤𝟐</span><sup><span>𝒏</span></sup><span>−𝟏。本例假设采用𝟑个比特给分组编序号，则𝑾</span><sub><span>𝑻</span></sub><span>的取值范围是𝟐~𝟕。</span></p><p><span>本例取𝑾</span><sub><span>𝑻</span></sub><span>=𝟓。</span></p><p><span>接收方需要维护一个接收窗口𝑾</span><sub><span>𝑹</span></sub><span>  ，只有正确到达接收方（无误码）且序号落入𝑾</span><sub><span>𝑹</span></sub><span>内的数据分组才被接收方接收。𝑾</span><sub><span>𝑹</span></sub><span>的取值只能是1，这一点与停止-等待协议是相同的。</span></p><p><span>接收方每正确收到一个序号落入接收窗口的数据分组，就将接收窗口向前滑动一个位置，这样就有一个新的序号落入接收窗口。与此同时，接收方还要给发送方发送针对该数据分组的确认分组。接收方不一定要对收到的的数据分组逐个发送确认，而是可以收到多个数据分组后对按照次序到达的最后一个数据分组发送确认，这由具体实现决定。接收方可以择机将接受到的数据分组交付上层处理。</span></p><p><span>发送方每收到一个按序确认的确认分组，就将发送窗口向前滑动一个位置，这样就有一个新的序号落入发送窗口，序号落入发送窗口内的数据分组可继续被发送。同时将收到确认的数据分组从缓存中删除了。</span></p><p>&nbsp;</p><p><span>回退N帧协议的接收方采用累积确认方式：</span></p><ul><li><p><span>接收方不必对收到的每一个数据分组都发送一个确认分组，而是可以在收到几个序号连续的数据分组后，</span><strong><span>对按序到达的最后一个数据分组发送确认分组</span></strong><span>。</span></p></li><li><p><span>接收方何时发送累积确认分组，由具体实现决定。</span></p></li><li><p><span>确认分组ACK</span><sub><span>n</span></sub><span>表明序号为n及之前的所有数据分组都已正确接收。</span></p></li></ul><p>&nbsp;</p><p><span>累计确认的优点：</span></p><ul><li><p><span>即使确认分组丢失，发送方有可能不必重传。</span></p></li><li><p><span>使用累计确认还可以减少接收方的开销。</span></p></li><li><p><span>减少网络资源的占用。</span></p></li></ul><p>&nbsp;</p><p><span>累积确认的缺点：</span></p><ul><li><p><span>不能向发送方及时准确地反映出接收方已正确接收的所有数据分组的数量。</span></p></li></ul><p>&nbsp;</p><p><span>在回退N帧协议的工作过程中，发送方的发送窗口和接收方的接收窗口按上述规则不断向前滑动。因此，这类协议又称为滑动窗口协议。在无传输差错的情况下，回退N帧协议的信道利用率比停止-等待协议的信道利用率有显著提高。提高的程度取决于发送窗口的大小。</span></p><p><span>超时重传、回退N帧的情况：一个数据分组的差错就可能引起大量数据分组的重传。在信道质量较差（容易出现误码）的情况下，回退N帧协议的信道利用率并不比停止-等待协议的信道利用率高。</span></p><p>&nbsp;</p><p><strong><span>总结</span></strong></p><p><img src="./库/image-20230515164820659.png" referrerpolicy="no-referrer" alt="image-20230515164820659"></p><p>&nbsp;</p><h4 id='选择重传协议'><span>选择重传协议</span></h4><p><span>为了使发送方仅重传出现差错的数据分组，接收方不再采用累积确认，而需要对每一个正确接收的数据分组进行逐一确认。</span></p><p>&nbsp;</p><p><span>窗口大小的确定：</span></p><ul><li><p><span>用𝒏(𝒏＞𝟏)个比特给分组编号</span></p></li><li><p><span>𝟏&lt;𝑾</span><sub><span>𝑹</span></sub><span>≤𝑾</span><sub><span>𝑻</span></sub></p></li><li><p><span>𝑾</span><sub><span>𝑻</span></sub><span>+𝑾</span><sub><span>𝑹</span></sub><span>≤𝟐</span><sup><span>𝒏</span></sup></p></li><li><p><span>当𝑾</span><sub><span>𝑹</span></sub><span>取最大值𝟐</span><sup><span>𝒏−𝟏</span></sup><span>时， 𝑾</span><sub><span>𝑻</span></sub><span>能取到的最大值也为𝟐</span><sup><span>𝒏−𝟏</span></sup></p></li><li><p><span>一般情况下，𝑾</span><sub><span>𝑹</span></sub><span>和𝑾</span><sub><span>𝑻</span></sub><span>取值相同</span></p></li><li><p><span>𝑾</span><sub><span>𝑹</span></sub><span>超过𝑾</span><sub><span>𝑻</span></sub><span>没有意义</span></p></li><li><p><span>确保接收窗口向前滑动后，落入接收窗口内的新序号与之前的旧序号没有重叠，避免无法分辨新旧数据分组。</span></p></li></ul><p><span>如果窗口尺寸超过了限制范围，那么接收方无法分辨新旧分组，进而出现分组重复这种传输错误。</span></p><p>&nbsp;</p><p><strong><span>发送方</span></strong></p><p><span>可在未收到接收方确认分组的情况下，将序号落入发送窗口内的多个数据分组全部发送出去。</span></p><p><span>只有按序收到对已发送数据分组的确认分组时，发送窗口才能向前滑动到相应位置。 </span></p><p><span>如果收到未按序到达的确认分组，应对其进行记录，以防止其相应数据分组的超时重发，但发送窗口不能向前滑动。</span></p><p>&nbsp;</p><p><strong><span>接收方</span></strong></p><p><span>可接收未按序到达但没有误码并且序号落入接收窗口内的数据分组。</span></p><p><span>为了使发送方仅重传出现差错的分组，接收方不再采用累积确认，而需要对每一个正确接收到的数据分组进行逐一确认。</span></p><p><span>只有在按序接收数据分组后，接收窗口才能向前滑动到相应位置。</span></p><p>&nbsp;</p><p><span>从滑动窗口的角度对比停止-等待协议、回退N帧协议和选择重传协议。</span></p><p><img src="./库/image-20230515174903730.png" referrerpolicy="no-referrer" alt="image-20230515174903730"></p><p>&nbsp;</p><h2 id='点对点协议ppp'><span>点对点协议PPP</span></h2><p><span>点对点协议（Point-to-Point Protocol，PPP）是目前使用最广泛的点对点数据链路层协议。</span></p><p><span>点对点协议PPP是因特网工程任务组（Internet Engineering Task Force，IETF）于1992年制定的。经过多次修订，目前PPP已成为因特网的正式标准[RFC1661，RFC1662]。</span></p><p>&nbsp;</p><p><span>点对点协议PPP主要有两种应用：</span></p><ol start='' ><li><p><span>因特网用户通过PPP接入ISP</span></p></li><li><p><span>应用于广域网路由器之间的专用线路</span></p></li></ol><p>&nbsp;</p><p><span>PPP协议为在点对点链路中传输各种协议数据报提供了一个标准方法，主要由以下三部分构成：</span></p><ul><li><p><span>对各种协议数据报的封装方法（封装成帧）</span></p></li><li><p><span>链路控制协议LCP，用于建立、配置以及测试数据链路的连接</span></p></li><li><p><span>一套网络控制协议NCP</span><sub><span>S</span></sub><span>，其中的每一个协议支持不同的网络层协议</span></p></li></ul><p><img src="./库/image-20230515181712881.png" alt="image-20230515181712881" style="zoom: 25%;" /></p><p>&nbsp;</p><h3 id='ppp的帧格式'><span>PPP的帧格式</span></h3><p><span>帧首部由四个字段构成，帧尾部由两个字段构成。</span></p><p><img src="./库/image-20230515181817239.png" referrerpolicy="no-referrer" alt="image-20230515181817239"></p><p><span>标志（Flag）字段：PPP帧的定界符，取值为0x7E。</span></p><p><span>地址（Address）字段：取值为0xFF，预留（目前没有什么作用）。</span></p><p><span>控制（Control）字段：取值为0x03，预留（目前没有什么作用）。</span></p><p><span>协议（Protocol）字段：其值用来指明帧的数据载荷应向上交付给哪个协议处理。</span></p><p><img src="./库/image-20230515182129146.png" referrerpolicy="no-referrer" alt="image-20230515182129146"></p><p><span>帧检验序列（Frame Check Sequence，FCS）字段：其值是使用循环冗余校验CRC计算出的检错码。</span></p><p>&nbsp;</p><p><img src="./库/image-20230515182233898.png" referrerpolicy="no-referrer" alt="image-20230515182233898"></p><p><span>标志（Flag）字段：是PPP帧的定界符，取值为：</span></p><ul><li><p><span>从字节角度看：取值为0x7E。</span></p></li><li><p><span>从比特角度看：取值为01111110。</span></p></li></ul><p>&nbsp;</p><p><strong><span>面向字节的异步链路使用字节填充来实现透明传输[RFC1662]</span></strong>
<img src="./库/image-20230515182323179.png" referrerpolicy="no-referrer" alt="image-20230515182323179"></p><p><span>发送方的处理：</span></p><ul><li><p><span>将数据载荷中出现的每一个0x7E减去0x20（相当于异或0x20），然后在其前面插入转义字符0x7D。</span></p></li><li><p><span>若数据载荷中原来就含有0x7D，则把每一个0x7D减去0x20，然后在其前面插入转义字符0x7D。</span></p></li><li><p><span>将数据载荷中出现的每一个ASCII码控制字符（即数值小于0x20的字符），加上0x20（相当于异或0x20，将其转换成非控制字符），然后在其前面插入转义字符0x7D。</span></p></li></ul><p>&nbsp;</p><p><span>接收方的处理：</span></p><p><span>进行与发送方相反的变换，就可以正确地恢复出未经过字节填充的原始数据载荷。</span></p><p>&nbsp;</p><p><strong><span>面向比特的同步链路使用零比特填充来实现透明传输</span></strong></p><p><img src="./库/image-20230515182439992.png" referrerpolicy="no-referrer" alt="image-20230515182439992"></p><p><span>发送方的处理：</span></p><p><span>对帧的数据载荷进行扫描（一般由硬件完成），每出现5个连续的比特1，则在其后填充一个比特0。</span></p><p>&nbsp;</p><p><span>接收方的处理：</span></p><p><span>对帧的数据载荷进行扫描，每出现5个连续的比特1时，就把其后的一个比特0删除。</span></p><p>&nbsp;</p><h3 id='ppp帧的差错检测'><span>PPP帧的差错检测</span></h3><p><img src="./库/image-20230515182530707.png" referrerpolicy="no-referrer" alt="image-20230515182530707"></p><p><span>帧检验序列FCS字段：其值是使用循环冗余校验CRC计算出的检错码。</span></p><p><span>CRC采用的生成多项式为 𝑪𝑹𝑪−𝑪𝑪𝑰𝑻𝑻=𝑿</span><sup><span>𝟏𝟔</span></sup><span>+𝑿</span><sup><span>𝟏𝟐</span></sup><span>+𝑿</span><sup><span>𝟓</span></sup><span>+𝟏</span></p><p>&nbsp;</p><p><span>接收方每收到一个PPP帧，就进行CRC检验。若CRC检验正确，就收下这个帧；否则，就丢弃这个帧。使用PPP的数据链路层，向上提供的是不可靠数据传输服务。</span></p><p>&nbsp;</p><h3 id='ppp的工作状态'><span>PPP的工作状态</span></h3><p><span>以用户主机拨号接入因特网服务提供者ISP的拨号服务器的过程为例：</span></p><p><img src="./库/image-20230515182656558.png" referrerpolicy="no-referrer" alt="image-20230515182656558"></p><p>&nbsp;</p><h2 id='共享式以太网'><span>共享式以太网</span></h2><p><span>以太网（Ethernet）以曾经被假想的电磁波传播介质——以太（Ether）来命名。</span></p><p><span>以太网最初采用无源电缆（不包含电源线）作为共享总线来传输帧，属于基带总线局域网，传输速率为2.94Mb/s。</span></p><p><span>以太网目前已经从传统的共享式以太网发展到交换式以太网，传输速率已经从10Mb/s提高到100Mb/s、1Gb/s甚至10Gb/s。我们会首先介绍最早流行的传输速率为10Mb/s的共享式以太网的相关知识。</span></p><p><img src="./库/image-20230515232551169.png" alt="image-20230515232551169" style="zoom:25%;" /></p><p>&nbsp;</p><h3 id='网络适配器'><span>网络适配器</span></h3><p><span>要将计算机连接到以太网，需要使用相应的网络适配器（Adapter），网络适配器一般简称为“网卡”。</span></p><p><span>不论是使用共享总线的共享式以太网，还是使用集线器的共享式以太网，都需要网卡。</span></p><p><img src="./库/image-20230515232932379.png" alt="image-20230515232932379" style="zoom:33%;" /></p><p><span>在计算机内部，网卡与CPU之间的通信，一般是通过计算机主板上的I/O总线以并行传输方式进行。</span></p><p><span>网卡与外部以太网（局域网）之间的通信，一般是通过传输媒体（同轴电缆、双绞线电缆、光纤）以串行方式进行的。</span></p><p><span>网卡除要实现物理层和数据链路层功能，其另外一个重要功能就是要</span><u><span>进行并行传输和串行传输的转换</span></u><span>。由于网络的传输速率和计算机内部总线上的传输速率并不相同，因此在网卡的核心芯片中都会包含用于缓存数据的存储器。</span></p><p><span>在确保网卡硬件正确的情况下，为了使网卡正常工作，还必须要在计算机的操作系统中为网卡安装相应的设备驱动程序。驱动程序负责驱动网卡发送和接收帧。</span></p><p>&nbsp;</p><h3 id='mac地址'><span>MAC地址</span></h3><p><img src="./库/image-20230515233303049.png" alt="image-20230515233303049" style="zoom:33%;" /></p><p><span>数据链路层必须使用地址来区分各主机。</span></p><blockquote><p><span>点对点信道：数据链路层不需要使用地址</span></p></blockquote><p><span>当多个主机连接在同一个广播信道上，要想实现两个主机之间的通信，则每个主机都必须有一个唯一的标识，即一个数据链路层地址。</span></p><p><span>在每个主机发送的帧的首部中，都携带有发送主机（源主机）和接收主机（目的主机）的数据链路层地址。由于这类地址是用于媒体接入控制（Medium Access Control，MAC）的，因此被称为MAC地址。</span></p><p><img src="./库/image-20230515233347584.png" alt="image-20230515233347584" style="zoom: 33%;" /></p><p>&nbsp;</p><p><span>MAC地址一般被固化在网卡的电可擦可编程只读存储器EEPROM中，因此MAC地址也被称为硬件地址。</span></p><p><span>MAC地址有时也被称为物理地址。不要被物理地址中的“物理”二字误导，误认为物理地址属于网络体系结构中物理层的范畴。物理地址属于数据链路层范畴。</span></p><p>&nbsp;</p><p><span>一般情况下，普通用户计算机中往往会包含两块网卡：</span></p><ul><li><p><span>一块是用于接入有线局域网的以太网卡</span></p></li><li><p><span>另一块是用于接入无线局域网的Wi-Fi网卡</span></p></li></ul><p><span>每块网卡都有一个全球唯一的MAC地址。交换机和路由器往往具有更多的网络接口，所以会拥有更多的MAC地址。</span></p><p><span>综上所述，</span><strong><span>MAC地址是对网络上各接口的唯一标识，而不是对网络上各设备的唯一标识。</span></strong></p><p>&nbsp;</p><p><span>IEEE 802局域网的MAC地址格式：</span></p><p><span>第1~3字节————组织唯一标识符OUI，由IEEE的注册管理机构分配</span></p><p><span>第4~6字节————网络接口标识符，由获得OUI的厂商自行随意分配</span></p><p>&nbsp;</p><p><span>标准表示法————XX-XX-XX-XX-XX-XX</span></p><p><span>其他表示法————XX:XX:XX:XX:XX:XX————XXXX.XXXX.XXXX</span></p><p>&nbsp;</p><p><img src="./库/image-20230515235134686.png" referrerpolicy="no-referrer" alt="image-20230515235134686"></p><p>&nbsp;</p><p><span>IEEE 802局域网的MAC地址发送顺序：</span></p><p><span>字节发送顺序：第1字节—&gt;第6字节</span></p><p><span>字节内的比特发送顺序：b</span><sub><span>0</span></sub><span>-&gt;b</span><sub><span>7</span></sub></p><p>&nbsp;</p><p><span>网卡从网络上每收到一个帧，就检查帧首部中的目的MAC地址，按以下情况处理：</span></p><p><span>（1）如果目的MAC地址是广播地址（FF-FF-FF-FF-FF-FF），则接受该帧。</span></p><p><span>（2）如果目的MAC地址与网卡上固化的全球单播MAC地址相同，则接受该帧。</span></p><p><span>（3）如果目的MAC地址是网卡支持的多播地址，则接受该帧。</span></p><p><span>（4）除上述（1）、（2）和（3）情况外，丢弃该帧。</span></p><p>&nbsp;</p><blockquote><p><span>接收：收到一个MAC帧，检查后决定是接受还是丢弃</span></p><p><span>接受：进行检查，例如比较目的MAC地址和本机的MAC地址</span></p></blockquote><p>&nbsp;</p><p><span>网卡还可被设置为一种特殊的工作方式：混杂方式（Promiscuous Mode）。工作在混杂方式的网卡，只要收到共享媒体上传来的帧就会收下，而不管帧的目的MAC地址是什么。</span></p><p><span>对于网络维护和管理人员，这种方式可以监视和分析局域网上的流量，以便找出提高网络性能的具体措施。</span></p><p><span>嗅探器（Sniffer）就是一种工作在混杂方式的网卡，再配合相应的工具软件（WireShark），就可以作为一种非常有用的网络工具来学习和分析网络。</span></p><p><span>混杂方式就像一把“双刃剑”，黑客常利用这种方式非法获取网络用户的口令。</span></p><p>&nbsp;</p><p><span>全球单播MAC地址就如同身份证上的身份证号码，具有唯一性，它往往与用户个人信息绑定在一起。因此，用户应尽量确保自己拥有的全球单播MAC地址不被泄露。为了避免用户设备连接Wi-Fi热点时MAC地址泄露的安全问题，目前大多数移动设备都已经采用了随机MAC地址技术。</span></p><p>&nbsp;</p><h3 id='csmacd协议的基本原理'><span>CSMA_CD协议的基本原理</span></h3><p><span>在以太网的发展初期，人们普遍认为“无源的电缆线比有源器件可靠”，因此将多个站点连接在一条总线上来构建共享总线以太网。</span></p><p><span>共享总线以太网具有天然的广播特性，即使总线上某个站点给另一个站点发送单播帧，表示帧的信号也会沿着总线传播到总线上的其他各站点。</span></p><p><span>当某个站点在总线上发送帧时，总线资源会被该站点独占。此时，如果总线上的其他站点也要在总线上发送帧，就会产生</span><strong><span>信号碰撞</span></strong><span>。</span></p><p><span>当两个或多个站点同时使用总线发送帧时，就会产生信号碰撞。</span></p><p>&nbsp;</p><p><strong><span>共享总线以太网的一个重要问题：如何协调总线上的各站点争用总线。</span></strong></p><p>&nbsp;</p><h4 id='多址接入ma'><span>多址接入MA</span></h4><p><span>多个站点连接在一条总线上，竞争使用总线。</span></p><p>&nbsp;</p><h4 id='载波监听cs'><span>载波监听CS</span></h4><p><span>每个站点在发送帧之前，先要检测一下总线上是否有其他站点在发送帧（“先听后说”）：</span></p><ul><li><p><span>若检测到总线空闲96比特时间（发送96比特所耗费的时间，也称为帧间最小间隔），则发送这个帧；</span></p></li><li><p><span>若检测到总线忙，则继续检测并等待总线转为空闲96比特时间，然后发送这个帧。</span></p></li></ul><p>&nbsp;</p><h4 id='碰撞检测cd'><span>碰撞检测CD</span></h4><p><span>每个正在发送帧的站点边发送边检测碰撞（“边说边听”）：</span></p><ul><li><p><span>一旦发现总线上出现碰撞，立即停止发送，退避一段随机时间后再次从载波监听开始进行发送（“一旦冲突，立即停说，等待时机，重新再说”）。</span></p></li></ul><p>&nbsp;</p><h4 id='强化碰撞-2'><span>强化碰撞</span></h4><p><span>发送帧的站点一旦检测到碰撞，除了立即停止发送帧外，还要再继续发送32比特或48比特的人为干扰信号（Jamming Signal），以便有足够多的碰撞信号使所有站点都能检测出碰撞。</span></p><p>&nbsp;</p><p><span>注意：</span></p><p><span>载波监听检测到总线空闲，但总线并不一定空闲。</span></p><p><span>使用CSMA/CD协议的共享总线以太网上的各站点，只是尽量避免碰撞并在出现碰撞时做出退避后重发的处理，但不能完全避免碰撞。</span></p><p><span>在使用CSMA/CD协议时，由于正在发送帧的站点必须“边发送帧边检测碰撞”，因此站点不可能同时进行发送和接收，也就是不可能进行全双工通信，而只能进行半双工通信（双向交替通信）。</span></p><p>&nbsp;</p><p><span>【2013年 题36】下列介质访问控制方法中，可能发生冲突的是（   B  ）。</span></p><p><span>A. CDMA</span></p><p><span>B. CSMA</span></p><p><span>C. TDMA</span></p><p><span>D. FDMA</span></p><p><span>CDMA（Code Division Multiplex Access）是码分多址的英文缩写词。 CDMA的每个用户可以在相同的时间使用相同的频带进行通信。</span></p><p><span>TDMA（Time Division Multiplex Access）是时分多址的英文缩写词。</span></p><p><span>FDMA（Frequency Division Multiplex Access）是频分多址的英文缩写词。</span></p><p><span>CSMA（Carrier Sense Multiple Access）是载波监听多址接入的英文缩写词。</span></p><p>&nbsp;</p><p><span>CSMA属于争用型的媒体接入控制协议，连接在同一媒体上的多个站点使用该协议以竞争方式发送数据帧，可能出现冲突（也称为碰撞）。</span></p><p><span>TDMA、FDMA、CDMA是常见的物理层信道复用技术，属于静态划分信道，用于多用户共享信道，不会发生冲突。</span></p><p>&nbsp;</p><h3 id='共享式以太网的争用期'><span>共享式以太网的争用期</span></h3><p><span>使用CSMA/CD协议的共享总线以太网上的任意站点在发送帧的过程中都可能会遭遇碰撞。</span></p><p><span>某个站点从发送帧开始，最长要经过多长时间，才能检测出自己发送的帧与其他站点发送的帧产生了碰撞？</span></p><p><span>应当考虑位于共享总线以太网两端的两个节点发送的帧产生碰撞的情况。</span></p><p><img src="./库/image-20230516140820467.png" referrerpolicy="no-referrer" alt="image-20230516140820467"></p><p><span>站点从发送帧开始，最多经过时长𝟐𝝉 （即𝜹→𝟎）就可检测出所发送的帧是否遭遇了碰撞。</span></p><p><span>因此，共享总线以太网的端到端往返时间𝟐𝝉被称为</span><strong><span>争用期</span></strong><span>（Contention Period）或碰撞窗口（Collision Window），它是一个非常重要的参数。</span><strong><span>站点从发送帧开始，经过争用期𝟐𝝉这段时间还没有检测到碰撞，就可以肯定这次发送不会产生碰撞。</span></strong></p><p>&nbsp;</p><p><span>从争用期的概念可以看出，共享总线以太网上的每一个站点从发送帧开始，到之后的一小段时间内，都有可能遭遇碰撞，而这一小段时间的长短是不确定的，它取决于另一个发送帧的站点与本站点的距离，但不会超过总线的端到端往返传播时延，即一个争用期𝟐𝝉 。</span></p><p><span>很显然，总线的长度越长（单程端到端传播时延越大），网络中站点数量越多，发生碰撞的概率就越大。因此，共享以太网的总线长度不能太长，接入的站点数量也不能太多。</span></p><p>&nbsp;</p><p><span>争用期𝟐𝝉=(𝟓𝟏𝟐 𝒃)/(𝟏𝟎 𝑴𝒃/𝒔)=(𝟓𝟏𝟐 𝒃)/(𝟏𝟎×𝟏𝟎</span><sup><span>𝟔</span></sup><span>  𝒃/𝒔)=𝟓𝟏.𝟐𝝁𝒔</span></p><p><span>𝟏𝟎𝑴𝒃/𝒔共享总线以太网（传统以太网）规定：争用期𝟐𝝉 的值为𝟓𝟏𝟐比特的发送时间，即𝟓𝟏.𝟐𝝁s 。</span></p><p><span>除考虑了信号传播时延外，还考虑到网络中可能存在转发器所带来的时延以及产生碰撞时继续发送𝟑𝟐比特或𝟒𝟖比特人为干扰信号所持续的时间等。</span></p><p><span>单程端到端传播时延𝝉=(𝟓𝟏.𝟐 𝝁𝒔)/𝟐=𝟐𝟓.𝟔𝝁𝒔</span></p><p><span>则总线长度为𝟐×𝟏𝟎</span><sup><span>𝟖</span></sup><span> 𝒎/𝒔   ×  𝟐𝟓.𝟔𝝁𝒔=𝟓𝟏𝟐𝟎𝒎（共享总线以太网规定：总线长度不能超过𝟐𝟓𝟎𝟎𝒎。）</span></p><p>&nbsp;</p><p><span>【2010年 题47】某局域网采用CSMA/CD协议实现介质访问控制，数据传输速率为10Mbps，主机甲和主机乙的距离为2km，信号传播速度是200 000km/s。请回答下列问题，要求说明理由或写出计算过程。</span></p><p><span>（1）若主机甲和主机乙发送数据时发送冲突，则从开始发送数据时刻起，到两台主机均检测到冲突时刻止，最短需经过多长时间？最长需经过多长时间（假设主机甲和主机乙发送数据过程中，其他主机不发送数据）？</span></p><p><span>最短需要经过的时长：两主机之间信号的单程传播时延，记为𝝉。</span></p><p><span>最长需要经过的时长：两主机之间信号的往返传播时延，记为𝟐𝝉。</span></p><p><span>𝝉=𝟐𝒌𝒎/(𝟐𝟎𝟎𝟎𝟎𝟎𝒌𝒎/𝒔)=𝟏𝟎</span><sup><span>−𝟓</span></sup><span>  𝒔</span></p><p>&nbsp;</p><h3 id='共享式以太网的最小帧长'><span>共享式以太网的最小帧长</span></h3><p><span>当帧长特别小的时候，发送方完成发送之后，不再进行碰撞检测不知道已发送完毕的帧遭遇了碰撞不会重发该帧。而接收方最终收到遭遇碰撞的帧，直接丢弃。</span></p><p><span>为了确保共享总线以太网上的每一个站点在发送完一个完整的帧之前，能够检测出是否产生了碰撞，</span><strong><span>帧的发送时延就不能少于共享总线以太网端到端的往返时间，即一个争用期𝟐𝝉 。</span></strong></p><p>&nbsp;</p><p><span>对于𝟏𝟎𝑴𝒃/𝒔的共享总线以太网，其争用期𝟐𝝉 的值规定为𝟓𝟏.𝟐𝝁s，因此其最小帧长为𝟓𝟏𝟐𝒃，即𝟔𝟒𝑩。</span></p><p><span>𝟏𝟎𝑴𝒃/𝒔×𝟓𝟏.𝟐𝝁s=𝟓𝟏𝟐𝒃=𝟔𝟒𝑩</span></p><p>&nbsp;</p><ul><li><p><span>当某个站点在发送帧时，如果帧的前𝟔𝟒𝑩没有遭遇碰撞，那么帧的后续部分也就不会遭遇碰撞。也就是说，如果遭遇碰撞，就一定是在帧的前𝟔𝟒𝑩之内。</span></p></li><li><p><span>由于发送帧的站点边发送帧边检测碰撞，一旦检测到碰撞就立即中止帧的发送，此时已发送的数据量一定小于𝟔𝟒𝑩。因此，接收站点收到长度小于𝟔𝟒𝑩的帧，就可判定这是一个遭遇了碰撞而异常中止的无效帧，将其丢弃即可。</span></p></li></ul><p>&nbsp;</p><h3 id='共享式以太网的最大帧长'><span>共享式以太网的最大帧长</span></h3><p><span>一般来说，帧的数据载荷的长度应远大于帧首部和尾部的总长度，这样可以提高帧的传输效率。</span></p><p><span>然而，如果不限制数据载荷的长度上限，就可能使得帧的长度太长，这会带来一些问题。</span></p><p><span>如果发送方发送一个很长的帧，将会长时间占用总线，导致其他节点无法发出帧，同时可能会造成接收方缓冲区溢出。</span></p><p>&nbsp;</p><p><span>以太网V2的MAC帧最大帧长1518B，最小帧长64B</span></p><p><img src="./库/image-20230517110514127.png" alt="image-20230517110514127" style="zoom:33%;" /></p><p>&nbsp;</p><p><span>【2009年 题37】在一个采用CSMA/CD协议的网络中，传输介质是一根完整的电缆，传输速率为1Gbps，电缆中的信号传播速度是200 000km/s。若最小数据帧长度减少800比特，则最远的两个站点之间的距离至少需要（D. 减少80m）</span></p><p><span>最小帧长    =    数据传输速率    ×    争用期𝟐𝝉  （可以自己推导一下）</span></p><p><span>设最远两个站点之间的距离为𝒅(𝒎)，最小帧长为𝒍(𝒃)，与题目给定相关已知量一起代入上式：</span></p><p><span>𝒍=(𝟐×𝒅/(𝟐𝟎𝟎𝟎𝟎𝟎×𝟏𝟎</span><sup><span>𝟑</span></sup><span> ))×𝟏𝟎</span><sup><span>𝟗</span></sup></p><p><span>𝒅=𝒍/𝟏𝟎，显然，若最小帧长减少800比特，最远的两个站点之间的距离至少需要减少80m。</span></p><p>&nbsp;</p><h3 id='共享式以太网的退避算法'><span>共享式以太网的退避算法</span></h3><p><span>在使用CSMA/CD协议的共享总线以太网中，正在发送帧的站点一边发送帧一边检测碰撞，当检测到碰撞时就立即停止发送，退避一段随机时间后再重新发送。</span></p><p><span>共享总线以太网中的各站点采用截断二进制指数退避（Truncated Binary Exponential Backoff）算法来选择退避的随机时间。</span></p><p>&nbsp;</p><p><span>这段随机时间应该如何选择呢？</span></p><p><span>退避时间 = 基本退避时间 x 随机数 r</span></p><p><span>基本退避时间：争用期𝟐𝝉</span></p><p><span>随机数 r ：𝒓从离散的整数集合{𝟎,𝟏,…,(𝟐</span><sup><span>𝒌−𝟏</span></sup><span>)}中随机选出一个数，𝒌=min⁡[重传次数，𝟏𝟎]。（这是该算法名称中“截断二进制指数”这种称谓的由来）</span></p><p>&nbsp;</p><p><span>如果连续多次发送碰撞，就表明可能有较多的站点参与竞争信道。但使用上述退避算法可使重传需要推迟的平均时间随重传次数而增大（即动态退避），因而减小产生碰撞的概率。</span></p><p><span>当重传达16次仍不能成功时，就表明同时打算发送帧的站点太多，以至于连续产生碰撞，此时应放弃重传并向高层报告。</span></p><p>&nbsp;</p><h3 id='共享式以太网的信道利用率'><span>共享式以太网的信道利用率</span></h3><p><img src="./库/image-20230517124334174.png" referrerpolicy="no-referrer" alt="image-20230517124334174"></p><p>&nbsp;</p><p><span>发送一帧所需的时间包括：</span></p><ol start='' ><li><p><span>多个争用期，也就是多个𝟐𝝉</span></p></li><li><p><span>发送帧所需要的时延</span></p></li><li><p><span>单程端到端的传播时延，也就是 𝝉</span></p></li></ol><p>&nbsp;</p><p><span>考虑以下这种理想情况：</span></p><ol start='' ><li><p><span>总线一旦空闲就有某个站点立即发送帧</span></p></li><li><p><span>各站点发送帧都不会产生碰撞</span></p></li><li><p><span>发送一帧占用总线的时间为𝑻</span><sub><span>𝟎+𝝉</span></sub><span>，而帧本身的发送时间是𝑻</span><sub><span>𝟎</span></sub></p></li></ol><p><img src="./库/image-20230517124930787.png" alt="image-20230517124930787" style="zoom:33%;" /></p><p>&nbsp;</p><p><span>【2015年 题36】下列关于CSMA/CD协议的叙述中，错误的是（      ）。</span></p><p><span>A. 边发送数据帧，边检测是否发生冲突</span></p><p><span>B. 适用于无线网络，以实现无线链路共享</span></p><p><span>C. 需要根据网络跨距和数据传输速率限定最小帧长</span></p><p><span>D. 当信号传播延迟趋近于0时，信道利用率趋近100%</span></p><p><span>选项A的描述正确，其所描述的是CSMA/CD协议中的“碰撞检测（冲突检测）CD”。</span></p><p><span>选项B的描述错误，因为CSMA/CD协议不适用于无线网络。对于802.11无线局域网，可以使用CSMA/CA协议。</span></p><p><span>选项C的描述正确，因为“最小帧长 = 数据传输速率 ×争用期𝟐𝝉 ” 。也就是说，最小帧长取决于数据传输速率和争用期𝟐𝝉。选项C中给出的“网络跨距”相当于给出了“端到端单程传播时延𝝉”，进而可得出“争用期𝟐𝝉 ”。</span></p><p><span>选项D的描述正确，因为选项D中给出“信号传播延迟趋近于0”，这相当于信号瞬间到达整个网络，网络中各站点瞬间就知道总线被占用，因此不会出现碰撞，进而使信道利用率趋近100%。</span></p><p>&nbsp;</p><blockquote><p><span>CSMA/CD与CSMA/CA的区别：</span></p><p><strong><span>CSMA/CD</span></strong></p><p><span>英文Carrier Sense Multiple Access with Collision Detection，意思是载波侦听多路访问／</span><strong><span>冲突检测</span></strong><span>。</span>
<strong><span>采用该协议要求设备在发送帧的同时要对信道进行侦听，以确定是否会发生信道冲突，若在发送数据过程中检测到冲突，则需要进行冲突处理。</span></strong><span>整个协议的处理规程如下：</span></p><ol start='' ><li><p><span>监听当前信道上是否有数据再发送，如果信道空闲，直接发送数据，如果信道忙，则按照一定的退避算法进行延时监听。</span></p></li><li><p><span>当信道允许发送数据时，发送数据。</span></p></li><li><p><span>数据发送过程中，边发送边监听，如果发送过程中检测到冲突，则停止发送数据，并发送阻塞信息，强化冲突，并转入1。</span></p></li></ol><p><strong><span>CSMA/CA</span></strong></p><p><span>英文Carrier Sense Multiple Access with Collision Avoidance，意思是载波侦听多路访问／</span><strong><span>冲突避免</span></strong><span>。</span>
<span>采用该协议要求</span><strong><span>设备要主动避免冲突而非被动侦测的方式来解决冲突问题。</span></strong><span>避免冲突的方法主要有两个：</span></p><ol start='' ><li><p><span>是监听到信道空闲时，并不是立即发送，而是等待一段时间再发送数据。</span></p></li><li><p><span>是先发送一个很小的信道侦测帧RTS，如果收到最近的接入点返回的CTS，就认为信道是空闲的，然后再发送数据。</span></p></li></ol><p><span>协议的主要流程如下：</span></p><ol start='' ><li><p><span>首先检测信道是否有使用，如果检测出信道空闲，则等待一段随机时间后，才送出数据。</span></p></li><li><p><span>接收端如果正确收到此帧，则经过一段时间间隔后，向发送端发送确认帧ACK。</span></p></li><li><p><span>发送端收到ACK帧，确定数据正确传输，在经历一段时间间隔后，再发送数据。</span></p></li></ol></blockquote><p>&nbsp;</p><h3 id='使用集线器的共享式以太网'><span>使用集线器的共享式以太网</span></h3><p><span>早期的传统以太网是使用粗同轴电缆的共享总线以太网，后来发展到使用价格相对便宜的细同轴电缆。当初认为这种连接方法既简单又可靠，因为在那个时代普遍认为有源器件不可靠，而无源的电缆线才是最可靠的。然而，实践证明这种使用无源电缆线和大量机械接口的总线型以太网并不像人们想象的那么可靠。</span></p><p><img src="./库/image-20230517130111577.png" alt="image-20230517130111577" style="zoom: 25%;" /></p><p><span>若总线上的某个机械连接点接触不良或断开，则整个网络通信就不稳定或彻底断网。</span></p><p>&nbsp;</p><p><span>在使用细同轴电缆的共享总线以太网之后，以太网发展出来了一种使用大规模集成电路来替代总线、并且可靠性非常高的设备，叫作集线器（Hub）。站点连接到集线器的传输媒体也转而使用更便宜、更灵活的双绞线电缆。</span></p><p>&nbsp;</p><p><span>集线器的一些主要特点如下：</span></p><ul><li><p><span>使用集线器的以太网虽然物理拓扑是星型的，但在逻辑上仍然是一个总线网。总线上的各站点共享总线资源，使用的还是CSMA/CD协议。</span></p></li><li><p><span>集线器只工作在物理层，它的每个接口仅简单地转发比特，并不进行碰撞检测。碰撞检测的任务由各站点中的网卡负责。</span></p></li><li><p><span>集线器一般都有少量的容错能力和网络管理功能。例如，若网络中某个站点的网卡出现了故障而不停地发送帧，集线器可以检测到这个问题，在内部断开与出故障网卡的连线，使整个以太网能正常工作。</span></p></li></ul><p>&nbsp;</p><p><u><span>使用细同轴电缆的共享总线型以太网</span></u><span>和</span><u><span>使用集线器和双绞线的星型拓扑的共享式以太网</span></u><span>，物理拓扑不相同，但工作逻辑相同，网络中的各站点都使用CSMA/CD协议来共享（争用）网络资源。</span></p><p>&nbsp;</p><p><span>IEEE于1990年制定了10BASE-T星型以太网的标准802.3i，这种以太网是局域网发展史上的一座非常重要的里程碑，它为以太网在局域网中的统治地位奠定了牢固的基础。</span></p><p>&nbsp;</p><p><strong><span>10BASE-T</span></strong></p><p><span>10：传输速率为10Mb/s</span></p><p><span>BASE：采用基带信号进行传输</span></p><p><span>T：采用双绞线作为传输媒体</span></p><p><span>10BASE-T以太网的通信距离较短，每个站点到集线器的距离不能超过100m。IEEE 802.3以太网还可使用光纤作为传输媒体，相应的标准为10BASE-F，“F”表示光纤。光纤主要用作集线器之间的远程连接。</span></p><p>&nbsp;</p><h3 id='在物理层扩展以太网'><span>在物理层扩展以太网</span></h3><h4 id='扩展站点与集线器之间的距离'><span>扩展站点与集线器之间的距离</span></h4><p><span>共享总线以太网中两站点之间的距离不能太远，否则它们之间所传输的信号就会衰减到使CSMA/CD协议无法正常工作。</span></p><p><span>在早期广泛使用粗同轴电缆或细同轴电缆共享总线以太网时，为了提高网络的地理覆盖范围，常用的是工作在物理层的转发器。IEEE 802.3标准规定，两个网段可用一个转发器连接起来，任意两个站点之间最多可以经过三个网段。</span></p><p><img src="./库/image-20230517130831609.png" referrerpolicy="no-referrer" alt="image-20230517130831609"></p><p>&nbsp;</p><p><span>随着使用双绞线和集线器的10BASE-T星型以太网成为以太网的主流类型，扩展网络覆盖范围就很少使用转发器了。</span></p><p><span>10BASE-T星型以太网中每个站点到集线器的距离不能超过100m，因此两站点间的通信距离最大不能超过200m。在10BASE-T星型以太网中，可使用光纤和一对光纤调制解调器来扩展站点与集线器之间的距离。</span></p><p><span>这种扩展方法比较简单，所需付出的代价是：为站点和集线器各增加一个用于电信号和光信号转换的光纤调制解调器，以及它们之间的一对通信光纤。信号在光纤中的衰减和失真很小，因此使用这种方法可以很简单地将站点与集线器之间的距离扩展到1000以上。</span></p><p><img src="./库/image-20230517130858090.png" alt="image-20230517130858090" style="zoom:33%;" /></p><p><span>	</span></p><h4 id='扩展共享式以太网的覆盖范围和站点数量'><span>扩展共享式以太网的覆盖范围和站点数量</span></h4><p><span>以太网集线器一般具有8~32个接口，如果要连接的站点数量超过了单个集线器能够提供的接口数量，就需要使用多个集线器，这样就可以连接成覆盖更大范围、连接更多站点的多级星型以太网。</span></p><p><span>采用多个集线器连接而成的多级星型以太网，在扩展了网络覆盖范围和站点数量的同时，也带来了一些负面因素。</span></p><ul><li><p><span>原本不同的碰撞域合并，使得总的网络吞吐量下降</span></p></li><li><p><span>新形成的碰撞域中每个节点发生碰撞的可能性增加</span></p></li></ul><p><img src="./库/image-20230517131256677.png" referrerpolicy="no-referrer" alt="image-20230517131256677"></p><p><span>在物理层扩展的共享式以太网仍然是一个碰撞域，不能连接太多的站点，否则可能会出现大量的碰撞，导致平均吞吐量太低。</span></p><p>&nbsp;</p><h3 id='在数据链路层扩展以太网'><span>在数据链路层扩展以太网</span></h3><p><span>为了避免使用集线器的同时，形成更大的碰撞域，可以使用网桥在数据链路层扩展共享式以太网。</span></p><p><span>网桥工作在数据链路层（包含其下的物理层），而集线器仅工作在物理层。网桥比集线器“懂得多”。</span></p><p>&nbsp;</p><h4 id='网桥的主要结构和工作原理'><span>网桥的主要结构和工作原理</span></h4><p><span>网桥内部的结构：</span></p><ol start='' ><li><p><span>接口1</span></p></li><li><p><span>缓存</span></p></li><li><p><span>接口2</span></p></li><li><p><span>网桥实体协议</span></p></li><li><p><span>接口管理软件</span></p></li><li><p><span>转发表</span></p></li></ol><p>&nbsp;</p><p><span>网桥的主要功能：</span></p><ul><li><p><span>转发MAC帧</span></p></li><li><p><span>丢弃MAC帧</span></p></li><li><p><span>转发广播MAC帧：目的MAC地址为FF-FF-FF-FF-FF-FF，不用查找转发表，而是会通过除接收该帧的接口的其他接口转发该广播帧。</span></p></li></ul><p>&nbsp;</p><p><strong><span>网桥的接口在向其连接的网段转发帧时，会执行相应的媒体接入控制协议，对于共享式以太网就是CSMA/CD协议。</span></strong></p><p>&nbsp;</p><h4 id='透明网桥的自学习和转发帧'><span>透明网桥的自学习和转发帧</span></h4><p><span>网桥中的转发表对于帧的转发起着决定性的作用，那么转发表是如何建立的呢？</span></p><p><span>透明网桥（Transparent Bridge）通过</span><strong><span>自学习</span></strong><span>算法建立转发表。</span></p><p><span>透明网桥中的“</span><strong><span>透明</span></strong><span>”，是指以太网中的各站点并不知道自己所发送的帧将会经过哪些网桥的转发，最终到达目的站点。也就是说，以太网中的各网桥对于各站点而言是看不见的。</span></p><p><span>透明网桥的标准是IEEE 802.1D，它通过一种自学习算法基于以太网中各站点间的相互通信逐步建立起自己的转发表。</span></p><p>&nbsp;</p><p><span>透明网桥自学习和转发帧的过程：</span></p><ol start='' ><li><p><span>网桥收到帧后进行登记（即自学习），登记的内容为帧的源MAC地址和进入网桥的接口号。</span></p></li><li><p><span>网桥根据帧的目的MAC地址和网桥的转发表对帧进行转发，包含以下三种情况：</span></p><ol start='' ><li><p><span>明确转发：网桥知道应当从哪个接口转发帧。</span></p></li><li><p><span>盲目转发：网桥不知道应当从哪个接口转发帧，只能将其通过除进入网桥的接口外的其他所有接口转发。</span></p></li><li><p><span>丢弃：网桥知道不应该转发该帧，将其丢弃。</span></p></li></ol></li></ol><p>&nbsp;</p><p><strong><span>注意：</span></strong></p><ul><li><p><span>如果网桥收到有误码的帧则直接丢弃。</span></p></li><li><p><span>如果网桥收到一个无误码的广播帧，则不用进行查表，而是直接从除接收该广播帧的接口的其他接口转发该广播帧。</span></p></li><li><p><span>转发表中的每条记录都有其有效时间，到期自动删除！这是因为各站点的MAC地址与网桥接口的对应关系并不是永久性的，例如某个站点更换了网卡，其MAC地址就会改变。</span></p></li></ul><p>&nbsp;</p><h4 id='透明网桥的生成树协议stp'><span>透明网桥的生成树协议STP</span></h4><p><span>为了提高以太网的可靠性，有时需要在两个以太网之间使用多个透明网桥来提供冗余链路。</span></p><p><img src="./库/image-20230517140457861.png" alt="image-20230517140457861" style="zoom:33%;" /></p><p>&nbsp;</p><p><span>造成广播帧充斥整个网络，网络资源被白白浪费，而网络中的主机之间无法正常通信！</span></p><p><span>说明：</span></p><ol start='' ><li><p><span>若网桥B1和B2的转发表中都没有待转发单播帧目的MAC地址的相关记录，则该单播帧也会引起类似的情况。</span></p></li><li><p><span>为了简单起见，未考虑信号在总线上碰撞的情况。</span></p></li></ol><p>&nbsp;</p><p><span>在增加冗余链路提高以太网可靠性的同时，却给网络引入了环路。网络中的广播帧将在环路中永久兜圈，造成广播帧充斥整个网络，网络资源被白白浪费，而网络中的主机之间无法正常通信！</span></p><p>&nbsp;</p><p><span>为了避免广播帧在环路中永久兜圈，透明网桥使用</span><strong><span>生成树协议</span></strong><span>（Spanning Tree Protocol，STP），可以在增加冗余链路提高网络可靠性的同时，又避免环路带来的问题。</span></p><p><span>不管网桥之间连接成了怎样复杂的带环拓扑，网桥之间通过交互</span><strong><span>网桥协议单元</span></strong><span>（Bridge Protocol Data Unit，</span><strong><span>BPDU</span></strong><span>），找出</span><strong><span>原网络拓扑的一个连通子集</span></strong><span>（即生成树），在这个子集里整个连通的网络中不存在环路。当首次连接网桥或网络拓扑发生变化时（人为改变或出现故障），网桥都会重新构造生成树，以确保网络的连通。</span></p><p><img src="./库/image-20230517140825739.png" alt="image-20230517140825739" style="zoom:33%;" /></p><p>&nbsp;</p><h2 id='交换式以太网'><span>交换式以太网</span></h2><p><span>网桥的接口数量很少，通常只有2~4个，一般只用来连接不同的网段。</span></p><p>&nbsp;</p><h3 id='以太网交换机'><span>以太网交换机</span></h3><p><span>1990年面世的交换式集线器（Switching Hub），</span><strong><span>实质上是具有多个接口的网桥</span></strong><span>，常称为以太网交换机（Switch）或二层交换机。</span></p><p>&nbsp;</p><ul><li><p><span>“二层”是指以太网交换机工作在数据链路层（包括物理层）。</span></p></li><li><p><span>与网桥相同，交换机内部的转发表也是通过自学习算法，基于网络中各主机间的通信，自动地逐步建立起来的。</span></p></li><li><p><span>另外，交换机也使用生成树协议STP，来产生能够连通全网但不产生环路的通信路径。</span></p></li></ul><p>&nbsp;</p><p><strong><span>注意！！！！！</span></strong></p><p><strong><span>仅使用交换机（而不使用集线器）的以太网就是交换式以太网。</span></strong></p><p><img src="./库/image-20230517170624425.png" referrerpolicy="no-referrer" alt="image-20230517170624425"></p><p>&nbsp;</p><p><span>交换机的每个接口可以连接计算机、集线器或另一个交换机。</span></p><p><span>当交换机的</span><strong><span>接口与计算机或交换机连接</span></strong><span>时，可以工作在</span><strong><span>全双工</span></strong><span>方式，并能在自身内部同时连通多对接口，使每一对相互通信的计算机都能像独占传输媒体那样，无碰撞地传输数据，这样就</span><strong><span>不需要使用CSMA/CD协议了。</span></strong></p><p><span>当交换机的</span><strong><span>接口连接的是集线器</span></strong><span>时，该接口就只能</span><strong><span>使用CSMA/CD</span></strong><span>协议并只能工作在</span><strong><span>半双工</span></strong><span>方式。</span></p><p><span>现在的交换机和计算机中的网卡都能自动识别上述两种情况，并自动切换到相应的工作方式。</span></p><p><img src="./库/image-20230517170950798.png" referrerpolicy="no-referrer" alt="image-20230517170950798"></p><p>&nbsp;</p><p><span>交换机一般都具有多种速率的接口，例如10Mb/s、100Mb/s、1Gb/s甚至10Gb/s的接口，大部分接口支持多速率自适应。</span></p><p><span>一般的交换机都采用“存储转发”方式，为了减小交换机的转发时延，某些交换机采用了</span><strong><span>直通交换方式</span></strong><span>（Cut-Through）。</span></p><p><span>采用直通交换方式的交换机，在接收帧的同时就立即按帧的目的MAC地址决定该帧的转发接口，然后通过其内部基于硬件的交叉矩阵进行转发，而不必把整个帧先缓存后再进行处理。</span></p><ul><li><p><span>直通交换的时延非常小。取决于接受目的MAC地址的速度。</span></p></li><li><p><span>直通交换不检查差错就直接将帧转发出去，有可能会将一些无效帧转发给其他主机。</span></p></li></ul><p>&nbsp;</p><p>&nbsp;</p><h3 id='共享式以太网和交换式以太网'><span>共享式以太网和交换式以太网</span></h3><p><img src="./库/image-20230517173635029.png" referrerpolicy="no-referrer" alt="image-20230517173635029"></p><p>&nbsp;</p><blockquote><p><span>网址：</span></p><p><a href='https://www.bilibili.com/video/BV1NT411g7n6?p=37&amp;spm_id_from=pageDriver&amp;vd_source=11579445a367b6624c1d123aa6f75a37' target='_blank' class='url'>https://www.bilibili.com/video/BV1NT411g7n6?p=37&spm_id_from=pageDriver&vd_source=11579445a367b6624c1d123aa6f75a37</a></p></blockquote><p>&nbsp;</p><h2 id='以太网的mac帧格式'><span>以太网的MAC帧格式</span></h2><p><span>DIX Ethernet V2 的帧格式和IEEE 802.3 的帧格式仅仅在类型字段上有区别，这里仅介绍DIX Ethernet V2 的帧格式。</span></p><p>&nbsp;</p><p><img src="./库/image-20230517174439693.png" referrerpolicy="no-referrer" alt="image-20230517174439693"></p><ul><li><p><span>类型字段：其值用来指明数据载荷中的内容是由上一层的哪个协议封装的，以便将收到的MAC帧的数据载荷上交给上一层的这个协议。</span></p></li><li><p><span>FCS字段：使用CRC生成的帧检验序列FCS，接收方的网卡通过FCS的内容就可检测出帧在传输过程中是否产生了误码。</span></p></li></ul><p>&nbsp;</p><p><span>物理层要在以太网MAC帧前面添加8字节的前导码，第一字节是帧开始定界符，后七个字节是时钟同步码。</span></p><p>&nbsp;</p><p><span>接收方可能收到的无效MAC帧包括以下几种：</span></p><ul><li><p><span>MAC帧的长度不是整数个字节</span></p></li><li><p><span>通过MAC帧的FCS字段的值检测出帧有误码</span></p></li><li><p><span>MAC帧的长度不在64~1518字节之间</span></p></li></ul><p><span>接收方收到无效的MAC帧时，就简单将其丢弃，以太网的数据链路层没有重传机制。</span></p><p>&nbsp;</p><h2 id='虚拟以太网vlan'><span>虚拟以太网VLAN</span></h2><p><span>虚拟局域网VLAN的诞生背景</span></p><ul><li><p><span>将多个站点通过一个或多个以太网交换机连接起来就构建出了交换式以太网。</span></p></li><li><p><span>交换式以太网中的所有站点都属于同一个广播域。</span></p></li><li><p><span>随着交换式以太网规模的扩大，广播域也相应扩大。</span></p></li><li><p><span>巨大的广播域会带来一系列问题。</span></p><ul><li><p><span>广播风暴</span></p></li><li><p><span>难以管理和维护，带来潜在的安全问题。</span></p></li></ul></li></ul><p>&nbsp;</p><p><span>分割广播域的方法：</span></p><ul><li><p><span>使用路由器可以隔离广播域（成本高）</span></p></li><li><p><span>虚拟局域网技术应运而生</span></p></li></ul><p>&nbsp;</p><h3 id='vlan概述'><span>VLAN概述</span></h3><p><span>虚拟局域网（Virtual Local Area Network，VLAN）是一种将局域网内的站点划分成与物理位置无关的逻辑组的技术，一个逻辑组就是一个VLAN，VLAN中的各站点具有某些共同的应用需求。</span></p><p><span>属于同一VLAN的站点之间可以直接进行通信，而不同VLAN中的站点之间不能直接通信。</span></p><p><span>网络管理员可对局域网中的各交换机进行配置来建立多个</span><strong><span>逻辑上独立的VLAN</span></strong><span>。</span></p><p><span>连接在同一交换机上的多个站点可以属于不同的VLAN，而属于同一VLAN的多个站点可以连接在不同的交换机上。</span></p><p><img src="./库/image-20230517175831779.png" alt="image-20230517175831779" style="zoom:33%;" /></p><p><span>虚拟局域网VLAN并不是一种新型网络，它只是局域网能够提供给用户的一种服务。</span></p><p>&nbsp;</p><h3 id='vlan的实现机制'><span>VLAN的实现机制</span></h3><p><span>虚拟局域网VLAN有多种实现技术，最常见的就是基于以太网交换机的接口来实现VLAN。这就需要以太网交换机能够实现以下两个功能：</span></p><ul><li><p><span>能够处理带有VLAN标记的帧，也就是IEEE 802.1Q帧。</span></p></li><li><p><span>交换机的各接口可以支持不同的接口类型，不同接口类型的接口对帧的处理方式有所不同。</span></p></li></ul><p>&nbsp;</p><h4 id='ieee-8021q帧'><span>IEEE 802.1Q帧</span></h4><p><img src="./库/image-20230517180157417.png" referrerpolicy="no-referrer" alt="image-20230517180157417"></p><p><span>IEEE 802.1Q帧中插入了4个字节的VALN标签，其最后12比特是虚拟局域网标识符VID，取值范围是0~4095，其中0和4095保留不使用。VID是802.1Q帧所属VLAN的编号，设备利用VID来识别帧所属的VLAN。广播帧只在同一VLAN内转发，这样就将广播域限制在了一个VLAN内。</span></p><p>&nbsp;</p><p><span>802.1Q帧一般不由用户主机处理，而是由以太网交换机来处理：</span></p><ul><li><p><span>当交换机收到普通的以太网MAC帧时，会给其插入4字节的VLAN标签使之成为802.1Q帧，该处理简称为“打标签”。</span></p></li><li><p><span>当交换机转发802.1Q帧时，</span><strong><span>可能</span></strong><span>会删除其4字节的VLAN标签使之成为普通的以太网MAC帧，该处理简称为“去标签”。交换机转发802.1Q帧时也有可能不进行“去标签”处理，是否进行“去标签”处理</span><strong><span>取决于交换机的接口类型</span></strong><span>。</span></p></li></ul><p>&nbsp;</p><h2 id='38以太网的发展'><span>3.8以太网的发展</span></h2><h3 id='100base-t以太网'><span>100BASE-T以太网</span></h3><p><span>100BASE-T以太网是指在双绞线上传输基带信号的速率为100Mb/s的以太网，也称为快速以太网（Fast Ethernet）。</span></p><p><span>100BASE-T以太网与10Mb/s标准以太网（传统以太网）一样，仍然使用IEEE 802.3的帧格式和CSMA/CD协议。</span></p><p><span>100BASE-T以太网为了与10Mb/s标准以太网保持兼容，需要以太网最小帧长保持不变，即仍为64字节。</span></p><ul><li><p><span>网段的最大电缆长度从1000m减小到100m</span></p></li><li><p><span>争用期缩短为5.12𝝁𝒔</span></p></li><li><p><span>帧间最小间隔缩短为0.96𝝁𝒔</span></p></li></ul><p>&nbsp;</p><p><span>100BASE-T以太网还可以使用以太网交换机来提供比集线器更好的服务质量，即在全双工方式下无碰撞工作。因此，</span><strong><span>使用交换机的100BASE-T以太网，工作在全双工方式下，并不使用CSMA/CD协议。</span></strong></p><p>&nbsp;</p><h3 id='吉比特以太网'><span>吉比特以太网</span></h3><p><span>吉比特以太网也称为千兆以太网（Gigabit Ethernet）。1998年，千兆以太网的标准802.3z成为正式标准。</span></p><p><span>IEEE 802.3z千兆以太网的主要特点有：</span></p><ul><li><p><span>速率为1000Mb/s（1Gb/s）</span></p></li><li><p><span>使用IEEE 802.3的帧格式（与10Mb/s和100Mb/s以太网相同）</span></p></li><li><p><span>支持半双工方式（使用CSMA/CD协议）和全双工方式（不使用CSMA/CD协议）</span></p></li><li><p><span>兼容10BASE-T和100BASE-T技术</span></p></li></ul><p>&nbsp;</p><p><span>当千兆以太网工作在半双工方式时，需要使用CSMA/CD协议。由于速率已经提高到了1000Mb/s，因此只有减小网段最大长度或增大最小帧长，才能使3.4.2节中介绍的以太网的参数a（𝝉 ∕ 𝑻</span><sub><span>𝟎</span></sub><span> ）保持为较小的数值。</span></p><ul><li><p><span>若将网段最大长度减小到10m，则网络基本失去了应用价值。</span></p></li><li><p><span>若将最小帧长增大到640字节，则当上层交付的待封装的协议数据单元PDU很短时，开销就会太大。</span></p></li></ul><p>&nbsp;</p><p><strong><span>实际上，千兆以太网的网段最大长度仍保持为100m，最小帧长仍保持为64字节（与10BASE-T和100BASE-T兼容）。</span></strong></p><p><span>这就需要使用</span><strong><span>载波延伸</span></strong><span>（Carrier Extension）的办法，将争用期增大为512字节的发送时间而保持最小帧长仍为64字节。</span></p><p><span>载波延伸：只要发送的MAC帧的长度不足512字节时，就在MAC帧尾部填充一些特殊字符，使MAC帧的长度增大到512字节。</span></p><p><span>在使用载波延伸的机制下，如果原本发送的是大量的64字节长的短帧，则每一个短帧都会被填充448字节的特殊字符，这样会造成很大的开销。因此，千兆以太网还使用了</span><strong><span>分组突发</span></strong><span>（Packet Bursting）功能。也就是当有很多短帧要连续发送时，只将第一个短帧用载波延伸的方法进行填充，而其后面的一系列短帧不用填充就可一个接一个地发送，它们之间只需空开必要的帧间最小间隔即可。这样就形成了一连串分组的突发，当累积发送1500字节或稍多一些为止。</span></p><p><img src="./库/image-20230517183131790.png" referrerpolicy="no-referrer" alt="image-20230517183131790"></p><p><span>当千兆以太网工作在全双工方式时，不使用CSMA/CD协议，也不会使用载波延伸和分组突发。</span></p><p>&nbsp;</p><h3 id='10吉比特以太网'><span>10吉比特以太网</span></h3><p><span>2002年6月，IEEE 802.3ae委员会通过10吉比特以太网（10GE）的正式标准，10GE也称为万兆以太网。</span></p><p><span>万兆以太网并不是将千兆以太网的速率简单地提高了10倍。万兆以太网的目标是将以太网从局域网范围（校园网或企业网）扩展到城域网与广域网，成为城域网和广域网的主干网的主流技术之一。</span></p><p><span>IEEE 802.3ae万兆以太网的主要特点有：</span></p><ul><li><p><span>速率为10Gb/s</span>
<span>使用IEEE 802.3标准的帧格式（与10Mb/s、100Mb/s和1Gb/s以太网相同）</span></p></li><li><p><span>保留IEEE 802.3标准对以太网最小帧长和最大帧长的规定。这是为了用户升级以太网时，仍能和较低速率的以太网方便地通信。</span></p></li><li><p><span>只工作在全双工方式而不存在争用媒体的问题，因此不需要使用CSMA/CD协议，这样传输距离就不再受碰撞检测的限制。</span></p></li><li><p><span>增加了支持城域网和广域网的物理层标准</span></p></li></ul><p>&nbsp;</p><p><span>万兆以太网交换机常作为千兆以太网的汇聚层交换机，与千兆以太网交换机相连，还可以连接对传输速率要求极高的视频服务器、文件服务器等设备。</span></p><p>&nbsp;</p><h3 id='40100吉比特以太网'><span>40/100吉比特以太网</span></h3><p><span>2010年，IEEE发布了40吉比特/100吉比特以太网（40GE/100GE）的IEEE 802.3ba标准，40GE/100GE也称为四万兆/十万兆以太网。</span></p><p><span>为了使以太网能够更高效、更经济地满足局域网、城域网和广域网的不同应用需求，IEEE 802.3ba标准定义了两种速率类型：</span></p><ul><li><p><span>40Gb/s主要用于计算应用</span></p></li><li><p><span>100Gb/s主要用于汇聚应用</span></p></li></ul><p>&nbsp;</p><p><span>IEEE 802.3ba标准只工作在全双工方式（不使用CSMA/CD协议），但仍使用IEEE 802.3标准的帧格式并遵守最小帧长和最大帧长的规定。</span></p><p>&nbsp;</p><h2 id='39-80211无线局域网的组成'><span>3.9 802.11无线局域网的组成</span></h2><p>&nbsp;</p><h1 id='第四章'><span>第四章</span></h1><h2 id='网络层概述-2'><span>网络层概述</span></h2><p><span>网络层的主要任务就是将分组从源主机经过多个网络和多段链路传输到目的主机。</span></p><p><span>可以将该任务划分：</span></p><ul><li><p><span>分组转发</span></p></li><li><p><span>路由选择</span></p></li></ul><p>&nbsp;</p><p><span>R1如何知道应从自己的哪个接口转发分组？转发表</span></p><p><span>转发表如何得来？路由表</span></p><p><span>路由表又如何得来？路由选择处理机上运行路由选择协议</span></p><p>&nbsp;</p><p><span>网络层向其上层提供的两种服务：</span></p><ul><li><p><span>面向连接的虚电路服务</span></p></li><li><p><span>无连接的数据报服务</span></p></li></ul><p>&nbsp;</p><h3 id='虚电路服务'><span>虚电路服务</span></h3><p><span>核心思想是“可靠通信应由网络自身来保证”。</span></p><p><span>必须首先建立网络层连接—— 虚电路（Virtual Circuit，VC），以保证通信双方所需的一切网络资源。</span></p><p><span>通信双方沿着已建立的虚电路发送分组。</span></p><p><span>通信结束后，需要释放之前所建立的虚电路。</span></p><p>&nbsp;</p><blockquote><p><span>虚电路表示这是一条逻辑上的连接，分组沿着这条逻辑连接按照存储转发方式传送，而不是真正建立了一条物理连接。而采用电路交换的电话通信，则是先建立一条真正的物理连接。因此，分组交换的虚连接与电路交换的连接只是类似，但并不完全一样。</span></p></blockquote><p>&nbsp;</p><p><span>分组的首部仅在连接建立阶段使用完整的目的主机地址，之后每个分组的首部只需要携带一条虚电路编号即可。</span></p><p>&nbsp;</p><p><span>这种通信方式如果再使用可靠传输的网络协议，就可使所发送的分组最终正确（无差错按序到达、不丢失、不重复）到达接收方。</span></p><p>&nbsp;</p><p><span>然而，因特网的先驱者并没有采用这种设计思想，而是采用了无连接的数据报服务。</span></p><p>&nbsp;</p><h3 id='数据报服务'><span>数据报服务</span></h3><p><span>核心思想是“可靠通信应由用户主机来保证”。</span></p><p><span>不需要建立网络层连接。</span></p><p><span>每个分组可走不同的路径。因此，每个分组的首部都必须携带目的主机的完整地址。</span></p><p><span>通信结束后，没有需要释放的连接。</span></p><p>&nbsp;</p><p><span>这种通信方式所传送的分组可能误码、丢失、重复和失序。</span></p><ul><li><p><span>将相对简单的尽最大努力（即不可靠）的分组交付功能置于因特网核心。</span></p></li><li><p><span>将复杂的网络处理功能置于因特网的边缘（即用户主机和其内部的运输层）</span></p></li></ul><p><span>由于网络自身不提供端到端的可靠传输服务，这就使得网络中的路由器可以做得比较简单，大大降低了网络造价。另外，这种设计思想的运行方式灵活、能够适应多种应用。因特网能够发展到今日的规模，充分证明了当初采取这种设计思想的正确性。</span></p><p>&nbsp;</p><p><span>本章后续内容将围绕网际层如何传送IP数据报这个主题进行介绍</span></p><p>&nbsp;</p><h2 id='网际协议ip'><span>网际协议IP</span></h2><p><span>网际协议（Internet Protocol，IP）是TCP/IP体系结构网际层中的核心协议。</span></p><p><img src="./库/image-20230517190046504.png" alt="image-20230517190046504" style="zoom:33%;" /></p><p>&nbsp;</p><h3 id='异构网络互连'><span>异构网络互连</span></h3><p><img src="./库/image-20230517190234083.png" alt="image-20230517190234083" style="zoom:33%;" /></p><p><span>这些网络的拓扑、性能以及所使用的网络协议都不尽相同，这是由用户需求的多样性造成的，没有一种单一的网络能够适应所有用户的需求。</span></p><p><span>要将众多的异构型网络都互连起来，并且能够互相通信，则会面临许多需要解决的问题。</span></p><ul><li><p><span>不同的网络接入机制</span></p></li><li><p><span>不同的差错恢复方法</span></p></li><li><p><span>不同的路由选择技术</span></p></li><li><p><span>不同的寻址方案</span></p></li><li><p><span>不同的最大分组长度</span></p></li><li><p><span>不同的服务（面向连接服务和无连接服务）</span></p></li></ul><p>&nbsp;</p><p><span>如果所有的网络在网络层都使用相同的IP协议，那么从网络层角度看好像是一个统一的网络（IP网）</span></p><p>&nbsp;</p><h3 id='ipv4地址概述'><span>IPv4地址概述</span></h3><p><span>IPv4地址是给因特网（Internet）上的每一个主机（或路由器）的每一个接口分配的一个在全世界范围内唯一的32比特的标识符。</span></p><p><span>IPv4地址由因特网名字和数字分配机构（Internet Corporation for Assigned Names and Numbers，ICANN）进行分配。</span></p><p><span>IPv4地址的编址方法经历了三个历史阶段：</span></p><ol start='' ><li><p><span>分类编址</span></p></li><li><p><span>划分子网</span></p></li><li><p><span>无分类编址（消除分类编址和划分子网的概念）</span></p></li></ol><p>&nbsp;</p><p><span>由于IPv4地址由32比特构成，不方便阅读、记录以及输入等，因此IPv4地址采用点分十进制表示方法以方便用户使用。</span></p><p>&nbsp;</p><h3 id='分类编址'><span>分类编址</span></h3><p><img src="./库/image-20230517200311206.png" referrerpolicy="no-referrer" alt="image-20230517200311206"></p><p>&nbsp;</p><p><span>A类、B类和C类地址都是单播地址，只有单播地址可以分配给网络中的主机（或路由器）的各接口。</span></p><p><span>主机号为“全0”的地址是网络地址，不能分配给主机（或路由器）的各接口。</span></p><p><span>主机号为“全1”的地址是广播地址，不能分配给主机（或路由器）的各接口。</span></p><p>&nbsp;</p><h4 id='a类地址8位-0'><span>A类地址8位 0</span></h4><p><span>最小网络号为0，表示本网络，不能指派；</span></p><p><span>最小可指派的网络号为1，网络地址为1.0.0.0</span></p><p><span>最大网络号为127，作为本地环回测试地址，不能指派</span></p><ul><li><p><span>最小的本地环回测试地址为127.0.0.1</span></p></li><li><p><span>最大的本地环回测试地址为127.255.255.254</span></p></li></ul><p><span>最大可指派的网络号为126，网络地址为126.0.0.0</span></p><p><span>可指派的A类网络数量为𝟐</span><sup><span>(𝟖−𝟏)</span></sup><span>−𝟐=𝟏𝟐𝟔（减2是去掉最小网络号0和最大网络号127）</span></p><p><span>每个A类网络中可分配的地址数量为𝟐</span><sup><span>𝟐𝟒</span></sup><span>−𝟐=𝟏𝟔𝟕𝟕𝟕𝟐𝟏𝟒（减2是去掉主机号为全0的网络地址和全1的广播地址）</span></p><p>&nbsp;</p><h4 id='b类地址16位-10'><span>B类地址16位 10</span></h4><p><span>最小可指派的网络号为128.0</span></p><p><span>网络地址为128.0.0.0</span></p><p><span>最大可指派的网络号为191.255</span></p><p><span>可指派的B类网络数量为𝟐</span><sup><span>(𝟏𝟔−𝟐)</span></sup><span>=𝟏𝟔𝟑𝟖𝟒</span></p><p><span>每个B类网络中可分配的地址数量为𝟐</span><sup><span>𝟏𝟔</span></sup><span>−𝟐=𝟔𝟓𝟓𝟑𝟒（减2是去掉主机号为全0的网络地址和全1的广播地址）</span></p><p>&nbsp;</p><h4 id='c类地址24位-110'><span>C类地址24位 110</span></h4><p><span>最小可指派的网络号为192.0.0</span></p><p><span>网络地址为192.0.0.0</span></p><p><span>最大可指派的网络号为223.255.255</span></p><p><span>网络地址为223.255.255.0</span></p><p>&nbsp;</p><h4 id='总结'><span>总结</span></h4><p><img src="./库/image-20230517201212159.png" referrerpolicy="no-referrer" alt="image-20230517201212159"></p><p><img src="./库/image-20230517201228279.png" referrerpolicy="no-referrer" alt="image-20230517201228279"></p><p>&nbsp;</p><h4 id='举例'><span>举例</span></h4><p><img src="./库/image-20230517201330322.png" referrerpolicy="no-referrer" alt="image-20230517201330322"></p><p>&nbsp;</p><h4 id='一般不使用的特殊ipv4地址'><span>一般不使用的特殊IPv4地址</span></h4><p><img src="./库/image-20230517201357336.png" referrerpolicy="no-referrer" alt="image-20230517201357336"></p><p>&nbsp;</p><h4 id='例题'><span>例题</span></h4><p><span>【练习】请给出下图各网络的IPv4地址分配方案，要求尽量节约IP地址。</span></p><ol start='' ><li><p><span>找出图中有哪些网络；</span></p></li><li><p><span>根据各网络中主机和路由器的接口总数量给各网络分配相应类别的网络号；</span></p></li><li><p><span>给各网络中的各主机和路由器的各接口分配IP地址。</span></p></li></ol><p><span>同一个网络中，不同主机和路由器的各接口的IPv4地址的主机号必须各不相同，并且不能为“全0”（网络地址）和“全1”（广播地址）。</span></p><p><img src="./库/image-20230517201934595.png" alt="image-20230517201934595" style="zoom: 50%;" /></p><p>&nbsp;</p><h3 id='划分子网'><span>划分子网</span></h3><p><span>随着更多的中小网络加入因特网，IPv4分类编址方法不够灵活、容易造成大量IPv4地址资源浪费的缺点就暴露出来了。</span></p><p>&nbsp;</p><p><span>还剩余大量地址：只能由该单位的同一个网络使用，而其他单位的网络不能使用。</span></p><p><span>申请新的网络号存在以下弊端：</span></p><ul><li><p><span>需要等待很长的时间，并且要花费更多的费用。</span></p></li><li><p><span>即便申请到了两个新的网络号，其他路由器的路由表还需要新增针对这两个新的网络的路由条目。</span></p></li><li><p><span>浪费原来已申请到的B类网络中剩余的大量地址。</span></p></li></ul><p>&nbsp;</p><p><span>如果可以从IPv4地址的主机号部分借用一些比特作为子网号来区分不同的子网，就可以利用原有网络中剩余的大量IPv4地址，而不用申请新的网络地址了。那么我们或计算机又如何知道在分类地址中，主机号有多少比特被借用作为子网号了呢？</span></p><p>&nbsp;</p><h4 id='子网掩码-2'><span>子网掩码</span></h4><p><span>子网掩码可以表明分类IPv4地址的主机号部分被借用了几个比特作为子网号。</span></p><p><span>与IPv4地址类似，子网掩码也是由32比特构成的。</span></p><ul><li><p><span>用左起多个连续的比特1对应IPv4地址中的网络号和子网号；</span></p></li><li><p><span>之后的多个连续的比特0对应IPv4地址中的主机号。</span></p></li></ul><p>&nbsp;</p><p><span>将划分子网的IPv4地址与相应的子网掩码进行逐比特的逻辑与运算，就可得到该IPv4地址所在子网的网络地址。</span></p><p><strong><span>只要给定了一个分类的IPv4地址及其相应的子网掩码，就可以得出子网划分的全部细节。</span></strong></p><p>&nbsp;</p><p><span>举例</span></p><p><span>【举例】已知某个网络的地址为218.75.230.0，使用子网掩码255.255.255.128对其进行子网划分，请给出划分细节。</span></p><p><img src="./库/image-20230517204335898.png" alt="image-20230517204335898" style="zoom:33%;" /></p><p><img src="./库/image-20230517204410221.png" alt="image-20230517204410221" style="zoom:33%;" /></p><h4 id='默认子网掩码'><span>默认子网掩码</span></h4><p><span>A类地址的默认子网掩码255.0.0.0</span></p><p><span>B类地址的默认子网掩码255.255.0.0</span></p><p><span>C类地址的默认子网掩码255.255.255.0</span></p><p>&nbsp;</p><h3 id='无分类编址'><span>无分类编址</span></h3><p><span>IPv4地址的划分子网编址方法在一定程度上缓解了因特网在发展中遇到的困难，但是数量巨大的C类网(𝟐</span><sup><span>(𝟐𝟒−𝟑)</span></sup><span>=𝟐𝟎𝟗𝟕𝟏𝟓𝟐)由于其每个网络所包含的地址数量太小(𝟐</span><sup><span>𝟖</span></sup><span>=𝟐𝟓𝟔)，因此并没有得到充分使用，而因特网的IPv4地址仍在加速消耗，整个IPv4地址空间面临全部耗尽的威胁。</span></p><p><span>为此，因特网工程任务组IETF又提出了采用无分类编址的方法，来解决IPv4地址资源紧张的问题，同时还专门成立IPv6工作组负责研究新版本的IP，以彻底解决IPv4地址耗尽问题。1993年，因特网工程任务组IETF发布了无分类域间路由选择（Classless Inter-Domain Routing，CIDR ）的RFC文档[RFC1517~1519，RFC1520]。</span></p><ul><li><p><span>CIDR消除了传统A类、B类和C类地址以及划分子网的概念。</span></p></li><li><p><span>CIDR可以更加有效地分配IPv4地址资源，并且可以在IPv6使用之前允许因特网的规模继续增长。</span></p></li></ul><p>&nbsp;</p><p><span>IPv4地址的无分类编址方法:</span></p><ul><li><p><span>两级结构（网络前缀，主机号）</span></p></li><li><p><span>使用地址掩码</span></p></li></ul><p><span>网络前缀是不定长的，仅从IPv4地址自身是无法确定其网络前缀和主机号的，需要配合使用32比特的地址掩码。</span></p><p><span>无分类编址方法使用的地址掩码与划分子网使用的子网掩码类似，由32比特构成。</span></p><ul><li><p><span>用左起多个连续的比特1对应IPv4地址中的网络前缀；</span></p></li><li><p><span>之后的多个连续的比特0对应IPv4地址中的主机号。</span></p></li></ul><p><span>实际上，无分类域间路由选择CIDR是将网络前缀都相同的、连续的多个无分类IPv4地址，组成一个CIDR地址块，只要知道CIDR地址块中的任何一个地址，就可以知道该地址块的以下全部细节：</span></p><ul><li><p><span>地址块中的最小地址</span></p></li><li><p><span>地址块中的最大地址</span></p></li><li><p><span>地址块中的地址数量</span></p></li><li><p><span>地址块中聚合某类网络（A类、B类、C类）的数量</span></p></li><li><p><span>地址掩码</span></p></li></ul><p>&nbsp;</p><p><span>【例1】给定的无分类编址的IPv4地址为128.14.35.7/20，请给出该地址所在CIDR地址块的全部细节。</span></p><p><span>128.14.35.7/20————————128.14.00100011.00000111</span></p><p><span>最小地址————128.14.32.0————128.14.00100000.00000000</span></p><p><span>最大地址————128.14.47.255————128.14.00101111.11111111</span></p><p><span>地址数量𝟐</span><sup><span>(𝟑𝟐−𝟐𝟎)</span></sup></p><p><span>聚合C类网的数量𝟐</span><sup><span>(𝟑𝟐−𝟐𝟎)</span></sup><span>÷𝟐</span><sup><span>𝟖</span></sup></p><p><span>地址掩码255.255.240.0————11111111.11111111.11110000.00000000</span></p><p>&nbsp;</p><p><span>使用无分类编址方法，可以根据客户的需要分配适当大小的CIDR地址块，因此可以更加有效地分配IPv4的地址空间。</span></p><ul><li><p><span>使用无分类编址方法的另一个好处是</span><strong><span>路由聚合</span></strong><span>（也称为</span><strong><span>构造超网</span></strong><span>）。</span></p></li><li><p><span>网络前缀越长，地址块越小，路由越具体；若路由器查表转发分组时发现有多条路由条目匹配，则选择网络前缀最长的那条路由条目，这称为最长前缀匹配，因为这样的路由更具体。</span></p></li></ul><p><img src="./库/image-20230518145059067.png" alt="image-20230518145059067" style="zoom:33%;" /></p><p>&nbsp;</p><h3 id='ipv4地址的应用规划'><span>IPv4地址的应用规划</span></h3><p><span>IPv4地址的应用规划是指将给定的IPv4地址块（或分类网络）划分成若干个更小的地址块（或子网），并将这些地址块（或子网）分配给互联网中的不同网络，进而可以给各网络中的主机和路由器的接口分配IPv4地址。</span></p><p>&nbsp;</p><h4 id='定长的子网掩码'><span>定长的子网掩码</span></h4><p><span>（Fixed Length Subnet Mask，FLSM）</span></p><p><span>所划分出的每一个子网都使用同一个子网掩码。</span></p><p><span>每个子网所分配的IP地址数量相同，容易造成地址资源的浪费。</span></p><p>&nbsp;</p><h4 id='变长的子网掩码'><span>变长的子网掩码</span></h4><p><span>（Variable Length Subnet Mask，VLSM）</span></p><p><span>所划分出的每一个子网可以使用不同的子网掩码。</span></p><p><span>每个子网所分配的IP地址数量可以不同，尽可能减少对地址资源的浪费。</span></p><p>&nbsp;</p><h4 id='定长的子网掩码举例'><span>定长的子网掩码举例</span></h4><p><span>【举例】假设申请到的C类网络为218.75.230.0，使用定长的子网掩码给下图所示的小型互联网中的各设备分配IPv4地址。</span></p><p><img src="./库/image-20230518150514298.png" alt="image-20230518150514298" style="zoom:50%;" /></p><p><span>应用需求：</span></p><p><span>网络1需要IP地址数量为9，网络2需要IP地址数量为28，网络3需要IP地址数量为15，网络4需要IP地址数量为13，网络5需要IP地址数量为4。</span></p><p><span>申请到的C类网络地址218.75.230.0，从主机号借用3比特作为子网号</span></p><p><span>子网数量：𝟐</span><sup><span>𝟑</span></sup><span>= 8（满足应用需求）</span></p><p><span>每个子网上的地址数量：𝟐</span><sup><span>(𝟖−𝟑)</span></sup><span>=𝟑𝟐（满足应用需求）</span></p><p><span>子网掩码255.255.255.11100000，也就是255.255.255.224</span></p><p><img src="./库/image-20230518150753302-1684393678732-1.png" referrerpolicy="no-referrer" alt="image-20230518150753302"></p><p>&nbsp;</p><h4 id='变长的子网掩码举例'><span>变长的子网掩码举例</span></h4><p><span>【举例】假设申请到的地址块为218.75.230.0/24，使用变长的子网掩码给下图所示的小型互联网中的各设备分配IPv4地址。</span></p><p><img src="./库/image-20230518150908502.png" alt="image-20230518150908502" style="zoom:50%;" /></p><p><span>应用需求：</span></p><p><span>从地址块218.75.230.0/24中取出5个地址块：/30，/28，/28，/28，/.27，按需分配给图中的5个网络。</span></p><p><strong><span>在地址块中选取子块的原则</span></strong></p><ul><li><p><span>每个子块的起点位置不能随便选取，只能选取主机号部分是块大小整数倍的地址作为起点。</span></p></li><li><p><span>建议先为大的子块选取。</span></p></li></ul><p>&nbsp;</p><h3 id='ipv4地址和mac地址'><span>IPv4地址和MAC地址</span></h3><p><span>数据报传送过程中IPv4地址与MAC地址的变化情况：</span></p><ul><li><p><span>在数据包的传送过程中，数据包的源IP地址和目的IP地址保持不变；</span></p></li><li><p><span>在数据包的传送过程中，数据包的源MAC地址和目的MAC地址逐链路（或逐网络）改变。</span></p></li></ul><p>&nbsp;</p><p><span>如何通过IP地址找出其相应的MAC地址？地址解析协议ARP</span></p><p>&nbsp;</p><p><span>如果仅使用MAC地址进行通信，则会出现以下主要问题：</span></p><ul><li><p><span>因特网中的每台路由器的路由表中就必须记录因特网上所有主机和路由器各接口的MAC地址。</span></p></li><li><p><span>手工给各路由器配置路由表几乎是不可能完成的任务，即使使用路由协议让路由器通过相互交换路由信息来自动构建路由表，也会因为路由信息需要包含海量的MAC地址信息而严重占用通信资源。</span></p></li><li><p><span>包含海量MAC地址的路由信息需要路由器具备极大的存储空间，并且会给分组的查表转发带来非常大的时延。</span></p></li></ul><p>&nbsp;</p><p><span>因特网为什么要使用IP地址和MAC地址这两种类型的地址来共同完成寻址工作，仅使用MAC地址进行通信不可以吗？</span></p><p><span>因特网的网际层使用IP地址进行寻址，就可使因特网中各路由器的路由表中的路由记录的数量大大减少，因为只需记录部分网络的网络地址，而不是记录每个网络中各通信设备的各接口的MAC地址。</span></p><p>&nbsp;</p><p><span>路由器收到IP数据报后，根据其首部中的目的IP地址的网络号部分，基于自己的路由表进行查表转发。</span></p><p><span>查表转发的结果可以指明IP数据报的下一跳路由器的IP地址，但无法指明该IP地址所对应的MAC地址。因此，在数据链路层封装该IP数据报成为帧时，帧首部中的目的MAC地址字段就无法填写，该问题需要使用网际层中的地址解析协议ARP来解决。</span></p><p>&nbsp;</p><h3 id='地址解析协议arp'><span>地址解析协议ARP</span></h3><p><span>ARP（Address Resolution Protocol）是计算机网络中的一种协议，用于将IP地址映射到MAC地址，以便在局域网（LAN）中进行通信。ARP协议解决了在以太网等共享媒介网络中，根据目标IP地址发送数据包时需要知道目标主机的MAC地址的问题。</span></p><p><span>以下是对ARP协议的详细介绍：</span></p><ol start='' ><li><p><span>目的：</span></p><ul><li><p><span>ARP协议的主要目的是解决IP地址和MAC地址之间的映射问题。当主机在局域网上发送数据包时，需要将目标IP地址转换为对应的MAC地址，以便在链路层发送数据帧。</span></p></li></ul></li><li><p><span>工作原理：</span></p><ul><li><p><span>当主机A需要向主机B发送数据包时，如果主机A知道主机B的IP地址，但不知道主机B的MAC地址，它会在本地网络（局域网）上广播一个ARP请求报文。</span></p></li><li><p><span>ARP请求报文包含主机A的MAC地址、IP地址和目标IP地址。其他主机收到ARP请求后，会检查请求中的目标IP地址是否与自己的IP地址相匹配。</span></p></li><li><p><span>如果有主机发现自己的IP地址与ARP请求中的目标IP地址匹配，则它会发送一个ARP响应报文，包含自己的MAC地址和IP地址。</span></p></li><li><p><span>主机A接收到ARP响应后，将会在本地缓存中保存目标IP地址和对应的MAC地址映射，以便以后的通信使用。</span></p></li><li><p><span>当主机A获得了主机B的MAC地址后，就可以构建以太网帧并将数据包发送到目标主机B。</span></p></li></ul></li><li><p><span>ARP缓存表：</span></p><ul><li><p><span>在ARP协议的实现中，每个主机都会维护一个ARP缓存表（也称为ARP缓存或ARP表），用于存储IP地址和对应的MAC地址映射。</span></p></li><li><p><span>当主机发送数据包时，它会首先检查本地的ARP缓存表，以确定目标IP地址对应的MAC地址是否已知。如果存在对应的MAC地址，就可以直接发送数据包。</span></p></li><li><p><span>如果ARP缓存表中没有目标IP地址的映射，主机将发送ARP请求来获取目标主机的MAC地址，并将响应中的映射信息添加到ARP缓存表中。</span></p></li></ul></li><li><p><span>ARP欺骗（ARP Spoofing）：</span></p><ul><li><p><span>ARP协议的设计本身没有提供身份验证或安全机制，这导致了一种攻击方式，称为ARP欺骗。</span></p></li><li><p><span>在ARP欺骗攻击中，攻击者发送伪造的ARP响应报文，将自己的MAC地址欺骗为目标主机的MAC地址。</span></p></li><li><p><span>这使得攻击者可以截获目标主机的网络流量或修改通信内容，从而进行各种恶意行为。</span></p><ul><li><p><span>防止ARP欺骗的常见方法之一是使用静态ARP条目或ARP防火墙等安全机制。</span></p></li></ul></li></ul></li></ol><p><span>总结：ARP协议在计算机网络中起着重要的作用，它通过将IP地址映射到MAC地址，解决了在局域网中进行通信时需要知道目标主机MAC地址的问题。了解ARP协议有助于理解网络通信的基本原理和安全问题。</span></p><p>&nbsp;</p><p><span>ARP缓存表中的信息有两种类型：</span></p><ul><li><p><span>动态类型：通过ARP自动获取，生命周期默认为两分钟。</span></p></li><li><p><span>静态类型：手工配置，不同操作系统下的生命周期不同，例如系统重启后不存在或系统重启后依然有效。</span></p></li></ul><p>&nbsp;</p><p><span>ARP仅仅工作在同一段链路中。</span></p><blockquote><p><span>ARP（Address Resolution Protocol）的工作范围是局域网（LAN）内部。具体来说，它适用于在同一个物理网络或广播域内解决IP地址和MAC地址之间的映射问题。</span></p><p><span>当主机需要与同一局域网内的其他主机进行通信时，它使用ARP协议来获取目标主机的MAC地址。ARP请求和响应报文在局域网上进行广播，以确保所有主机都能收到并参与地址解析过程。</span></p><p><span>然而，ARP协议的范围是有限的，它仅在局域网范围内起作用。当主机需要与不在同一局域网内的目标通信时，将涉及到路由器和跨网络的通信。在这种情况下，ARP协议无法直接解析目标主机的MAC地址。相反，主机将使用默认网关（路由器）的MAC地址作为下一跳的目标，并通过路由器将数据包转发到目标网络。</span></p><p><span>因此，ARP协议的范围局限于局域网，用于解决同一物理网络内的IP地址和MAC地址映射问题。在更大规模的网络中，涉及不同的子网和广域网通信时，会使用其他协议和技术来实现地址解析和路由。</span></p></blockquote><p>&nbsp;</p><p><span>ARP协议的相关注意事项：</span></p><ul><li><p><span>由于ARP协议的主要用途是从网际层使用的IP地址解析出在数据链路层使用的MAC地址。因此，有的教材将ARP协议划归在网际层，而有的教材将ARP协议划归在数据链路层。这两种做法都是可以的。</span></p></li><li><p><span>除了本节课介绍的ARP请求报文和响应报文，ARP协议还有其他类型的报文，例如用于检查IP地址冲突的“无故ARP”（Gratuitous ARP）。</span></p></li><li><p><span>由于ARP协议很早就制定出来了（1982年11月），当时并没有考虑网络安全问题。因此，ARP协议没有安全验证机制，存在ARP欺骗和攻击等问题。</span></p></li></ul><p>&nbsp;</p><h3 id='ip数据报的发送和转发过程'><span>IP数据报的发送和转发过程</span></h3><p><span>IP数据报的发送和转发是计算机网络中的重要过程，涉及源主机、目标主机以及中间路由器之间的交互。下面是IP数据报的发送和转发过程的详细介绍：</span></p><ol start='' ><li><p><span>IP数据报发送过程：</span>
<span>a. 应用层数据生成：源主机上的应用程序生成数据，并通过传输层（如TCP或UDP）将数据封装为传输层报文段。</span>
<span>b. IP地址分配：源主机为数据报选择源IP地址和目标IP地址。源IP地址是源主机的唯一标识，目标IP地址是数据报要传输到的目标主机的地址。</span>
<span>c. 封装为IP数据报：源主机将传输层报文段封装为IP数据报。数据报的头部包含源IP地址、目标IP地址和其他相关字段。</span>
<span>d. 查找目标主机的MAC地址：源主机根据目标IP地址和本地的ARP缓存表或发送ARP请求来获取目标主机的MAC地址。</span>
<span>e. 封装为链路层帧：源主机使用目标主机的MAC地址和源主机的MAC地址构建链路层帧，将IP数据报封装在帧中，并将帧发送到物理网络。</span></p></li><li><p><span>IP数据报转发过程：</span>
<span>a. 接收和解析帧：中间路由器接收到物理网络上的帧，解析链路层帧头部，获取目标MAC地址和源MAC地址。</span>
<span>b. 解封装IP数据报：路由器根据帧中的目标MAC地址和自己的MAC地址判断是否需要处理该帧。如果需要处理，则解封装帧，提取IP数据报。</span>
<span>c. 路由选择：路由器根据目标IP地址和本地路由表选择最佳的下一跳路由器。路由表包含与不同目标网络相关联的下一跳路由器和出接口。</span>
<span>d. 转发决策：根据路由选择的结果，路由器确定应该将IP数据报发送到哪个接口和下一跳路由器。</span>
<span>e. 更新MAC地址：路由器更新链路层帧的目标MAC地址和源MAC地址，以便正确转发到下一跳路由器。</span>
<span>f. 发送到下一跳：路由器将更新后的帧发送到下一跳路由器，继续进行下一跳的转发过程。</span>
<span>g. 重复转发过程：重复上述过程，直到数据报到达目标主机。</span></p></li></ol><p><span>总结：IP数据报的发送和转发过程涉及源主机、目标主机以及中间路由器之间的交互。源主机将数据封装为IP数据报，并通过链路层帧发送到物理网络。中间路由器接收和解析帧，根据路由表进行路由选择和转发决策，更新帧的MAC地址，并将数据报转发到下一跳路由器，直到数据报到达目标主机。这样实现了数据在网络中的传输和转发。</span></p><p>&nbsp;</p><p><span>路由器收到IP数据报后如何转发？</span></p><ul><li><p><span>检查收到的IP数据报是否正确</span></p><ul><li><p><span>生存时间是否结束</span></p></li><li><p><span>首部是否误码</span></p></li><li><p><span>若不正确，则丢弃该IP数据报，并向发送该IP数据报的源主机发送差错报告。</span></p></li></ul></li><li><p><span>基于IP数据报首部中的目的IP地址在路由表中进行查找。</span></p><ul><li><p><span>若找到匹配的路由条目，则按该路由条目的指示进行转发，否则丢弃该IP数据报，并向发送该IP数据报的源主机发送差错报告。</span></p></li></ul></li></ul><p>&nbsp;</p><p><strong><span>路由器不转发广播IP数据报，即路由器隔离广播域。如果因特网中数量巨大的路由器收到广播IP数据报后都进行转发，则会造成巨大的广播风暴，严重浪费因特网资源。</span></strong></p><p>&nbsp;</p><h3 id='ipv4数据报的首部格式'><span>IPv4数据报的首部格式</span></h3><p><span>IPv4数据报的首部格式及其内容是实现IPv4协议各种功能的基础。</span></p><p><span>在TCP/IP标准中，各种数据格式常常以32比特（即4字节）为单位来描述。</span></p><p><img src="./库/image-20230518181714581.png" alt="image-20230518181714581" style="zoom: 33%;" /></p><p>&nbsp;</p><p><span>固定部分是指每个IPv4数据报都必须要包含的部分。</span></p><p><span>某些IPv4数据报的首部，除了包含20字节的固定部分，还包含一些可选的字段来增加IPv4数据报的功能。</span></p><p><span>IPv4数据报首部中的各字段或某些字段的组合，用来表达IPv4协议的相关功能。</span></p><ul><li><p><span>版本：长度为4个比特，用来表示IP协议的版本。通信双方使用的IP协议的版本必须一致。目前广泛使用的IP协议的版本号为4（即IPv4）。</span></p></li><li><p><span>首部长度：长度为4个比特，该字段的</span><strong><span>取值以4字节为单位</span></strong><span>，用来表示IPv4数据报的首部长度。最小取值为二进制的0101，即十进制的5，再乘以4字节单位，表示IPv4数据报首部只有20字节固定部分。最大取值为二进制的1111，即十进制的15，再乘以4字节单位，表示IPv4数据报首部包含20字节固定部分和最大40字节可变部分。</span></p></li><li><p><span>可选字段：长度从1字节到40字节不等，用来支持排错、测量以及安全措施等功能。虽然可选字段增加了IPv4数据报的功能，但这同时也使得IPv4数据报的首部长度成为可变的，这就增加了因特网中每一个路由器处理IPv4数据报的开销。实际上，可选字段很少被使用。</span></p></li><li><p><span>填充：用来确保IPv4数据报的首部长度是4字节的整数倍，使用全0进行填充。</span></p></li><li><p><span>区分服务：长度为8个比特，用来获得更好的服务。该字段在旧标准中叫作服务类型，但实际上一直没有被使用过。1998年，因特网工程任务组IETF把这个字段改名为区分服务。利用该字段的不同取值可提供不同等级的服务质量。只有在使用区分服务时该字段才起作用，一般情况下都不使用该字段。</span></p></li><li><p><span>总长度：长度为16个比特，该字段的</span><strong><span>取值以字节为单位</span></strong><span>，用来表示IPv4数据报的长度（首部长度+数据载荷长度）。最大取值为二进制的16个比特1，即十进制的65535（很少传输这么长的IPv4数据报）。</span></p></li></ul><p>&nbsp;</p><p>&nbsp;</p><p><span>【举例】IPv4数据报首部中的首部长度字段和总长度字段。</span></p><p><span>首部长度字段的取值=(𝟎𝟏𝟎𝟏)</span><sub><span>𝟐</span></sub><span>，以𝟒字节为单位</span></p><p><span>总长度字段的取值=(𝟎𝟎𝟎𝟎 𝟎𝟎𝟏𝟏 𝟏𝟏𝟏𝟏 𝟏𝟏𝟎𝟎)</span><sub><span>𝟐</span></sub><span>，以字节为单位</span></p><p><span>首部长度=(𝟎𝟏𝟎𝟏)</span><sub><span>𝟐</span></sub><span>×𝟒=𝟓×𝟒=𝟐𝟎（字节）</span></p><p><span>总长度=(𝟎𝟎𝟎𝟎 𝟎𝟎𝟏𝟏 𝟏𝟏𝟏𝟏 𝟏𝟏𝟎𝟎)</span><sub><span>𝟐</span></sub><span>=𝟏𝟎𝟐𝟎（字节）</span></p><p><span>数据载荷长度 = 总长度 − 首部长度 = 𝟏𝟎𝟐𝟎−𝟐𝟎=𝟏𝟎𝟎𝟎（字节）</span></p><p>&nbsp;</p><h4 id='ipv4数据报分片的概念'><span>IPv4数据报分片的概念</span></h4><p><span>标识、标志、片偏移共同用于IPv4数据报的分片。</span></p><p><span>帧的数据载荷长度受限于最大传送单元MTU，例如，以太网规定MTU的取值为1500字节。</span></p><p><span>当IPv4数据报长度超过MTU时，无法封装成帧，需要将原IPv4数据报分片为若干个更小的IPv4数据报。</span></p><p>&nbsp;</p><ul><li><p><span>标识：长度为16个比特，属于同一个IPv4数据报的各分片数据报应该具有相同的标识。IP软件会维持一个计数器，每产生一个IPv4数据报，计数器值就加1，并将此值赋给标识字段。</span></p></li><li><p><span>标志：</span></p><ul><li><p><span>最低位（More Fragment，MF）</span></p><ul><li><p><span>MF=1表示本分片后面还有分片</span></p></li><li><p><span>MF=0表示本分片后面没有分片</span></p></li></ul></li><li><p><span>中间位（Don’t Fragment，DF）</span></p><ul><li><p><span>DF=1表示不允许分片</span></p></li><li><p><span>DF=0表示允许分片</span></p></li></ul></li><li><p><span>最高位为保留位，必须设置为0</span></p></li></ul></li><li><p><span>片偏移：长度为13个比特，该字段的取值以8字节为单位，用来指出分片IPv4数据报的数据载荷偏移其在原IPv4数据报的位置有多远。</span><strong><span>片偏移必须为整数</span></strong><span>。片偏移从0开始。</span></p></li></ul><p>&nbsp;</p><p><span>【举例】某个IPv4数据报总长度为3820字节，采用20字节固定首部，根据数据链路层要求，需要将该IPv4数据报分片为长度不超过1420字节的数据报片。</span></p><p><img src="./库/image-20230518182917476.png" referrerpolicy="no-referrer" alt="image-20230518182917476"></p><p>&nbsp;</p><p><span>生存时间（Time To Live，TTL）：长度为8个比特，最大取值为二进制的11111111，即十进制的255。该字段的取值最初以秒为单位。因此，IPv4数据报的最大生存时间最初为255秒。路由器转发IPv4数据报时，将其首部中该字段的值减去该数据报在路由器上所耗费的时间，若结果不为0就转发，否则就丢弃。</span></p><p><span>生存时间字段后来改为以“跳数”为单位，路由器收到待转发的IPv4数据报时，将其首部中的该字段的值减1，若结果不为0就转发，否则就丢弃。</span></p><p><span>【举例】生存时间TTL字段的作用 —— 防止被错误路由的IPv4数据报无限制地在因特网中兜圈</span></p><p>&nbsp;</p><p><span>协议：长度为8个比特，用来指明IPv4数据报的数据载荷是何种协议数据单元PDU。</span></p><p><img src="./库/image-20230518191724273.png" referrerpolicy="no-referrer" alt="image-20230518191724273"></p><p>&nbsp;</p><p><span>首部检验和：长度为16个比特，用于检测IPv4数据报在传输过程中其首部是否出现了差错。</span></p><p><span>IPv4数据报每经过一个路由器，其首部中的某些字段的值（例如生存时间TTL、标志以及片偏移等）都可能发生变化，因此路由器都要重新计算一下首部检验和。</span></p><p><span>由于网际层并不向其高层提供可靠传输的服务，并且计算首部检验和是一项耗时的操作，因此在IPv6中，路由器不再计算首部检验和，从而更快转发IP数据报。</span></p><p><span>上述检验和的计算方法不仅用于IP协议，还用于运输层的用户数据报协议UDP和传输控制协议TCP，常被称为因特网检验和（Internet Checksum）。这种检验和的检错性能虽然不如CRC，但更易用软件实现。</span></p><p>&nbsp;</p><blockquote><p><span>在计算机网络中，IPv4数据报首部的首部校验和（Header Checksum）用于检测IP数据报首部在传输过程中是否发生了错误或损坏。</span></p><p><span>IPv4数据报首部校验和是通过对首部中的各个字段进行校验计算得到的。在发送端，计算校验和时，IPv4数据报首部的所有字段（除了校验和字段本身）被看作16位的字（每个字段占两个字节），并进行二进制求和运算。求和时采用的算法是按位求和，并将进位（若有）加到低位上。最终，将结果取反得到校验和值，然后将校验和值填充到首部的校验和字段中。</span></p><p><span>在接收端，接收主机会重新计算校验和，并将计算得到的校验和与接收到的校验和进行比较。如果两者相等，则说明首部没有在传输过程中发生错误或损坏；如果两者不相等，则说明首部在传输过程中发生了错误或损坏。</span></p><p><span>通过校验和机制，可以有效地检测传输过程中的数据错误或损坏。当数据报首部发生错误时，接收主机会丢弃该数据报，避免了对错误数据的进一步处理和传递。</span></p><p><span>需要注意的是，IPv4数据报首部校验和只校验首部部分，不包括数据部分。对于数据的完整性校验，需要使用更高层的协议，如TCP或UDP中的校验和机制。</span></p></blockquote><p>&nbsp;</p><p><span>源IP地址：长度为32个比特，用来填写发送IPv4数据报的源主机的IPv4地址。</span></p><p><span>目的IP地址：长度为32个比特，用来填写接收IPv4数据报的目的主机的IPv4地址。</span></p><p>&nbsp;</p><h2 id='静态路由配置及其可能产生的路由环路问题'><span>静态路由配置及其可能产生的路由环路问题</span></h2><p><span>静态路由配置是指用户或者网络管理员使用路由器相关命令给路由器人工配置路由表，</span><strong><span>这种方法不能及时适应网络状态（流量、拓扑）的变化。</span></strong></p><p>&nbsp;</p><p><span>使用静态路由配置可能会出现以下</span><strong><span>导致路由环路</span></strong><span>的问题：</span></p><ul><li><p><span>路由条目配置错误</span></p></li><li><p><span>聚合路由条目时可能引入了不存在的网络（黑洞路由利用最长前缀匹配可以解决这个问题）</span></p></li><li><p><span>网络故障（当一个网络出现故障的时候，不仅要删除相应的路由条目，还要配置一个相同地址的黑洞路由）</span></p></li></ul><p>&nbsp;</p><p><span>路由条目的类型：</span></p><ul><li><p><span>直连网络：也就是路由的端口</span></p></li><li><p><span>动态路由（路由选择协议）</span></p></li><li><p><span>静态路由（人工配置）</span></p></li></ul><p>&nbsp;</p><p><span>特殊的静态路由条目：</span></p><ul><li><p><span>默认路由：目的网络</span><code>0.0.0.0</code><span>，地址掩码</span><code>0.0.0.0</code></p></li><li><p><span>特定主机路由：目的网络为特定主机的IP，地址掩码：</span><code>255.255.255.255</code></p></li><li><p><span>黑洞路由：下一跳为</span><code>null0</code></p></li></ul><p>&nbsp;</p><p><span>路由器在查找转发表转发IP数据报时，遵循“</span><strong><span>最长前缀匹配</span></strong><span>”的原则，因此特定主机路由条目的匹配优先级最高。</span></p><p>&nbsp;</p><h2 id='路由选择协议'><span>路由选择协议</span></h2><h3 id='路由选择协议概述'><span>路由选择协议概述</span></h3><ul><li><p><span>静态路由选择</span></p><ul><li><p><span>由人工配置的网络路由、默认路由、特定主机路由、黑洞路由</span></p></li><li><p><span>不能及时使用网络状态（流量、拓扑）的变化</span></p></li><li><p><span>一般只在小规模网络中使用</span></p></li></ul></li><li><p><span>动态路由选择</span></p><ul><li><p><span>路由器结果路由选择协议自动获得路由信息</span></p></li><li><p><span>能较好地适应网络状态的变化</span></p></li><li><p><span>适用于大规模网络</span></p></li></ul></li></ul><p>&nbsp;</p><p><span>因特网是全球最大的互联网，它所采取的路由选择协议具有以下三个主要特点：</span></p><ul><li><p><span>自适应：因特网采用动态路由选择，能较好地适应网络状态的变化。</span></p></li><li><p><span>分布式：因特网中的各路由器通过相互间的信息交互，共同完成路由信息的获取和更新。</span></p></li><li><p><span>分层次：将整个因特网划分为许多较小的自治系统（Autonomous System，AS）。在自治系统内部和外部采用不同类别的路由选择协议，分别进行路由选择。</span></p></li></ul><p>&nbsp;</p><p><span>因特网采用分层次的路由选择协议：将网络分为多个自治系统，每个自治系统之间使用</span><strong><span>外部网关协议EGP</span></strong><span>，自治系统内部使用</span><strong><span>内部网关协议IGP</span></strong><span>。</span></p><p><span>注意：</span></p><ul><li><p><span>外部网关协议EGP和内部网关协议IGP只是路由选择协议的分类名称，而不是具体的路由选择协议。</span></p></li><li><p><span>外部网关协议和内部网关协议名称中使用的是“网关”这个名词，是因为在因特网早期的RFC文档</span>
<span>中，没有使用“路由器”而使用的是“网关”这一名词。</span></p></li></ul><p>&nbsp;</p><p><span>路由器的结构：</span></p><ul><li><p><span>输入端口</span></p></li><li><p><span>输出端口</span></p></li><li><p><span>路由选择部分：路由表仅包含从目的网络到下一跳的映射</span></p></li><li><p><span>分组转发部分</span></p></li></ul><p>&nbsp;</p><p><span>常见的路由选择协议：</span></p><ol start='' ><li><p><span>内部网关协议</span></p><ol start='' ><li><p><span>路由信息协议RIP：基于距离向量，最早在因特网上使用</span></p></li><li><p><span>内部网关路由协议IGRP：基于距离向量，思科私有</span></p></li><li><p><span>增强型内部网关路由协议EIGRP：基于距离向量和链路状态，思科私有</span></p></li><li><p><span>开放式最短路径优先OSPF：基于链路状态</span></p></li><li><p><span>中间系统到中间系统IS-IS：基于链路状态</span></p></li></ol></li><li><p><span>外部网关协议</span></p><ol start='' ><li><p><span>边界网关协议BGP</span></p></li></ol></li></ol><p>&nbsp;</p><h3 id='路由信息协议rip'><span>路由信息协议RIP</span></h3><p><span>Routing Information Protocol RFC 1058</span></p><p>&nbsp;</p><p><span>RIP要求自治系统AS内的每一个路由器都要维护一个从它自己到AS内其他每一个网络距离的记录，这是一组距离记录，称为</span><strong><span>距离向量</span></strong><span>。</span></p><p>&nbsp;</p><p><span>RIP使用</span><strong><span>跳数</span></strong><span>作为度量来衡量到达目的网络的距离：</span></p><ul><li><p><span>路由器到达直连网络的距离为1</span></p></li><li><p><span>路由器到达非直连网路的距离为经过的路由器数量+1</span></p></li><li><p><span>允许一条路径最多含有15个路由器。即距离等于16的时候相当于不可达。因此RIP仅适合于小型互联网。</span></p></li></ul><p>&nbsp;</p><p><span>RIP认为好的路由就是路径最短的路由，即经过路由器数量最少的路由，而无关乎每条路由的带宽。</span></p><p><span>当有多条距离相等的路由时，RIP可以进行等价负载均衡。</span></p><p>&nbsp;</p><p><span>RIP包含以下三个要点：</span></p><ul><li><p><span>和谁交换信息：仅和相邻路由器交换（这也造成了坏消息传得慢的问题）</span></p></li><li><p><span>交换什么信息：交换自己的路由表</span></p></li><li><p><span>何时交换信息：周期性交换（比如每三十秒一次）</span></p></li></ul><p><strong><span>路由器周期性地和其他相邻路由器交换自己的路由表</span></strong></p><p>&nbsp;</p><p><span>RIP的基本工作过程：</span></p><ul><li><p><span>路由器刚刚开始工作的时候，仅知道自己和直连网络的距离为1</span></p></li><li><p><span>每个路由器仅和相邻的其他路由器周期性地交换、更新路由表</span></p></li><li><p><span>若干次交换和更新之后，每个路由器都知道到达本AS内其他网络的最短距离和下一跳地址，称为</span><strong><span>收敛</span></strong></p></li></ul><p>&nbsp;</p><p><span>RIP路由条目的更新规则：</span></p><ul><li><p><span>发现了新的网络，</span><strong><span>添加</span></strong></p></li><li><p><span>到达目的网络，相同的下一跳，最新消息，</span><strong><span>更新</span></strong></p></li><li><p><span>到达目的网络，不同的下一跳，新路由优势，</span><strong><span>更新</span></strong></p></li><li><p><span>到达目的网络，不同的下一跳，新路由劣势，</span><strong><span>不更新</span></strong></p></li><li><p><span>到达目的网络，不同的下一跳，距离相等，</span><strong><span>等价负载均衡</span></strong></p></li></ul><p>&nbsp;</p><p><span>RIP存在</span><strong><span>坏消息传得慢</span></strong><span>的问题：这</span><strong><span>是距离算法的一个固有问题</span></strong><span>，该问题也可以称作是</span><strong><span>路由环路</span></strong><span>或者</span><strong><span>距离无穷计数</span></strong><span>的问题，可以采取以下几种方式来减轻该问题的出现的频率：</span></p><ul><li><p><span>限制最大路径为15（16表示不可达）</span></p></li><li><p><span>当路由表发生变化的时候就立刻发送更新报文（即</span><strong><span>触发更新</span></strong><span>），而不仅仅是周期性地发送</span></p></li><li><p><span>让路由器记录收到某特定路由信息的接口，而不让同一路由信息再次通过该接口反方向传输（即水平分割）</span></p></li></ul><p>&nbsp;</p><p><strong><span>无法彻底避免RIP中可能会产生的路由环路问题，这是距离向量算法的本质决定的。</span></strong></p><p>&nbsp;</p><h3 id='开放最短路径优先ospf'><span>开放最短路径优先OSPF</span></h3><p><span>Open Shortest Path First，是为了克服路由信息协议RIP的缺点在1989年开发出来的。</span></p><ul><li><p><span>“开放”表明OSPF协议不是受某一厂商控制，而是公开发表的。</span></p></li><li><p><span>“最短路径优先”是因为使用了Dijkstra提出的最短路径算法（Shortest Path First，SPF）。</span></p></li></ul><p>&nbsp;</p><p><em><span>“开放最短路径优先”只是一个路由选择协议的名称，但这并不表示其他的路由选择协议不是“最短路径优先”。实际上，用于自治系统AS内部的各种路由选择协议（例如RIP），都要寻找一条“最短”的路径。</span></em></p><p>&nbsp;</p><ul><li><p><strong><span>OSPF的最短路径是基于链路状态来考虑的</span></strong><span>，而不像RIP是基于距离向量的。</span><strong><span>链路状态</span></strong><span>（Link State，LS）是指本路由器都和哪些路由器相邻，以及相应链路的“代价（cost）”。“</span><strong><span>代价</span></strong><span>”用来表示费用、距离、时延和带宽等，这些都由网络管理人员来决定。</span>
<em><span>思科路由器中OSPF协议计算代价的方法是：100Mb/s除以链路带宽计算结果小于1的值仍记为1，大于1且有小数的，舍去小数。</span></em></p></li><li><p><span>OSPF基于链路状态并采用最短路径算法计算路由，从算法上保证了不会产生路由环路。</span></p></li><li><p><span>OSPF不限制网络规模，更新效率高，收敛速度快。</span></p></li></ul><p>&nbsp;</p><p><span>OSPF路由器邻居关系的建立和维护：</span></p><ul><li><p><span>OSPF相邻路由器之间通过交互</span><strong><span>问候</span></strong><span>（Hello）分组来建立和维护邻居关系。</span></p></li><li><p><strong><span>问候</span></strong><span>（Hello）</span><strong><span>分组封装在IP数据报</span></strong><span>中，发往</span><strong><span>组播地址224.0.0.5</span></strong><span>。IP数据报首部中的</span><strong><span>协议号字段的取值为89</span></strong><span>，表明IP数据报的数据载荷为OSPF分组。</span></p></li><li><p><strong><span>OSPF分组直接使用网际层的IP数据报进行封装，而不像RIP报文需要使用运输层用户数据报协议UDP封装</span></strong><span>。</span><u><span>从数据包按网络体系结构逐层封装的角度看</span></u><span>，</span><strong><span>OSPF属于网际层协议，而RIP属于应用层协议</span></strong><span>（但其核心功能是路由选择，属于网际层）。</span></p></li><li><p><span>问候（Hello）分组的发送周期为10秒。</span></p></li><li><p><span>若40秒未收到来自邻居路由器的问候（Hello）分组，则认为邻居路由器不可达。</span></p></li><li><p><span>每个路由器都会建立一张邻居表。</span></p></li><li><p><span>使用OSPF的每个路由器都会产生</span><strong><span>链路状态通告LSA</span></strong><span>（Link State Advertisement）。</span></p><ul><li><p><span>LSA中包含以下两类链路状态信息：</span></p><ul><li><p><span>直连网络的链路状态信息</span></p></li><li><p><span>邻居路由器的链路状态信息</span></p></li></ul></li></ul></li><li><p><strong><span>链路状态通告LSA被封装在链路状态更新LSU（Link State Update）分组中，采用可靠的洪泛法（Flooding）进行发送。</span></strong>
<img src="./库/image-20230421143617171.png" alt="image-20230421143617171" style="zoom:33%;" /></p><ul><li><p><span>洪泛法的要点是路由器向自己所有的邻居路由器发送链路状态更新分组，收到该分组的各路由器又将该分组转发给自己所有的邻居路由器（但其上游路由器除外），以此类推。</span></p></li><li><p><span>可靠是指收到链路状态更新分组后要发送确认，收到重复的更新分组无需再次转发，但要发送一次确认。</span></p></li></ul></li><li><p><span>使用OSPF的每一个路由器都有一个链路状态数据库（Link State Database，LSDB），用于存储链路状态通告LSA。</span>
<img src="./库/image-20230421143645888.png" alt="image-20230421143645888" style="zoom:25%;" /></p><ul><li><p><strong><span>通过各路由器洪泛发送封装有各自链路状态通告LSA的链路状态更新分组LSU</span></strong><span>，各路由器的链路状态数据库LSDB最终将达到一致。</span></p></li></ul></li></ul><p>&nbsp;</p><p><span>基于链路状态数据库进行最短路径优先计算：</span></p><ul><li><p><span>使用OSPF的各路由器，基于链路状态数据库LSDB进行最短路径优先计算，构建出各自到达其他各路由器的最短路径，即构建各自的路由表。</span></p></li></ul><p>&nbsp;</p><p><span>OSPF的五种分组类型：</span></p><ul><li><p><span>问候（Hello）：用来发现和维护邻居路由器的可达性。</span></p></li><li><p><span>数据库描述（Database Description）：用来向邻居路由器给出自己的链路状态数据库中的所有链路状态项目的摘要信息。</span></p></li><li><p><span>链路状态请求（Link State Request）：用来向邻居路由器请求发送某些链路状态项目的详细信息。</span></p></li><li><p><strong><span>链路状态更新LSU</span></strong><span>（Link State Update）：路由器使用链路状态更新分组将其链路状态信息进行洪泛发送，即用洪泛法对整个系统更新链路状态。其内部包含</span><strong><span>链路状态通告LSA</span></strong><span>。</span></p></li><li><p><span>链路状态确认（Link State Acknowledgement）：对链路状态更新分组的确认分组。</span></p></li></ul><p>&nbsp;</p><p><span>为了减少洪泛发送问候分组和链路状态更新分组的数量，OSPF采用以下措施：</span></p><ol start='' ><li><p><span>选举指定路由器（Designated Router，DR）和备用的指定路由器（Backup Designated Router，BDR）</span></p></li><li><p><span>所有的非DR/BDR只与DR/BDR建立邻居关系</span></p></li><li><p><span>非DR/BDR之间通过DR/BDR交换信息</span></p></li></ol><p>&nbsp;</p><p><span>OSPF划分区域</span></p><ul><li><p><span>为了使OSPF协议能够用于规模很大的网络，OSPF把一个自治系统AS再划分为若干个更小的范围，称为区域（area）。</span></p></li><li><p><span>划分区域的好处就是把利用洪泛法交换链路状态信息的范围局限于每一个区域，而不是整个自治系统AS，这样就减少了整个网络上的通信量。</span></p></li><li><p><span>采用划分区域的方法，虽然使交换信息的种类增多了，同时也使OSPF协议更加复杂了，但这样做能使每一个区域内部交换路由信息的通信量大大减小，因而使OSPF协议能够用于规模更大的自治系统AS。</span></p></li></ul><p>&nbsp;</p><ol start='' ><li><p><span>自治系统边界路由器（AS Border Router，ASBR）</span></p></li><li><p><span>主干路由器（Backbone Router，BBR）</span></p></li><li><p><span>区域内路由器（Internal Router，IR）</span></p></li><li><p><span>区域边界路由器（Area Border Router，ABR）</span></p></li></ol><p><img src="./库/image-20230422232955781.png" referrerpolicy="no-referrer" alt="image-20230422232955781"></p><p>&nbsp;</p><blockquote><p><span>OSPF（Open Shortest Path First）是一种内部网关协议（Interior Gateway Protocol，IGP），被广泛应用于计算机网络中的路由器之间的通信和路由选择。</span></p><p><span>OSPF被称为分布式的链路状态协议，这是因为它采用了一种分布式的路由算法来计算网络中的最短路径。在OSPF中，每个路由器都负责维护自己直接连接的链路状态信息，并通过与其他邻居路由器交换链路状态更新来了解整个网络的拓扑结构。</span></p><p><span>具体而言，分布式的意思是指OSPF中的路由计算过程是由每个参与网络的路由器独立完成的，而不需要一个中心化的控制节点来进行路由计算和决策。每个路由器根据收集到的链路状态信息，使用SPF（Shortest Path First）算法计算出到达网络中其他路由器的最短路径，并将这些信息存储在自己的路由表中。</span></p><p><span>分布式的特点使得OSPF具有以下优点：</span></p><ol start='' ><li><p><span>灵活性：由于每个路由器独立计算路由，可以更好地适应网络的动态变化和故障恢复。</span></p></li><li><p><span>可扩展性：分布式的设计使得OSPF能够应对大规模的网络环境，并能够在网络规模扩大时有效地进行路由计算。</span></p></li><li><p><span>冗余和容错：分布式的链路状态信息存储在多个路由器中，如果某个路由器发生故障，其他路由器仍然可以通过交换链路状态信息来计算新的最短路径。</span></p></li></ol><p><span>需要注意的是，虽然OSPF是一种分布式的协议，但路由器之间仍然需要进行链路状态信息的交换，以保持网络的一致性。这种交换通常是通过OSPF协议的Hello消息和链路状态更新消息来实现的。通过分布式的链路状态协议，OSPF能够提供高效和可靠的路由选择功能，适用于复杂的企业网络和互联网环境。</span></p></blockquote><p>&nbsp;</p><h3 id='边界网关协议bgp'><span>边界网关协议BGP</span></h3><h4 id='bgp的相关基本概念'><span>BGP的相关基本概念</span></h4><p><span>边界网关协议（Border Gateway Protocol，BGP）属于外部网关协议EGP这个类别，用于自治系统AS之间的路由选择协议。由于在不同AS内度量路由的“代价”（距离、带宽、费用等）可能不同，因此对于AS之间的路由选择，使用统一的“代价”作为度量来寻找最佳路由是不行的。</span></p><p><strong><span>没有统一的路由度量，寻找最佳路由是无意义的。</span></strong></p><p><span>BGP只能是力求寻找一条能够到达目的网络且比较好的路由（即不能兜圈子），而并非要寻找一条最佳路由。</span></p><p><span>自治系统之间的路由选择协议应当允许使用多种路由选择策略。这些策略包括政治、经济、安全等，它们都是由网络管理人员对每一个路由器进行设置的。但这些策略并不是自治系统之间的路由选择协议本身。</span></p><p>&nbsp;</p><ul><li><p><span>在配置BGP时，每个AS的管理员要选择至少一个路由器作为该AS的“BGP发言人”。</span></p></li><li><p><span>一般来说，两个BGP发言人都是通过一个共享网络连接在一起的，而BGP发言人往往就是BGP边界路由器。</span></p></li><li><p><span>BGP发言人除了运行BGP协议外，还必须运行自己所在AS所使用的内部网关协议IGP，例如RIP或OSPF。</span></p></li><li><p><span>BGP发言人交换网络可达性的信息，也就是要到达某个网络所要经过的一系列自治系统。</span></p></li><li><p><span>当BGP发言人相互交换了网络可达性的信息后，各BGP发言人就根据所采用的策略，从收到的路由信息中找出到达各自治系统的较好的路由，也就是构造出树形结构且不存在环路的自治系统连通图。</span></p></li></ul><p>&nbsp;</p><p><img src="./库/image-20230422234246182.png" alt="image-20230422234246182" style="zoom:80%;" /></p><p>&nbsp;</p><p><strong><span>BGP适用于多级结构的因特网</span></strong></p><p><img src="./库/image-20230422234327816.png" alt="image-20230422234327816" style="zoom:80%;" /></p><p>&nbsp;</p><h4 id='bgp-4的四种报文'><span>BGP-4的四种报文</span></h4><p><span>BGP-4是目前使用得最多的版本，在[RFC 4271]中规定了BGP-4的四种报文</span></p><ul><li><p><span>打开OPEN：用来与相邻的另一个BGP发言人建立关系，使通信初始化。</span></p></li><li><p><span>保活KEEPALIVE：用来周期性地证实邻站的连通性。</span></p></li><li><p><span>更新UPDATE：用来通告某一条路由的信息，以及列出要撤销的多条路由。</span></p></li><li><p><span>通知NOTIFICATION：用来发送检测到的差错。</span></p></li></ul><p>&nbsp;</p><ol start='' ><li><p><span>从实现功能（路由选择）的角度看，这三个路由选择协议都属于网络层。</span></p></li><li><p><span>从数据包按网络体系结构逐层封装的角度看，RIP和BGP属于应用层，OSPF属于网络层。</span></p></li></ol><p><img src="./库/image-20230422234628431.png" alt="image-20230422234628431" style="zoom:33%;" /></p><p>&nbsp;</p><blockquote><p><span>RIP用UDP，所以RIP是应用层协议</span></p><p><span>BGP用TCP，所以BGP是应用层协议</span></p><p><span>OSPF用IP（RIP用到网络层），所以OSPF是传输层协议；（有不同的说法）</span></p><p><span>比如在考研的考纲中：OSPF协议是不使用UDP数据报传送，而是直接使用IP数据报传送，因此OSPF是被划分到属于网络层协议-这一点考研党要以考纲为标准</span></p></blockquote><p>&nbsp;</p><h3 id='路由器的基本工作原理'><span>路由器的基本工作原理</span></h3><p><strong><span>路由器</span></strong><span>是一种具有多个输入端口和输出端口的</span><strong><span>专用计算机</span></strong><span>，其任务是</span><strong><span>转发分组</span></strong><span>。</span></p><p>&nbsp;</p><p><span>路由器由两部分构成：</span></p><ul><li><p><span>路由选择：其核心是路由选择处理机，其根据路由选择协议周期性地和其他路由器进行路由信息的交换，以便构建和更新路由表。同时也会周期性的地发送路由信息给其他路由器</span></p></li><li><p><span>分组转发：输入端口、输出端口、交换结构</span></p><ul><li><p><span>物理层识别出比特流，交付上层</span></p></li><li><p><span>链路层识别出帧，去掉帧头和帧尾，交付上层</span></p></li><li><p><span>网络层</span></p><ul><li><p><span>如果是数据分组则查别转发，若找不到转发条目，则丢弃分组。</span><strong><span>网络层更新数据分组首部中某些字段的值（生存时间TTL）</span></strong><span>，然后向下交付链路层封装</span></p></li><li><p><span>如果是路由分组，则送交路由选择处理机，来更新路由表</span></p></li></ul></li><li><p><span>交换结构的三种基本实现方式：</span><strong><span>通过存储器</span></strong><span>、</span><strong><span>通过总线</span></strong><span>、</span><strong><span>通过互联网络</span></strong><span>，这三种交换结构可实现的路由器转发速率依次提高。</span></p></li></ul></li></ul><p>&nbsp;</p><blockquote><p><span>在计算机网络中，网际层和网络层并不是完全相同的概念，尽管它们之间存在一定的关联。</span></p><p><span>网络层是计算机网络体系结构中的一层，位于传输层和数据链路层之间。它负责将数据包从源主机传输到目标主机，通过选择合适的路径和转发机制来实现数据包的传输和路由。网络层的功能包括地址分配、路由选择、拥塞控制等。</span></p><p><span>而网际层是网络层的一个特定实现，它是TCP/IP协议族中的一部分。TCP/IP协议族是互联网中最常用的协议套件，它包括了多个协议，其中网际层是其中一个重要的组成部分。网际层主要负责IP（Internet Protocol）的功能，包括IP地址的分配和路由选择。</span></p><p><span>因此，可以说网际层是网络层的一个实现，它是TCP/IP协议族中负责网络层功能的部分。但是在其他网络体系结构或协议套件中，网络层的实现可能不完全相同，因此网际层和网络层并不是严格等同的概念。</span></p></blockquote><p>&nbsp;</p><h2 id='网际控制报文协议icmp'><span>网际控制报文协议ICMP</span></h2><blockquote><p><span>网际控制报文协议（Internet Control Message Protocol，ICMP）是互联网协议族中的一个协议，用于在IP网络中传递控制和错误消息。它通常与IP协议一起使用，以提供一些网络诊断和错误报告的功能。</span></p><p><span>ICMP的主要作用是在网络中传递各种类型的控制消息和错误消息，以便实现网络的可靠性和诊断。一些常见的用途包括：</span></p><ol start='' ><li><p><span>差错报告：当在网络中发生错误时，ICMP可以生成差错报告消息，例如目标不可达、超时等，以通知源主机或中间路由设备发生了问题。</span></p></li><li><p><span>路由器发现：ICMP的路由器发现功能可用于确定网络中的路由器和其能力。例如，ICMP路由器通告消息可以广播路由器的存在和网络范围等信息。</span></p></li><li><p><span>数据报重定向：当一个路由器收到的数据报应该通过不同的接口进行传输时，它可以发送ICMP重定向消息给发送方，告知发送方更好的路由选择。</span></p></li><li><p><span>Ping和跟踪路由：通过ICMP的回显请求和回显应答消息，可以进行常用的网络诊断，如检查主机的可达性和延迟，以及跟踪数据报在网络中的路径。</span></p></li></ol><p><span>总的来说，ICMP是一种在IP网络中用于传递控制和错误消息的协议，提供了一些网络诊断和错误报告的功能，以帮助维护和管理网络的正常运行。</span></p></blockquote><p>&nbsp;</p><p><span>注意：ICMP（Internet Control Message Protocol）并不是路由选择协议。它是Internet协议族中的一个子协议，主要用于在IP网络之间传递控制消息和错误信息，比如ping命令就是使用ICMP协议来检测网络连接是否正常。路由选择协议（Routing Protocol）是网络中用于交换路由信息、计算最优路由并将路由信息传递给其他路由器的协议。常见的路由选择协议有RIP、OSPF、BGP等。</span></p><p>&nbsp;</p><ul><li><p><span>为了更有效地转发IP数据报以及提高IP数据报交付成功的机会，TCP/IP体系结构的网际层使用了网际控制报文协议（Internet Control Message Protocol，ICMP）[RFC 792]。</span></p></li><li><p><span>主机或路由器使用ICMP来发送差错报告报文和询问报文。</span></p></li><li><p><span>ICMP报文被封装在IP数据报中发送。</span></p></li></ul><p>&nbsp;</p><h3 id='差错报告报文'><span>差错报告报文</span></h3><p><span>用来向主机或路由器报告差错情况。</span></p><p>&nbsp;</p><p><span>常见的ICMP差错报告报文有以下五种：</span></p><ul><li><p><span>终点不可达：当</span><u><span>路由器或主机</span></u><span>不能交付IP数据报时，就向源点发送重点不可达报文。具体可再根据ICMP的代码字段细分为目的网络不可达、目的主机不可达、目的协议不可达、目的端口不可达、目的网络未知、目的主机未知等13种。</span></p></li><li><p><span>源点抑制：当</span><u><span>路由器或主机</span></u><span>由于拥塞而丢弃IP数据报时，就向发送该IP数据报的源点发送源点抑制报文，使源点知道应当把IP数据报的发送速率放慢。</span></p></li><li><p><span>时间超过（超时）：当路由器收到一个目的IP地址不是自己的IP数据报时，会将其首部中生存时间TTL字段的值减1。若结果不为0，则路由器将该数据报转发出去；若结果为0，路由器不但要丢弃该数据报，还要向发送该IP数据报的源点发送时间超过（超时）报文。</span>
<span>另外，当终点在预先规定的时间内未能收到一个数据报的全部数据报分片时，就把已收到的数据报片都丢弃，也会向源点发送时间超过（超时）报文。</span></p></li><li><p><span>参数问题：当路由器或目的主机收到IP数据报后，根据其首部中的检验和字段的值发现首部在传送过程中出现了误码，就丢弃该数据报，并向发送该数据报的源点发送参数问题报文。</span></p></li><li><p><span>改变路由：路由器把改变路由报文发送给主机，让主机知道下次应将IP数据报发送给另外的路由器，这样可以通过更好的路由到达目的主机。</span></p></li></ul><p>&nbsp;</p><p><span>以下情况不应发送ICMP差错报告报文：</span></p><ul><li><p><span>对ICMP差错报告报文不再发送ICMP差错报告报文。</span></p></li><li><p><span>对第一个分片的IP数据报片的所有后续数据报片都不发送ICMP差错报告报文。</span></p></li><li><p><span>对具有多播地址的IP数据报都不发送ICMP差错报告报文。</span></p></li><li><p><span>对具有特殊地址（例如127.0.0.0或0.0.0.0）的IP数据报不发送ICMP差错报告报文。</span></p></li></ul><p>&nbsp;</p><h3 id='询问报文'><span>询问报文</span></h3><p><span>用来向主机或路由器询问情况。</span></p><p>&nbsp;</p><p><span>常用的ICMP询问报文有以下两种：</span></p><ul><li><p><span>回送请求和回答</span></p><ul><li><p><span>由主机或路由器向一个特定的目的主机或路由器发出。</span></p></li><li><p><span>收到此报文的主机或路由器必须给发送该报文的源主机或路由器发送ICMP回送回答报文。</span></p></li><li><p><span>这种询问报文用来测试目的站是否可达以及了解其有关状态。</span></p></li></ul></li><li><p><span>时间戳请求和回答</span></p><ul><li><p><span>用来请求某个主机或路由器回答当前的日期和时间。</span></p></li><li><p><span>在ICMP时间戳回答报文中有一个32比特的字段，其中写入的整数代表从1900年1月1日起到当前时刻一共有多少秒。</span></p></li><li><p><span>这种询问报文用来进行时钟同步和测量时间。</span></p></li></ul></li></ul><p>&nbsp;</p><h3 id='icmp的典型应用'><span>ICMP的典型应用</span></h3><ul><li><p><span>分组网间探测（Packet InterNet Groper，PING）</span></p><ul><li><p><span>分组网间探测PING用来测试主机或路由器之间的连通性。</span></p></li><li><p><span>PING是TCP/IP体系结构的应用层直接使用网际层ICMP的一个例子，它并不使用运输层的TCP或UDP。</span></p></li><li><p><span>PING应用所使用的ICMP报文类型为回送请求和回答。</span></p></li></ul></li><li><p><span>跟踪路由（traceroute）</span></p><ul><li><p><span>跟踪路由应用traceroute，用于探测IP数据报从源主机到达目的主机要经过哪些路由器。</span></p></li><li><p><span>在不同操作系统中，traceroute应用的命令和实现机制有所不同：</span></p><ul><li><p><span>在UNIX版本中，具体命令为“traceroute”，其在运输层使用UDP协议，在网络层使用ICMP报文类型只有差错报告报文。</span></p></li><li><p><span>在Windows版本中，具体命令为“tracert”，其应用层直接使用网际层的ICMP协议，所使用的ICMP报文类型有回送请求和回答报文以及差错报告报文。</span></p></li></ul></li></ul></li></ul><p>&nbsp;</p><h2 id='vpn与nat'><span>VPN与NAT</span></h2><h3 id='虚拟专用网vpn'><span>虚拟专用网VPN</span></h3><p><span>虚拟专用网（Virtual Private Network，VPN）：利用公用的因特网作为本机构各专用网之间的通信载体，这样形成的网络又称为虚拟专用网。</span></p><p>&nbsp;</p><p><span>给专用网内各主机配置的IP地址应该是该专用网所在机构可以自行分配的IP地址，这类IP地址仅在机构内部有效，称为</span><strong><span>专用地址</span></strong><span>（Private Address），不需要向因特网的管理机构申请。</span></p><p>&nbsp;</p><blockquote><p><span>[RFC 1918]规定了以下三个CIDR地址块中的地址作为专用地址：</span></p><ul><li><p><span>10.0.0.0~10.255.255.255（CIDR地址块10/8）</span></p></li><li><p><span>172.16.0.0~172.31.255.255（CIDR地址块172.16/12）</span></p></li><li><p><span>192.168.0.0~192.168.255.255（CIDR地址块192.168/16）</span></p></li></ul><p><span>很显然，全世界可能有很多不同机构的专用网具有相同的专用IP地址，但这并不会引起麻烦，因为这些专用地址仅在机构内部使用。</span></p></blockquote><p>&nbsp;</p><p><strong><span>在因特网中的所有路由器，对目的地址是专用地址的IP数据报一律不进行转发，这需要由因特网服务提供者ISP对其拥有的因特网路由器进行设置来实现。</span></strong></p><p>&nbsp;</p><p><img src="./库/image-20230423131556830.png" alt="image-20230423131556830" style="zoom:80%;" /></p><p>&nbsp;</p><ul><li><p><span>虽然两个专用网内的主机间发送的数据报是通过公用的因特网传送的，但从效果上就好像是本机构的专用网上传送一样，这也是虚拟专用网中“虚拟”的含义。</span></p></li><li><p><span>IP数据报在因特网中可能要经过多个网络和路由器，但从逻辑上看，路由器R1和R2之间好像是一条直通的点对点链路，因此也被称为IP隧道技术。</span></p></li></ul><p>&nbsp;</p><p><span>本例所示的是同一机构内不同部门的内部网络所构成的VPN，又称为内联网VPN。有时，一个机构的虚拟专用网VPN需要某些外部机构（通常是合作伙伴）参加进来，这样的VPN就称为外联网VPN。</span></p><p><span>在外地工作的员工需要访问公司内部的专用网时，只要在任何地点接入因特网，运行驻留在员工PC中的VPN软件，在员工的PC和公司的主机之间建立VPN隧道，就可以访问专用网中的资源，这种虚拟专用网又称为远程接入VPN。</span></p><p>&nbsp;</p><h3 id='网络地址转换nat'><span>网络地址转换NAT</span></h3><p><span>尽管因特网采用了无分类编址方法来减缓IPv4地址空间耗尽的速度，但由于因特网用户数量的急剧增长，特别是大量小型办公室和家庭网络接入因特网的需求不断增加，IPv4地址空间即将耗尽的危险然仍没有解除（实际上，因特网号码分配管理局IANN于2011年2月3日宣布，IPv4地址已经分配完毕）。</span></p><p><span>网络地址转换（Network Address Translation，NAT）技术于1994年被提出，用来缓解IPv4地址空间即将耗尽的问题。</span></p><p><strong><span>NAT能使大量使用内部专用地址的专用网络用户共享少量外部全球地址来访问因特网上的主机和资源。</span></strong></p><p><span>这种方法需要在专用网络连接到因特网的路由器上安装NAT软件。装有NAT软件的路由器称为NAT路由器，它至少要有一个有效的外部全球地址IPG。这样，所有使用内部专用地址的主机在和外部因特网通信时，都要在NAT路由器上将其内部专用地址转换成IPG。</span></p><p><span>上述方法有一个缺点：如果NAT路由器拥有𝒏（𝒏比较小）个全球IP地址，那么专用网内最多可以同时有𝒏台主机接入因特网。若专用网内的主机数量大于𝒏，则需要轮流使用NAT路由器中数量较少的全球IP地址。</span></p><p><img src="./库/image-20230423132816599.png" alt="image-20230423132816599" style="zoom:80%;" /></p><p>&nbsp;</p><p><span>由于目前绝大多数基于TCP/IP协议栈的网络应用，都使用运输层的传输控制协议TCP或用户数据报协议UDP，为了更加有效地利用NAT路由器中的全球IP地址，现在常将NAT转换和运输层端口号结合使用。这样就可以使内部专用网中使用专用地址的大量主机，共用NAT路由器上的1个全球IP地址，因而可以同时与因特网中的不同主机进行通信。</span></p><p><span>将NAT和运输层端口号结合使用，称为网络地址与端口号转换（Network Address and Port Translation，NAPT）。现在很多家用路由器将家中各种智能设备（手机、平板、笔记本电脑、台式电脑、物联网设备等）接入因特网，这种路由器实际上就是一个NAPT路由器，但往往并不运行路由选择协议。</span></p><p><img src="./库/image-20230519204833918.png" alt="image-20230519204833918" style="zoom:33%;" /></p><p>&nbsp;</p><blockquote><p><span>这段话提到的家用路由器一般都是NAPT（Network Address Port Translation）路由器，也被称为NAT路由器。NAPT路由器是一种将内部私有网络（如家庭局域网）的IP地址转换为公共IP地址并进行端口映射的路由器。这种路由器将家庭内的多台设备共享同一个公网IP地址，在Internet上只能看到一个公网IP地址，因此在网络层面上形成了一个单一的路由器接口。这样，即使家庭内的设备有动态变化或者增加，也不会影响到Internet中的路由信息。</span></p><p><span>然而，家用路由器通常不运行路由选择协议，因为它们并不需要与其他路由器交换路由信息来实现路由选择功能。这是因为它们只需要将从局域网内发出的数据包转发到公网上，或者将从公网发来的数据包转发到局域网内的正确设备。因此，这种路由器并不需要计算和选择路由。同时，这种路由器的路由表也是非常简单的，只需要维护一个简单的转发表即可，因此不需要运行复杂的路由选择协议。</span></p></blockquote><p>&nbsp;</p><ul><li><p><span>尽管NAT（和NAPT）的出现在很大程度上缓解了IPv4地址资源紧张的局面，但NAT（和NAPT）对网络应用并不完全透明，会对某些网络应用产生影响。</span></p></li><li><p><strong><span>NAT（和NAPT）的一个重要特点就是通信必须由专用网内部发起，外网主机不能首先发起通信</span></strong><span>，因此拥有内部专用地址的主机不能直接充当因特网中的服务器。</span></p></li><li><p><span>对于目前P2P这类需要外网主机主动与内网主机进行通信的网络应用，在通过NAT时会遇到问题，需要网络应用自身使用一些特殊的NAT穿透技术来解决。</span></p></li></ul><p>&nbsp;</p><p><span>由于NAT对外网屏蔽了内网主机的网络地址，能为内网主机提供一定的安全防护。</span></p><p>&nbsp;</p><h2 id='多播'><span>多播</span></h2><h3 id='ip多播技术的相关基本概念'><span>IP多播技术的相关基本概念</span></h3><p><span>多播（Multicast，也称为组播）是一种实现“一对多”通信的技术，与传统单播“一对一”通信相比，多播可以极大地节省网络资源。在因特网上进行的多播，称为IP多播。</span></p><p><img src="./库/image-20230424233600736.png" alt="image-20230424233600736" style="zoom: 33%;" /></p><p><span>当多播组的成员数量很大时，采用多播方式可以显著地减少网络中各种资源的消耗。</span></p><p>&nbsp;</p><p><span>要在因特网上实现IP多播，则因特网中的路由器需要解决哪些主要问题？</span></p><ul><li><p><span>IP多播报寻址的问题</span></p></li><li><p><span>多播路由选择协议</span></p></li></ul><p>&nbsp;</p><h3 id='ip多播地址和多播组'><span>IP多播地址和多播组</span></h3><ul><li><p><span>在IPv4中，D类地址被作为多播地址。</span></p></li><li><p><span>多播地址只能用作目的地址，而不能用作源地址。</span></p></li><li><p><span>用每一个D类地址来标识一个多播组，使用同一个IP多播地址接收IP多播数据报的所有主机就构成了一个多播组。</span></p><ul><li><p><span>每个多播组的成员是可以随时变动的，一台主机可以随时加入或离开多播组。</span></p></li><li><p><span>多播组成员的数量和所在的地理位置也不受限制，一台主机可以属于几个多播组。</span></p></li></ul></li><li><p><span>非多播组成员也可以向多播组发送IP多播数据报。</span></p></li><li><p><span>与IP数据报相同，IP多播数据报也是“尽最大努力交付”，不保证一定能够交付给多播组内的所有成员。</span></p></li></ul><p><img src="./库/image-20230424234050079.png" alt="image-20230424234050079" style="zoom: 33%;" /></p><p>&nbsp;</p><p><span>IPv4多播地址又可分为预留的多播地址（永久多播地址）、全球范围可用的多播地址以及本地管理的多播地址[RFC 3330]。</span></p><p><img src="./库/image-20230424234209547.png" alt="image-20230424234209547" style="zoom:33%;" /></p><p>&nbsp;</p><h3 id='ip多播的两种形式'><span>IP多播的两种形式</span></h3><ul><li><p><span>只在本局域网上进行的硬件多播。</span></p></li><li><p><span>在因特网上进行的多播。</span></p></li></ul><p><span>目前大部分主机都是通过局域网接入因特网的。因此，在因特网上进行多播的最后阶段，还是要把IP多播数据报在局域网上用硬件多播交付给多播组的所有成员。</span></p><p>&nbsp;</p><h4 id='在局域网上进行硬件多播'><span>在局域网上进行硬件多播</span></h4><p><span>由于</span><strong><span>MAC地址（也称为硬件地址）有多播MAC地址</span></strong><span>这种类型，因此只要把IPv4多播地址映射成多播MAC地址，即可将IP多播数据报封装在局域网的MAC帧中，而</span><strong><span>MAC帧首部中的目的MAC地址字段的值，就设置为由IPv4多播地址映射成的多播MAC地址</span></strong><span>。这样，可以很方便地利用硬件多播来实现局域网内的IP多播。</span></p><p><span>当给某个多播组的成员主机配置其所属多播组的IP多播地址时，系统就会根据</span><strong><span>映射规则</span></strong><span>从该IP多播地址生成相应的局域网多播MAC地址。</span></p><p>&nbsp;</p><p><img src="./库/image-20230424235550729.png" referrerpolicy="no-referrer" alt="image-20230424235550729"></p><p>&nbsp;</p><blockquote><p><span>在IP网络中，IP多播是一种将数据包发送到一组特定主机的通信方式。每个IP多播组都有一个唯一的IP地址，这个IP地址被用来标识这个多播组。在局域网中，为了能够将IP多播数据包正确地发送到特定的主机，还需要将IP多播地址转换为相应的局域网多播MAC地址。</span></p><p><span>局域网多播MAC地址是一种特殊的MAC地址，用于标识多播数据包的目标设备。每个局域网多播MAC地址的前24位都是固定的，而后24位则是根据IP多播地址计算得出的。计算过程基于一种称为“映射规则”的算法。</span></p><p><span>具体来说，给某个多播组的成员主机配置其所属多播组的IP多播地址时，系统会根据这个IP地址通过映射规则计算出相应的局域网多播MAC地址。映射规则中使用的算法是基于多播组地址的最低23位，这些位被用于计算局域网多播MAC地址的后24位。计算出的局域网多播MAC地址用于标识这个多播组的所有成员主机。</span></p><p><span>总之，通过映射规则将IP多播地址转换为局域网多播MAC地址可以确保IP多播数据包被正确地发送到目标设备，并且只有属于特定多播组的成员才能接收到这些数据包。</span></p></blockquote><p>&nbsp;</p><p><span>因特网号码指派管理局IANA，将自己从IEEE注册管理机构申请到的以太网MAC地址块中从01-00-5E-00-00-00到01-00-5E-7F-FF-FF的多播MAC地址，用于映射IPv4多播地址。这些多播MAC地址的左起前25个比特都是相同的，剩余23个比特可以任意变化，因此共有𝟐</span><sup><span>𝟐𝟑</span></sup><span>个。</span></p><p><img src="./库/image-20230424235634053.png" alt="image-20230424235634053" style="zoom:33%;" /></p><p>&nbsp;</p><p><span>由于IP多播地址可变化的28比特的前5个比特无法映射到MAC多播地址，这会造成IP多播地址与多播MAC地址的映射关系并不是唯一的。</span></p><p><img src="./库/image-20230424235753660.png" alt="image-20230424235753660" style="zoom:33%;" /></p><p>&nbsp;</p><p><span>【举例】 IP多播地址与多播MAC地址的映射关系并不是唯一的。</span></p><ul><li><p><span>IP多播地址226.0.9.26——11100010.00000000.00001001.00011010</span></p></li><li><p><span>IP多播地址226.128.9.26——11100010.10000000.00001001.00011010</span></p></li></ul><p><img src="./库/image-20230425000118511.png" alt="image-20230425000118511" style="zoom:33%;" /></p><p>&nbsp;</p><p><span>IP多播地址226.0.9.26和IP多播地址226.128.9.26都映射到了多播MAC地址01-00-5E-00-09-1A</span></p><p><span>由于IP多播地址与多播MAC地址的映射关系不是唯一的，因此收到IP多播数据报的主机还要在网际层利用软件进行过滤，把不是主机要接收的IP多播数据报丢弃。</span></p><p>&nbsp;</p><p><span>【举例】收到IP多播数据报的主机还要在网际层利用软件进行过滤，把不是主机要接收的IP多播数据报丢弃。</span></p><p><img src="./库/image-20230425000705861.png" alt="image-20230425000705861" style="zoom:25%;" /></p><p>&nbsp;</p><h4 id='在因特网上进行ip多播'><span>在因特网上进行IP多播</span></h4><p><img src="./库/image-20230425001916411.png" alt="image-20230425001916411" style="zoom: 33%;" /></p><ul><li><p><span>要在因特网上进行IP多播，就必须要考虑IP多播数据报经过多个多播路由器进行转发的问题。</span></p><ul><li><p><span>多播路由器必须根据IP多播数据报首部中的IP多播地址，将其转发到有该多播组成员的局域网。</span></p></li><li><p><span>路由器如何知道自己各接口所在局域网中是否有某个多播组的成员？网际组管理协议IGMP</span></p></li></ul></li><li><p><span>网际组管理协议（Internet Group Management Protocol，IGMP）是TCP/IP体系结构网际层中的协议，其作用是</span><strong><span>让连接在本地局域网上的多播路由器知道本局域网上是否有主机（实际上是主机中的某个进程）加入或退出了某个多播组</span></strong><span>。</span></p><ul><li><p><strong><span>IGMP仅在本网络有效</span></strong><span>，使用IGMP并不能知道多播组所包含的成员数量，也不能知道多播组的成员都分布在哪些网络中。</span></p></li><li><p><strong><span>仅使用IGMP并不能在因特网上进行IP多播</span></strong><span>。连接在局域网上的多播路由器还必须和因特网上的其他多播路由器协同工作，以便把IP多播数据报用最小的代价传送给所有的多播组成员，这就需要使用</span><strong><span>多播路由选择协议</span></strong><span>。</span></p></li></ul></li><li><p><span>多播路由选择协议的主要任务是：在多播路由器之间为每个多播组建立一个</span><strong><span>多播转发树</span></strong><span>。</span></p><ul><li><p><span>多播转发树连接多播源和所有拥有该多播组成员的路由器。</span></p></li><li><p><span>IP多播数据报只要沿着多播转发树进行</span><strong><span>洪泛</span></strong><span>，就能被传送到所有拥有该多播组成员的多播路由器。</span></p></li><li><p><span>之后，在多播路由器所直连的局域网内，多播路由器通过</span><strong><span>硬件多播</span></strong><span>，将IP多播数据报发送给该多播组的所有成员。</span>
<img src="./库/image-20230425002507462.png" alt="image-20230425002507462" style="zoom: 25%;" /></p></li><li><p><span>在计算机网络中，硬件多播（Hardware Multicast）是一种网络通信方式，它允许一个多播数据包同时发送给多个目标设备，而不需要为每个目标设备单独发送一个数据包。</span></p><p><span>硬件多播是通过在网络硬件上实现的，包括交换机和网卡等设备。当一个多播数据包到达交换机时，交换机会根据数据包的目标MAC地址（多播地址）和端口映射表将数据包发送到所有与该多播地址关联的端口上。这样，所有的目标设备都可以接收到数据包。</span></p><p><u><span>与单播和广播不同</span></u><span>，多播数据包只会被特定的一组设备接收。这个设备组被称为“多播组”，</span><strong><span>每个多播组都有一个唯一的多播IP地址，可以用来标识这个多播组</span></strong><span>。只有加入这个多播组的设备才能接收到这个多播组的数据包。</span></p><p><strong><span>硬件多播可以提高网络的效率和带宽利用率，因为它可以让数据包同时到达多个设备，而不需要为每个设备单独发送一个数据包</span></strong><span>。它也可以减少网络拥塞和负载，因为只有特定设备组才会接收到数据包，而其他设备则不会收到。因此，硬件多播在各种网络应用中都得到广泛使用，如视频和音频流媒体、在线游戏、群组通信等。</span></p></li></ul></li><li><p><span>针对不同的多播组需要维护不同的多播转发树，而且必须动态地适应多播组成员的变化，但此时网络拓扑并不一定发生变化，因此多播路由选择协议要比单播路由选择协议（例如RIP、OSPF等）复杂得多。</span></p></li><li><p><span>即使某个主机不是任何多播组的成员，它也可以向任何多播组发送多播数据报。</span></p></li><li><p><span>为了覆盖多播组的所有成员，多播转发树可能要经过一些没有多播组成员的路由器（例如上图中的R2）。</span></p></li></ul><p>&nbsp;</p><h5 id='网际组管理协议igmp不用看）'><span>网际组管理协议IGMP（不用看）</span></h5><p><span>网际组管理协议IGMP目前的最新版本是2002年10月公布的IGMPv3[RFC 3376]。</span></p><p>&nbsp;</p><h6 id='三种报文类型'><span>三种报文类型</span></h6><ul><li><p><span>成员报告报文</span></p></li><li><p><span>成员查询报文</span></p></li><li><p><span>离开组报文</span></p></li></ul><p>&nbsp;</p><p><span>IGMP报文被封装在IP数据报中传送</span></p><ul><li><p><span>协议字段的值 = 2，表示数据载荷部分是IGMP报文。</span></p></li><li><p><span>目的地址字段的值根据其所封装IGMP报文类型各有不同，但都属于IP多播地址。也就是说封装有IGMP数据报格式的IP数据报都是IP多播数据报。</span></p></li><li><p><span>生成时间TTL字段的值 = 1，避免封装IGMP报文的IP多播数据报被路由器转发到其他网络。</span></p></li></ul><p>&nbsp;</p><h6 id='加入多播组'><span>加入多播组</span></h6><ul><li><p><span>多播路由器被设置为接收所有IP多播数据报</span></p></li><li><p><span>IGMP成员报告报文封装在IP多播数据报中</span></p></li><li><p><span>IP多播数据报封装在以太网多播帧中</span></p></li><li><p><span>IGMP成员报告报文的内容：希望加入的IP多播组的IP多播地址</span></p></li><li><p><span>IP多播数据报的目的地址：希望加入的IP多播组的IP多播地址</span></p></li><li><p><span>以太网多播帧的目的地址：由IP多播组的IP多播地址映射而来的多播MAC地址</span></p></li></ul><p>&nbsp;</p><p><span>同一IP多播组内的其他成员收到IGMP成员报告报文后：</span></p><ol start='' ><li><p><span>MAC层接受</span></p></li><li><p><span>网际层接受</span></p></li><li><p><span>取消发送IGMP成员报告</span></p></li></ol><p>&nbsp;</p><p><span>其他IP多播组或者不在任何IP多播组内的主机受到IGMP成员报告报文后，直接在MAC层丢弃该IGMP成员报告报文</span></p><p>&nbsp;</p><h6 id='监视多播组的成员变化'><span>监视多播组的成员变化</span></h6><p><span>多播路由器默认每隔125秒就向其直连网络发送一个封装有IGMP成员查询报文的IP多播数据报</span></p><ul><li><p><span>IGMP成员查询报文封装在IP多播数据报中</span></p></li><li><p><span>IP多播数据报封装在以太网多播帧中</span></p></li><li><p><span>IGMP成员查询报文的内容：主要是要查询的特定的IP多播组的IP多播地址，也可以是0.0.0.0，这表示全部多播地址</span></p></li><li><p><span>IP多播数据报的目的地址：224.0.0.1，特殊的IP多播地址，在本网络中所有参加多播的主机和路由器的网际层都会接受该多播数据报。</span></p></li><li><p><span>以太网多播帧的目的地址：01-00-5E-00-00-01，由224.0.0.1映射而来的多播MAC地址</span></p></li></ul><p>&nbsp;</p><p><span>同一网络中不存在任何一个IP多播组内的主机在MAC层丢弃该IGMP成员查询报文</span></p><p><span>同一网络中，位于任意IP多播组内的成员收到IGMP成员查询报文后：</span></p><ol start='' ><li><p><span>在MAC层接受多播帧</span></p></li><li><p><span>网际层接受多播IP多播数据报</span></p><ol start='' ><li><p><span>如果主机属于IGMP成员查询报文所查询的IP多播组，那么</span><strong><span>将会在一定时间后进行响应</span></strong><span>，将会发送IGMP成员报告报文作为应答。</span></p></li><li><p><span>如果主机不属于IGMP成员查询报文所查询的IP多播组，那么不响应</span></p></li></ol></li><li><p><span>处于被查询的IP多播组内的主机之所以会在一定时间后才进行响应是因为，如果在等待时间内收到了同一IP多播组内的其他成员的IGMP报告报文就取消响应。</span></p></li></ol><p>&nbsp;</p><p><span>多播路由器被设置为接收所有IP多播数据报。</span></p><p><span>当多播路由器收到了之前发送的IGMP成员查询报文的回复（IGMP成员报告报文）之后，就知道自己所在网络中，含有该多播组成员。长时间收不到该多播组成员的响应，则将其从多播组列表中删除！</span></p><p>&nbsp;</p><h6 id='选择发送igmp成员查询报文的多播路由器'><span>选择发送IGMP成员查询报文的多播路由器</span></h6><ul><li><p><span>同一网络中的多播路由器可能不止一个，但 没有必要每个多播路由器都周期性地发送IGMP成员查询报文。</span></p></li><li><p><span>只要在这些多播路由器中选择一个作为查询路由器，由查询路由器发送IGMP成员查询报文，而其他的多播路由器仅被动接收响应并更新自己的多播组列表即可。</span></p></li><li><p><span>选择查询路由器的方法：</span></p><ul><li><p><span>每个多播路由器若监听到源IP地址比自己的IP地址小的IGMP成员查询报文则退出选举。</span></p></li><li><p><span>最后，网络中只有IP地址最小的多播路由器成为查询路由器。</span></p></li></ul></li></ul><p>&nbsp;</p><h6 id='退出多播组'><span>退出多播组</span></h6><p><span>IGMPv2在IGMPv1的基础上增加了一个可选项：当主机要退出某个多播组时，可主动发送一个离开组报文而不必等待多播路由器的查询。这样可使多播路由器能够更快地发现某个组有成员离开。</span></p><p>&nbsp;</p><ul><li><p><span>IGMP离开组报文封装在IP多播数据报中</span></p></li><li><p><span>IP多播数据报封装在以太网多播帧中</span></p></li><li><p><span>IGMP离开组报文的内容：228.1.1.1，也就是主机要离开的IP多播组</span></p></li><li><p><span>IP多播数据报的目的地址：224.0.0.2，这是一个特殊的IP多播地址，在本网络中的所有多播路由器的网际层都会接受该多播数据报。</span></p></li><li><p><span>以太网多播帧的目的地址：01-00-5E-00-00-02</span></p></li></ul><p>&nbsp;</p><p><span>同一个网络中不处于任何一个IP多播组的其他主机：直接在MAC层丢弃IGMP离开组报文</span></p><p><span>同一网络中，位于任意IP多播组内的成员收到IGMP离开组报文后：</span></p><ul><li><p><span>在MAC层接受多播帧</span></p></li><li><p><span>在网际层发现该IP数据报地址是224.0.0.2，所以丢弃该IP数据报，丢弃该IGMP离开组报文</span></p></li></ul><p><span>多播路由器收到IGMP离开组报文后：有成员离开该多播组，暂时不删除该多播组，</span><strong><span>立即发送针对该多播组的特殊的IGMP成员查询报文</span></strong><span>，探测该多播组是否还有其他成员。封装该报文的IP多播数据报的目的地址为该多播组的地址228.1.1.1，而不是特殊的多播地址224.0.0.1。</span></p><p>&nbsp;</p><h5 id='多播路由选择协议不用看）'><span>多播路由选择协议（不用看）</span></h5><p><span>多播路由选择协议的主要任务是：在多播路由器之间为每个多播组建立一个多播转发树。多播转发树连接多播源和所拥有该多播组成员的路由器。</span></p><p><span>目前有以下两种方法来构建多播转发树：</span></p><ul><li><p><span>基于源树（Source-Base Tree）多播路由选择</span></p></li><li><p><span>组共享树（Group-Shared Tree）多播路由选择</span></p></li></ul><p>&nbsp;</p><h6 id='基于源树多播路由选择'><span>基于源树多播路由选择</span></h6><p><span>基于源树的多播路由选择的最典型算法是</span><strong><span>反向路径多播</span></strong><span>（Reverse Path Multicasting，</span><strong><span>RPM</span></strong><span>）算法。RPM算法包含以下两个步骤：</span></p><ol start='' ><li><p><span>利用反向路径广播（Reverse Path Broadcasting，RPB）算法建立一个</span><strong><span>广播转发树</span></strong><span>。</span></p><ol start='' ><li><p><span>要建立广播转发树，可以使用洪泛（Flooding）法。</span></p></li><li><p><span>利用反向路径广播RPB算法生成的广播转发树，不会存在环路，因此可以避免广播分组在环路中兜圈。</span></p></li><li><p><span>RPB算法的要点是：每一台路由器在收到一个广播分组时，先检查该广播分组是否是从源点经最短路径传送来的。</span></p><ol start='' ><li><p><span>若是，本路由器就从自己除刚才接收该广播分组的接口的所有其他接口转发该广播分组。</span></p></li><li><p><span>否则，丢弃该广播分组。</span></p></li><li><p><span>如果本路由器有好几个邻居路由器都处在到源点的最短路径上，也就是存在好几条同样长度的最短路径，那么只能选取一条最短路径。选取的规则是这几条最短路径中的邻居路由器的IP地址最小的那条最短路径。</span></p></li></ol></li><li><p><span>RPB中“反向路径”的意思是：在计算最短路径时把源点当作终点。</span></p></li><li><p><span>经过上述过程，最终可以得出转发广播分组的广播转发树。以后就按该广播转发树转发广播分组，这样就避免了广播分组兜圈子，同时每一个路由器也不会收到重复的广播分组。</span></p></li></ol></li><li><p><span>利用剪枝（Pruning）算法，剪除广播转发树中的下游非成员路由器，获得一个</span><strong><span>多播转发树</span></strong><span>。</span></p><ol start='' ><li><p><span>将没有多播组成员（使用IGMP来探测）、并且也没有下游路由器的叶节点从广播转发树上剪除就可实现多播转发树。</span></p></li></ol></li></ol><p><img src="./库/image-20230425114024659.png" alt="image-20230425114024659" style="zoom:33%;" /></p><p>&nbsp;</p><h6 id='组共享树多播路由选择'><span>组共享树多播路由选择</span></h6><p><span>组共享树多播路由选择采用基于核心的分布式生成树算法来建立共享树。该方法在每个多播组中指定一个核心（core）路由器，以该路由器为根，建立一棵连接多播组的所有成员路由器的生成树，作为多播转发树。</span></p><p><span>每个多播组中除了核心路由器，其他所有成员路由器都会向自己多播组中的核心路由器单播加入报文。加入报文通过单播朝着核心路由器转发，直到它到达已经属于该多播生成树的某个节点或者直接到达该核心路由器。加入报文所经过的路径，就确定了一条从单播该报文的边缘节点到核心路由器之间的分支，而这个新分支就被嫁接到现有的多播转发树上。</span></p><p><img src="./库/image-20230425113835762.png" alt="image-20230425113835762" style="zoom:33%;" /></p><p>&nbsp;</p><h3 id='因特网的多播路由选择协议'><span>因特网的多播路由选择协议</span></h3><p><span>目前还没有在整个因特网范围使用的多播路由选择协议。下面是一些建议使用的多播路由选择协议：</span></p><ul><li><p><span>距离向量多播路由选择协议（Distance Vector Multicast Routing Protocol，DVMRP）[RFC 1075]。</span></p></li><li><p><span>开放最短路径优先的多播扩展（Multicast Extensions to OSPF，MOSPF）[RFC 1585]。</span></p></li><li><p><span>协议无关多播-稀疏方式（Protocol Independent Multicast-Sparse Mode，PIM-SM）[RFC 2362]。</span></p></li><li><p><span>协议无关多播-密集方式（Protocol Independent Multicast-Dense Mode，PIM-DM）[RFC 3973]。</span></p></li><li><p><span>基于核心的转发树（Core Based Tree，CBT）[RFC 2189，RFC 2201]。</span></p></li></ul><p>&nbsp;</p><p><span>尽管因特网工程任务组IETF努力推动着因特网上的全球多播主干网（Multicast Backbone On the Internet，MBONE）的建设，但至今在因特网上的IP多播还没有得到大规模的应用。</span></p><ul><li><p><span>主要原因是：改变一个已成功运行且广泛部署的网络层协议是一件及其困难的事情。</span></p></li><li><p><span>目前IP多播主要应用在一些局部的园区网络、专用网络或者虚拟专用网中。</span></p></li></ul><p>&nbsp;</p><h3 id='ipv4的缺陷'><span>IPv4的缺陷</span></h3><p><span>IPv4是在20世纪70年代末期设计的，其IPv4地址的设计存在以下缺陷：</span></p><ul><li><p><span>IPv4的设计者最初并没有想到该协议会在全球范围内广泛使用，因此将IPv4地址的长度规定为他们认为足够长的32比特。</span></p></li><li><p><span>IPv4地址早期的编址方法（分类的IPv4地址和划分子网的IPv4地址）也不够合理，造成IPv4地址资源的浪费。</span></p></li></ul><p>&nbsp;</p><p><span>如果没有网络地址转换NAT技术的广泛应用，IPv4早已停止发展。</span></p><p><span>然而，NAT仅仅是为了延长IPv4使用寿命而采取的权宜之计，解决IPv4地址耗尽的根本措施就是采用具有更大地址空间（IP地址的长度为128比特）的新版本IP，即IPv6。</span></p><p><span>因特网工程任务组IETF早在1992年6月就提出要制定下一代的IP，即IPng（IP Next Generation）。IPng现在正式称为IPv6。</span></p><p><span>直接将因特网的核心协议从IPv4更换成IPv6是不可行的。世界上许多团体都从因特网的发展中看到了机遇，因此在IPv6标准的制定过程中出于自身经济利益而产生了激烈的争论。</span></p><p><span>到目前为止，IPv6还只是草案标准阶段[RFC 2460，RFC 4862，RFC 4443]。</span></p><p>&nbsp;</p><p><span>尽早开始过渡到IPv6有以下好处：</span></p><ul><li><p><span>有更多时间来平滑过渡</span></p></li><li><p><span>有更多时间来培养IPv6的专门人才</span></p></li><li><p><span>及早提供IPv6服务比较便宜</span></p></li></ul><p>&nbsp;</p><h3 id='ipv6引进的主要变化'><span>IPv6引进的主要变化</span></h3><ul><li><p><span>更大的地址空间：IPv6将IPv4的32比特地址空间增大到了128比特，在采用合理编址方法的情况下，在可预见的未来是不会用完的。</span></p></li><li><p><span>扩展的地址层次结构：可划分为更多的层次，这样可以更好地反映出因特网的拓扑结构，使得对寻址和路由层次的设计更具有灵活性。</span></p></li><li><p><span>灵活的首部格式：与IPv4首部并不兼容。IPv6定义了许多可选的的扩展首部，不仅可提供比IPv4更多的功能，而且还可以提高路由器的处理效率，因为路由器对逐跳扩展首部外的其他扩展首部都不进行处理。</span></p></li><li><p><span>改进的选项：IPv6允许分组包含有选项的控制信息，因而可以包含一些新的选项。然而IPv4规定的选项却是固定不变的。</span></p></li><li><p><span>允许协议继续扩充：这一点很重要，因为技术总是在不断地发展，而新的应用也会层出不穷。然而IPv4的功能却是固定不变的。</span></p></li><li><p><span>支持即插即用（即自动配置）：IPv6支持主机或路由器自动配置IPv6地址及其他网络配置参数。因此IPv6不需要使用DHCP。</span></p></li><li><p><span>支持资源的预分配：IPv6能为实时音视频等要求保证一定带宽和时延的应用，提供更好的服务质量保证。</span></p></li></ul><p>&nbsp;</p><h3 id='ipv6数据报的基本首部'><span>IPv6数据报的基本首部</span></h3><h4 id='ipv6数据报的基本首部-2'><span>IPv6数据报的基本首部</span></h4><p><img src="./库/image-20230520142254868.png" referrerpolicy="no-referrer" alt="image-20230520142254868"></p><p><span>所有的扩展首部并不属于IPv6数据报的首部，它们与其后面的数据部分合起来构成有效载荷（payload，也称为净负荷）。</span></p><p>&nbsp;</p><h4 id='ipv6数据报首部格式'><span>IPv6数据报首部格式</span></h4><p><img src="./库/image-20230520142327825.png" alt="image-20230520142327825" style="zoom:50%;" /></p><p><span>IPv6将IPv4数据报首部中不必要的功能取消了，这使得IPv6数据报基本首部中的字段数量减少到只有8个。</span></p><p><span>取消了首部长度字段，因为IPv6数据报的首部长度是固定的40字节。由于IPv6地址的长度扩展到了128比特，因此使得IPv6数据报基本首部的长度反而增大到了40字节，比IPv4数据报首部固定部分的长度（20字节）增大了20字节。</span></p><p><span>取消了区分服务（服务类型）字段，因为IPv6数据报首部中的通信量类和流标号字段实现了区分服务字段的功能。</span></p><p><span>取消了总长度字段，改用有效载荷长度字段。这是因为IPv6数据报的首部长度是固定的40字节，只有其后面的有效载荷长度是可变的。</span></p><p><span>取消了标识、标志和片偏移字段，因为这些功能已包含在IPv6数据报的分片扩展首部中。</span></p><p><span>把生存时间TTL字段改称为跳数限制字段，这样名称与作用更加一致。</span></p><p><span>取消了协议字段，改用下一个首部字段。</span></p><p><span>取消了首部检验和字段，这样可以加快路由器处理IPv6数据报的速度。</span></p><p><span>取消了选项字段，改用扩展首部来实现选项功能。</span></p><p>&nbsp;</p><p><span>版本字段：长度为4比特，用来表示IP协议的版本。对于IPv6该字段的值是6。</span></p><p><span>通信量类字段：长度为8比特，该字段用来区分不同的IPv6数据报的类别或优先级。目前正在进行不同的通信量类性能的实验。</span></p><p><span>流标号字段：长度为20比特。</span></p><ul><li><p><span>IPv6提出了流的抽象概念。</span></p></li><li><p><span>“流”就是因特网上从特定源点到特定终点（单播或多播）的一系列IPv6数据报（如实时音视频数据的传送），而在这个“流”所经过的路径上的所有路由器都保证指明的服务质量。</span></p></li><li><p><span>所有属于同一个流的IPv6数据报都具有同样的流标号。换句话说，流标号用于资源分配。</span></p></li><li><p><span>流标号对于实时音视频数据的传送特别有用，但对于传统的非实时数据，流标号则没有用处，把流标号字段的值置为0即可。</span></p></li></ul><p><span>有效载荷长度字段：长度为16比特，它指明IPv6数据报基本首部后面的有效载荷（包括扩展首部和数据部分）的字节数量。该字段以字节为单位，最大取值为65535，因此IPv6数据报基本首部后面的有效载荷的最大长度为65535字节。</span></p><p><span>下一个首部字段：长度为8比特。该字段相当于IPv4数据报首部中的协议字段或可选字段。</span></p><ul><li><p><span>当IPv6数据报没有扩展首部时，该字段的作用与IPv4的协议字段一样，它的值指出了IPv6数据报基本首部后面的数据是何种协议数据单元PDU。</span></p></li><li><p><span>当IPv6数据报基本首部后面带有扩展首部时，该字段的值就标识后面第一个扩展首部的类型。</span></p></li></ul><p><img src="./库/image-20230520142809540.png" alt="image-20230520142809540" style="zoom:33%;" /></p><p>&nbsp;</p><p><span>跳数限制字段：长度为8比特。该字段用来防止IPv6数据报在因特网中永久兜圈。</span></p><ul><li><p><span>源点在每个IPv6数据报发出时即设定某个跳数限制（最大255跳）。</span></p></li><li><p><span>每个路由器在转发IPv6数据报时，要先把跳数限制字段中的值减1。当跳数限制的值为0时，就把这个IPv6数据报丢弃（即不转发）。</span></p></li><li><p><span>该字段的作用与IPv4数据报首部中的生存时间TTL字段完全一样。IPv6将名称改为跳数限制后，可使名称与作用更加一致。</span></p></li></ul><p><span>源地址字段和目的地址字段：长度都为128比特。分别用来填写IPv6数据报的发送端的IPv6地址和接收端的IPv6地址。</span></p><p>&nbsp;</p><p><span>IPv4数据报如果在其首部中使用了选项字段，则在数据报的整个传送路径中的全部路由器，都要对选项字段进行检查，这就降低了路由器处理数据报的速度。</span></p><p><span>实际上，在路径中的路由器对很多选项是不需要检查的。因此，为了提高路由器对数据包的处理效率，IPv6把原来IPv4首部中的选项字段都放在了扩展首部中，由路径两端的源点和终点的主机来处理，而数据报传送路径中的所有路由器都不处理这些扩展首部（除逐跳选项扩展首部）。</span></p><p>&nbsp;</p><h3 id='ipv6数据报的扩展首部'><span>IPv6数据报的扩展首部</span></h3><p><span>在[RFC 2460]中定义了以下六种扩展首部：</span></p><ul><li><p><span>逐跳选项</span></p></li><li><p><span>路由选择</span></p></li><li><p><span>分片</span></p></li><li><p><span>鉴别</span></p></li><li><p><span>封装安全有效载荷</span></p></li><li><p><span>目的站选项</span></p></li></ul><p><span>每一个扩展首部都由若干个字段组成，它们的长度也各不相同。</span></p><p><span>所有扩展首部中的第一个字段都是8比特的下一个首部字段。该字段的值指出在该扩展首部后面是何种扩展首部。</span></p><p><span>当使用多个扩展首部时，应按以上的先后顺序出现。</span></p><p>&nbsp;</p><p>&nbsp;</p><h3 id='ipv6地址'><span>IPv6地址</span></h3><p><span>略</span></p><p>&nbsp;</p><h3 id='从ipv4向ipv6过渡'><span>从IPv4向IPv6过渡</span></h3><p><span>因特网上使用IPv4的路由器的数量太大，要让所有路由器都改用IPv6并不能一蹴而就。因此，从IPv4转变到IPv6只能采用逐步演进的办法。</span></p><p><span>另外，新部署的IPv6系统必须能够向后兼容，也就是IPv6系统必须能够接收和转发IPv4数据报，并且能够为IPv4数据报选择路由。</span></p><p><span>下面介绍两种由IPv4向IPv6过渡的策略：</span></p><ul><li><p><span>使用双协议栈</span></p></li><li><p><span>使用隧道技术</span></p></li></ul><p>&nbsp;</p><h4 id='使用双协议栈'><span>使用双协议栈</span></h4><p><span>双协议栈（Dual Stack）是指在完全过渡到IPv6之前，使一部分主机或路由器装有IPv4和IPv6两套协议栈。</span></p><p><span>双协议栈主机或路由器既可以和IPv6系统通信，又可以和IPv4系统通信。</span></p><p><span>双协议栈主机或路由器记为IPv6/IPv4，表明它具有一个IPv6地址和一个IPv4地址。双协议栈主机在与IPv6主机通信时采用IPv6地址，而与IPv4主机通信时采用IPv4地址。</span></p><p><span>双协议栈主机通过域名系统DNS查询目的主机采用的IP地址：</span></p><ul><li><p><span>若DNS返回的是IPv4地址，则双协议栈的源主机就使用IPv4地址</span></p></li><li><p><span>若DNS返回的是IPv6地址，则双协议栈的源主机就使用IPv6地址</span></p></li></ul><p><img src="./库/image-20230520144816555.png" referrerpolicy="no-referrer" alt="image-20230520144816555"></p><p>&nbsp;</p><h4 id='使用隧道技术'><span>使用隧道技术</span></h4><p><span>隧道技术（Tunneling）的核心思想是：</span></p><ul><li><p><span>当IPv6数据报要进入IPv4网络时，将IPv6数据报重新封装成IPv4数据报，即整个IPv6数据报成为IPv4数据报的数据载荷。</span></p></li><li><p><span>封装有IPv6数据报的IPv4数据报在IPv4网络中传输。</span></p></li><li><p><span>当IPv4数据报要离开IPv4网络时，再将其数据载荷（即原来的IPv6数据报）取出并转发到IPv6网络。</span></p></li></ul><p><img src="./库/image-20230520144906265.png" referrerpolicy="no-referrer" alt="image-20230520144906265"></p><p><span>要使双协议栈路由器R4知道IPv4数据报的数据载荷是IPv6数据报，则IPv4数据报首部中协议字段的值必须设置为41。</span></p><p>&nbsp;</p><h3 id='网际控制报文协议icmpv6'><span>网际控制报文协议ICMPv6</span></h3><p><span>略</span></p><p>&nbsp;</p><h2 id='软件定义网络'><span>软件定义网络</span></h2><p><span>略</span></p><p>&nbsp;</p><h1 id='第五章'><span>第五章</span></h1><h2 id='运输层概述'><span>运输层概述</span></h2><p><span>第2~4章依次介绍了计算机网络体系结构中的物理层、数据链路层和网络层，它们共同解决了将主机通过异构网络互联起来所面临的问题，实现了主机到主机的通信。</span></p><p><span>然而在计算机网络中实际进行通信的真正实体，是位于通信两端主机中的进程。如何为运行在不同主机上的应用进程提供直接的逻辑通信服务，就是运输层的主要任务。运输层协议又称为端到端协议。</span></p><p><img src="./库/image-20230520163032482.png" alt="image-20230520163032482" style="zoom:50%;" /></p><p><span>运输层向应用层实体屏蔽了下面网络核心的细节（例如网络拓扑、所采用的路由选择协议等），它使应用进程看见的就好像是在两个运输层实体之间有一条端到端的逻辑通信信道。</span></p><p><span>根据应用需求的不同，因特网的运输层为应用层提供了两种不同的运输层协议，即面向连接的TCP和无连接的UDP，这两种协议就是本章要讨论的主要内容。</span></p><p>&nbsp;</p><h3 id='tcpip体系结构运输层中的两个重要协议'><span>TCP/IP体系结构运输层中的两个重要协议</span></h3><p><img src="./库/image-20230520163444007.png" referrerpolicy="no-referrer" alt="image-20230520163444007"></p><p>&nbsp;</p><h4 id='tcp'><span>TCP</span></h4><p><span>传输控制协议（Transmission Control Protocol，TCP）为其上层提供的是面向连接的可靠的数据传输服务。</span></p><p><span>使用TCP通信的双方，在传送数据之前必须首先建立TCP连接（逻辑连接，而非物理连接）。数据传输结束后必须要释放TCP连接。</span></p><p><span>TCP为了实现可靠传输，就必须使用很多措施，例如TCP连接管理、确认机制、超时重传、流量控制以及拥塞控制等。</span></p><p><span>TCP的实现复杂，TCP报文段的首部比较大，占用处理机资源比较多。</span></p><p>&nbsp;</p><h4 id='udp'><span>UDP</span></h4><p><span>用户数据报协议（User Datagram Protocol，UDP）为其上层提供的是无连接的不可靠的数据传输服务。</span></p><p><span>使用UDP通信的双方，在传送数据之前不需要建立连接。</span></p><p><span>UDP不需要实现可靠传输，因此不需要使用实现可靠传输的各种机制。</span></p><p><span>UDP的实现简单，UDP用户数据报的首部比较小。</span></p><p>&nbsp;</p><h3 id='运输层端口号'><span>运输层端口号</span></h3><p><span>运行在计算机上的进程是使用进程标识符（Process Identification，PID）来标识的。</span></p><p><span>然而，因特网上的计算机并不是使用统一的操作系统，而不同操作系统（Windows、Linux、MacOS）又使用不同格式的进程标识符。为了使运行不同操作系统的计算机的应用进程之间能够基于网络进行通信，就必须使用统一的方法对TCP/IP体系的应用进程进行标识。</span></p><p><span>TCP/IP体系结构的运输层使用端口号来标识和区分应用层的不同应用进程。端口号的长度为16比特，取值范围是0~65535。</span></p><p>&nbsp;</p><p><span>服务器端使用端口号：</span></p><ul><li><p><span>熟知端口号0~1023：由IANA分配给TCP/IP体系结构应用层中最重要的一些应用协议。</span></p></li><li><p><span>登记端口号1024~49151：为没有熟知端口号的应用程序使用。要使用这类端口号，必须在IANA进行登记，以防止重复。例如，Microsoft RDP微软远程桌面应用程序使用的端口号是3389。</span></p></li></ul><p>&nbsp;</p><p><span>客户端使用端口号：</span></p><ul><li><p><span>短暂端口号49152~65535：仅在客户端使用，由客户进程在运行时动态选择，通信结束后会被系统收回，以便给其他客户进程使用。</span></p></li></ul><p>&nbsp;</p><p><span>端口号只具有本地意义，即端口号只是为了标识本计算机网络协议栈应用层中的各应用进程。在因特网中，不同计算机中的相同端口号是没有关系的，即相互独立。另外，TCP和UDP端口号之间也是没有关系的。</span></p><p>&nbsp;</p><h3 id='发送方的复用和接收方的分用'><span>发送方的复用和接收方的分用</span></h3><p><img src="./库/image-20230520165140210.png" alt="image-20230520165140210" style="zoom:33%;" /></p><p>&nbsp;</p><blockquote><p><span>在计算机网络中，运输层的发送方复用（Multiplexing）和接收方分用（Demultiplexing）是指在发送方将多个应用程序的数据流合并为一个传输层的数据流，并在接收方将传输层的数据流分发给相应的应用程序。</span></p><p><span>发送方复用（Multiplexing）：</span>
<span>发送方复用是指将来自不同应用程序的数据流合并为一个传输层的数据流，以便通过网络传输。发送方在将数据传递给传输层之前，使用不同的标识符（如端口号）对数据进行标记，以区分不同的应用程序。这样，多个应用程序的数据可以通过同一个传输层协议（如TCP或UDP）进行传输。</span></p><p><span>在发送方，复用的过程包括将不同应用程序的数据进行分段（如果需要），添加传输层的协议头部信息（如源端口和目标端口），并将数据发送到网络层进行传输。复用机制确保了多个应用程序的数据能够共享同一个传输层协议的连接。</span></p><p><span>接收方分用（Demultiplexing）：</span>
<span>接收方分用是指在接收方将传输层的数据流分发给相应的应用程序。接收方根据传输层协议的标识符（如目标端口号）来判断数据应该交给哪个应用程序进行处理。</span></p><p><span>在接收方，分用的过程包括从传输层接收数据流，解析传输层的协议头部信息，提取目标端口号，并将数据传递给相应的应用程序。分用机制确保了接收方能够正确将传输层的数据流分发给对应的应用程序。</span></p><p><span>通过发送方复用和接收方分用，多个应用程序可以共享同一个传输层协议的连接，实现并发传输和接收数据，并确保数据能够正确地被分发给相应的应用程序。</span></p></blockquote><p>&nbsp;</p><h2 id='tcp和udp对比'><span>TCP和UDP对比</span></h2><p><span>无连接的UDP和面向连接的TCP——“连接”指逻辑连接关系，而不是物理连接。</span></p><p><img src="./库/image-20230520170421678.png" referrerpolicy="no-referrer" alt="image-20230520170421678"></p><p>&nbsp;</p><p><span>UDP和TCP对单播、多播和广播的支持情况：</span></p><ul><li><p><span>UDP支持单播、多播和广播</span></p></li><li><p><span>TCP仅支持单播</span></p></li></ul><p>&nbsp;</p><p><span>UDP和TCP应用层报文的处理：</span></p><ul><li><p><span>UDP是面向应用报文的</span></p></li><li><p><span>TCP是面向字节流的</span></p></li></ul><p>&nbsp;</p><p><span>UDP和TCP对数据传输可靠性的支持情况：</span></p><ul><li><p><span>UDP向上层提供无连接不可靠传输服务（适用于IP电话、视频会议等实时应用）</span></p></li><li><p><span>TCP向上层提供面向连接的可靠传输服务（适用于要求可靠传输的应用，例如文件传输）</span></p></li></ul><p>&nbsp;</p><p><span>UDP首部和TCP首部的对比：</span></p><p><img src="./库/image-20230520170613935.png" referrerpolicy="no-referrer" alt="image-20230520170613935"></p><p>&nbsp;</p><h3 id='tcp报文段的首部格式'><span>TCP报文段的首部格式</span></h3><p><span>TCP的全部功能需要依靠其首部中的各字段来实现。</span></p><p><img src="./库/image-20230520172434719.png" alt="image-20230520172434719" style="zoom: 50%;" /></p><p><span>序号：占32比特，取值范围0~2</span><sup><span>32</span></sup><span>-1。当序号增加到最后一个时，下一个序号又回到0。用来指出本TCP报文段数据载荷的第一个字节的序号。</span></p><p><span>确认号：占32比特，取值范围0~2</span><sup><span>32</span></sup><span>-1。当确认号增加到最后一个时，下一个确认号又回到0。用来指出期望收到对方下一个TCP报文段的数据载荷的第一个字节的序号，同时也是对之前收到的所有数据的确认。</span></p><p><span>确认标志位ACK：只有当ACK取值为1时，确认号字段才有效。ACK取值为0时，确认号字段无效。</span><u><span>TCP规定：在TCP连接建立后，所有传送的TCP报文段都必须把ACK置1。</span></u></p><p><span>数据偏移：占4比特，该字段的取值</span><strong><span>以4字节为单位</span></strong><span>。指出TCP报文段的数据载荷部分的起始处距离TCP报文段的起始处有多远，这</span><strong><span>实际上指出了TCP报文段的首部长度</span></strong><span>。</span></p><p><span>保留：占6比特，保留为今后使用，目前应置为0。</span></p><p><span>窗口：占16比特，该字段的取值</span><strong><span>以字节为单位</span></strong><span>。指出发送本报文段的一方的接收窗口的大小，即接收缓存的可用空间大小，这用来表征接收方的接收能力。在计算机网络中，经常用接收方的接收能力的大小来控制发送方的数据发送量，这就是所谓的流量控制。</span></p><p>&nbsp;</p><blockquote><p><span>在计算机网络中，TCP（Transmission Control Protocol）报文头部的窗口字段用于流量控制和拥塞控制。窗口字段告知接收方可以接收多少数据，以便发送方根据该值进行数据发送。</span></p><p><span>具体来说，窗口字段的意义如下：</span></p><ol start='' ><li><p><span>接收窗口（Receive Window）：接收方使用接收窗口来指示发送方可以发送多少数据。接收方根据自身的处理能力、可用的缓冲区空间等因素决定接收窗口的大小。发送方的数据量不应超过接收窗口的大小，以避免过多的数据被发送而导致接收方无法及时处理。</span></p></li><li><p><span>滑动窗口（Sliding Window）：滑动窗口是发送方用于跟踪接收方窗口大小和数据确认的机制。发送方根据接收方报告的接收窗口大小来确定可以发送的数据量。发送方发送数据后等待接收方的确认，确认后滑动窗口向前滑动，允许发送方发送更多的数据。</span></p></li><li><p><span>拥塞窗口（Congestion Window）：拥塞窗口用于拥塞控制，以防止网络拥塞。拥塞窗口的大小由发送方动态调整，以控制发送数据的速率。如果网络拥塞，发送方会减小拥塞窗口的大小，从而减少发送的数据量。如果网络状况良好，发送方会逐渐增加拥塞窗口的大小，以提高发送速率。</span></p></li></ol><p><span>总的来说，窗口字段在TCP中起到了流量控制和拥塞控制的作用，确保发送方根据接收方的处理能力和网络状况合理发送数据，以实现可靠的数据传输。</span></p></blockquote><p>&nbsp;</p><p><span>检验和：占16比特，用来检查整个TCP报文段在传输过程中是否出现了误码。</span></p><p><span>同步标志位SYN：用于TCP“三报文握手”建立连接。当SYN=1且ACK=0时，表明这是一个TCP连接请求报文段。对方若同意建立连接，则应在响应的TCP报文段的首部中使SYN=1且ACK=1。综上所述，</span><strong><span>SYN为1的TCP报文段要么是一个连接请求报文段，要么是一个连接响应报文段。</span></strong></p><p><span>终止标志位FIN：用于TCP“四报文挥手”释放连接。当FIN=1时，表明此TCP报文段的发送方已经将全部数据发送完毕，现在要求释放TCP连接。</span></p><p><span>复位标志位RST：用于复位TCP连接。当RST=1时，表明TCP连接中出现严重差错，必须释放连接，然后再重新建立连接。RST置1还用来拒绝一个非法的TCP报文段或拒绝打开一个TCP连接。</span></p><p>&nbsp;</p><p><span>出于效率的考虑，TCP的发送方可能会延迟发送数据，而TCP的接收方可能会延迟向应用进程交付数据。这样可以一次处理更多的数据。但是当两个应用进程进行交互式通信时，有时在一端的应用进程希望在键入一个命令后立即就能够收到对方的响应。在这种情况下，应用进程可以通知TCP使用推送（PUSH）操作。</span></p><p><span>推送标志位PSH：发送方TCP把PSH置1，并立即创建一个TCP报文段发送出去，而不需要积累到足够多的数据再发送。接收方TCP收到PSH为1的TCP报文段，就尽快地交付给应用进程，而不再等到接收到足够多的数据才向上交付。</span></p><p>&nbsp;</p><p><span>紧急标志位URG：当URG=1时，紧急指针字段有效。当URG=0时，紧急指针字段无效。</span></p><p><span>紧急指针：占16比特，以字节为单位，用来指明紧急数据的长度。当发送方有紧急数据时，可将紧急数据“插队”到发送缓存的最前面，并立刻封装到一个TCP报文段中进行发送。紧急指针会指出本报文段数据载荷部分包含了多长的紧急数据，紧急数据之后是普通数据。接收方收到紧急标志位为1的TCP报文段，会按照紧急指针字段的值从报文段数据载荷中取出紧急数据并直接上交应用进程，而不必在接收缓存中排队。</span></p><p>&nbsp;</p><p><span>选项（长度可变，最大40字节）：</span></p><ul><li><p><span>最大报文段长度MSS选项：指出TCP报文段数据载荷部分的最大长度，而不是整个TCP报文段的长度。</span></p></li><li><p><strong><span>窗口扩大选项：用来扩大窗口，提高吞吐率。</span></strong></p></li><li><p><span>时间戳选项：</span></p><ul><li><p><span>用于计算往返时间RTT</span></p></li><li><p><span>用于处理序号超范围的情况，又称为防止序号绕回PAWS。</span></p></li></ul></li><li><p><strong><span>选择确认选项：用来实现选择确认功能。</span></strong></p></li></ul><p>&nbsp;</p><p><span>填充字段：若选项字段的长度加上20字节固定首部的长度不能被4字节整除时，需要填充相应数量的比特0，以确保首部长度能被4字节整除。</span></p><p>&nbsp;</p><blockquote><p><span>MSS是TCP的最大报文段的数据长度，是指TCP报文段中数据的最大长度，不包含TCP首部</span></p><p><span>MTU和MSS之间相差一个IP首部和一个TCP首部的长度</span></p><p>&nbsp;</p><p><a href='https://www.dyxmq.cn/network/tcpip/the-difference-between-mss-and-mtu.html' target='_blank' class='url'>https://www.dyxmq.cn/network/tcpip/the-difference-between-mss-and-mtu.html</a></p><p><img src="./库/image-20230523175308671.png" alt="image-20230523175308671" style="zoom:50%;" /></p><p><span>MTU: Maximum transmission unit，最大传输单元，IP报文段的最大大小。</span></p><p><span>MSS: Maximum segment size，最大的帧大小，是TCP数据段的最大大小。</span></p><p><span>其中MTU工作于数据链路层，取决于网络环境。而MSS只是TCP负载部分的大小，它受限于MTU。</span></p><p><span>要注意的是MSS描述的只是TCP负载部分的长度，不包括头部。</span></p></blockquote><p>&nbsp;</p><h3 id='tcp的连接建立'><span>TCP的连接建立</span></h3><p><span>TCP是面向连接的协议，它基于运输连接来传送TCP报文段。TCP运输连接的建立和释放，是每一次面向连接的通信中必不可少的过程。</span></p><p>&nbsp;</p><p><span>TCP运输连接有以下三个阶段：</span></p><ol start='' ><li><p><span>通过“三报文握手”来建立TCP连接。</span></p></li><li><p><span>基于已建立的TCP连接进行可靠的数据传输。</span></p></li><li><p><span>在数据传输结束后，还要通过“四报文挥手”来释放TCP连接。</span></p></li></ol><p>&nbsp;</p><p><span>“三报文握手”建立TCP连接的目的在于解决以下三个主要问题：</span></p><ol start='' ><li><p><span>使TCP双方能够确知对方的存在。</span></p></li><li><p><span>使TCP双方能够协商一些参数（例如最大报文段长度、最大窗口大小、时间戳选项等）。</span></p></li><li><p><span>使TCP双方能够对运输实体资源进行分配和初始化。运输实体资源包括缓存大小、各状态变量、连接表中的项目等。</span></p></li></ol><p>&nbsp;</p><p><img src="./库/image-20230521130941804.png" referrerpolicy="no-referrer" alt="image-20230521130941804"></p><p>&nbsp;</p><p><strong><span>TCP连接请求报文段</span></strong><span>和</span><strong><span>TCP连接请求确认报文段</span></strong><span>首部中的同步标志位SYN的值必须设置为1。</span></p><p>&nbsp;</p><h4 id='tcp客户'><span>TCP客户</span></h4><p><span>序号seq字段被设置了一个初始值x，作为TCP客户进程所选择的初始序号。</span></p><p><span>TCP规定同步标志位SYN被设置为1的报文段（例如TCP连接请求报文段和TCP连接请求确认报文段）不能携带数据，但要消耗掉一个序号。按上述规定，TCP连接请求报文段不能携带数据（即没有数据载荷），但是会消耗掉序号x。因此，TCP客户进程下一次发送的TCP报文段的数据载荷的第一个字节的序号为x+1。</span></p><p>&nbsp;</p><h4 id='tcp服务器'><span>TCP服务器</span></h4><p><span>TCP连接请求确认报文段首部中的同步标志位SYN和确认标志位ACK的值都设置为1。</span></p><p><span>序号seq字段被设置了一个初始值y，作为TCP服务器进程所选择的初始序号。</span></p><p><span>TCP规定同步标志位SYN被设置为1的报文段（例如TCP连接请求报文段和TCP连接请求确认报文段）不能携带数据，但要消耗掉一个序号。</span></p><p><span>确认号ack字段的值被设置为x+1，这是对TCP客户进程所选择的初始序号x的确认。</span></p><p>&nbsp;</p><p><span>TCP规定普通的TCP确认报文段可以携带数据，但如果不携带数据，则不消耗序号。</span></p><p>&nbsp;</p><p><span>采用“三报文握手”而不是“两报文握手”来建立TCP连接，是为了防止已失效的TCP连接请求报文段突然又传送到了TCP服务器进程，因而导致错误。</span></p><p>&nbsp;</p><h3 id='tcp的连接释放'><span>TCP的连接释放</span></h3><p><img src="./库/image-20230521131544948.png" referrerpolicy="no-referrer" alt="image-20230521131544948"></p><p>&nbsp;</p><h4 id='tcp客户-2'><span>TCP客户</span></h4><p><strong><span>发送TCP连接释放报文段并进入终止等待1状态</span></strong></p><p><span>序号seq字段的值设置为u，它等于TCP客户进程之前已经传送过的数据的最后一个字节的序号加1。</span></p><p><span>TCP规定终止标志位FIN等于1的TCP报文段即使不携带数据，也要消耗掉一个序号。</span></p><p><span>确认号ack字段的值设置为v，它等于TCP客户进程之前已收到的数据的最后一个字节的序号加1。</span></p><p>&nbsp;</p><p><strong><span>发送TCP普通确认报文段并进入时间等待状态</span></strong></p><p><span>确认标志位ACK的值设置为1，表明这是一个TCP普通确认报文段。</span></p><p><span>序号seq字段的值设置为u+1，这是因为TCP客户进程之前发送的TCP连接释放报文段虽然不携带数据，但要消耗掉一个序号。</span></p><p><span>确认号ack字段的值设置为w+1，这是对所收到的TCP连接释放报文段的确认。</span></p><p><span>MSL是最长报文段寿命（Maximum Segment Lifetime）的英文缩写词，[RFC793]建议为2分钟。也就是说，TCP客户进程进入时间等待（TIME-WAIT）状态后，还要经过4分钟才能进入关闭（CLOSED）状态。这完全是从工程上来考虑的。对于现在的网络，MSL取为2分钟可能太长了，因此TCP允许不同的实现可根据具体情况使用更小的MSL值。</span></p><p>&nbsp;</p><p><span>处于时间等待（TIME-WAIT）状态后要经过2MSL时长，可以确保TCP服务器进程能够收到最后一个TCP确认报文段而进入关闭（CLOSED）状态。</span></p><p><span>另外，TCP客户进程在发送完最后一个TCP确认报文段后，再经过2MSL时长，就可以使本次连接持续时间内所产生的的所有报文段都从网络中消失。这样就可以使下一个新的TCP连接中不会出现旧连接中的报文段。</span></p><p>&nbsp;</p><h4 id='tcp服务器-2'><span>TCP服务器</span></h4><p><strong><span>发送TCP普通确认报文段并进入关闭等待状态</span></strong></p><p><span>确认标志位ACK的值被设置为1，表明这是一个TCP普通确认报文段。</span></p><p><span>序号seq字段的值设置为v，它等于TCP服务器进程之前已传送过的数据的最后一个字节的序号加1。</span>
<span>这也与之前收到的TCP连接释放报文段中的确认号v匹配。</span></p><p><span>确认号ack字段的值设置为u+1，这是对TCP连接释放报文段的确认。</span></p><p>&nbsp;</p><p><strong><span>发送TCP连接释放报文段并进入最后确认状态</span></strong></p><p><span>TCP连接释放报文段首部中的终止标志位FIN和确认标志位ACK的值都被设置为1。表明这是一个TCP连接释放报文段，同时也对之前收到的TCP报文段进行确认。</span></p><p><span>序号seq字段的值假定被设置为w，这是因为在半关闭状态下TCP服务器进程可能又发送了一些数据。</span></p><p><span>确认号ack字段的值被设置为u+1，这是对之前收到的TCP连接释放报文段的重复确认。</span></p><p>&nbsp;</p><h3 id='tcp保活计时器的作用'><span>TCP保活计时器的作用</span></h3><p><span>启动保活计时器（通常为2小时），每75秒发送TCP探测报文，若一连发送10个探测报文段后仍无TCP客户进程的响应，TCP服务器进程就认为TCP客户进程所在主机出了故障，于是就关闭这个连接。</span></p><p>&nbsp;</p><h3 id='tcp流量控制'><span>TCP流量控制</span></h3><p><span>TCP为应用程序提供了流量控制（Flow Control）机制，以解决因发送方发送数据太快而导致接收方来不及接收，造成接收方的接收缓存溢出的问题。</span></p><p><span>接收方根据接收缓存的可用空间大小控制发送方的发送速率。</span></p><p><span>流量控制的基本方法：接收方根据自己的接收能力（接收缓存的可用空间大小）控制发送方的发送速率。</span></p><p>&nbsp;</p><p><span>假设：</span></p><ul><li><p><span>网络不会拥塞（不考虑TCP的拥塞控制）</span></p></li><li><p><span>在A和B建立TCP连接时，B告诉A：“我的接收窗口rwnd=400”，因此A将自己的发送窗口swnd也设置为400。</span></p></li></ul><p><img src="./库/image-20230521144540565.png" referrerpolicy="no-referrer" alt="image-20230521144540565"></p><p>&nbsp;</p><p><span>为了打破由于非零窗口通知报文段丢失而引起的双方互相等待的死锁局面，TCP为每一个连接都设有一个持续计时器。</span></p><ul><li><p><span>只要TCP连接的一方收到对方的零窗口通知，就启动持续计时器。</span></p></li><li><p><span>当持续计时器超时时，就发送一个零窗口探测报文段，仅携带1字节的数据。</span></p></li><li><p><span>对方在确认这个零窗口探测报文段时，给出自己现在的接收窗口值。</span></p></li><li><p><span>如果接收窗口值仍然是0，那么收到这个报文段的一方就重新启动持续计时器。</span></p></li><li><p><span>如果接收窗口值不是0，那么死锁的局面就可以被打破了。</span></p></li></ul><p><img src="./库/image-20230521144436880.png" referrerpolicy="no-referrer" alt="image-20230521144436880"></p><p>&nbsp;</p><p><span>如果零窗口探测报文段丢失了，还会打破死锁的局面吗？</span></p><p><span>回答是肯定的。因为零窗口探测报文段也有重传计时器， 当重传计时器超时后，零窗口探测报文段会被重传。</span></p><p>&nbsp;</p><h3 id='tcp拥塞控制-2'><span>TCP拥塞控制</span></h3><p><span>在某段时间，若对网络中某一资源的需求超过了该资源所能提供的可用部分，网络性能就要变坏，这种情况就叫作拥塞（congestion）。计算机网络中的链路容量（带宽）、交换节点中的缓存和处理机等都是网络的资源。</span></p><p><span>若出现拥塞而不进行控制，整个网络的吞吐量将随输入负荷的增大而下降。</span></p><p><img src="./库/image-20230521144722128.png" alt="image-20230521144722128" style="zoom:33%;" /></p><p>&nbsp;</p><h4 id='流量控制与拥塞控制的区别'><span>流量控制与拥塞控制的区别</span></h4><h5 id='流量控制-2'><span>流量控制</span></h5><p><img src="./库/image-20230521144811608.png" alt="image-20230521144811608" style="zoom:33%;" /></p><p><span>以接收方的接收能力控制发送方（源点）的发送速率。</span></p><p><span>只与特定的点对点通信的发送方和接收方之间的流量有关。</span></p><p>&nbsp;</p><h5 id='拥塞控制'><span>拥塞控制</span></h5><p><img src="./库/image-20230521144826975.png" alt="image-20230521144826975" style="zoom:50%;" /></p><p><span>防止过多的数据注入到网络中，使网络能够承受现有的网络负荷。</span></p><p><span>源点根据各方面因素，按拥塞控制算法自行控制发送速率。</span></p><p><span>全局性问题，涉及网络中所有的主机、路由器等。</span></p><p>&nbsp;</p><h3 id='tcp的四种拥塞控制方法'><span>TCP的四种拥塞控制方法</span></h3><p><span>为了集中精力讨论拥塞控制算法的基本原理，假定如下条件：</span></p><ul><li><p><span>数据是单方向传送的，而另一个方向只传送确认。</span></p></li><li><p><span>接收方总是有足够大的接收缓存空间，因而发送方的发送窗口的大小仅由网络的拥塞程度来决定，也就是不考虑接收方对发送方的流量控制。</span></p></li><li><p><span>以TCP最大报文段MSS（即TCP报文段的数据载荷部分）的个数作为讨论问题的单位，而不是以字节为单位（尽管TCP是面向字节流的）。</span></p></li></ul><p>&nbsp;</p><p><span>发送窗口swnd</span></p><p><span>拥塞窗口cwnd</span></p><p><span>慢开始门限ssthresh</span></p><p><span>当cwnd &lt; ssthresh时，使用慢开始算法。</span></p><p><span>当cwnd &gt; ssthresh时，停止使用慢开始算法而改用拥塞避免算法。</span></p><p><span>当cwnd = ssthresh时，既可使用慢开始算法，也可使用拥塞避免算法。</span></p><p>&nbsp;</p><h4 id='慢开始'><span>慢开始</span></h4><p><span>（slow-start）</span></p><p><span>cwnd的维护原则：只要网络没有出现拥塞，拥塞窗口就再增大一些，但只要网络出现拥塞，拥塞窗口就减少一些。</span></p><p><span>判断网络出现拥塞的依据：没有按时收到应当到达的TCP确认报文段而产生了超时重传。</span></p><p><span>“慢开始”是指一开始向网络注入的报文段少，而并不是指拥塞窗口cwnd的值增长速度慢。</span></p><p>&nbsp;</p><h4 id='拥塞避免'><span>拥塞避免</span></h4><p><span>（congestion avoidance）</span></p><p><img src="./库/image-20230521145350477.png" referrerpolicy="no-referrer" alt="image-20230521145350477"></p><p><span>“拥塞避免”也并非指完全能够避免拥塞，而是指在拥塞避免阶段将cwnd值控制为按线性规律增长，使网络比较不容易出现拥塞。</span></p><p>&nbsp;</p><h4 id='快重传'><span>快重传</span></h4><p><span>（fast retransmit）</span></p><p><span>重传计时器超时误认为网络出现拥塞将cwnd的值陡然降低为1并错误地启动慢开始算法因而降低了传输效率。或者是IP数据报首部误码被路由器丢弃。</span></p><p>&nbsp;</p><p><span>采用快重传算法可以让发送方尽早知道发生了个别TCP报文段的丢失。</span></p><p><span>“快重传”是指使发送方尽快（尽早）进行重传，而不是等重传计时器超时再重传。</span></p><p><span>这就要求接收方不要等待自己发送数据时才进行捎带确认，而是要立即发送确认，即使收到了失序的报文段也要立即发出对已收到的报文段的重复确认。</span></p><p><span>发送方一旦收到3个连续的重复确认，就将相应的报文段立即重传，而不是等该报文段的重传计时器超时再重传。</span></p><p><img src="./库/image-20230521145546406.png" referrerpolicy="no-referrer" alt="image-20230521145546406"></p><p>&nbsp;</p><p><span>对于个别丢失的报文段，发送方不会出现超时重传，也就不会误认为出现了拥塞而错误地把拥塞窗口cwnd的值减为1。实践证明，使用快重传可以使整个网络的吞吐量提高约20%。</span></p><p>&nbsp;</p><h4 id='快恢复'><span>快恢复</span></h4><p><span>（fast recovery）</span></p><p><span>与快重传算法配合使用的是快恢复算法，发送方一旦收到3个重复确认，就知道现在只是丢失了个别的报文段，于是不启动慢开始算法，而是执行快恢复算法。</span></p><p><span>发送方将慢开始门限ssthresh的值和拥塞窗口cwnd的值都调整为当前cwnd值的一半，并开始执行拥塞避免算法。</span></p><p><span>也有的快恢复实现是把快恢复开始时的cwnd值再增大一些，即cwnd=新ssthresh+3。理由如下：</span></p><ul><li><p><span>既然发送方收到了3个重复的确认，就表明有3个数据报文段已经离开了网络。</span></p></li><li><p><span>这3个报文段不再消耗网络资源而是停留在接收方的接收缓存中。</span></p></li><li><p><span>可见现在网络中不是堆积了报文段而是减少了3个报文段，因此可以适当把cwnd值增大一些。</span></p></li></ul><p><img src="./库/image-20230521145706396.png" referrerpolicy="no-referrer" alt="image-20230521145706396"></p><p>&nbsp;</p><h3 id='tcp可靠传输的实现'><span>TCP可靠传输的实现</span></h3><p><span>TCP的滑动窗口以字节为单位。</span></p><p>&nbsp;</p><p><span>为了简单起见，假定网络不存在拥塞问题，也就是发送方在构造自己的</span><strong><span>发送窗口swnd</span></strong><span>时，仅考虑接收方的</span><strong><span>接收窗口rwnd</span></strong><span>，而不考虑发送方自己的</span><strong><span>拥塞窗口cwnd</span></strong><span>。</span></p><ul><li><p><span>发送方在没有收到接收方确认的情况下，可以把序号落入发送窗口内的数据依次全部发送出去。</span></p></li><li><p><span>凡是已经发送过的数据，在未收到确认之前都必须暂时保留，以便在超时重传时使用。</span></p></li></ul><p>&nbsp;</p><p><span>发送窗口后沿的移动情况：</span></p><ul><li><p><span>不动（没有收到新的确认）</span></p></li><li><p><span>前移（收到新的确认）</span></p></li></ul><p>&nbsp;</p><p><span>发送窗口前沿的移动情况：</span></p><ul><li><p><span>前移（通常情况）</span></p></li><li><p><span>不动</span></p><ul><li><p><span>情况1：没有收到新的确认，接收方通知的窗口大小也没有改变。</span></p></li><li><p><span>情况2：收到了新的确认，但接收方通知的窗口缩小了，使发送窗口的前沿正好不动。</span></p></li></ul></li><li><p><span>向后收缩（接收方通知的窗口变小了）TCP协议强烈反对这样移动</span></p></li></ul><p>&nbsp;</p><p><span>应该如何描述发送窗口的状态呢？换句话说，如果要编程实现滑动窗口机制，那么对于发送窗口的状态应该如何标记和维护呢？</span></p><p><img src="./库/image-20230521153330460.png" alt="image-20230521153330460" style="zoom:33%;" /></p><p><span>使用三个指针P1、P2、P3分别指向相应的字节序号：</span></p><ul><li><p><span>P1指向发送窗口内已发送但还未收到确认的第一个数据的序号。</span></p></li><li><p><span>P2指向发送窗口内还未发送的第一个数据的序号。</span></p></li><li><p><span>P3指向发送窗口前沿外的第一个数据的序号。</span></p></li></ul><p><span>这样就可以用P1、P2和P3这三个指针来描述发送窗口的相关信息:</span></p><ul><li><p><span>小于P1的就是已发送并已收到确认的部分</span></p></li><li><p><span>大于等于P3的就是不允许发送的部分</span></p></li><li><p><span>P3 - P1 = 发送窗口尺寸</span></p></li><li><p><span>P2 - P1 = 已发送但还未收到确认的字节数量</span></p></li><li><p><span>P3 - P2 = 允许发送但当前还未发送的字节数量（又称为可用窗口或有效窗口）</span></p></li></ul><p>&nbsp;</p><p><span>接收方只能对按序收到的数据中的最高序号给出确认。</span></p><p><span>eg：确认报文段ack=34，rwnd=20</span></p><p><span>表明接收方已经收到序号到33为止的全部数据，现在期望收到序号为34的数据。表明接收方自己的接收窗口rwnd的尺寸仍为20字节。</span></p><p><img src="./库/image-20230521153721575.png" alt="image-20230521153721575" style="zoom:33%;" /></p><p>&nbsp;</p><p><span>对于TCP可靠传输的实现，还需要做以下补充说明：</span></p><ol start='' ><li><p><span>虽然发送方的发送窗口是根据接收方的接收窗口设置的，但在同一时刻，发送方的发送窗口并不总是和接收方的接收窗口一样大，这是因为：</span></p><ol start='' ><li><p><span>网络传送窗口值需要经历一定的时间滞后，并且这个时间还是不确定的。</span></p></li><li><p><span>发送方还可能根据网络当时的拥塞情况适当减小自己的发送窗口尺寸。</span></p></li></ol></li><li><p><span>对于不按序到达的数据应如何处理，TCP并无明确规定。</span></p><ol start='' ><li><p><span>如果接收方把不按序到达的数据一律丢弃，那么接收窗口的管理将会比较简单，但这样做对网络资源的利用不利，因为发送方会重复传送较多的数据。</span></p></li><li><p><span>TCP通常对不按序到达的数据先临时存放在接收窗口中，等到字节流中所缺少的字节收到后，再按序交付上层的应用进程。</span></p></li></ol></li><li><p><span>TCP要求接收方必须有累积确认（这一点与选择重传协议不同）和捎带确认机制。这样可以减小传输开销。接收方可以在合适的时候发送确认，也可以在自己有数据要发送时把确认信息顺便捎带上。</span></p><ol start='' ><li><p><span>接收方不应过分推迟发送确认，否则会导致发送方不必要的超时重传，这反而浪费了网络资源。TCP标准规定，确认推迟的时间不应超过0.5秒。若收到一连串具有最大长度的报文段，则必须每隔一个报文段就发送一个确认[RFC 1122]。</span></p></li><li><p><span>捎带确认实际上并不经常发生，因为大多数应用程序很少同时在两个方向上发送数据。</span></p></li></ol></li><li><p><span>TCP的通信是全双工通信。通信中的每一方都在发送和接收报文段。因此，每一方都有自己的发送窗口和接收窗口。在谈到这些窗口时，一定要弄清楚是哪一方的窗口。</span></p></li></ol><p>&nbsp;</p><h3 id='tcp超时重传时间的选择'><span>TCP超时重传时间的选择</span></h3><p><span>TCP超时重传时间RTO的选择是TCP最复杂的问题之一。</span></p><p>&nbsp;</p><p><span>超时重传时间RTO过短，会导致不必要的重传，增大网络负荷。</span></p><p><span>超时重传时间RTO过长，使网络的空闲时间增大，降低了传输效率</span></p><p>&nbsp;</p><p><span>TCP下层是复杂的因特网环境：</span></p><ul><li><p><span>主机A所发送的报文段可能只经过一个高速率的局域网</span></p></li><li><p><span>也可能经过多个低速率的网络</span></p></li><li><p><span>并且每个IP数据报的转发路由还可能不同</span></p></li></ul><p>&nbsp;</p><p><span>不能直接使用略大于某次测量得到的往返时间RTT样本的值作为超时重传时间RTO。</span></p><p><span>但是，可以利用每次测量得到的RTT样本计算加权平均往返时间RTTs，这样可以得到比较平滑的往返时间。显然，超时重传时间RTO的值应略大于加权平均往返时间RTTs的值（而不是某个RTT样本的值）。</span></p><p>&nbsp;</p><p><span>超时重传时间的计算公式：</span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="25.705ex" height="1.967ex" role="img" focusable="false" viewBox="0 -704 11361.6 869.6" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.375ex;"><defs><path id="MJX-4-TEX-I-1D445" d="M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"></path><path id="MJX-4-TEX-I-1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path><path id="MJX-4-TEX-I-1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"></path><path id="MJX-4-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-4-TEX-I-1D446" d="M308 24Q367 24 416 76T466 197Q466 260 414 284Q308 311 278 321T236 341Q176 383 176 462Q176 523 208 573T273 648Q302 673 343 688T407 704H418H425Q521 704 564 640Q565 640 577 653T603 682T623 704Q624 704 627 704T632 705Q645 705 645 698T617 577T585 459T569 456Q549 456 549 465Q549 471 550 475Q550 478 551 494T553 520Q553 554 544 579T526 616T501 641Q465 662 419 662Q362 662 313 616T263 510Q263 480 278 458T319 427Q323 425 389 408T456 390Q490 379 522 342T554 242Q554 216 546 186Q541 164 528 137T492 78T426 18T332 -20Q320 -22 298 -22Q199 -22 144 33L134 44L106 13Q83 -14 78 -18T65 -22Q52 -22 52 -14Q52 -11 110 221Q112 227 130 227H143Q149 221 149 216Q149 214 148 207T144 186T142 153Q144 114 160 87T203 47T255 29T308 24Z"></path><path id="MJX-4-TEX-N-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path><path id="MJX-4-TEX-N-34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path id="MJX-4-TEX-I-D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path><path id="MJX-4-TEX-I-1D437" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D445" xlink:href="#MJX-4-TEX-I-1D445"></use></g><g data-mml-node="mi" transform="translate(759,0)"><use data-c="1D447" xlink:href="#MJX-4-TEX-I-1D447"></use></g><g data-mml-node="mi" transform="translate(1463,0)"><use data-c="1D442" xlink:href="#MJX-4-TEX-I-1D442"></use></g><g data-mml-node="mo" transform="translate(2503.8,0)"><use data-c="3D" xlink:href="#MJX-4-TEX-N-3D"></use></g><g data-mml-node="mi" transform="translate(3559.6,0)"><use data-c="1D445" xlink:href="#MJX-4-TEX-I-1D445"></use></g><g data-mml-node="mi" transform="translate(4318.6,0)"><use data-c="1D447" xlink:href="#MJX-4-TEX-I-1D447"></use></g><g data-mml-node="msub" transform="translate(5022.6,0)"><g data-mml-node="mi"><use data-c="1D447" xlink:href="#MJX-4-TEX-I-1D447"></use></g><g data-mml-node="mi" transform="translate(617,-150) scale(0.707)"><use data-c="1D446" xlink:href="#MJX-4-TEX-I-1D446"></use></g></g><g data-mml-node="mo" transform="translate(6367.9,0)"><use data-c="2B" xlink:href="#MJX-4-TEX-N-2B"></use></g><g data-mml-node="mn" transform="translate(7368.1,0)"><use data-c="34" xlink:href="#MJX-4-TEX-N-34"></use></g><g data-mml-node="mi" transform="translate(7868.1,0)"><use data-c="D7" xlink:href="#MJX-4-TEX-I-D7"></use></g><g data-mml-node="mi" transform="translate(8646.1,0)"><use data-c="1D445" xlink:href="#MJX-4-TEX-I-1D445"></use></g><g data-mml-node="mi" transform="translate(9405.1,0)"><use data-c="1D447" xlink:href="#MJX-4-TEX-I-1D447"></use></g><g data-mml-node="msub" transform="translate(10109.1,0)"><g data-mml-node="mi"><use data-c="1D447" xlink:href="#MJX-4-TEX-I-1D447"></use></g><g data-mml-node="mi" transform="translate(617,-150) scale(0.707)"><use data-c="1D437" xlink:href="#MJX-4-TEX-I-1D437"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>R</mi><mi>T</mi><mi>O</mi><mo>=</mo><mi>R</mi><mi>T</mi><msub><mi>T</mi><mi>S</mi></msub><mo>+</mo><mn>4</mn><mi>×</mi><mi>R</mi><mi>T</mi><msub><mi>T</mi><mi>D</mi></msub></math></mjx-assistive-mml></mjx-container><script type="math/tex">RTO = RTT_S  + 4 × RTT_D  </script></p><p><img src="./库/image-20230521170756012.png" referrerpolicy="no-referrer" alt="image-20230521170756012"></p><p>&nbsp;</p><p><span>往返时间RTT的测量是比较复杂的。</span></p><p><span>当发送方出现超时重传后，收到确认报文段时是无法判断出该确认到底是对原数据报文段的确认还是对重传数据报文段的确认，也就是无法准确测量出RTT，进而无法正确计算RTO。</span></p><p><span>报文段每重传一次，就把RTO增大一些。典型的做法是将新RTO的值取为旧RTO的2倍。 </span></p><p>&nbsp;</p><h3 id='tcp的选择确认'><span>TCP的选择确认</span></h3><p><span>在之前介绍TCP的快重传和可靠传输时，TCP接收方只能对按序收到的数据中的最高序号给出确认。当发送方超时重传时，接收方之前已收到的未按序到达的数据也会被重传。</span></p><p><span>能否设法只传送缺少的数据而不重传已经正确到达、只是未按序到达的数据呢？</span></p><p><span>TCP可以使用选择确认（Selective ACK，</span><strong><span>SACK</span></strong><span>）[RFC 2018]（建议标准）</span></p><p><img src="./库/image-20230521171429097.png" alt="image-20230521171429097" style="zoom:33%;" /></p><p><img src="./库/image-20230521171454347.png" referrerpolicy="no-referrer" alt="image-20230521171454347"></p><p>&nbsp;</p><p><span>SACK相关文档并没有指明发送方应当怎样响应SACK。因此大多数的TCP实现还是重传所有未被确认的数据块。</span></p><p>&nbsp;</p><h1 id='第六章'><span>第六章</span></h1><h2 id='应用层概述'><span>应用层概述</span></h2><ul><li><p><span>应用层：解决通过应用进程的交互来实现特定网络应用的问题</span></p></li><li><p><span>运输层：解决进程之间基于网络通信的问题</span></p></li><li><p><span>网络层：解决分组在多个网络上传输（路由）的问题</span></p></li><li><p><span>链路层：解决分组在一个网络（或一段链路）上传输的问题</span></p></li><li><p><span>物理层：解决使用何种信号来传输比特的问题</span></p></li></ul><p>&nbsp;</p><p><span>应用层是计算机网络体系结构的最顶层，是设计和建立计算机网络的最终目的，也是计算机网络中发展最快的部分。</span></p><ul><li><p><span>早期基于文本的应用（电子邮件、远程登录、文件传输、新闻组）</span></p></li><li><p><span>20世纪90年代将因特网带入千家万户的万维网WWW</span></p></li><li><p><span>当今流行的即时通信、P2P文件共享及各种音视频应用</span></p></li><li><p><span>计算设备的小型化和“无处不在”，宽带住宅接入和无线接入的日益普及和迅速发展，为未来更多的新型应用提供了广阔的舞台</span></p></li></ul><p>&nbsp;</p><p><span>在本章中，我们以一些经典的网络应用为例来学习有关网络应用的原理、协议和实现方面的知识。</span></p><p>&nbsp;</p><h2 id='客户服务器方式和对等方式'><span>客户/服务器方式和对等方式</span></h2><p><span>网络应用程序运行在处于网络边缘的不同的端系统上，通过彼此间的通信来共同完成某项任务。</span></p><p><span>开发一种新的网络应用，首先要考虑的问题就是网络应用程序在各种端系统上的组织方式和它们之间的关系。目前流行的主要有以下两种：</span></p><ul><li><p><span>客户/服务器（Client/Server，C/S）方式</span></p></li><li><p><span>对等（Peer-to-Peer，P2P）方式</span></p></li></ul><p>&nbsp;</p><h3 id='cs客户服务器方式'><span>CS客户服务器方式</span></h3><ul><li><p><span>客户和服务器是指通信中所涉及的两个应用进程。</span></p></li><li><p><span>客户/服务器方式所描述的是进程之间服务和被服务的关系。</span></p></li><li><p><span>客户是服务请求方，服务器是服务提供方。</span></p></li><li><p><span>服务器总是处于运行状态，并等待客户的服务请求。</span></p></li></ul><p><span>服务器具有固定端口号（例如HTTP服务器的默认端口号为80），而运行服务器的主机也具有固定的IP地址。</span></p><p>&nbsp;</p><p><span>C/S方式是因特网上传统的、同时也是最成熟的方式，很多我们熟悉的网络应用采用的都是C/S方式。包括万维网WWW、电子邮件、文件传输FTP等。</span></p><p><span>基于C/S方式的应用服务通常是</span><strong><span>服务集中型</span></strong><span>的，即应用服务集中在网络中比客户计算机少得多的服务器计算机上。</span></p><ul><li><p><span>由于一台服务器计算机要为多个客户机提供服务，在C/S应用中，常会出现服务器计算机跟不上众多客户机请求的情况。</span></p></li><li><p><span>为此，在C/S应用中，常用计算机群集（或服务器场）构建一个强大的虚拟服务器。</span></p></li></ul><p>&nbsp;</p><h3 id='p2p对等方式'><span>P2P对等方式</span></h3><p><span>在P2P方式中，</span><strong><span>没有固定的服务请求者和服务提供者</span></strong><span>，分布在网络边缘各端系统中的应用进程是对等的，被称为对等方。对等方相互之间直接通信，</span><strong><span>每个对等方既是服务的请求者，又是服务的提供者</span></strong><span>。</span></p><p><span>目前，在因特网上流行的P2P应用主要包括P2P文件共享、即时通信、P2P流媒体、分布式存储等。</span></p><p><span>基于P2P的应用是</span><strong><span>服务分散型</span></strong><span>的，因为服务不是集中在少数几个服务器计算机中，而是分散在大量对等计算机中，这些计算机并不为服务提供商所有，而是为个人控制的桌面计算机和笔记本电脑，它们通常位于住宅、校园和办公室中。</span></p><p><span>P2P方式的最突出特性之一就是它的</span><strong><span>可扩展性</span></strong><span>。因为系统每增加一个对等方，不仅增加的是服务的请求者，同时也增加了服务的提供者，系统性能不会因规模的增大而降低。</span></p><p><span>P2P方式具有成本上的优势，因为它通常不需要庞大的服务器设置和服务器带宽。为了降低成本，服务提供商对于将P2P方式用于应用的兴趣越来越大。</span></p><p>&nbsp;</p><h2 id='动态主机配置协议dhcp'><span>动态主机配置协议DHCP</span></h2><p><span>如何配置用户主机，才能使用户主机正常访问Web服务器？</span></p><p><span>动态主机配置协议DHCP可为计算机自动配置网络参数，使得计算机“即插即联网”（Plug-and-Play Networking）。DHCP目前是因特网草案标准[RFC 2131，RFC 2132]。</span></p><p><span>DHCP服务器可为局域网中各主机配置以下参数：</span></p><ul><li><p><span>IP地址：192.168.0.1~192.168.0.251</span></p></li><li><p><span>子网掩码：255.255.255.0</span></p></li><li><p><span>默认网关：192.168.0.254</span></p></li><li><p><span>DNS服务器：192.168.0.253</span></p></li></ul><p>&nbsp;</p><p><span>动态主机配置协议DHCP的基本工作过程：</span></p><p><img src="./库/image-20230522171522035.png" referrerpolicy="no-referrer" alt="image-20230522171522035"></p><p>&nbsp;</p><ul><li><p><span>DISCOVER</span></p><ul><li><p><span>事务ID</span></p></li><li><p><span>DHCP客户端的MAC地址</span></p></li></ul></li><li><p><span>OFFER</span></p><ul><li><p><span>事务ID</span></p></li><li><p><span>配置信息：</span></p><ul><li><p><span>IP地址——使用ARP确保所选IP地址未被网络中其他主机占用</span></p></li><li><p><span>子网掩码</span></p></li><li><p><span>地址租期</span></p></li><li><p><span>默认网关</span></p></li><li><p><span>DNS服务器</span></p></li></ul></li></ul></li><li><p><span>REQUEST</span></p><ul><li><p><span>事务ID</span></p></li><li><p><span>DHCP客户端的MAC地址</span></p></li><li><p><span>接受的租约中的IP地址</span></p></li><li><p><span>提供此租约的DHCP服务器端的IP地址</span></p></li></ul></li><li><p><span>ACK</span></p><ul><li><p><span>使用ARP检测所分配到的IP地址是否已被网络中其他主机占用：</span></p><ul><li><p><span>若是，则发送DHCP谢绝报文，并重新发送DHCP发现报文</span></p></li><li><p><span>否则，可以使用租约中的IP地址与网络中其他主机通信了</span></p></li></ul></li></ul></li></ul><p>&nbsp;</p><blockquote><p><span>动态主机配置协议（Dynamic Host Configuration Protocol，简称DHCP）是一种网络协议，用于自动分配IP地址、子网掩码、默认网关和其他网络配置信息给网络中的设备。下面是DHCP的详细工作过程：</span></p><ol start='' ><li><p><span>DHCP发现：当设备连接到网络时，它会发送一个DHCP发现广播消息，以查找可用的DHCP服务器。该广播消息被发送到本地网络中的所有设备。</span></p></li><li><p><span>DHCP提供：在收到DHCP发现广播消息的DHCP服务器会做出响应。它们将发送一个DHCP提供消息，其中包含可用的IP地址、租约时间以及其他配置信息。通常情况下，多个DHCP服务器可能会发送提供消息。</span></p></li><li><p><span>DHCP请求：设备在接收到一个或多个DHCP提供消息后，选择其中一个DHCP服务器，并向其发送一个DHCP请求消息，以确认接受该服务器提供的配置信息。</span></p></li><li><p><span>DHCP确认：选定的DHCP服务器收到DHCP请求消息后，会向设备发送一个DHCP确认消息，确认设备已经成功获得了IP地址和其他配置信息。此确认消息还包含其他网络配置参数，如默认网关、DNS服务器和租约时间等。</span></p></li><li><p><span>IP地址绑定：在DHCP确认之后，设备与DHCP服务器之间建立了一个租约，该租约指定了设备可以使用IP地址的时间段。DHCP服务器会将设备的MAC地址与分配给它的IP地址进行绑定，以便在租约到期之前保持一致性。</span></p></li><li><p><span>更新与续约：设备使用分配的IP地址进行网络通信。在租约即将到期之前，设备可以选择续约来延长租约时间，或者重新执行DHCP过程以获取新的IP地址和配置信息。</span></p></li><li><p><span>租约释放：当设备不再需要分配的IP地址时，或者断开与网络的连接，它会发送一个DHCP释放消息给DHCP服务器，以释放已分配的IP地址。</span></p></li></ol><p><span>总的来说，DHCP的工作过程包括设备发现、DHCP服务器提供配置信息、设备请求并确认配置信息、绑定IP地址与设备的MAC地址、续约或重新执行DHCP过程，以及释放不再使用的IP地址。通过使用DHCP，网络管理员可以更方便地管理和分配IP地址，并确保网络设备能够有效地获得正确的网络配置。</span></p></blockquote><p>&nbsp;</p><p><span>DHCP中继代理：</span></p><p><img src="./库/image-20230522171804162.png" alt="image-20230522171804162" style="zoom:33%;" /></p><p>&nbsp;</p><p>&nbsp;</p><h2 id='域名系统'><span>域名系统</span></h2><h3 id='域名系统的作用'><span>域名系统的作用</span></h3><p><span>因特网是否可以只使用一台DNS服务器？</span></p><p><span>这种做法并不可取。因为因特网的规模很大，这样的域名服务器肯定会因为超负荷而无法正常工作，而且一旦域名服务器出现故障，整个因特网就会瘫痪。</span></p><p><span>早在1983年，因特网就开始采用层次结构的命名树作为主机的名字（即域名），并使用分布式的域名系统DNS。</span></p><p><span>DNS使大多数域名都在本地解析，仅少量解析需要在因特网上通信，因此系统效率很高。</span></p><p><span>由于DNS是分布式系统，即使单个计算机出了故障，也不会妨碍整个系统的正常运行。</span></p><p>&nbsp;</p><blockquote><p><span>域名系统（Domain Name System，简称DNS）是互联网中用于将域名转换为 IP 地址的系统。它充当了互联网上的“电话簿”，为用户提供了方便的方式来访问网站、发送电子邮件和进行其他互联网服务。</span></p><p><span>以下是域名系统的一些主要作用：</span></p><ol start='' ><li><p><span>域名解析：域名系统的主要作用是将易于记忆的域名转换为计算机可识别的 IP 地址。当用户在浏览器中输入一个域名时，域名系统将负责解析该域名并返回与之对应的 IP 地址，使用户能够访问所需的网站。</span></p></li><li><p><span>IP 地址管理：域名系统还负责管理 IP 地址的分配和映射。它将域名与相应的 IP 地址相关联，并确保每个域名都具有唯一的 IP 地址。这样，当用户请求一个域名时，域名系统可以迅速地提供与之对应的 IP 地址。</span></p></li><li><p><span>负载均衡：域名系统可以用于实现负载均衡。当一个域名对应多个服务器时，域名系统可以根据不同的算法和策略将用户的请求分发到不同的服务器上，以平衡服务器的负载，提高系统的性能和可用性。</span></p></li><li><p><span>邮件路由：域名系统在电子邮件传递中也起到了重要的作用。它帮助确定电子邮件服务器的位置，确保电子邮件能够正确地路由到目标服务器，并被发送到正确的收件人。</span></p></li></ol><p><span>总之，域名系统是互联网中至关重要的基础设施，它使得用户可以使用易于记忆的域名来访问网站和其他网络服务，而无需记住复杂的 IP 地址。它简化了互联网的使用，并提供了许多重要的功能，包括域名解析、IP 地址管理、负载均衡和邮件路由。</span></p></blockquote><p>&nbsp;</p><h3 id='因特网的域名结构'><span>因特网的域名结构</span></h3><p><span>因特网采用层次树状结构的域名结构。</span></p><p><span>域名的结构由若干个分量组成，各分量之间用“点”隔开，分别代表不同级别的域名。</span></p><p><code>… .三级域名.二级域名.顶级域名</code></p><ul><li><p><span>每一级的域名都由英文字母和数字组成，不超过63个字符，不区分大小写字母。</span></p></li><li><p><span>级别最低的域名写在最左边，而级别最高的顶级域名写在最右边。</span></p></li><li><p><span>完整的域名不超过255个字符。</span></p></li></ul><p><span>域名系统既不规定一个域名需要包含多少个下级域名，也不规定每一级的域名代表什么意思。</span></p><p><span>各级域名由其上一级的域名管理机构管理，而最高的顶级域名则由因特网名称与数字地址分配机构ICANN进行管理。</span></p><p><span>【举例】湖南科技大学网络信息中心的域名</span></p><p><code>nic.hnust.edu.cn</code></p><p>&nbsp;</p><p><span>顶级域名（Top Level Domain，TLD）分为以下三类：</span></p><ul><li><p><span>国家顶级域名nTLD：采用ISO 3166的规定。如cn表示中国，us表示美国，uk表示英国、等等。</span></p></li><li><p><span>通用顶级域名gTLD：最常见的通用顶级域名有七个，即：com（公司企业）、net（网络服务机构）、org（非营利性组织）、int（国际组织）、edu（美国教育机构）、gov（美国政府部门）、mil（美国军事部门）。</span></p></li><li><p><span>反向域arpa：用于反向域名解析，即IP地址反向解析为域名。</span></p></li></ul><p>&nbsp;</p><p><span>在国家顶级域名下注册的二级域名均由该国家自行确定。例如，顶级域名为jp的日本，将其教育和企业机构的二级域名定为ac和co，而不用edu和com。</span></p><p><span>我国则将二级域名划分为以下两类：</span></p><ul><li><p><span>类别域名：共七个：ac（科研机构）、com（工、商、金融等企业）、edu（教育机构）、gov（政府部门）、net（提供网络服务的机构）、mil（军事机构）和org（非营利性组织）。</span></p></li><li><p><span>行政区域名：共34个，适用于我国的各省、自治区、直辖市。例如：bj为北京市、sh为上海市、js为江苏省，等等。</span></p></li></ul><p>&nbsp;</p><p><span>【举例】因特网的域名空间</span></p><p><img src="./库/image-20230522173538213.png" alt="image-20230522173538213" style="zoom:33%;" /></p><p><span>这种按等级管理的命名方法便于维护名字的唯一性，并且也容易设计出一种高效的域名查询机制。需要注意的是，域名只是个逻辑概念，并不代表计算机所在的物理地点。</span></p><p>&nbsp;</p><h3 id='因特网上的域名服务器'><span>因特网上的域名服务器</span></h3><p><span>域名和IP地址的映射关系必须保存在域名服务器中，供所有其他应用查询。显然不能将所有信息都储存在一台域名服务器中。DNS使用分布在各地的域名服务器来实现域名到IP地址的转换。</span></p><p>&nbsp;</p><h4 id='根域名服务器'><span>根域名服务器</span></h4><p><span>根域名服务器是最高层次的域名服务器。</span></p><p><span>每个根域名服务器都知道所有的顶级域名服务器的域名及其IP地址。</span></p><p><span>尽管我们将这13个根域名服务器中的每一个都视为单个的服务器，但“每台服务器”实际上是由许多分布在世界各地的计算机构成的服务器群集。</span></p><ul><li><p><span>当本地域名服务器向根域名服务器发出查询请求时，路由器就把查询请求报文转发到离这个DNS客户最近的一个根域名服务器。</span></p></li><li><p><span>这就加快了DNS的查询过程，同时也更合理地利用了因特网的资源。根域名服务器通常并不直接对域名进行解析，而是返回该域名所属顶级域名的顶级域名服务器的IP地址。</span></p></li></ul><p>&nbsp;</p><h4 id='顶级域名服务器'><span>顶级域名服务器</span></h4><p><span>顶级域名服务器负责管理在该顶级域名服务器注册的所有二级域名。</span></p><p><span>当收到DNS查询请求时就给出相应的回答，可能是最后的结果，也可能是下一级权限域名服务器的IP地址。</span></p><p>&nbsp;</p><h4 id='权限域名服务器'><span>权限域名服务器</span></h4><p><span>权限域名服务器负责管理某个区的域名。</span></p><p><span>每一个主机的域名都必须在某个权限域名服务器处注册登记。因此权限域名服务器知道其管辖的域名与IP地址的映射关系。</span></p><p><span>另外，权限域名服务器还知道其下级域名服务器的地址。</span></p><p>&nbsp;</p><h4 id='本地域名服务器'><span>本地域名服务器</span></h4><p><strong><span>本地域名服务器不属于上述的域名服务器的等级结构。</span></strong></p><p><span>当一个主机发出DNS请求报文时，这个报文就首先被送往该主机的本地域名服务器。</span></p><p><span>本地域名服务器起着代理的作用，会将该报文转发到上述的域名服务器的等级结构中。</span></p><p><span>每一个因特网服务提供者ISP，一个大学，甚至一个大学里的学院，都可以拥有一个本地域名服务器，它有时也称为默认域名服务器。</span></p><p><span>本地域名服务器离用户较近，一般不超过几个路由器的距离，也有可能就在同一个局域网中。本地域名服务器的IP地址需要直接配置在需要域名解析的主机中。</span></p><p>&nbsp;</p><h3 id='因特网的域名解析过程'><span>因特网的域名解析过程</span></h3><ul><li><p><span>递归查询</span></p></li><li><p><span>迭代查询</span></p></li></ul><p><img src="./库/image-20230522173920876.png" referrerpolicy="no-referrer" alt="image-20230522173920876"></p><p>&nbsp;</p><p><span>由于递归查询对于被查询的域名服务器负担太大，通常采用以下模式：从请求主机到本地域名服务器的查询是递归查询，而其余的查询是迭代查询。</span></p><p>&nbsp;</p><p><span>为了提高DNS的查询效率，并减轻根域名服务器的负荷和减少因特网上的DNS查询报文数量，在域名服务器中广泛地使用了高速缓存。高速缓存用来存放最近查询过的域名以及从何处获得域名映射信息的记录。</span></p><p><img src="./库/image-20230522174204346.png" alt="image-20230522174204346" style="zoom:33%;" /></p><p><span>由于域名到IP地址的映射关系并不是永久不变，为保持高速缓存中的内容正确，域名服务器应为每项内容设置计时器并删除超过合理时间的项（例如，每个项目只存放两天）。</span></p><p><span>不但在本地域名服务器中需要高速缓存，在用户主机中也很需要。许多用户主机在启动时从本地域名服务器下载域名和IP地址的全部数据库，维护存放自己最近使用的域名的高速缓存，并且只在从缓存中找不到域名时才向域名服务器查询。同理，主机也需要保持高速缓存中内容的正确性。</span></p><p>&nbsp;</p><p><img src="./库/image-20230522174250643.png" referrerpolicy="no-referrer" alt="image-20230522174250643"></p><p>&nbsp;</p><h2 id='文件传输协议ftp'><span>文件传输协议FTP</span></h2><h3 id='ftp的作用'><span>FTP的作用</span></h3><p><span>将某台计算机中的文件通过网络传送到可能相距很远的另一台计算机中，是一项基本的网络应用，即文件传送。文件传送协议（File Transfer Protocol，FTP）是因特网上使用得最广泛的文件传送协议。</span></p><p><span>FTP提供交互式的访问，允许客户指明文件的类型与格式（如指明是否使用ASCII码），并允许文件具有存取权限（如访问文件的用户必须经过授权，并输入有效的口令）。</span>
<span>FTP屏蔽了各计算机系统的细节，因而适合于在异构网络中任意计算机之间传送文件。</span></p><p><span>在因特网发展的早期阶段，用FTP传送文件约占整个因特网的通信量的三分之一，而由电子邮件和域名系统所产生的通信量还要小于FTP所产生的通信量。只是到了1995年，万维网WWW的通信量才首次超过了FTP。</span></p><p>&nbsp;</p><p><span>【举例】文件传送协议FTP的应用</span></p><p><span>根据应用需求的不同，FTP服务器可能需要一台高性能和高可靠性的服务器计算机，也可能只需要一台普通的个人计算机即可。在windows系统中添加了一个FTP站点（FTP服务器），具体方法比较简单，请同学们在网上自行查阅。</span></p><p>&nbsp;</p><p><span>FTP的常见用途是在计算机之间传输文件，尤其是用于批量传输文件。</span>
<span>FTP的另一个常见用途是让网站设计者将构成网站内容的大量文件批量上传到他们的Web服务器。</span></p><p>&nbsp;</p><h3 id='ftp的基本工作原理'><span>FTP的基本工作原理</span></h3><h4 id='主动模式'><span>主动模式</span></h4><p><span>主动模式（建立数据通道时，FTP服务器主动连接FTP客户）</span></p><p><img src="./库/image-20230522200524470.png" alt="image-20230522200524470" style="zoom:33%;" /></p><p>&nbsp;</p><h4 id='被动模式'><span>被动模式</span></h4><p><img src="./库/image-20230522200542534.png" alt="image-20230522200542534" style="zoom:33%;" /></p><p>&nbsp;</p><p><span>FTP客户和服务器之间要建立以下两个并行的TCP连接：</span></p><p><span>一个是控制连接，在整个会话期间一直保持打开，用于传送FTP相关控制命令。</span></p><p><span>另一个是数据连接，用于文件传输，在每次文件传输时才建立，传输结束就关闭。</span></p><p>&nbsp;</p><p><span>FTP客户和服务器之间要建立“控制连接”和“数据连接”这两个并行的TCP连接。控制连接在整个会话期间都保持打开状态，而数据连接在每次文件传输时才建立，传输结束就关闭。</span></p><p><span>默认情况下，FTP使用TCP 21端口进行控制连接，TCP 20端口进行数据连接。</span></p><p><span>但是，是否使用TCP 20端口建立数据连接与传输模式有关，主动方式使用TCP 20端口，被动方式由服务器和客户端自行协商决定。</span></p><p>&nbsp;</p><h2 id='电子邮件'><span>电子邮件</span></h2><h3 id='电子邮件的作用'><span>电子邮件的作用</span></h3><p><span>电子邮件E-mail是因特网上最早流行的一种应用，并且仍然是当今因特网上最重要、最实用的应用之一。</span></p><p>&nbsp;</p><p><span>发件人将邮件发送到自己使用的邮件服务器；</span></p><p><span>发件人的邮件服务器将收到的邮件按其目的地址转发到收件人邮件服务器中的收件人邮箱；</span></p><p><span>收件人在方便的时候访问收件人邮件服务器中自己的邮箱，获取收到的电子邮件。</span></p><p>&nbsp;</p><p><span>电子邮件使用方便、传递迅速而且费用低廉。它不仅可以传送文字信息，而且还可附上声音和图像。</span></p><p>&nbsp;</p><h3 id='电子邮件系统的组成'><span>电子邮件系统的组成</span></h3><p><span>电子邮件系统采用客户/服务器方式。</span></p><p><span>电子邮件系统的三个主要组成构件：用户代理，邮件服务器，以及电子邮件所需的协议。</span></p><ul><li><p><span>用户代理是用户与电子邮件系统的接口，又称为电子邮件客户端软件。</span></p></li><li><p><span>邮件服务器是电子邮件系统的基础设施。因特网上所有的因特网服务提供者ISP都有邮件服务器，其功能是发送和接收邮件，同时还要负责维护用户的邮箱。</span></p></li><li><p><span>协议包括邮件发送协议（例如SMTP）和邮件读取协议（例如POP3，IMAP）。</span></p></li></ul><p>&nbsp;</p><p><img src="./库/image-20230522201949353.png" referrerpolicy="no-referrer" alt="image-20230522201949353"></p><p>&nbsp;</p><h3 id='简单邮件传送协议smtp的基本工作过程'><span>简单邮件传送协议SMTP的基本工作过程</span></h3><p><span>简单邮件传送协议（Simple Mail Transfer Protocol，SMTP）的基本工作过程</span></p><p><img src="./库/image-20230522202933507.png" referrerpolicy="no-referrer" alt="image-20230522202933507"></p><p>&nbsp;</p><p><span>注意：</span></p><ul><li><p><span>为了简单起见，省略了认证过程；</span></p></li><li><p><span>应答代码后面一般都跟有简单的描述信息；</span></p></li><li><p><span>不同的SMTP服务器给出的相同应答代码的描述信息可能不同。</span></p></li></ul><p>&nbsp;</p><h3 id='电子邮件的信息格式'><span>电子邮件的信息格式</span></h3><p><span>电子邮件的信息格式并不是由SMTP定义的，而是在[RFC 822]中单独定义的。这个RFC文档已在2008年更新为[RFC 5322]。一个电子邮件有信封和内容两部分。而内容又由首部和主体两部分构成。</span></p><p>&nbsp;</p><p>&nbsp;</p><h3 id='多用途因特网邮件扩展'><span>多用途因特网邮件扩展</span></h3><p><span>SMTP协议只能传送ASCII码文本数据，不能传送可执行文件或其他的二进制对象。</span></p><p><span>SMTP不能满足传送多媒体邮件（例如带有图片、音频或视频数据）的需要。并且许多其他非英语国家的文字（例如中文、俄文、甚至带有重音符号的法文或德文）也无法用SMTP传送。</span></p><p><span>为解决SMTP传送非ASCII码文本的问题，提出了多用途因特网邮件扩展 (Multipurpose Internet Mail Extensions，MIME)。</span></p><ul><li><p><span>增加了5个新的邮件首部字段，这些字段提供了有关邮件主体的信息。</span></p></li><li><p><span>定义了许多邮件内容的格式，对多媒体电子邮件的表示方法进行了标准化。</span></p></li><li><p><span>定义了传送编码，可对任何内容格式进行转换，而不会被邮件系统改变。</span></p></li></ul><p><span>实际上，MIME不仅仅用于SMTP，也用于后来的同样面向ASCII字符的HTTP。</span></p><p><img src="./库/image-20230522203024351.png" alt="image-20230522203024351" style="zoom:25%;" /></p><p>&nbsp;</p><h3 id='常用的邮件读取协议'><span>常用的邮件读取协议</span></h3><h4 id='邮局协议'><span>邮局协议</span></h4><p><span>（Post Office Protocol，</span><strong><span>POP</span></strong><span>）</span></p><p><span>POP3是其第三个版本，是因特网正式标准。</span></p><p><span>非常简单、功能有限的邮件读取协议。</span></p><p><span>用户只能以</span><strong><span>下载并删除</span></strong><span>方式或</span><strong><span>下载并保留</span></strong><span>方式从邮件服务器下载邮件到用户方计算机。</span></p><p><span>不允许用户在邮件服务器上管理自己的邮件。（例如创建文件夹，对邮件进行分类管理等）。</span></p><p><span>端口号为110</span></p><p>&nbsp;</p><h4 id='因特网邮件访问协议'><span>因特网邮件访问协议</span></h4><p><span>因特网邮件访问协议</span>
<span>（Internet Message Access Protocol，</span><strong><span>IMAP</span></strong><span>）</span></p><p><span>IMAP4是其第四个版本，是因特网建议标准。</span></p><p><span>功能比POP3强大的邮件读取协议。</span></p><p><span>用户在自己的计算机上就可以操控邮件服务器中的邮箱，就像在本地操控一样，因此IMAP是一个联机协议。</span></p><p><span>端口号为143</span></p><p>&nbsp;</p><p><strong><span>POP3和IMAP4都采用基于TCP连接的客户/服务器方式</span></strong></p><p>&nbsp;</p><h3 id='基于万维网的电子邮件'><span>基于万维网的电子邮件</span></h3><p><span>通过浏览器登录（提供用户名和口令）邮件服务器万维网网站就可以撰写、收发、阅读和管理电子邮件。这种工作模式与IMAP很类似，不同的是用户计算机无需安装专门的用户代理程序，只需要使用通用的万维网浏览器。</span></p><p><span>邮件服务器网站通常都提供非常强大和方便的邮件管理功能，用户可以在邮件服务器网站上管理和处理自己的邮件，而不需要将邮件下载到本地进行管理。</span></p><p><img src="./库/image-20230522203840930.png" alt="image-20230522203840930" style="zoom: 25%;" /></p><p>&nbsp;</p><h2 id='万维网www'><span>万维网WWW</span></h2><h3 id='万维网概述'><span>万维网概述</span></h3><p><span>万维网（World Wide Web，WWW）并非某种特殊的计算机网络。它是一个大规模的、联机式的信息储藏所，是运行在因特网上的一个分布式应用。</span></p><p><span>万维网利用网页之间的超链接将不同网站的网页链接成一张逻辑上的信息网。</span></p><p><span>万维网是欧洲粒子物理实验室的Tim Berners-Lee最初于1989年3月提出的。</span></p><p>&nbsp;</p><p><span>目前比较流行的浏览器如下：</span></p><ul><li><p><span>chrome</span></p></li><li><p><span>Firefox</span></p></li><li><p><span>IE</span></p></li></ul><p>&nbsp;</p><p><span>浏览器最重要的部分是渲染引擎，也就是浏览器内核。负责对网页内容进行解析和显示。</span></p><p><span>不同的浏览器内核对网页内容的解析也有不同，因此同一网页在不同内核的浏览器里的显示效果可能不同；网页编写者需要在不同内核的浏览器中测试网页显示效果。</span></p><p>&nbsp;</p><h3 id='统一资源定位符'><span>统一资源定位符</span></h3><p><span>为了方便地访问在世界范围的文档，万维网使用统一资源定位符URL来指明因特网上任何种类“资源”的位置。</span></p><p><span>URL的一般形式由以下四个部分组成：</span><code>&lt;协议&gt;://&lt;主机&gt;:&lt;端口&gt;/&lt;路径&gt;</code></p><p><code>http://www.hnust.cn:80/ggtz/119945.html</code></p><p>&nbsp;</p><h3 id='万维网文档'><span>万维网文档</span></h3><p><span>HTML：超文本标记语言HTML(HyperText Markup Language，HTML)，使用多种“标签”来描述网页的结构和内容</span></p><p><span>CSS：层叠样式表CSS(Cascading Style Sheets，CSS)，从审美的角度来描述网页的样式</span></p><p><span>JavaScript：一种脚本语言（和Java没有任何关系）控制网页的行为</span></p><h3 id='超文本传输协议http'><span>超文本传输协议HTTP</span></h3><p><span>HTTP定义了浏览器（即万维网客户进程）怎样向万维网服务器请求万维网文档，以及万维网服务器怎样把万维网文档传送给浏览器。</span></p><p>&nbsp;</p><h4 id='http10和http11'><span>HTTP1.0和HTTP1.1</span></h4><p><strong><span>HTTP/1.0</span></strong><span>采用</span><strong><span>非持续连接</span></strong><span>方式。在该方式下，每次浏览器要请求一个文件都要与服务器建立TCP连接，当收到响应后就立即关闭连接。</span></p><p><span>每请求一个文档就要有两倍的RTT的开销。若一个网页上有很多引用对象（例如图片等），那么请求每一个对象都需要花费2RTT的时间。</span></p><p><span>为了减小时延，浏览器通常会建立多个并行的TCP连接同时请求多个对象。但是，这会大量占用万维网服务器的资源，特别是万维网服务器往往要同时服务于大量客户的请求，这会使其负担很重。</span></p><p><img src="./库/image-20230522211739945.png" alt="image-20230522211739945" style="zoom:33%;" /></p><p>&nbsp;</p><p><strong><span>HTTP/1.1</span></strong><span>采用</span><strong><span>持续连接</span></strong><span>方式。在该方式下，万维网服务器在发送响应后仍然保持这条连接，使同一个客户（浏览器）和该服务器可以继续在这条连接上传送后续的HTTP请求报文和响应报文。这并不局限于传送同一个页面上引用的对象，而是只要这些文档都在同一个服务器上就行。</span></p><p><span>为了进一步提高效率，HTTP/1.1的持续连接还可以使用流水线方式工作，即浏览器在收到HTTP的响应报文之前就能够连续发送多个请求报文。这样的一个接一个的请求报文到达服务器后，服务器就发回一个接一个的响应报文。这样就节省了很多个RTT时间，使TCP连接中的空闲时间减少，提高了下载文档的效率。</span></p><p>&nbsp;</p><h4 id='http的报文格式'><span>HTTP的报文格式</span></h4><p><span>HTTP</span><strong><span>是面向文本的</span></strong><span>，其报文中的每一个字段都是一些ASCII码串，并且</span><strong><span>每个字段的长度都是不确定的</span></strong><span>。</span></p><p>&nbsp;</p><h5 id='http请求报文'><span>HTTP请求报文</span></h5><p><img src="./库/image-20230522211847642.png" alt="image-20230522211847642" style="zoom:25%;" /></p><p><img src="./库/image-20230522211910126.png" alt="image-20230522211910126" style="zoom:33%;" /></p><p><img src="./库/image-20230522212030799.png" referrerpolicy="no-referrer" alt="image-20230522212030799"></p><p>&nbsp;</p><h5 id='http响应报文'><span>HTTP响应报文</span></h5><p><img src="./库/image-20230522212315180.png" referrerpolicy="no-referrer" alt="image-20230522212315180"></p><p>&nbsp;</p><p>&nbsp;</p><h3 id='使用cookie在服务器上记录信息'><span>使用Cookie在服务器上记录信息</span></h3><p><span>早期的万维网应用非常简单，仅仅是用户查看存放在不同服务器上的各种静态的文档。因此HTTP被设计为一种无状态的协议。这样可以简化服务器的设计。</span></p><p><span>现在，用户可以通过万维网进行各种复杂的应用，如网上购物、电子商务等。这些应用往往需要万维网服务器能够识别用户。</span></p><p><span>Cookie提供了一种机制使得万维网服务器能够“记住”用户，而无需用户主动提供用户标识信息。也就是说，</span><strong><span>Cookie是一种对无状态的HTTP进行状态化的技术</span></strong><span>。</span></p><p>&nbsp;</p><p><img src="./库/image-20230522213411415.png" referrerpolicy="no-referrer" alt="image-20230522213411415"></p><p>&nbsp;</p><h3 id='万维网缓存与代理服务器'><span>万维网缓存与代理服务器</span></h3><p><span>在万维网中还可以使用缓存机制以提高万维网的效率。</span></p><p><span>万维网缓存又称为Web缓存（Web Cache），可位于客户机，也可位于中间系统上，位于中间系统上的Web缓存又称为代理服务器（Proxy Server）。</span></p><p><span>Web缓存把最近的一些请求和响应暂存在本地磁盘中。当新请求到达时，若发现这个请求与暂时存放的请求相同，就返回暂存的响应，而不需要按URL的地址再次去因特网访问该资源。</span></p><p>&nbsp;</p><p><img src="./库/image-20230522223254818.png" referrerpolicy="no-referrer" alt="image-20230522223254818"></p></div></div>
</body>
<!-- <script src="http://code.jquery.com/jquery-1.7.2.min.js"></script> -->
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="http://yandex.st/highlightjs/6.2/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<!--侧栏目录生成代码-->
<script>
    //标题序号计数器
    var hCount = [0, 0, 0, 0, 0, 0];

    //设置计数器
    function setHCount(number) {
        //当前计数器加一
        hCount[number - 1]++;
        for (var i = number, length = hCount.length; i < length; i++) {
            //子目录计数器全部置零
            hCount[i] = 0;
        }
    }

    //重命名目录名称
    function setHTagValue(item, number) {
        //获取标题名
        var text = $(item).get(0).innerHTML;
        //初始化空字符串
        var before = "";
        //生成序号
        for (var i = 0, length = hCount.length; i < number; i++) {
            if (i < number - 1)
                before += hCount[i] + ".";
            else
                before += hCount[i] + " ";
        }
        //在标题前面加上序号
        $(item).get(0).innerHTML = before + text;
    }

    function renameHTag(item) {
        var tag = $(item).get(0).localName;
        if (tag === "h1") {
            setHCount(1);
            //console\.log("捕获到标签:%s", tag);
            setHTagValue(item, 1);
        }
        if (tag === "h2") {
            setHCount(2);
            //console.log("捕获到标签:%s", tag);
            setHTagValue(item, 2);
        }
        if (tag === "h3") {
            setHCount(3);
            //console.log("捕获到标签:%s", tag);
            setHTagValue(item, 3);
        }
        if (tag === "h4") {
            setHCount(4);
            //console.log("捕获到标签:%s", tag);
            setHTagValue(item, 4);
        }
        if (tag === "h5") {
            setHCount(5);
            //console.log("捕获到标签:%s", tag);
            setHTagValue(item, 5);
        }
        if (tag === "h6") {
            setHCount(6);
            //console.log("捕获到标签:%s", tag);
            setHTagValue(item, 6)
        }
    }

    $(document).ready(function () {
        $("h1,h2,h3,h4,h5,h6").each(function (i, item) {
            //给<H>类标签编号
            renameHTag(item);
            //获取标签的名字,h1,还是h2
            var tag = $(item).get(0).localName;
            //为该标签设置id属性
            $(item).attr("id", "wow" + i);
            //添加一个页内超链接,并设置class选择器
            //      $("#category").append('<a class="new'+tag+'" href="#wow'+i+'">'+$(this).text()+'</a></br>');
            $("#category").append('<a class="new' + tag + '" href="#wow' + i + '">' + $(item).text() + '</a></br>');
            //为每一个标题超链接的class属性设置左边距
            $(".newh1").css("margin-left", 0);
            $(".newh2").css("margin-left", 20);
            $(".newh3").css("margin-left", 40);
            $(".newh4").css("margin-left", 60);
            $(".newh5").css("margin-left", 80);
            $(".newh6").css("margin-left", 100);
        });
        //设置class选择器为.book-body的html内容
        $(".book-body").html($(".book-body").nextAll())
    });
</script>
<style type="text/css">
    @media (max-width: 1600px) {
        .book-body {
            /* padding-left: 200px; */
            padding-right: 0px;
        }
    }

    @media (max-width: 1400px) {
        .book-body {
            /* padding-left: 200px; */
            padding-right: 0px;
        }
    }

    @media (max-width: 1200px) {
        .book-body {
            /* padding-left: 300px; */
            padding-left: 0px;
        }
    }

    @media (max-width: 700px) {
        .book-body {
            padding-left: 0px;
        }
    }

    @media (min-width: 600px) {
        #category {
            /* 绝对定位 */
            position: fixed;
            /* left: 20px; */
            /* 目录显示的位置 */
            left: 0px;
            top: 0;
            /* 目录栏的高度,这里设置为60%主要是为了不挡住返回顶部和折叠按钮 */
            height: 79%;
            /* 开启垂直滚动条 */
            overflow-y: scroll;
            /* 开启水平滚动条 */
            overflow-x: scroll;
        }
    }

    @media (-webkit-max-device-pixel-ratio: 1) {
        ::-webkit-scrollbar-track-piece {
            background-color: #FFF
        }

        ::-webkit-scrollbar {
            width: 6px;
            height: 6px
        }

        ::-webkit-scrollbar-thumb {
            background-color: #c2c2c2;
            background-clip: padding-box;
            min-height: 28px
        }

        ::-webkit-scrollbar-thumb:hover {
            background-color: #A0A0A0
        }
    }
</style>
<script>
    // id="category" οnclick="showOrCloseCategory()"
    function showOrCloseCategory() {
        var id = document.getElementById("category");
        var book_body = document.getElementById("book_body");
        //如果展开了
        if (id.style.display == 'block') {
            //console.log("开始展开");
            id.style.display = 'none';
            id.style.width = "0%";
            book_body.style.width = "100%";
            book_body.style.paddingleft = 0;
        }
        //如果被折叠了
        else if (id.style.display == 'none') {
            //console.log("开始折叠");
            id.style.display = 'block';
            book_body.style.width = "90%";
            id.style.width = "20%"
        }
    }
</script>
<!--返回顶部-->
<a href="javascript:scroll(0,0)" style="position:fixed;float:right;left:40px;top:80%">返回顶部</a>
<button onclick="showOrCloseCategory()" style="position:fixed;float:right;left:40px;top:85%">折叠/展开</button>
<!--文章主体部分-->
<div class="book-body" id="book_body" style="width:90%;display:block"></div>
<!--目录栏，设置占用宽度为20%可以根据实际情况设置-->
<div class="book-summary" id="category" style="width:20%;display:block"></div>


</html>